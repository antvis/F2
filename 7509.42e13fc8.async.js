"use strict";(self.webpackChunk_antv_f2_site=self.webpackChunk_antv_f2_site||[]).push([[7509],{67509:function(e,t,n){n.r(t),n.d(t,{SandpackNode:function(){return Ee}});var r=n(66575),i=n(35118),o=n(17662),s=n(31404),a=n(81486),c=n(5486),u=n(30702),l=n(97374),d=n(65225),h=n(72242),f=n(15821),p=n(43400),v=n(90907),m=n(420),w=n(4143),y=n(4112),g=n(8154),b=n(61341),k=n(10779),_=n(79746),P=n(34944),x=Object.create,E=Object.defineProperty,S=Object.getOwnPropertyDescriptor,j=Object.getOwnPropertyNames,I=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,C=function(e,t){return function(){return t||(0,e[j(e)[0]])((t={exports:{}}).exports,t),t.exports}},M=function(e,t,n){return n=null!=e?x(I(e)):{},function(e,t,n,r){if(t&&"object"===P(t)||"function"==typeof t){var i,o=_(j(t));try{var s=function(){var o=i.value;L.call(e,o)||o===n||E(e,o,{get:function(){return t[o]},enumerable:!(r=S(t,o))||r.enumerable})};for(o.s();!(i=o.n()).done;)s()}catch(e){o.e(e)}finally{o.f()}}return e}(!t&&e&&e.__esModule?n:E(n,"default",{value:e,enumerable:!0}),e)},F=function(e,t,n){return function(e,t,n){t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n}(e,"symbol"!==P(t)?t+"":t,n),n},O=function(e,t,n){if(!t.has(e))throw TypeError("Cannot "+n)},A=function(e,t,n){return O(e,t,"read from private field"),n?n.call(e):t.get(e)},D=function(e,t,n){if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},U=function(e,t,n,r){return O(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n},T=function(e,t,n){return O(e,t,"access private method"),n},R=C({"../../node_modules/.pnpm/cuid@2.1.8/node_modules/cuid/lib/pad.js":function(e,t){t.exports=function(e,t){var n="000000000"+e;return n.substr(n.length-t)}}}),W=C({"../../node_modules/.pnpm/cuid@2.1.8/node_modules/cuid/lib/fingerprint.browser.js":function(e,t){var n=R(),r="object"===("undefined"==typeof window?"undefined":P(window))?window:self,i=Object.keys(r).length,o=n(((navigator.mimeTypes?navigator.mimeTypes.length:0)+navigator.userAgent.length).toString(36)+i.toString(36),4);t.exports=function(){return o}}}),N=C({"../../node_modules/.pnpm/cuid@2.1.8/node_modules/cuid/lib/getRandomValue.browser.js":function(e,t){var n,r,i="undefined"!=typeof window&&(window.crypto||window.msCrypto)||"undefined"!=typeof self&&self.crypto;i?(r=Math.pow(2,32)-1,n=function(){return Math.abs(i.getRandomValues(new Uint32Array(1))[0]/r)}):n=Math.random,t.exports=n}}),H=C({"../../node_modules/.pnpm/cuid@2.1.8/node_modules/cuid/index.js":function(e,t){var n=W(),r=R(),i=N(),o=0,s=Math.pow(36,4);function a(){return r((i()*s<<0).toString(36),4)}function c(){return o=o<s?o:0,++o-1}function u(){return"c"+(new Date).getTime().toString(36)+r(c().toString(36),4)+n()+(a()+a())}u.slug=function(){var e=(new Date).getTime().toString(36),t=c().toString(36).slice(-4),r=n().slice(0,1)+n().slice(-1),i=a().slice(-2);return e.slice(-2)+t+r+i},u.isCuid=function(e){return"string"==typeof e&&!!e.startsWith("c")},u.isSlug=function(e){if("string"!=typeof e)return!1;var t=e.length;return t>=7&&t<=10},u.fingerprint=n,t.exports=u}}),B=C({"../../node_modules/.pnpm/@open-draft+deferred-promise@2.1.0/node_modules/@open-draft/deferred-promise/build/createDeferredExecutor.js":function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createDeferredExecutor=void 0,e.createDeferredExecutor=function(){return function e(t,n){e.state="pending",e.resolve=function(n){if("pending"===e.state){e.result=n;return t(n instanceof Promise?n:Promise.resolve(n).then((function(t){return e.state="fulfilled",t})))}},e.reject=function(t){if("pending"===e.state)return queueMicrotask((function(){e.state="rejected"})),n(e.rejectionReason=t)}}}}}),V=C({"../../node_modules/.pnpm/@open-draft+deferred-promise@2.1.0/node_modules/@open-draft/deferred-promise/build/DeferredPromise.js":function(e){var t,n;Object.defineProperty(e,"__esModule",{value:!0}),e.DeferredPromise=void 0;var r=B(),i=(t=new WeakMap,n=new WeakSet,function(e){f(s,e);var i=p(s);function s(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;c(this,s);var a=(0,r.createDeferredExecutor)();return e=i.call(this,(function(e,t){a(e,t),null==o||o(a.resolve,a.reject)})),m(l(e),n),y(l(e),t,{writable:!0,value:void 0}),w(l(e),"resolve",void 0),w(l(e),"reject",void 0),k(l(e),t,a),e.resolve=b(l(e),t).resolve,e.reject=b(l(e),t).reject,e}return u(s,[{key:"state",get:function(){return b(this,t).state}},{key:"rejectionReason",get:function(){return b(this,t).rejectionReason}},{key:"then",value:function(e,t){return g(this,n,o).call(this,d(h(s.prototype),"then",this).call(this,e,t))}},{key:"catch",value:function(e){return g(this,n,o).call(this,d(h(s.prototype),"catch",this).call(this,e))}},{key:"finally",value:function(e){return g(this,n,o).call(this,d(h(s.prototype),"finally",this).call(this,e))}}]),s}(v(Promise)));function o(e){return Object.defineProperties(e,{resolve:{configurable:!0,value:this.resolve},reject:{configurable:!0,value:this.reject}})}e.DeferredPromise=i}}),z=C({"../../node_modules/.pnpm/@open-draft+deferred-promise@2.1.0/node_modules/@open-draft/deferred-promise/build/index.js":function(e){var t=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),n=e&&e.__exportStar||function(e,n){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(n,r)||t(n,e,r)};Object.defineProperty(e,"__esModule",{value:!0}),n(B(),e),n(V(),e)}}),J=C({"../../node_modules/.pnpm/strict-event-emitter@0.4.3/node_modules/strict-event-emitter/lib/MemoryLeakError.js":function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MemoryLeakError=void 0;var t=function(e){f(n,e);var t=p(n);function n(e,r,i){var o;return c(this,n),o=t.call(this,"Possible EventEmitter memory leak detected. ".concat(i," ").concat(r.toString()," listeners added. Use emitter.setMaxListeners() to increase limit")),w(l(o),"emitter",void 0),w(l(o),"type",void 0),w(l(o),"count",void 0),o.emitter=e,o.type=r,o.count=i,o.name="MaxListenersExceededWarning",o}return u(n)}(v(Error));e.MemoryLeakError=t}}),q=C({"../../node_modules/.pnpm/strict-event-emitter@0.4.3/node_modules/strict-event-emitter/lib/Emitter.js":function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Emitter=void 0;var t,n,r,i,o,s,a,l,d,h,f,p=J(),v=function(){function e(){c(this,e),D(this,i),D(this,s),D(this,l),D(this,h),D(this,t,void 0),D(this,n,void 0),D(this,r,void 0),U(this,t,new Map),U(this,n,e.defaultMaxListeners),U(this,r,!1)}return u(e,[{key:"setMaxListeners",value:function(e){return U(this,n,e),this}},{key:"getMaxListeners",value:function(){return A(this,n)}},{key:"eventNames",value:function(){return Array.from(A(this,t).keys())}},{key:"emit",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];var a=T(this,i,o).call(this,e);return a.forEach((function(e){e.apply(t,r)})),a.length>0}},{key:"addListener",value:function(e,s){T(this,h,f).call(this,"newListener",e,s);var a=T(this,i,o).call(this,e).concat(s);if(A(this,t).set(e,a),A(this,n)>0&&this.listenerCount(e)>A(this,n)&&!A(this,r)){U(this,r,!0);var c=new p.MemoryLeakError(this,e,this.listenerCount(e));console.warn(c)}return this}},{key:"on",value:function(e,t){return this.addListener(e,t)}},{key:"once",value:function(e,t){return this.addListener(e,T(this,l,d).call(this,e,t))}},{key:"prependListener",value:function(e,n){var r=T(this,i,o).call(this,e);if(r.length>0){var s=[n].concat(r);A(this,t).set(e,s)}else A(this,t).set(e,r.concat(n));return this}},{key:"prependOnceListener",value:function(e,t){return this.prependListener(e,T(this,l,d).call(this,e,t))}},{key:"removeListener",value:function(e,n){var r=T(this,i,o).call(this,e);return r.length>0&&(T(this,s,a).call(this,r,n),A(this,t).set(e,r),T(this,h,f).call(this,"removeListener",e,n)),this}},{key:"off",value:function(e,t){return this.removeListener(e,t)}},{key:"removeAllListeners",value:function(e){return e?A(this,t).delete(e):A(this,t).clear(),this}},{key:"listeners",value:function(e){return Array.from(T(this,i,o).call(this,e))}},{key:"listenerCount",value:function(e){return T(this,i,o).call(this,e).length}},{key:"rawListeners",value:function(e){return this.listeners(e)}}],[{key:"listenerCount",value:function(e,t){return e.listenerCount(t)}}]),e}(),m=v;t=new WeakMap,n=new WeakMap,r=new WeakMap,i=new WeakSet,o=function(e){return A(this,t).get(e)||[]},s=new WeakSet,a=function(e,t){var n=e.indexOf(t);return n>-1&&e.splice(n,1),[]},l=new WeakSet,d=function(e,t){var n=this;return function r(){n.removeListener(e,r);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];t.apply(n,o)}},h=new WeakSet,f=function(e,t,n){this.emit.apply(this,[e].concat([t,n]))},F(m,"defaultMaxListeners",10),e.Emitter=m}}),G=C({"../../node_modules/.pnpm/strict-event-emitter@0.4.3/node_modules/strict-event-emitter/lib/index.js":function(e){var t=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),n=e&&e.__exportStar||function(e,n){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(n,r)||t(n,e,r)};Object.defineProperty(e,"__esModule",{value:!0}),n(q(),e),n(J(),e)}}),K=M(H()),$=/(%?)(%([sdjo]))/g;function Q(e,t){switch(t){case"s":return e;case"d":case"i":return Number(e);case"j":return JSON.stringify(e);case"o":if("string"==typeof e)return e;var n=JSON.stringify(e);return"{}"===n||"[]"===n||/^\[object .+?\]$/.test(n)?e:n}}function X(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(0===n.length)return e;var i=0,o=e.replace($,(function(e,t,r,o){var s=Q(n[i],o);return t?e:(i++,s)}));return i<n.length&&(o+=" ".concat(n.slice(i).join(" "))),o=o.replace(/%{2,2}/g,"%")}function Y(e){if(e.stack){var t=e.stack.split("\n");t.splice(1,2),e.stack=t.join("\n")}}var Z=function(e){f(n,e);var t=p(n);function n(e){var r;c(this,n),(r=t.call(this,e)).message=e,r.name="Invariant Violation";for(var i=arguments.length,o=new Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];return r.message=X.apply(void 0,[e].concat(o)),Y(l(r)),r}return u(n)}(v(Error)),ee=function(e,t){if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];throw a(Z,[t].concat(r))}};ee.as=function(e,t,n){if(!t){for(var r=null!=e.prototype.name,i=arguments.length,o=new Array(i>3?i-3:0),s=3;s<i;s++)o[s-3]=arguments[s];var a=r?new e(X(n,o)):e(X(n,o));throw a}};var te=M(z()),ne=window.localStorage.CSB_EMULATOR_DEBUG,re="[0m",ie="[32;1m",oe="[31m",se="[36;1m",ae={preview:"[33;1m",emulator:"[35;1m",runtime:se,bridge:"[34m","runtime:worker":se};function ce(e){return function(t){if("true"===ne){for(var n,r=function(){return t.includes("sender")?"".concat(ie,"sender"):t.includes("receiver")?"".concat(oe,"receiver"):""},i=t.replace(/\[.+\]:/,""),o=arguments.length,s=new Array(o>1?o-1:0),a=1;a<o;a++)s[a-1]=arguments[a];(n=console).debug.apply(n,["".concat(ae[e]).concat(e,":").concat(r()).concat(re,":").concat(i)].concat(s))}}}var ue=ce("emulator"),le=function(){function e(t){var n=this;c(this,e),w(this,"emitter",void 0),w(this,"channel",void 0),w(this,"receiverPort",void 0),w(this,"receiverReadyPromise",void 0),this.target=t,this.emitter=new EventTarget,this.channel=new MessageChannel,this.receiverPort=this.channel.port1;var r=new te.DeferredPromise,i=function(e){"internal/ready"===e.data.type&&(ue("[message-sender]: runtime is ready"),r.resolve())};window.addEventListener("message",i),r.then((function(){window.removeEventListener("message",i)})),this.receiverReadyPromise=r,this.receiverPort.onmessage=function(e){var t=e.data;null!=t.type&&(ue('[message-sender]: emitting "%s" event...',t.type,t.payload),n.emitter.dispatchEvent(new MessageEvent(t.type,{data:t.payload})))}}var t,n;return u(e,[{key:"handshake",value:(n=s(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new te.DeferredPromise,e.next=3,this.receiverReadyPromise;case 3:return ue("[message-sender]: sending handshake"),this.target.postMessage({type:"internal/handshake"},"*",[this.channel.port2]),this.on("internal/handshake/done",(function(){t.resolve(),clearTimeout(n)})),n=setTimeout((function(){t.reject(new Error("MessageSender: Handshake timeout"))}),5e3),e.abrupt("return",t);case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"on",value:function(e,t,n){ue('[message-sender]: add listener "%s"',e),this.emitter.addEventListener(e,(function(e){e instanceof MessageEvent&&t(e)}),n)}},{key:"off",value:function(e,t,n){this.emitter.removeEventListener(e,t,n)}},{key:"send",value:(t=s(o().mark((function e(t){var n,r,s,a,c,u=this,l=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new te.DeferredPromise,r=(0,K.default)(),s=(l.length<=1?void 0:l[1])||{},ue('[message-sender]: send "%s" (%s)',t,r,s),this.receiverPort.postMessage({type:t,payload:{operationId:r,payload:s}}),ue('[message-sender]: adding done listener for "%s" (%s)',t,r),a=function(e){var o=e.data;if(o.operationId===r){var s=o.listenerPayload||{};ue('[message-sender]: resolving "%s (%s) promise!',t,r),n.resolve(i(i({},s),{},{operationId:o.operationId}))}},c=function(e){var i=e.data;i.operationId===r&&(ue('[message-sender]: rejecting "%s (%s) promise!',t,r),n.reject(i.error))},this.on("internal/operation/done",a),this.on("internal/operation/failed",c),e.abrupt("return",n.finally((function(){u.emitter.removeEventListener("internal/operation/done",a),u.emitter.removeEventListener("internal/operation/failed",c)})));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),de=M(z()),he=M(H()),fe=function(){function e(t){c(this,e),this.channel=t}var t,n,r,a,l,d,h,f;return u(e,[{key:"init",value:(f=s(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.channel.send("fs/init",{files:t});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"readFile",value:(h=s(o().mark((function e(t,n){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.channel.send("fs/readFile",{path:t,encoding:n}).catch((function(e){throw new Error(X('Failed to read file at path "%s"',t),{cause:e})}));case 2:if(r=e.sent){e.next=5;break}throw new Error("File not found");case 5:return e.abrupt("return",r.data);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"writeFile",value:(d=s(o().mark((function e(t,n,r){var i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=void 0,s=!1,"object"===P(r)?(i=r.encoding,s=!!r.recursive):"string"==typeof r&&(i=r),e.next=5,this.channel.send("fs/writeFile",{path:t,content:n,encoding:i,recursive:s}).catch((function(e){throw new Error(X('Failed to write file at path "%s"',t),{cause:e})}));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"readdir",value:(l=s(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.channel.send("fs/readdir",{path:t}).catch((function(e){throw new Error(X('Failed to read directory at path "%s"',t),{cause:e})}));case 2:if(n=e.sent){e.next=5;break}throw new Error("Directory not found");case 5:return e.abrupt("return",n.data);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"mkdir",value:(a=s(o().mark((function e(t,n){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(null==n||!n.recursive),e.next=3,this.channel.send("fs/mkdir",{path:t,recursive:r}).catch((function(e){throw new Error(X('Failed to make directory at path "%s"',t),{cause:e})}));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"stat",value:(r=s(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.channel.send("fs/stat",{path:t}).catch((function(e){throw new Error(X('Failed to stat file at path "%s"',t),{cause:e})}));case 2:if(n=e.sent){e.next=5;break}throw new Error("File not found");case 5:return e.abrupt("return",n.data);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"rm",value:(n=s(o().mark((function e(t,n){var r,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(r=n||{}).force,s=r.recursive,e.next=3,this.channel.send("fs/rm",{path:t,force:i,recursive:s}).catch((function(e){throw new Error(X('Failed to remove file at path "%s"',t),{cause:e})}));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"watch",value:(t=s(o().mark((function e(t,n,r){var s,a=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,he.default)(),e.next=3,this.channel.send("fs/watch",{watcherId:s,includes:t,excludes:n});case 3:return this.channel.on("fs/watch-event",(function(e){var t=e.data;if(t.watcherId===s&&r){var n=i({},t);delete n.watcherId,r(n)}})),e.abrupt("return",{dispose:function(){return a.channel.send("fs/unwatch",{watcherId:s})}});case 5:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}(),pe=M(G()),ve=function(){function e(t){c(this,e),this.channel=t}return u(e,[{key:"create",value:function(){return new me(this.channel)}}]),e}(),me=function(){function e(t){var n=this;c(this,e),w(this,"id",void 0),w(this,"state",void 0),w(this,"stdout",void 0),w(this,"stderr",void 0),w(this,"stdin",void 0),this.channel=t,this.state="running",this.stdout=new pe.Emitter,this.stderr=new pe.Emitter,this.stdin={write:function(e){if(!n.id)throw new Error("Failed to write to stdin, no process is currently running");return n.channel.send("shell/stdin",{data:e,workerId:n.id})}},this.forwardStdEvents()}var t,n,r;return u(e,[{key:"forwardStdEvents",value:function(){var e=this;this.channel.on("worker/tty",(function(t){var n=t.data;if(n.workerId===e.id)switch(n.payload.type){case"out":e.stdout.emit("data",n.payload.data);break;case"err":e.stderr.emit("data",n.payload.data)}}))}},{key:"runCommand",value:(r=s(o().mark((function e(t,n){var r,i,s=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},ee(!this.id,'Failed to run "runCommand" on a ShellProcess: there is already a process running.'),e.next=4,this.channel.send("shell/runCommand",{command:t,args:n,options:r});case 4:return i=e.sent,ee(i,'Failed to run "runCommand" on a ShellProcess: was not able to retrieve a running process.'),this.id=i.id,this.state="running",e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"on",value:(n=s(o().mark((function e(t,n){var r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="progress"===e.t0?3:"exit"===e.t0?5:7;break;case 3:return this.channel.on("worker/progress",(function(e){var t=e.data;n(t.status)})),e.abrupt("return");case 5:return this.channel.on("worker/exit",(function(e){var t=e.data;t.workerId===r.id&&n(t.exitCode,t.error)})),e.abrupt("return");case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"kill",value:(t=s(o().mark((function e(){var t=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ee(this.id,'Failed to run "kill" on a ShellProcess: there is no process running. Did you forget to run it?'),this.state="idle",e.next=4,this.channel.send("shell/exit",{id:this.id}).catch((function(e){throw new Error(X('Failed to kill shell with ID "%s"',t.id),{cause:e})}));case 4:this.id=void 0;case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),we=M(z()),ye=function(){function e(t){c(this,e),this.channel=t}var t,n,r;return u(e,[{key:"waitFor",value:(r=s(o().mark((function e(t,n){var r,i,s,a,c,u=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]?u[2]:2e4,i=new we.DeferredPromise,s=setTimeout((function(){i.reject()}),r),e.next=5,this.channel.send("preview/get/info",t).catch((function(e){i.reject(new Error(X('Failed to look up preview information for shell ID "%s" (port: %d)',t.sourceShellId,t.port)))}));case 5:return a=e.sent,(c=a&&n(a))&&i.resolve({url:a.url,port:a.port,sourceShellId:a.sourceShellId}),this.channel.on("preview/port/ready",(function(e){var t=e.data;!c&&n(t)&&i.resolve({url:t.url,port:t.port,sourceShellId:t.sourceShellId})})),e.abrupt("return",i.finally((function(){clearTimeout(s)})));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"getByShellId",value:(n=s(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.waitFor({sourceShellId:t},(function(e){return e.sourceShellId===t}),n).catch((function(e){throw new Error(X('Failed to get shell by ID "%s"',t),{cause:e})})));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"waitForPort",value:(t=s(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.waitFor({port:t},(function(e){return e.port===t}),n).catch((function(e){throw new Error(X("Failed to await port %d",t),{cause:e})})));case 1:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}(),ge=ce("emulator"),be=function(){function e(t){c(this,e),w(this,"channel",null),w(this,"isConnected",void 0),w(this,"url",void 0),w(this,"fileSystemApi",null),w(this,"shellApi",null),w(this,"previewApi",null),this.options=t,ee(this.options.iframe,'Failed to create a Nodebox: expected "iframe" argument to be a reference to an <iframe> element but got %j',this.options.iframe),this.url=this.options.runtimeUrl||"https://nodebox-runtime.codesandbox.io",this.isConnected=!1}var t;return u(e,[{key:"connect",value:(t=s(o().mark((function e(){var t,n,r,i,s,a=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.options,n=t.iframe,r=t.cdnUrl,ge("[message-sender]: Connecting to node emulator..."),i=new de.DeferredPromise,this.url||i.reject(new Error("Nodebox URL is missing. Did you forget to provide it when creating this Nodebox instance?")),ee(n.contentWindow,"Failed to create a MessageChannel with the Nodebox iframe: no content window found"),this.channel=new le(n.contentWindow),s=new de.DeferredPromise,n.setAttribute("src",this.url),n.addEventListener("load",(function(){s.resolve()}),{once:!0}),n.addEventListener("error",(function(e){s.reject(e.error)}),{once:!0}),e.next=12,s;case 12:return ge("[message-sender]: IFrame loaded..."),e.next=15,this.channel.handshake();case 15:return ge("[message-sender]: Handshake completed..."),this.channel.send("connect",{cdnUrl:r}),this.channel.on("runtime/ready",(function(){i.resolve()})),e.abrupt("return",i.then((function(){ge("[message-sender]: Connected to runtime..."),a.isConnected=!0})));case 19:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"fs",get:function(){return ee(this.isConnected,'Failed to access the File System API: consumer is not connected. Did you forget to run "connect()"?'),this.fileSystemApi||(this.fileSystemApi=new fe(this.channel)),this.fileSystemApi}},{key:"shell",get:function(){return ee(this.isConnected,'Failed to access the Shell API: consumer is not connected. Did you forget to run "connect()"?'),this.shellApi||(this.shellApi=new ve(this.channel)),this.shellApi}},{key:"preview",get:function(){return ee(this.isConnected,'Failed to access the Preview API: consumer is not connected. Did you forget to run "connect()"?'),this.previewApi||(this.previewApi=new ye(this.channel)),this.previewApi}}]),e}(),ke=n(80975),_e=n(44314);n(94179),n(52627);function Pe(e,t){return(0,r._)(this,void 0,void 0,(function(){var n,i,o;return(0,r.a)(this,(function(s){return n=e.contentWindow,(0,r.n)(n,"Failed to await preview iframe: no content window found"),9e4,20,i=0,[2,new Promise((function(n,s){e.addEventListener("error",(function(){return s(new Error("Iframe error"))})),e.addEventListener("abort",(function(){return s(new Error("Aborted"))})),function a(){var c=function t(){clearTimeout(o),i=20,n(),e.removeEventListener("load",t)};i>=20?s((0,r.c)("Could not able to connect to preview.")):(e.setAttribute("src",t),o=setTimeout((function(){a(),e.removeEventListener("load",c)}),9e4),i+=1,e.addEventListener("load",c))}()}))]}))}))}var xe=[{code:function(e){var t=e.scope,n=window.history.__proto__,r=[],i=0,o=function(e){parent.postMessage({type:"urlchange",url:e,back:i>0,forward:i<r.length-1,channelId:t.channelId},"*")};Object.assign(window.history,{go:function(e){var t=i+e;if(t>=0&&t<=r.length-1){var s=r[i=t],a=s.url,c=s.state;n.replaceState.call(window.history,c,"",a);var u=document.location.href;o(u),window.dispatchEvent(new PopStateEvent("popstate",{state:c}))}},back:function(){window.history.go(-1)},forward:function(){window.history.go(1)},pushState:function(e,t,s){n.replaceState.call(window.history,e,t,s),function(e,t){r.splice(i+1),r.push({url:e,state:t}),i=r.length-1}(s,e),o(document.location.href)},replaceState:function(e,t,s){n.replaceState.call(window.history,e,t,s),r[i]={state:e,url:s},o(document.location.href)}}),window.addEventListener("message",(function(e){var t=e.data;"urlback"===t.type?history.back():"urlforward"===t.type?history.forward():"refresh"===t.type&&document.location.reload()}))}.toString(),id:"historyListener"},{code:"function consoleHook({ scope }) {"+_e.c+"\n};",id:"consoleHook"},{code:function(e){var t,n=e.scope,r=0;function i(){var e=function(){if("undefined"==typeof window)return 0;var e=document.body,t=document.documentElement;return Math.max(e.scrollHeight,e.offsetHeight,t.offsetHeight)}();r!==e&&window.parent.postMessage({type:"resize",height:e,codesandbox:!0,channelId:n.channelId},"*"),r=e}i(),new MutationObserver((function(){void 0===t&&(i(),t=setTimeout((function(){t=void 0}),300))})).observe(document,{attributes:!0,childList:!0,subtree:!0}),setInterval(i,300)}.toString(),id:"watchResize"}],Ee=function(e){function t(t,n,i){void 0===i&&(i={});var o=e.call(this,t,n,(0,r.h)((0,r.h)({},i),{bundlerURL:i.bundlerURL}))||this;return o._modulesCache=new Map,o.messageChannelId=(0,_e.g)(),o._initPromise=null,o.emitter=new _e.E,o.manageIframes(t),o.emulator=new be({iframe:o.emulatorIframe,runtimeUrl:o.options.bundlerURL}),o.updateSandbox(n),o}return(0,r.g)(t,e),t.prototype._init=function(e){return(0,r._)(this,void 0,void 0,(function(){return(0,r.a)(this,(function(t){switch(t.label){case 0:return[4,this.emulator.connect()];case 1:return t.sent(),[4,this.emulator.fs.init(e)];case 2:return t.sent(),[4,this.globalListeners()];case 3:return t.sent(),[2]}}))}))},t.prototype.compile=function(e){return(0,r._)(this,void 0,void 0,(function(){var t,n;return(0,r.a)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.status="initializing",this.dispatch({type:"start",firstLoad:!0}),this._initPromise||(this._initPromise=this._init(e)),[4,this._initPromise];case 1:return r.sent(),this.dispatch({type:"connected"}),[4,this.createShellProcessFromTask(e)];case 2:return t=r.sent().id,[4,this.createPreviewURLFromId(t)];case 3:return r.sent(),[4,this.setLocationURLIntoIFrame()];case 4:return r.sent(),this.dispatchDoneMessage(),[3,6];case 5:return n=r.sent(),this.dispatch({type:"action",action:"notification",notificationType:"error",title:(0,_e.a)(n)}),this.dispatch({type:"done",compilatonError:!0}),[3,6];case 6:return[2]}}))}))},t.prototype.createShellProcessFromTask=function(e){return(0,r._)(this,void 0,void 0,(function(){var t,n,i=this;return(0,r.a)(this,(function(o){switch(o.label){case 0:return t=(0,_e.r)(e["/package.json"]),this.emulatorCommand=(0,_e.b)(t),this.emulatorShellProcess=this.emulator.shell.create(),[4,this.emulatorShellProcess.on("exit",(function(e){i.dispatch({type:"action",action:"notification",notificationType:"error",title:(0,r.c)("Error: process.exit(".concat(e,") called."))})}))];case 1:return o.sent(),[4,this.emulatorShellProcess.on("progress",(function(e){var t,n;if("command_running"===e.state||"starting_command"===e.state)return i.dispatch({type:"shell/progress",data:(0,r.h)((0,r.h)({},e),{command:[null===(t=i.emulatorCommand)||void 0===t?void 0:t[0],null===(n=i.emulatorCommand)||void 0===n?void 0:n[1].join(" ")].join(" ")})}),void(i.status="installing-dependencies");i.dispatch({type:"shell/progress",data:e})}))];case 2:return o.sent(),this.emulatorShellProcess.stdout.on("data",(function(e){i.dispatch({type:"stdout",payload:{data:e,type:"out"}})})),this.emulatorShellProcess.stderr.on("data",(function(e){i.dispatch({type:"stdout",payload:{data:e,type:"err"}})})),[4,(n=this.emulatorShellProcess).runCommand.apply(n,this.emulatorCommand)];case 3:return[2,o.sent()]}}))}))},t.prototype.createPreviewURLFromId=function(e){var t;return(0,r._)(this,void 0,void 0,(function(){var n;return(0,r.a)(this,(function(r){switch(r.label){case 0:return this.iframePreviewUrl=void 0,[4,this.emulator.preview.getByShellId(e)];case 1:return n=r.sent().url,this.iframePreviewUrl=n+(null!==(t=this.options.startRoute)&&void 0!==t?t:""),[2]}}))}))},t.prototype.manageIframes=function(e){var t,n,i;if("string"==typeof e){var o=document.querySelector(e);(0,r.n)(o,"The element '".concat(e,"' was not found")),this.iframe=document.createElement("iframe"),null==o||o.appendChild(this.iframe)}else this.iframe=e;n=this.iframe,i=this.options,n.style.border="0",n.style.width=i.width||"100%",n.style.height=i.height||"100%",n.style.overflow="hidden",n.allow="cross-origin-isolated",(0,r.n)(this.iframe.parentNode,"The given iframe does not have a parent."),this.emulatorIframe=document.createElement("iframe"),this.emulatorIframe.classList.add("sp-bridge-frame"),null===(t=this.iframe.parentNode)||void 0===t||t.appendChild(this.emulatorIframe)},t.prototype.setLocationURLIntoIFrame=function(){return(0,r._)(this,void 0,void 0,(function(){return(0,r.a)(this,(function(e){switch(e.label){case 0:return this.iframePreviewUrl?[4,Pe(this.iframe,this.iframePreviewUrl)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.dispatchDoneMessage=function(){this.status="done",this.dispatch({type:"done",compilatonError:!1}),this.iframePreviewUrl&&this.dispatch({type:"urlchange",url:this.iframePreviewUrl,back:!1,forward:!1})},t.prototype.globalListeners=function(){return(0,r._)(this,void 0,void 0,(function(){var e=this;return(0,r.a)(this,(function(t){switch(t.label){case 0:return window.addEventListener("message",(function(t){var n,r;"PREVIEW_LOADED"===t.data.type&&(n=e.iframe,r=e.messageChannelId,xe.forEach((function(e){var t,i=e.code,o={uid:e.id,type:"INJECT_AND_INVOKE",code:"exports.activate = ".concat(i),scope:{channelId:r}};null===(t=n.contentWindow)||void 0===t||t.postMessage(o,"*")}))),"urlchange"===t.data.type&&t.data.channelId===e.messageChannelId?e.dispatch({type:"urlchange",url:t.data.url,back:t.data.back,forward:t.data.forward}):t.data.channelId===e.messageChannelId&&e.dispatch(t.data)})),[4,this.emulator.fs.watch(["*"],[".next","node_modules","build","dist","vendor",".config",".vuepress"],(function(t){return(0,r._)(e,void 0,void 0,(function(){var e,n,i,o,s;return(0,r.a)(this,(function(r){switch(r.label){case 0:return t?(n="newPath"in(e=t)?e.newPath:"path"in e?e.path:"",[4,this.emulator.fs.stat(n)]):[2];case 1:if("file"!==r.sent().type)return[2,null];r.label=2;case 2:switch(r.trys.push([2,10,,11]),e.type){case"change":case"create":return[3,3];case"remove":return[3,5];case"rename":return[3,6];case"close":return[3,8]}return[3,9];case 3:return[4,this.emulator.fs.readFile(e.path,"utf8")];case 4:return i=r.sent(),this.dispatch({type:"fs/change",path:e.path,content:i}),this._modulesCache.set(e.path,(0,_e.w)(i)),[3,9];case 5:return this.dispatch({type:"fs/remove",path:e.path}),this._modulesCache.delete(e.path),[3,9];case 6:return this.dispatch({type:"fs/remove",path:e.oldPath}),this._modulesCache.delete(e.oldPath),[4,this.emulator.fs.readFile(e.newPath,"utf8")];case 7:return o=r.sent(),this.dispatch({type:"fs/change",path:e.newPath,content:o}),this._modulesCache.set(e.newPath,(0,_e.w)(o)),[3,9];case 8:return[3,9];case 9:return[3,11];case 10:return s=r.sent(),this.dispatch({type:"action",action:"notification",notificationType:"error",title:(0,_e.a)(s)}),[3,11];case 11:return[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},t.prototype.restartShellProcess=function(){var e;return(0,r._)(this,void 0,void 0,(function(){return(0,r.a)(this,(function(t){switch(t.label){case 0:return this.emulatorShellProcess&&this.emulatorCommand?(this.dispatch({type:"start",firstLoad:!0}),this.status="initializing",[4,this.emulatorShellProcess.kill()]):[3,3];case 1:return t.sent(),null===(e=this.iframe)||void 0===e||e.removeAttribute("attr"),this.emulator.fs.rm("/node_modules/.vite",{recursive:!0,force:!0}),[4,this.compile(Object.fromEntries(this._modulesCache))];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},t.prototype.updateSandbox=function(e){var t,n=this,r=(0,_e.f)(e.files);"running"!==(null===(t=this.emulatorShellProcess)||void 0===t?void 0:t.state)?(this.dispatch({codesandbox:!0,modules:r,template:e.template,type:"compile"}),Object.entries(r).forEach((function(e){var t=e[0],r=e[1];n._modulesCache.set(t,(0,_e.w)(r))}))):Object.entries(r).forEach((function(e){var t=e[0],r=e[1];n._modulesCache.get(t)&&(0,_e.r)(r)===(0,_e.r)(n._modulesCache.get(t))||n.emulator.fs.writeFile(t,r,{recursive:!0})}))},t.prototype.dispatch=function(e){var t,n;return(0,r._)(this,void 0,void 0,(function(){return(0,r.a)(this,(function(r){switch(r.label){case 0:switch(e.type){case"compile":return[3,1];case"refresh":return[3,2];case"urlback":case"urlforward":return[3,4];case"shell/restart":return[3,5];case"shell/openPreview":return[3,6]}return[3,7];case 1:return this.compile(e.modules),[3,8];case 2:return[4,this.setLocationURLIntoIFrame()];case 3:return r.sent(),[3,8];case 4:return null===(n=null===(t=this.iframe)||void 0===t?void 0:t.contentWindow)||void 0===n||n.postMessage(e,"*"),[3,8];case 5:return this.restartShellProcess(),[3,8];case 6:return window.open(this.iframePreviewUrl,"_blank"),[3,8];case 7:this.emitter.dispatch(e),r.label=8;case 8:return[2]}}))}))},t.prototype.listen=function(e){return this.emitter.listener(e)},t.prototype.destroy=function(){this.emulatorIframe.remove(),this.emitter.cleanup()},t}(ke.S)}}]);