"use strict";(self.webpackChunk_antv_f2_site=self.webpackChunk_antv_f2_site||[]).push([[5243],{24612:function(e,t,n){n.d(t,{Th:function(){return Jf}});var r=n(34944),i=n.n(r),a=n(78643),o=n(54091),s=n(85545),l=n(62228),u=n(67538),c=n(96103),h=n(55332),d=n(38471),f=n(26186),v=n(47156),p=n(17517),g=n(88244),m=n(52810),y=n(38516),E=n(98773),_=n(43665),T=n(55072),S=n(79364),R=n(12873),A=n(24753),x=n(91508),k=n(53982),N=n(99107),M=n(57002),C=n(60241),b=n(31973),P=n(20773),O=n(50315),I=n(53894),w=n(76622),L=n(86703),D=n(70148),B=n(90176),F=n(17020),U=n(45327),Z=n(21254),G=n(57387),V=n(60286),W=n(67505),H=n(77280);function X(e,t,n,r){var i=e-n,a=t-r;return Math.sqrt(i*i+a*a)}function z(e,t){var n=Math.min.apply(Math,(0,c.Z)(e)),r=Math.min.apply(Math,(0,c.Z)(t));return{x:n,y:r,width:Math.max.apply(Math,(0,c.Z)(e))-n,height:Math.max.apply(Math,(0,c.Z)(t))-r}}function Y(e,t,n,r,i,a){return n*Math.cos(i)*Math.cos(a)-r*Math.sin(i)*Math.sin(a)+e}function j(e,t,n,r,i,a){return n*Math.sin(i)*Math.cos(a)+r*Math.cos(i)*Math.sin(a)+t}function K(e,t,n,r,i,a,o){for(var s=function(e,t,n){return Math.atan(-t/e*Math.tan(n))}(n,r,i),l=1/0,u=-1/0,c=[a,o],h=2*-Math.PI;h<=2*Math.PI;h+=Math.PI){var d=s+h;a<o?a<d&&d<o&&c.push(d):o<d&&d<a&&c.push(d)}for(var f=0;f<c.length;f++){var v=Y(e,0,n,r,i,c[f]);v<l&&(l=v),v>u&&(u=v)}for(var p=function(e,t,n){return Math.atan(t/(e*Math.tan(n)))}(n,r,i),g=1/0,m=-1/0,y=[a,o],E=2*-Math.PI;E<=2*Math.PI;E+=Math.PI){var _=p+E;a<o?a<_&&_<o&&y.push(_):o<_&&_<a&&y.push(_)}for(var T=0;T<y.length;T++){var S=j(0,t,n,r,i,y[T]);S<g&&(g=S),S>m&&(m=S)}return{x:l,y:g,width:u-l,height:m-g}}function q(e,t,n,r){return X(e,t,n,r)}function $(e,t,n,r,i){return{x:(1-i)*e+i*n,y:(1-i)*t+i*r}}function Q(e,t,n,r,i){var a=1-i;return a*a*a*e+3*t*i*a*a+3*n*i*i*a+r*i*i*i}function J(e,t,n,r){var i,a,o,s=-3*e+9*t-9*n+3*r,l=6*e-12*t+6*n,u=3*t-3*e,c=[];if((0,N.Z)(s,0))(0,N.Z)(l,0)||(i=-u/l)>=0&&i<=1&&c.push(i);else{var h=l*l-4*s*u;(0,N.Z)(h,0)?c.push(-l/(2*s)):h>0&&(a=(-l-(o=Math.sqrt(h)))/(2*s),(i=(-l+o)/(2*s))>=0&&i<=1&&c.push(i),a>=0&&a<=1&&c.push(a))}return c}function ee(e,t,n,r,i,a,o,s){for(var l=[e,o],u=[t,s],c=J(e,n,i,o),h=J(t,r,a,s),d=0;d<c.length;d++)l.push(Q(e,n,i,o,c[d]));for(var f=0;f<h.length;f++)u.push(Q(t,r,a,s,h[f]));return z(l,u)}function te(e){if(e.length<2)return 0;for(var t=0,n=0;n<e.length-1;n++){var r=e[n],i=e[n+1];t+=X(r[0],r[1],i[0],i[1])}return t}function ne(e,t,n,r){var i=1-r;return i*i*e+2*r*i*t+r*r*n}function re(e,t,n){var r=e+n-2*t;if((0,N.Z)(r,0))return[.5];var i=(e-t)/r;return i<=1&&i>=0?[i]:[]}function ie(e,t,n,r,i,a){var o=re(e,n,i)[0],s=re(t,r,a)[0],l=[e,i],u=[t,a];return void 0!==o&&l.push(ne(e,n,i,o)),void 0!==s&&u.push(ne(t,r,a,s)),z(l,u)}var ae=n(77135),oe=n(4933),se=n(24395),le=n(76895),ue=function(e){return e.GROUP="g",e.FRAGMENT="fragment",e.CIRCLE="circle",e.ELLIPSE="ellipse",e.IMAGE="image",e.RECT="rect",e.LINE="line",e.POLYLINE="polyline",e.POLYGON="polygon",e.TEXT="text",e.PATH="path",e.HTML="html",e.MESH="mesh",e}({}),ce=function(e){return e[e.ZERO=0]="ZERO",e[e.NEGATIVE_ONE=1]="NEGATIVE_ONE",e}({}),he=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.plugins=[]}),[{key:"addRenderingPlugin",value:function(e){this.plugins.push(e),this.context.renderingPlugins.push(e)}},{key:"removeAllRenderingPlugins",value:function(){var e=this;this.plugins.forEach((function(t){var n=e.context.renderingPlugins.indexOf(t);n>=0&&e.context.renderingPlugins.splice(n,1)}))}}])}(),de=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.clipSpaceNearZ=ce.NEGATIVE_ONE,this.plugins=[],this.config=(0,u.Z)({enableDirtyCheck:!0,enableCulling:!1,enableAutoRendering:!0,enableDirtyRectangleRendering:!0,enableDirtyRectangleRenderingDebug:!1,enableSizeAttenuation:!0,enableRenderingOptimization:!1},t)}),[{key:"registerPlugin",value:function(e){-1===this.plugins.findIndex((function(t){return t===e}))&&this.plugins.push(e)}},{key:"unregisterPlugin",value:function(e){var t=this.plugins.findIndex((function(t){return t===e}));t>-1&&this.plugins.splice(t,1)}},{key:"getPlugins",value:function(){return this.plugins}},{key:"getPlugin",value:function(e){return this.plugins.find((function(t){return t.name===e}))}},{key:"getConfig",value:function(){return this.config}},{key:"setConfig",value:function(e){Object.assign(this.config,e)}}])}(),fe=f.add,ve=f.copy,pe=f.max,ge=f.min,me=f.scale,ye=f.sub,Ee=function(){function e(){(0,o.Z)(this,e),this.center=[0,0,0],this.halfExtents=[0,0,0],this.min=[0,0,0],this.max=[0,0,0]}return(0,a.Z)(e,[{key:"update",value:function(e,t){ve(this.center,e),ve(this.halfExtents,t),ye(this.min,this.center,this.halfExtents),fe(this.max,this.center,this.halfExtents)}},{key:"setMinMax",value:function(e,t){fe(this.center,t,e),me(this.center,this.center,.5),ye(this.halfExtents,t,e),me(this.halfExtents,this.halfExtents,.5),ve(this.min,e),ve(this.max,t)}},{key:"getMin",value:function(){return this.min}},{key:"getMax",value:function(){return this.max}},{key:"add",value:function(t){if(!e.isEmpty(t))if(e.isEmpty(this))this.setMinMax(t.getMin(),t.getMax());else{var n=this.center,r=n[0],i=n[1],a=n[2],o=this.halfExtents,s=o[0],l=o[1],u=o[2],c=r-s,h=r+s,d=i-l,f=i+l,v=a-u,p=a+u,g=t.center,m=g[0],y=g[1],E=g[2],_=t.halfExtents,T=_[0],S=_[1],R=_[2],A=m-T,x=m+T,k=y-S,N=y+S,M=E-R,C=E+R;A<c&&(c=A),x>h&&(h=x),k<d&&(d=k),N>f&&(f=N),M<v&&(v=M),C>p&&(p=C),n[0]=.5*(c+h),n[1]=.5*(d+f),n[2]=.5*(v+p),o[0]=.5*(h-c),o[1]=.5*(f-d),o[2]=.5*(p-v),this.min[0]=c,this.min[1]=d,this.min[2]=v,this.max[0]=h,this.max[1]=f,this.max[2]=p}}},{key:"setFromTransformedAABB",value:function(e,t){var n=this.center,r=this.halfExtents,i=e.center,a=e.halfExtents,o=t[0],s=t[4],l=t[8],u=t[1],c=t[5],h=t[9],d=t[2],f=t[6],v=t[10],p=Math.abs(o),g=Math.abs(s),m=Math.abs(l),y=Math.abs(u),E=Math.abs(c),_=Math.abs(h),T=Math.abs(d),S=Math.abs(f),R=Math.abs(v);n[0]=t[12]+o*i[0]+s*i[1]+l*i[2],n[1]=t[13]+u*i[0]+c*i[1]+h*i[2],n[2]=t[14]+d*i[0]+f*i[1]+v*i[2],r[0]=p*a[0]+g*a[1]+m*a[2],r[1]=y*a[0]+E*a[1]+_*a[2],r[2]=T*a[0]+S*a[1]+R*a[2],ye(this.min,n,r),fe(this.max,n,r)}},{key:"intersects",value:function(e){var t=this.getMax(),n=this.getMin(),r=e.getMax(),i=e.getMin();return n[0]<=r[0]&&t[0]>=i[0]&&n[1]<=r[1]&&t[1]>=i[1]&&n[2]<=r[2]&&t[2]>=i[2]}},{key:"intersection",value:function(t){if(!this.intersects(t))return null;var n=new e,r=pe([0,0,0],this.getMin(),t.getMin()),i=ge([0,0,0],this.getMax(),t.getMax());return n.setMinMax(r,i),n}},{key:"getNegativeFarPoint",value:function(e){return 273===e.pnVertexFlag?ve([0,0,0],this.min):272===e.pnVertexFlag?[this.min[0],this.min[1],this.max[2]]:257===e.pnVertexFlag?[this.min[0],this.max[1],this.min[2]]:256===e.pnVertexFlag?[this.min[0],this.max[1],this.max[2]]:17===e.pnVertexFlag?[this.max[0],this.min[1],this.min[2]]:16===e.pnVertexFlag?[this.max[0],this.min[1],this.max[2]]:1===e.pnVertexFlag?[this.max[0],this.max[1],this.min[2]]:[this.max[0],this.max[1],this.max[2]]}},{key:"getPositiveFarPoint",value:function(e){return 273===e.pnVertexFlag?ve([0,0,0],this.max):272===e.pnVertexFlag?[this.max[0],this.max[1],this.min[2]]:257===e.pnVertexFlag?[this.max[0],this.min[1],this.max[2]]:256===e.pnVertexFlag?[this.max[0],this.min[1],this.min[2]]:17===e.pnVertexFlag?[this.min[0],this.max[1],this.max[2]]:16===e.pnVertexFlag?[this.min[0],this.max[1],this.min[2]]:1===e.pnVertexFlag?[this.min[0],this.min[1],this.max[2]]:[this.min[0],this.min[1],this.min[2]]}}],[{key:"isEmpty",value:function(e){return!e||0===e.halfExtents[0]&&0===e.halfExtents[1]&&0===e.halfExtents[2]}}])}(),_e=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e),this.distance=t||0,this.normal=n||f.fromValues(0,1,0),this.updatePNVertexFlag()}),[{key:"updatePNVertexFlag",value:function(){this.pnVertexFlag=(Number(this.normal[0]>=0)<<8)+(Number(this.normal[1]>=0)<<4)+Number(this.normal[2]>=0)}},{key:"distanceToPoint",value:function(e){return f.dot(e,this.normal)-this.distance}},{key:"normalize",value:function(){var e=1/f.len(this.normal);f.scale(this.normal,this.normal,e),this.distance*=e}},{key:"intersectsLine",value:function(e,t,n){var r=this.distanceToPoint(e),i=r/(r-this.distanceToPoint(t)),a=i>=0&&i<=1;return a&&n&&f.lerp(n,e,t,i),a}}])}(),Te=function(){return(0,a.Z)((function e(t){if((0,o.Z)(this,e),this.planes=[],t)this.planes=t;else for(var n=0;n<6;n++)this.planes.push(new _e)}),[{key:"extractFromVPMatrix",value:function(e){var t=(0,h.Z)(e,16),n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=t[9],v=t[10],p=t[11],g=t[12],m=t[13],y=t[14],E=t[15];f.set(this.planes[0].normal,a-n,u-o,p-c),this.planes[0].distance=E-g,f.set(this.planes[1].normal,a+n,u+o,p+c),this.planes[1].distance=E+g,f.set(this.planes[2].normal,a+r,u+s,p+d),this.planes[2].distance=E+m,f.set(this.planes[3].normal,a-r,u-s,p-d),this.planes[3].distance=E-m,f.set(this.planes[4].normal,a-i,u-l,p-v),this.planes[4].distance=E-y,f.set(this.planes[5].normal,a+i,u+l,p+v),this.planes[5].distance=E+y,this.planes.forEach((function(e){e.normalize(),e.updatePNVertexFlag()}))}}])}(),Se=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,o.Z)(this,e),this.x=0,this.y=0,this.x=t,this.y=n}return(0,a.Z)(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"copyFrom",value:function(e){this.x=e.x,this.y=e.y}}])}(),Re=function(){function e(t,n,r,i){(0,o.Z)(this,e),this.x=t,this.y=n,this.width=r,this.height=i,this.left=t,this.right=t+r,this.top=n,this.bottom=n+i}return(0,a.Z)(e,[{key:"toJSON",value:function(){}}],[{key:"fromRect",value:function(t){return new e(t.x,t.y,t.width,t.height)}},{key:"applyTransform",value:function(t,n){var r=v.fromValues(t.x,t.y,0,1),i=v.fromValues(t.x+t.width,t.y,0,1),a=v.fromValues(t.x,t.y+t.height,0,1),o=v.fromValues(t.x+t.width,t.y+t.height,0,1),s=v.create(),l=v.create(),u=v.create(),c=v.create();v.transformMat4(s,r,n),v.transformMat4(l,i,n),v.transformMat4(u,a,n),v.transformMat4(c,o,n);var h=Math.min(s[0],l[0],u[0],c[0]),d=Math.min(s[1],l[1],u[1],c[1]),f=Math.max(s[0],l[0],u[0],c[0]),p=Math.max(s[1],l[1],u[1],c[1]);return e.fromRect({x:h,y:d,width:f-h,height:p-d})}}])}(),Ae="Method not implemented.";function xe(e){return void 0===e?0:e>360||e<-360?e%360:e}var ke=f.create();function Ne(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Array.isArray(e)&&3===e.length?r?f.clone(e):f.copy(ke,e):(0,E.Z)(e)?r?f.fromValues(e,t,n):f.set(ke,e,t,n):r?f.fromValues(e[0],e[1]||t,e[2]||n):f.set(ke,e[0],e[1]||t,e[2]||n)}var Me=Math.PI/180;function Ce(e){return e*Me}var be=180/Math.PI;function Pe(e){return e*be}var Oe=Math.PI/2;function Ie(e,t){return 16===t.length?function(e,t){var n,r,i=p.getScaling(f.create(),t),a=(0,h.Z)(i,3),o=a[0],s=a[1],l=a[2],u=Math.asin(-t[2]/o);return u<Oe?u>-Oe?(n=Math.atan2(t[6]/s,t[10]/l),r=Math.atan2(t[1]/o,t[0]/o)):(r=0,n=-Math.atan2(t[4]/s,t[5]/s)):(r=0,n=Math.atan2(t[4]/s,t[5]/s)),e[0]=n,e[1]=u,e[2]=r,e}(e,t):function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=r*r,s=i*i,l=a*a,u=n*n+o+s+l,c=n*a-r*i;return c>.499995*u?(e[0]=Oe,e[1]=2*Math.atan2(r,n),e[2]=0):c<-.499995*u?(e[0]=-Oe,e[1]=2*Math.atan2(r,n),e[2]=0):(e[0]=Math.asin(2*(n*i-a*r)),e[1]=Math.atan2(2*(n*a+r*i),1-2*(s+l)),e[2]=Math.atan2(2*(n*r+i*a),1-2*(o+s))),e}(e,t)}function we(e){var t=e[0],n=e[1],r=e[3],i=e[4],a=Math.sqrt(t*t+n*n),o=Math.sqrt(r*r+i*i);if(t*i-n*r<0&&(t<i?a=-a:o=-o),a){var s=1/a;t*=s,n*=s}if(o){var l=1/o;r*=l,i*=l}var u=Pe(Math.atan2(n,t));return[e[6],e[7],a,o,u]}var Le=p.create(),De=p.create(),Be=v.create(),Fe=[f.create(),f.create(),f.create()],Ue=f.create();function Ze(e,t,n,r,i){e[0]=t[0]*r+n[0]*i,e[1]=t[1]*r+n[1]*i,e[2]=t[2]*r+n[2]*i}var Ge=function(e){return e[e.ORBITING=0]="ORBITING",e[e.EXPLORING=1]="EXPLORING",e[e.TRACKING=2]="TRACKING",e}({}),Ve=function(e){return e[e.DEFAULT=0]="DEFAULT",e[e.ROTATIONAL=1]="ROTATIONAL",e[e.TRANSLATIONAL=2]="TRANSLATIONAL",e[e.CINEMATIC=3]="CINEMATIC",e}({}),We=function(e){return e[e.ORTHOGRAPHIC=0]="ORTHOGRAPHIC",e[e.PERSPECTIVE=1]="PERSPECTIVE",e}({}),He="updated",Xe=2e-4,ze=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.clipSpaceNearZ=ce.NEGATIVE_ONE,this.eventEmitter=new d.Z,this.matrix=p.create(),this.right=f.fromValues(1,0,0),this.up=f.fromValues(0,1,0),this.forward=f.fromValues(0,0,1),this.position=f.fromValues(0,0,1),this.focalPoint=f.fromValues(0,0,0),this.distanceVector=f.fromValues(0,0,-1),this.distance=1,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.dollyingStep=0,this.maxDistance=1/0,this.minDistance=-1/0,this.zoom=1,this.rotateWorld=!1,this.fov=30,this.near=.1,this.far=1e3,this.aspect=1,this.projectionMatrix=p.create(),this.projectionMatrixInverse=p.create(),this.jitteredProjectionMatrix=void 0,this.enableUpdate=!0,this.type=Ge.EXPLORING,this.trackingMode=Ve.DEFAULT,this.projectionMode=We.PERSPECTIVE,this.frustum=new Te,this.orthoMatrix=p.create()}),[{key:"isOrtho",value:function(){return this.projectionMode===We.ORTHOGRAPHIC}},{key:"getProjectionMode",value:function(){return this.projectionMode}},{key:"getPerspective",value:function(){return this.jitteredProjectionMatrix||this.projectionMatrix}},{key:"getPerspectiveInverse",value:function(){return this.projectionMatrixInverse}},{key:"getFrustum",value:function(){return this.frustum}},{key:"getPosition",value:function(){return this.position}},{key:"getFocalPoint",value:function(){return this.focalPoint}},{key:"getDollyingStep",value:function(){return this.dollyingStep}},{key:"getNear",value:function(){return this.near}},{key:"getFar",value:function(){return this.far}},{key:"getZoom",value:function(){return this.zoom}},{key:"getOrthoMatrix",value:function(){return this.orthoMatrix}},{key:"getView",value:function(){return this.view}},{key:"setEnableUpdate",value:function(e){this.enableUpdate=e}},{key:"setType",value:function(e,t){return this.type=e,this.type===Ge.EXPLORING?this.setWorldRotation(!0):this.setWorldRotation(!1),this._getAngles(),this.type===Ge.TRACKING&&void 0!==t&&this.setTrackingMode(t),this}},{key:"setProjectionMode",value:function(e){return this.projectionMode=e,this}},{key:"setTrackingMode",value:function(e){if(this.type!==Ge.TRACKING)throw new Error("Impossible to set a tracking mode if the camera is not of tracking type");return this.trackingMode=e,this}},{key:"setWorldRotation",value:function(e){return this.rotateWorld=e,this._getAngles(),this}},{key:"getViewTransform",value:function(){return p.invert(p.create(),this.matrix)}},{key:"getWorldTransform",value:function(){return this.matrix}},{key:"jitterProjectionMatrix",value:function(e,t){var n=p.fromTranslation(p.create(),[e,t,0]);this.jitteredProjectionMatrix=p.multiply(p.create(),n,this.projectionMatrix)}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0}},{key:"setMatrix",value:function(e){return this.matrix=e,this._update(),this}},{key:"setProjectionMatrix",value:function(e){this.projectionMatrix=e}},{key:"setFov",value:function(e){return this.setPerspective(this.near,this.far,e,this.aspect),this}},{key:"setAspect",value:function(e){return this.setPerspective(this.near,this.far,this.fov,e),this}},{key:"setNear",value:function(e){return this.projectionMode===We.PERSPECTIVE?this.setPerspective(e,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,e,this.far),this}},{key:"setFar",value:function(e){return this.projectionMode===We.PERSPECTIVE?this.setPerspective(this.near,e,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,e),this}},{key:"setViewOffset",value:function(e,t,n,r,i,a){return this.aspect=e/t,void 0===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.projectionMode===We.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"clearViewOffset",value:function(){return void 0!==this.view&&(this.view.enabled=!1),this.projectionMode===We.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"setZoom",value:function(e){return this.zoom=e,this.projectionMode===We.ORTHOGRAPHIC?this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far):this.projectionMode===We.PERSPECTIVE&&this.setPerspective(this.near,this.far,this.fov,this.aspect),this}},{key:"setZoomByViewportPoint",value:function(e,t){var n=this.canvas.viewport2Canvas({x:t[0],y:t[1]}),r=n.x,i=n.y,a=this.roll;this.rotate(0,0,-a),this.setPosition(r,i),this.setFocalPoint(r,i),this.setZoom(e),this.rotate(0,0,a);var o=this.canvas.viewport2Canvas({x:t[0],y:t[1]}),s=o.x,l=o.y,u=f.fromValues(s-r,l-i,0),c=f.dot(u,this.right)/f.length(this.right),d=f.dot(u,this.up)/f.length(this.up),v=this.getPosition(),p=(0,h.Z)(v,2),g=p[0],m=p[1],y=this.getFocalPoint(),E=(0,h.Z)(y,2),_=E[0],T=E[1];return this.setPosition(g-c,m-d),this.setFocalPoint(_-c,T-d),this}},{key:"setPerspective",value:function(e,t,n,r){var i;this.projectionMode=We.PERSPECTIVE,this.fov=n,this.near=e,this.far=t,this.aspect=r;var a=this.near*Math.tan(Ce(.5*this.fov))/this.zoom,o=2*a,s=this.aspect*o,l=-.5*s;if(null!==(i=this.view)&&void 0!==i&&i.enabled){var u=this.view.fullWidth,c=this.view.fullHeight;l+=this.view.offsetX*s/u,a-=this.view.offsetY*o/c,s*=this.view.width/u,o*=this.view.height/c}return function(e,t,n,r,i,a,o){var s,l,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=2*a,h=n-t,d=r-i,f=c/h,v=c/d,p=(n+t)/h,g=(r+i)/d,m=o-a,y=o*a;u?(s=-o/m,l=-y/m):(s=-(o+a)/m,l=-2*y/m),e[0]=f,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=v,e[6]=0,e[7]=0,e[8]=p,e[9]=g,e[10]=s,e[11]=-1,e[12]=0,e[13]=0,e[14]=l,e[15]=0}(this.projectionMatrix,l,l+s,a-o,a,e,this.far,this.clipSpaceNearZ===ce.ZERO),p.invert(this.projectionMatrixInverse,this.projectionMatrix),this.triggerUpdate(),this}},{key:"setOrthographic",value:function(e,t,n,r,i,a){var o;this.projectionMode=We.ORTHOGRAPHIC,this.rright=t,this.left=e,this.top=n,this.bottom=r,this.near=i,this.far=a;var s=(this.rright-this.left)/(2*this.zoom),l=(this.top-this.bottom)/(2*this.zoom),u=(this.rright+this.left)/2,c=(this.top+this.bottom)/2,h=u-s,d=u+s,f=c+l,v=c-l;if(null!==(o=this.view)&&void 0!==o&&o.enabled){var g=(this.rright-this.left)/this.view.fullWidth/this.zoom,m=(this.top-this.bottom)/this.view.fullHeight/this.zoom;d=(h+=g*this.view.offsetX)+g*this.view.width,v=(f-=m*this.view.offsetY)-m*this.view.height}return this.clipSpaceNearZ===ce.NEGATIVE_ONE?p.ortho(this.projectionMatrix,h,d,f,v,i,a):p.orthoZO(this.projectionMatrix,h,d,f,v,i,a),p.invert(this.projectionMatrixInverse,this.projectionMatrix),this._getOrthoMatrix(),this.triggerUpdate(),this}},{key:"setPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.position[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.position[2],r=Ne(e,t,n);return this._setPosition(r),this.setFocalPoint(this.focalPoint),this.triggerUpdate(),this}},{key:"setFocalPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.focalPoint[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.focalPoint[2],r=f.fromValues(0,1,0);if(this.focalPoint=Ne(e,t,n),this.trackingMode===Ve.CINEMATIC){var i=f.subtract(f.create(),this.focalPoint,this.position);e=i[0],t=i[1],n=i[2];var a=f.length(i),o=Pe(Math.asin(t/a)),s=90+Pe(Math.atan2(n,e)),l=p.create();p.rotateY(l,l,Ce(s)),p.rotateX(l,l,Ce(o)),r=f.transformMat4(f.create(),[0,1,0],l)}return p.invert(this.matrix,p.lookAt(p.create(),this.position,this.focalPoint,r)),this._getAxes(),this._getDistance(),this._getAngles(),this.triggerUpdate(),this}},{key:"getDistance",value:function(){return this.distance}},{key:"getDistanceVector",value:function(){return this.distanceVector}},{key:"setDistance",value:function(e){if(this.distance===e||e<0)return this;this.distance=e,this.distance<Xe&&(this.distance=Xe),this.dollyingStep=this.distance/100;var t=f.create();e=this.distance;var n=this.forward,r=this.focalPoint;return t[0]=e*n[0]+r[0],t[1]=e*n[1]+r[1],t[2]=e*n[2]+r[2],this._setPosition(t),this.triggerUpdate(),this}},{key:"setMaxDistance",value:function(e){return this.maxDistance=e,this}},{key:"setMinDistance",value:function(e){return this.minDistance=e,this}},{key:"setAzimuth",value:function(e){return this.azimuth=xe(e),this.computeMatrix(),this._getAxes(),this.type===Ge.ORBITING||this.type===Ge.EXPLORING?this._getPosition():this.type===Ge.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this}},{key:"getAzimuth",value:function(){return this.azimuth}},{key:"setElevation",value:function(e){return this.elevation=xe(e),this.computeMatrix(),this._getAxes(),this.type===Ge.ORBITING||this.type===Ge.EXPLORING?this._getPosition():this.type===Ge.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this}},{key:"getElevation",value:function(){return this.elevation}},{key:"setRoll",value:function(e){return this.roll=xe(e),this.computeMatrix(),this._getAxes(),this.type===Ge.ORBITING||this.type===Ge.EXPLORING?this._getPosition():this.type===Ge.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this}},{key:"getRoll",value:function(){return this.roll}},{key:"_update",value:function(){this._getAxes(),this._getPosition(),this._getDistance(),this._getAngles(),this._getOrthoMatrix(),this.triggerUpdate()}},{key:"computeMatrix",value:function(){var e=m.setAxisAngle(m.create(),[0,0,1],Ce(this.roll));p.identity(this.matrix);var t=m.setAxisAngle(m.create(),[1,0,0],Ce((this.rotateWorld&&this.type!==Ge.TRACKING||this.type===Ge.TRACKING?1:-1)*this.elevation)),n=m.setAxisAngle(m.create(),[0,1,0],Ce((this.rotateWorld&&this.type!==Ge.TRACKING||this.type===Ge.TRACKING?1:-1)*this.azimuth)),r=m.multiply(m.create(),n,t);r=m.multiply(m.create(),r,e);var i=p.fromQuat(p.create(),r);this.type===Ge.ORBITING||this.type===Ge.EXPLORING?(p.translate(this.matrix,this.matrix,this.focalPoint),p.multiply(this.matrix,this.matrix,i),p.translate(this.matrix,this.matrix,[0,0,this.distance])):this.type===Ge.TRACKING&&(p.translate(this.matrix,this.matrix,this.position),p.multiply(this.matrix,this.matrix,i))}},{key:"_setPosition",value:function(e,t,n){this.position=Ne(e,t,n);var r=this.matrix;r[12]=this.position[0],r[13]=this.position[1],r[14]=this.position[2],r[15]=1,this._getOrthoMatrix()}},{key:"_getAxes",value:function(){f.copy(this.right,Ne(v.transformMat4(v.create(),[1,0,0,0],this.matrix))),f.copy(this.up,Ne(v.transformMat4(v.create(),[0,1,0,0],this.matrix))),f.copy(this.forward,Ne(v.transformMat4(v.create(),[0,0,1,0],this.matrix))),f.normalize(this.right,this.right),f.normalize(this.up,this.up),f.normalize(this.forward,this.forward)}},{key:"_getAngles",value:function(){var e=this.distanceVector[0],t=this.distanceVector[1],n=this.distanceVector[2],r=f.length(this.distanceVector);if(0===r)return this.elevation=0,void(this.azimuth=0);this.type===Ge.TRACKING||this.rotateWorld?(this.elevation=Pe(Math.asin(t/r)),this.azimuth=Pe(Math.atan2(-e,-n))):(this.elevation=-Pe(Math.asin(t/r)),this.azimuth=-Pe(Math.atan2(-e,-n)))}},{key:"_getPosition",value:function(){f.copy(this.position,Ne(v.transformMat4(v.create(),[0,0,0,1],this.matrix))),this._getDistance()}},{key:"_getFocalPoint",value:function(){f.transformMat3(this.distanceVector,[0,0,-this.distance],g.fromMat4(g.create(),this.matrix)),f.add(this.focalPoint,this.position,this.distanceVector),this._getDistance()}},{key:"_getDistance",value:function(){this.distanceVector=f.subtract(f.create(),this.focalPoint,this.position),this.distance=f.length(this.distanceVector),this.dollyingStep=this.distance/100}},{key:"_getOrthoMatrix",value:function(){if(this.projectionMode===We.ORTHOGRAPHIC){var e=this.position,t=m.setAxisAngle(m.create(),[0,0,1],-this.roll*Math.PI/180);p.fromRotationTranslationScaleOrigin(this.orthoMatrix,t,f.fromValues((this.rright-this.left)/2-e[0],(this.top-this.bottom)/2-e[1],0),f.fromValues(this.zoom,this.zoom,1),e)}}},{key:"triggerUpdate",value:function(){if(this.enableUpdate){var e=this.getViewTransform(),t=p.multiply(p.create(),this.getPerspective(),e);this.getFrustum().extractFromVPMatrix(t),this.eventEmitter.emit(He)}}},{key:"rotate",value:function(e,t,n){throw new Error(Ae)}},{key:"pan",value:function(e,t){throw new Error(Ae)}},{key:"dolly",value:function(e){throw new Error(Ae)}},{key:"createLandmark",value:function(e,t){throw new Error(Ae)}},{key:"gotoLandmark",value:function(e,t){throw new Error(Ae)}},{key:"cancelLandmarkAnimation",value:function(){throw new Error(Ae)}}])}(),Ye=function(e){return e[e.Standard=0]="Standard",e}({}),je=function(e){return e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED",e[e.Z_INDEX_CHANGED=2]="Z_INDEX_CHANGED",e}({}),Ke=f.create(),qe=p.create(),$e=m.create();function Qe(e){if(e.localDirtyFlag){if(0!==e.localSkew[0]||0!==e.localSkew[1]){p.fromRotationTranslationScaleOrigin(e.localTransform,e.localRotation,e.localPosition,f.fromValues(1,1,1),e.origin),0===e.localSkew[0]&&0===e.localSkew[1]||(p.identity(qe),qe[4]=Math.tan(e.localSkew[0]),qe[1]=Math.tan(e.localSkew[1]),p.multiply(e.localTransform,e.localTransform,qe));var t=p.fromRotationTranslationScaleOrigin(qe,m.set($e,0,0,0,1),f.set(Ke,1,1,1),e.localScale,e.origin);p.multiply(e.localTransform,e.localTransform,t)}else{var n=e.localTransform,r=e.localPosition,i=e.localRotation,a=e.localScale,o=e.origin,s=0!==r[0]||0!==r[1]||0!==r[2],l=1!==i[3]||0!==i[0]||0!==i[1]||0!==i[2],u=1!==a[0]||1!==a[1]||1!==a[2],c=0!==o[0]||0!==o[1]||0!==o[2];l||u||c?p.fromRotationTranslationScaleOrigin(n,i,r,a,o):s?p.fromTranslation(n,r):p.identity(n)}e.localDirtyFlag=!1}}var Je={absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:new Re(0,0,0,0)},et=function(e){return e.COORDINATE="<coordinate>",e.COLOR="<color>",e.PAINT="<paint>",e.NUMBER="<number>",e.ANGLE="<angle>",e.OPACITY_VALUE="<opacity-value>",e.SHADOW_BLUR="<shadow-blur>",e.LENGTH="<length>",e.PERCENTAGE="<percentage>",e.LENGTH_PERCENTAGE="<length> | <percentage>",e.LENGTH_PERCENTAGE_12="[<length> | <percentage>]{1,2}",e.LENGTH_PERCENTAGE_14="[<length> | <percentage>]{1,4}",e.LIST_OF_POINTS="<list-of-points>",e.PATH="<path>",e.FILTER="<filter>",e.Z_INDEX="<z-index>",e.OFFSET_DISTANCE="<offset-distance>",e.DEFINED_PATH="<defined-path>",e.MARKER="<marker>",e.TRANSFORM="<transform>",e.TRANSFORM_ORIGIN="<transform-origin>",e.TEXT="<text>",e.TEXT_TRANSFORM="<text-transform>",e}({});function tt(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function nt(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function rt(){}var it=.7,at=1/it,ot="\\s*([+-]?\\d+)\\s*",st="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",lt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ut=/^#([0-9a-f]{3,8})$/,ct=new RegExp("^rgb\\(".concat(ot,",").concat(ot,",").concat(ot,"\\)$")),ht=new RegExp("^rgb\\(".concat(lt,",").concat(lt,",").concat(lt,"\\)$")),dt=new RegExp("^rgba\\(".concat(ot,",").concat(ot,",").concat(ot,",").concat(st,"\\)$")),ft=new RegExp("^rgba\\(".concat(lt,",").concat(lt,",").concat(lt,",").concat(st,"\\)$")),vt=new RegExp("^hsl\\(".concat(st,",").concat(lt,",").concat(lt,"\\)$")),pt=new RegExp("^hsla\\(".concat(st,",").concat(lt,",").concat(lt,",").concat(st,"\\)$")),gt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function mt(){return this.rgb().formatHex()}function yt(){return this.rgb().formatRgb()}function Et(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=ut.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?_t(t):3===n?new Rt(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Tt(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Tt(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=ct.exec(e))?new Rt(t[1],t[2],t[3],1):(t=ht.exec(e))?new Rt(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=dt.exec(e))?Tt(t[1],t[2],t[3],t[4]):(t=ft.exec(e))?Tt(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=vt.exec(e))?Ct(t[1],t[2]/100,t[3]/100,1):(t=pt.exec(e))?Ct(t[1],t[2]/100,t[3]/100,t[4]):gt.hasOwnProperty(e)?_t(gt[e]):"transparent"===e?new Rt(NaN,NaN,NaN,0):null}function _t(e){return new Rt(e>>16&255,e>>8&255,255&e,1)}function Tt(e,t,n,r){return r<=0&&(e=t=n=NaN),new Rt(e,t,n,r)}function St(e){return e instanceof rt||(e=Et(e)),e?new Rt((e=e.rgb()).r,e.g,e.b,e.opacity):new Rt}function Rt(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function At(){return"#".concat(Mt(this.r)).concat(Mt(this.g)).concat(Mt(this.b))}function xt(){var e=kt(this.opacity);return"".concat(1===e?"rgb(":"rgba(").concat(Nt(this.r),", ").concat(Nt(this.g),", ").concat(Nt(this.b)).concat(1===e?")":", ".concat(e,")"))}function kt(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Nt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Mt(e){return((e=Nt(e))<16?"0":"")+e.toString(16)}function Ct(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Pt(e,t,n,r)}function bt(e){if(e instanceof Pt)return new Pt(e.h,e.s,e.l,e.opacity);if(e instanceof rt||(e=Et(e)),!e)return new Pt;if(e instanceof Pt)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new Pt(o,s,l,e.opacity)}function Pt(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Ot(e){return(e=(e||0)%360)<0?e+360:e}function It(e){return Math.max(0,Math.min(1,e||0))}function wt(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Lt(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];var o=t?t.apply(this,i):i[0],s=n.cache;if(s.has(o))return s.get(o);var l=e.apply(this,i);return n.cache=s.set(o,l)||s,l};return n.cache=new(Lt.Cache||Map),Lt.cacheList.push(n.cache),n}tt(rt,Et,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:mt,formatHex:mt,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return bt(this).formatHsl()},formatRgb:yt,toString:yt}),tt(Rt,(function(e,t,n,r){return 1===arguments.length?St(e):new Rt(e,t,n,null==r?1:r)}),nt(rt,{brighter:function(e){return e=null==e?at:Math.pow(at,e),new Rt(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?it:Math.pow(it,e),new Rt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},clamp:function(){return new Rt(Nt(this.r),Nt(this.g),Nt(this.b),kt(this.opacity))},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:At,formatHex:At,formatHex8:function(){return"#".concat(Mt(this.r)).concat(Mt(this.g)).concat(Mt(this.b)).concat(Mt(255*(isNaN(this.opacity)?1:this.opacity)))},formatRgb:xt,toString:xt})),tt(Pt,(function(e,t,n,r){return 1===arguments.length?bt(e):new Pt(e,t,n,null==r?1:r)}),nt(rt,{brighter:function(e){return e=null==e?at:Math.pow(at,e),new Pt(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?it:Math.pow(it,e),new Pt(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Rt(wt(e>=240?e-240:e+120,i,r),wt(e,i,r),wt(e<120?e+240:e-120,i,r),this.opacity)},clamp:function(){return new Pt(Ot(this.h),It(this.s),It(this.l),kt(this.opacity))},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=kt(this.opacity);return"".concat(1===e?"hsl(":"hsla(").concat(Ot(this.h),", ").concat(100*It(this.s),"%, ").concat(100*It(this.l),"%").concat(1===e?")":", ".concat(e,")"))}})),Lt.Cache=Map,Lt.cacheList=[],Lt.clearCache=function(){Lt.cacheList.forEach((function(e){return e.clear()}))};var Dt=function(e){return e[e.kUnknown=0]="kUnknown",e[e.kNumber=1]="kNumber",e[e.kPercentage=2]="kPercentage",e[e.kEms=3]="kEms",e[e.kPixels=4]="kPixels",e[e.kRems=5]="kRems",e[e.kDegrees=6]="kDegrees",e[e.kRadians=7]="kRadians",e[e.kGradians=8]="kGradians",e[e.kTurns=9]="kTurns",e[e.kMilliseconds=10]="kMilliseconds",e[e.kSeconds=11]="kSeconds",e[e.kInteger=12]="kInteger",e}({}),Bt=function(e){return e[e.kUNumber=0]="kUNumber",e[e.kUPercent=1]="kUPercent",e[e.kULength=2]="kULength",e[e.kUAngle=3]="kUAngle",e[e.kUTime=4]="kUTime",e[e.kUOther=5]="kUOther",e}({}),Ft=function(e){return e[e.kYes=0]="kYes",e[e.kNo=1]="kNo",e}({}),Ut=function(e){return e[e.kYes=0]="kYes",e[e.kNo=1]="kNo",e}({}),Zt=[{name:"em",unit_type:Dt.kEms},{name:"px",unit_type:Dt.kPixels},{name:"deg",unit_type:Dt.kDegrees},{name:"rad",unit_type:Dt.kRadians},{name:"grad",unit_type:Dt.kGradians},{name:"ms",unit_type:Dt.kMilliseconds},{name:"s",unit_type:Dt.kSeconds},{name:"rem",unit_type:Dt.kRems},{name:"turn",unit_type:Dt.kTurns}],Gt=function(e){return e[e.kUnknownType=0]="kUnknownType",e[e.kUnparsedType=1]="kUnparsedType",e[e.kKeywordType=2]="kKeywordType",e[e.kUnitType=3]="kUnitType",e[e.kSumType=4]="kSumType",e[e.kProductType=5]="kProductType",e[e.kNegateType=6]="kNegateType",e[e.kInvertType=7]="kInvertType",e[e.kMinType=8]="kMinType",e[e.kMaxType=9]="kMaxType",e[e.kClampType=10]="kClampType",e[e.kTransformType=11]="kTransformType",e[e.kPositionType=12]="kPositionType",e[e.kURLImageType=13]="kURLImageType",e[e.kColorType=14]="kColorType",e[e.kUnsupportedColorType=15]="kUnsupportedColorType",e}({}),Vt=function(e){return e?"number"===e?Dt.kNumber:"percent"===e||"%"===e?Dt.kPercentage:function(e){return Zt.find((function(t){return t.name===e})).unit_type}(e):Dt.kUnknown},Wt=function(e){var t=1;switch(e){case Dt.kPixels:case Dt.kDegrees:case Dt.kSeconds:break;case Dt.kMilliseconds:t=.001;break;case Dt.kRadians:t=180/Math.PI;break;case Dt.kGradians:t=.9;break;case Dt.kTurns:t=360}return t},Ht=function(e){switch(e){case Dt.kNumber:case Dt.kInteger:return"";case Dt.kPercentage:return"%";case Dt.kEms:return"em";case Dt.kRems:return"rem";case Dt.kPixels:return"px";case Dt.kDegrees:return"deg";case Dt.kRadians:return"rad";case Dt.kGradians:return"grad";case Dt.kMilliseconds:return"ms";case Dt.kSeconds:return"s";case Dt.kTurns:return"turn"}return""},Xt=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"toString",value:function(){return this.buildCSSText(Ft.kNo,Ut.kNo,"")}},{key:"isNumericValue",value:function(){return this.getType()>=Gt.kUnitType&&this.getType()<=Gt.kClampType}}],[{key:"isAngle",value:function(e){return e===Dt.kDegrees||e===Dt.kRadians||e===Dt.kGradians||e===Dt.kTurns}},{key:"isLength",value:function(e){return e>=Dt.kEms&&e<Dt.kDegrees}},{key:"isRelativeUnit",value:function(e){return e===Dt.kPercentage||e===Dt.kEms||e===Dt.kRems}},{key:"isTime",value:function(e){return e===Dt.kSeconds||e===Dt.kMilliseconds}}])}(),zt=function(e){function t(e){var n;return(0,o.Z)(this,t),(n=(0,s.Z)(this,t)).colorSpace=e,n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getType",value:function(){return Gt.kColorType}},{key:"to",value:function(e){return this}}])}(Xt),Yt=function(e){return e[e.Constant=0]="Constant",e[e.LinearGradient=1]="LinearGradient",e[e.RadialGradient=2]="RadialGradient",e}({}),jt=function(e){function t(e,n){var r;return(0,o.Z)(this,t),(r=(0,s.Z)(this,t)).type=e,r.value=n,r}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.type,this.value)}},{key:"buildCSSText",value:function(e,t,n){return n}},{key:"getType",value:function(){return Gt.kColorType}}])}(Xt),Kt=function(e){function t(e){var n;return(0,o.Z)(this,t),(n=(0,s.Z)(this,t)).value=e,n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.value)}},{key:"getType",value:function(){return Gt.kKeywordType}},{key:"buildCSSText",value:function(e,t,n){return n+this.value}}])}(Xt),qt=function(e){return function(e){switch(e){case Bt.kUNumber:return Dt.kNumber;case Bt.kULength:return Dt.kPixels;case Bt.kUPercent:return Dt.kPercentage;case Bt.kUTime:return Dt.kSeconds;case Bt.kUAngle:return Dt.kDegrees;default:return Dt.kUnknown}}(function(e){switch(e){case Dt.kNumber:case Dt.kInteger:return Bt.kUNumber;case Dt.kPercentage:return Bt.kUPercent;case Dt.kPixels:return Bt.kULength;case Dt.kMilliseconds:case Dt.kSeconds:return Bt.kUTime;case Dt.kDegrees:case Dt.kRadians:case Dt.kGradians:case Dt.kTurns:return Bt.kUAngle;default:return Bt.kUOther}}(e))},$t=function(e){function t(e){var n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Dt.kNumber;return(0,o.Z)(this,t),n=(0,s.Z)(this,t),r="string"==typeof i?Vt(i):i,n.unit=r,n.value=e,n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.value,this.unit)}},{key:"equals",value:function(e){var t=e;return this.value===t.value&&this.unit===t.unit}},{key:"getType",value:function(){return Gt.kUnitType}},{key:"convertTo",value:function(e){if(this.unit===e)return new t(this.value,this.unit);var n=qt(this.unit);if(n!==qt(e)||n===Dt.kUnknown)return null;var r=Wt(this.unit)/Wt(e);return new t(this.value*r,e)}},{key:"buildCSSText",value:function(e,t,n){var r;switch(this.unit){case Dt.kUnknown:break;case Dt.kInteger:r=Number(this.value).toFixed(0);break;case Dt.kNumber:case Dt.kPercentage:case Dt.kEms:case Dt.kRems:case Dt.kPixels:case Dt.kDegrees:case Dt.kRadians:case Dt.kGradians:case Dt.kMilliseconds:case Dt.kSeconds:case Dt.kTurns:var i=this.value,a=Ht(this.unit);if(i<-999999||i>999999){var o=Ht(this.unit);r=!Number.isFinite(i)||Number.isNaN(i)?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(Number.isFinite(e)?"NaN":e>0?"infinity":"-infinity")+t}(i,o):i+(o||"")}else r="".concat(i).concat(a)}return n+=r}}])}(Xt),Qt=new $t(0,"px");new $t(1,"px");var Jt=new $t(0,"deg"),en=function(e){function t(e,n,r){var i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(0,o.Z)(this,t),(i=(0,s.Z)(this,t,["rgb"])).r=e,i.g=n,i.b=r,i.alpha=a,i.isNone=l,i}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.r,this.g,this.b,this.alpha)}},{key:"buildCSSText",value:function(e,t,n){return"".concat(n,"rgba(").concat(this.r,",").concat(this.g,",").concat(this.b,",").concat(this.alpha,")")}}])}(zt),tn=new Kt("unset"),nn={"":tn,unset:tn,initial:new Kt("initial"),inherit:new Kt("inherit")},rn=new en(0,0,0,0,!0),an=new en(0,0,0,0),on=Lt((function(e,t,n,r){return new en(e,t,n,r)}),(function(e,t,n,r){return"rgba(".concat(e,",").concat(t,",").concat(n,",").concat(r,")")})),sn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Dt.kNumber;return new $t(e,t)};function ln(e){var t=e.type,n=e.value;return"hex"===t?"#".concat(n):"literal"===t?n:"rgb"===t?"rgb(".concat(n.join(","),")"):"rgba(".concat(n.join(","),")")}new $t(50,"%");var un=function(){var e=/^(linear\-gradient)/i,t=/^(repeating\-linear\-gradient)/i,n=/^(radial\-gradient)/i,r=/^(repeating\-radial\-gradient)/i,i=/^(conic\-gradient)/i,a=/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,o=/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,s=/^(left|center|right|top|bottom)/i,l=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,u=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,c=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,h=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,d=/^\(/,f=/^\)/,v=/^,/,p=/^\#([0-9a-fA-F]+)/,g=/^([a-zA-Z]+)/,m=/^rgb/i,y=/^rgba/i,E=/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/,_="";function T(e){throw new Error("".concat(_,": ").concat(e))}function S(){var e=O(R);return _.length>0&&T("Invalid input not EOF"),e}function R(){return A("linear-gradient",e,k)||A("repeating-linear-gradient",t,k)||A("radial-gradient",n,N)||A("repeating-radial-gradient",r,N)||A("conic-gradient",i,N)}function A(e,t,n){return x(t,(function(t){var r=n();return r&&(F(v)||T("Missing comma before color stops")),{type:e,orientation:r,colorStops:O(I)}}))}function x(e,t){var n=F(e);if(n){F(d)||T("Missing (");var r=t(n);return F(f)||T("Missing )"),r}}function k(){return B("directional",a,1)||B("angular",h,1)}function N(){var e,t,n=M();return n&&((e=[]).push(n),t=_,F(v)&&((n=M())?e.push(n):_=t)),e}function M(){var e=function(){var e=B("shape",/^(circle)/i,0);e&&(e.style=D()||C());return e}()||function(){var e=B("shape",/^(ellipse)/i,0);e&&(e.style=L()||C());return e}();if(e)e.at=b();else{var t=C();if(t){e=t;var n=b();n&&(e.at=n)}else{var r=P();r&&(e={type:"default-radial",at:r})}}return e}function C(){return B("extent-keyword",o,1)}function b(){if(B("position",/^at/,0)){var e=P();return e||T("Missing positioning value"),e}}function P(){var e={x:L(),y:L()};if(e.x||e.y)return{type:"position",value:e}}function O(e){var t=e(),n=[];if(t)for(n.push(t);F(v);)(t=e())?n.push(t):T("One extra comma");return n}function I(){var e=B("hex",p,1)||x(y,(function(){return{type:"rgba",value:O(w)}}))||x(m,(function(){return{type:"rgb",value:O(w)}}))||B("literal",g,0);return e||T("Expected color definition"),e.length=L(),e}function w(){return F(E)[1]}function L(){return B("%",u,1)||B("position-keyword",s,1)||D()}function D(){return B("px",l,1)||B("em",c,1)}function B(e,t,n){var r=F(t);if(r)return{type:e,value:r[n]}}function F(e){var t=/^[\n\r\t\s]+/.exec(_);t&&U(t[0].length);var n=e.exec(_);return n&&U(n[0].length),n}function U(e){_=_.substring(e)}return function(e){return _=e,S()}}();var cn=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,hn=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,dn=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,fn=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;var vn={left:180,top:-90,bottom:90,right:0,"left top":225,"top left":225,"left bottom":135,"bottom left":135,"right top":-45,"top right":-45,"right bottom":45,"bottom right":45},pn=Lt((function(e){var t;return t="angular"===e.type?Number(e.value):vn[e.value]||0,sn(t,"deg")})),gn=Lt((function(e){var t=50,n=50,r="%",i="%";if("position"===(null==e?void 0:e.type)){var a=e.value,o=a.x,s=a.y;"position-keyword"===(null==o?void 0:o.type)&&("left"===o.value?t=0:"center"===o.value?t=50:"right"===o.value?t=100:"top"===o.value?n=0:"bottom"===o.value&&(n=100)),"position-keyword"===(null==s?void 0:s.type)&&("left"===s.value?t=0:"center"===s.value?n=50:"right"===s.value?t=100:"top"===s.value?n=0:"bottom"===s.value&&(n=100)),"px"!==(null==o?void 0:o.type)&&"%"!==(null==o?void 0:o.type)&&"em"!==(null==o?void 0:o.type)||(r=null==o?void 0:o.type,t=Number(o.value)),"px"!==(null==s?void 0:s.type)&&"%"!==(null==s?void 0:s.type)&&"em"!==(null==s?void 0:s.type)||(i=null==s?void 0:s.type,n=Number(s.value))}return{cx:sn(t,r),cy:sn(n,i)}})),mn=Lt((function(e){if(e.indexOf("linear")>-1||e.indexOf("radial")>-1)return un(e).map((function(e){var t=e.type,n=e.orientation,r=e.colorStops;!function(e){var t,n,r=e.length;e[r-1].length=null!==(t=e[r-1].length)&&void 0!==t?t:{type:"%",value:"100"},r>1&&(e[0].length=null!==(n=e[0].length)&&void 0!==n?n:{type:"%",value:"0"});for(var i=0,a=Number(e[0].length.value),o=1;o<r;o++){var s,l=null===(s=e[o].length)||void 0===s?void 0:s.value;if(!(0,T.Z)(l)&&!(0,T.Z)(a)){for(var u=1;u<o-i;u++)e[i+u].length={type:"%",value:"".concat(a+(Number(l)-a)*u/(o-i))};i=o,a=Number(l)}}}(r);var i,a=r.map((function(e){return{offset:sn(Number(e.length.value),"%"),color:ln(e)}}));if("linear-gradient"===t)return new jt(Yt.LinearGradient,{angle:n?pn(n):Jt,steps:a});if("radial-gradient"===t&&(n||(n=[{type:"shape",value:"circle"}]),"shape"===n[0].type&&"circle"===n[0].value)){var o,s=gn(n[0].at),l=s.cx,u=s.cy;if(n[0].style){var c=n[0].style,h=c.type,d=c.value;"extent-keyword"===h?(nn[i=d]||(nn[i]=new Kt(i)),o=nn[i]):o=sn(d,h)}return new jt(Yt.RadialGradient,{cx:l,cy:u,size:o,steps:a})}}));var t=e[0];if("("===e[1]||"("===e[2])if("l"===t){var n=cn.exec(e);if(n){var r,i=(null===(r=n[2].match(fn))||void 0===r?void 0:r.map((function(e){return e.split(":")})))||[];return[new jt(Yt.LinearGradient,{angle:sn(parseFloat(n[1]),"deg"),steps:i.map((function(e){var t=(0,h.Z)(e,2),n=t[0],r=t[1];return{offset:sn(100*Number(n),"%"),color:r}}))})]}}else if("r"===t){var a=function(e){var t=hn.exec(e);if(t){var n,r=(null===(n=t[4].match(fn))||void 0===n?void 0:n.map((function(e){return e.split(":")})))||[];return{cx:sn(50,"%"),cy:sn(50,"%"),steps:r.map((function(e){var t=(0,h.Z)(e,2),n=t[0],r=t[1];return{offset:sn(100*Number(n),"%"),color:r}}))}}return null}(e);if(a){if(!(0,S.Z)(a))return[new jt(Yt.RadialGradient,a)];e=a}}else if("p"===t)return function(e){var t=dn.exec(e);if(t){var n=t[1],r=t[2];switch(n){case"a":n="repeat";break;case"x":n="repeat-x";break;case"y":n="repeat-y";break;default:n="no-repeat"}return{image:r,repetition:n}}return null}(e)}));function yn(e){return e&&!!e.image}function En(e){return e&&!(0,T.Z)(e.r)&&!(0,T.Z)(e.g)&&!(0,T.Z)(e.b)}var _n=Lt((function(e){if(yn(e))return(0,u.Z)({repetition:"repeat"},e);if((0,T.Z)(e)&&(e=""),"transparent"===e)return an;if("currentColor"===e)e="black";else if("none"===e)return rn;var t=mn(e);if(t)return t;var n=Et(e),r=[0,0,0,0];return null!==n&&(r[0]=n.r||0,r[1]=n.g||0,r[2]=n.b||0,r[3]=n.opacity),on.apply(void 0,r)}));function Tn(e,t){if(En(e)&&En(t))return[[Number(e.r),Number(e.g),Number(e.b),Number(e.alpha)],[Number(t.r),Number(t.g),Number(t.b),Number(t.alpha)],function(e){var t=e.slice();if(t[3])for(var n=0;n<3;n++)t[n]=Math.round((0,R.Z)(t[n],0,255));return t[3]=(0,R.Z)(t[3],0,1),"rgba(".concat(t.join(","),")")}]}function Sn(e,t){if((0,T.Z)(t))return sn(0,"px");if(t="".concat(t).trim().toLowerCase(),isFinite(Number(t))){if("px".search(e)>=0)return sn(Number(t),"px");if("deg".search(e)>=0)return sn(Number(t),"deg")}var n=[];t=t.replace(e,(function(e){return n.push(e),"U".concat(e)}));var r="U(".concat(e.source,")");return n.map((function(e){return sn(Number(t.replace(new RegExp("U".concat(e),"g"),"").replace(new RegExp(r,"g"),"*0")),e)}))[0]}var Rn=function(e){return Sn(new RegExp("px","g"),e)},An=Lt(Rn);Lt((function(e){return Sn(new RegExp("%","g"),e)}));var xn=function(e){return(0,E.Z)(e)||isFinite(Number(e))?sn(Number(e)||0,"px"):Sn(new RegExp("px|%|em|rem","g"),e)},kn=Lt(xn),Nn=function(e){return Sn(new RegExp("deg|rad|grad|turn","g"),e)},Mn=Lt(Nn);function Cn(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a="",o=e.value||0,s=t.value||0,l=qt(e.unit),u=e.convertTo(l),c=t.convertTo(l);return u&&c?(o=u.value,s=c.value,a=Ht(e.unit)):($t.isLength(e.unit)||$t.isLength(t.unit))&&(o=On(e,i,n),s=On(t,i,n),a="px"),[o,s,function(e){return r&&(e=Math.max(e,0)),e+a}]}function bn(e){var t=0;return e.unit===Dt.kDegrees?t=e.value:e.unit===Dt.kRadians?t=Pe(Number(e.value)):e.unit===Dt.kTurns?t=360*Number(e.value):e.value&&(t=e.value),t}function Pn(e,t){var n;return Array.isArray(e)?n=e.map((function(e){return Number(e)})):(0,S.Z)(e)?n=e.split(" ").map((function(e){return Number(e)})):(0,E.Z)(e)&&(n=[e]),2===t?1===n.length?[n[0],n[0]]:[n[0],n[1]]:4===t?1===n.length?[n[0],n[0],n[0],n[0]]:2===n.length?[n[0],n[1],n[0],n[1]]:3===n.length?[n[0],n[1],n[2],n[1]]:[n[0],n[1],n[2],n[3]]:"even"===t&&n.length%2==1?[].concat((0,c.Z)(n),(0,c.Z)(n)):n}function On(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.unit===Dt.kPixels)return Number(e.value);if(e.unit===Dt.kPercentage&&n){var i=n.nodeName===ue.GROUP?n.getLocalBounds():n.getGeometryBounds();return(r?i.min[t]:0)+e.value/100*i.halfExtents[t]*2}return 0}var In=function(e){return Sn(/deg|rad|grad|turn|px|%/g,e)},wn=["blur","brightness","drop-shadow","contrast","grayscale","sepia","saturate","hue-rotate","invert"];function Ln(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if("none"===(e=e.toLowerCase().trim()))return[];for(var t,n=/\s*([\w-]+)\(([^)]*)\)/g,r=[],i=0;t=n.exec(e);){if(t.index!==i)return[];if(i=t.index+t[0].length,wn.indexOf(t[1])>-1&&r.push({name:t[1],params:t[2].split(" ").map((function(e){return In(e)||_n(e)}))}),n.lastIndex===e.length)return r}return[]}function Dn(e){return e.toString()}var Bn=function(e){return"number"==typeof e?sn(e):/^\s*[-+]?(\d*\.)?\d+\s*$/.test(e)?sn(Number(e)):sn(0)},Fn=Lt(Bn);function Un(e,t){return[e,t,Dn]}function Zn(e,t){return function(n,r){return[n,r,function(n){return Dn((0,R.Z)(n,e,t))}]}}function Gn(e,t){if(e.length===t.length)return[e,t,function(e){return e}]}function Vn(e){return 0===e.parsedStyle.d.totalLength&&(e.parsedStyle.d.totalLength=(0,A.D)(e.parsedStyle.d.absolutePath)),e.parsedStyle.d.totalLength}function Wn(e){return 0===e.parsedStyle.points.totalLength&&(e.parsedStyle.points.totalLength=te(e.parsedStyle.points.points)),e.parsedStyle.points.totalLength}function Hn(e,t){return e[0]===t[0]&&e[1]===t[1]}function Xn(e,t){var n=e.prePoint,r=e.currentPoint,i=e.nextPoint,a=Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2),o=Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2),s=Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2),l=Math.acos((a+o-s)/(2*Math.sqrt(a)*Math.sqrt(o)));if(!l||0===Math.sin(l)||(0,N.Z)(l,0))return{xExtra:0,yExtra:0};var u=Math.abs(Math.atan2(i[1]-r[1],i[0]-r[0])),c=Math.abs(Math.atan2(i[0]-r[0],i[1]-r[1]));return u=u>Math.PI/2?Math.PI-u:u,c=c>Math.PI/2?Math.PI-c:c,{xExtra:Math.cos(l/2-u)*(t/2*(1/Math.sin(l/2)))-t/2||0,yExtra:Math.cos(c-l/2)*(t/2*(1/Math.sin(l/2)))-t/2||0}}function zn(e,t){return[t[0]+(t[0]-e[0]),t[1]+(t[1]-e[1])]}Lt((function(e){return(0,S.Z)(e)?e.split(" ").map(Fn):e.map(Fn)}));var Yn=function(e,t){var n=e.x*t.x+e.y*t.y,r=Math.sqrt((Math.pow(e.x,2)+Math.pow(e.y,2))*(Math.pow(t.x,2)+Math.pow(t.y,2)));return(e.x*t.y-e.y*t.x<0?-1:1)*Math.acos(n/r)},jn=function(e,t,n,r,i,a,o,s){t=Math.abs(t),n=Math.abs(n);var l=Ce(r=(0,M.Z)(r,360));if(e.x===o.x&&e.y===o.y)return{x:e.x,y:e.y,ellipticalArcAngle:0};if(0===t||0===n)return{x:0,y:0,ellipticalArcAngle:0};var u=(e.x-o.x)/2,c=(e.y-o.y)/2,h={x:Math.cos(l)*u+Math.sin(l)*c,y:-Math.sin(l)*u+Math.cos(l)*c},d=Math.pow(h.x,2)/Math.pow(t,2)+Math.pow(h.y,2)/Math.pow(n,2);d>1&&(t*=Math.sqrt(d),n*=Math.sqrt(d));var f=(Math.pow(t,2)*Math.pow(n,2)-Math.pow(t,2)*Math.pow(h.y,2)-Math.pow(n,2)*Math.pow(h.x,2))/(Math.pow(t,2)*Math.pow(h.y,2)+Math.pow(n,2)*Math.pow(h.x,2));f=f<0?0:f;var v=(i!==a?1:-1)*Math.sqrt(f),p=v*(t*h.y/n),g=v*(-n*h.x/t),m={x:Math.cos(l)*p-Math.sin(l)*g+(e.x+o.x)/2,y:Math.sin(l)*p+Math.cos(l)*g+(e.y+o.y)/2},y={x:(h.x-p)/t,y:(h.y-g)/n},E=Yn({x:1,y:0},y),_=Yn(y,{x:(-h.x-p)/t,y:(-h.y-g)/n});!a&&_>0?_-=2*Math.PI:a&&_<0&&(_+=2*Math.PI);var T=E+(_%=2*Math.PI)*s,S=t*Math.cos(T),R=n*Math.sin(T);return{x:Math.cos(l)*S-Math.sin(l)*R+m.x,y:Math.sin(l)*S+Math.cos(l)*R+m.y,ellipticalArcStartAngle:E,ellipticalArcEndAngle:E+_,ellipticalArcAngle:T,ellipticalArcCenter:m,resultantRx:t,resultantRy:n}};function Kn(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.arcParams,i=r.rx,a=void 0===i?0:i,o=r.ry,s=void 0===o?0:o,l=r.xRotation,u=r.arcFlag,c=r.sweepFlag,h=jn({x:e.prePoint[0],y:e.prePoint[1]},a,s,l,!!u,!!c,{x:e.currentPoint[0],y:e.currentPoint[1]},t),d=jn({x:e.prePoint[0],y:e.prePoint[1]},a,s,l,!!u,!!c,{x:e.currentPoint[0],y:e.currentPoint[1]},n?t+.005:t-.005),f=d.x-h.x,v=d.y-h.y,p=Math.sqrt(f*f+v*v);return{x:-f/p,y:-v/p}}function qn(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function $n(e,t){return qn(e)*qn(t)?(e[0]*t[0]+e[1]*t[1])/(qn(e)*qn(t)):1}function Qn(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos($n(e,t))}function Jn(e,t){var n=t[1],r=t[2],i=(0,M.Z)(Ce(t[3]),2*Math.PI),a=t[4],o=t[5],s=e[0],l=e[1],u=t[6],c=t[7],h=Math.cos(i)*(s-u)/2+Math.sin(i)*(l-c)/2,d=-1*Math.sin(i)*(s-u)/2+Math.cos(i)*(l-c)/2,f=h*h/(n*n)+d*d/(r*r);f>1&&(n*=Math.sqrt(f),r*=Math.sqrt(f));var v=n*n*(d*d)+r*r*(h*h),p=v?Math.sqrt((n*n*(r*r)-v)/v):1;a===o&&(p*=-1),isNaN(p)&&(p=0);var g=r?p*n*d/r:0,m=n?p*-r*h/n:0,y=(s+u)/2+Math.cos(i)*g-Math.sin(i)*m,E=(l+c)/2+Math.sin(i)*g+Math.cos(i)*m,_=[(h-g)/n,(d-m)/r],T=[(-1*h-g)/n,(-1*d-m)/r],S=Qn([1,0],_),R=Qn(_,T);return $n(_,T)<=-1&&(R=Math.PI),$n(_,T)>=1&&(R=0),0===o&&R>0&&(R-=2*Math.PI),1===o&&R<0&&(R+=2*Math.PI),{cx:y,cy:E,rx:Hn(e,[u,c])?0:n,ry:Hn(e,[u,c])?0:r,startAngle:S,endAngle:S+R,xRotation:i,arcFlag:a,sweepFlag:o}}var er=function(e){if(""===e||Array.isArray(e)&&0===e.length)return{absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:{x:0,y:0,width:0,height:0}};var t;try{t=(0,C.A)(e)}catch(n){t=(0,C.A)(""),console.error("[g]: Invalid SVG Path definition: ".concat(e))}!function(e){for(var t=0;t<e.length;t++){var n=e[t-1],r=e[t];if("M"===r[0]&&n){var i=n[0],a=[r[1],r[2]],o=void 0;"L"===i||"M"===i?o=[n[1],n[2]]:"C"!==i&&"A"!==i&&"Q"!==i||(o=[n[n.length-2],n[n.length-1]]),o&&Hn(a,o)&&(e.splice(t,1),t--)}}}(t);var n=function(e){for(var t=!1,n=e.length,r=0;r<n;r++){var i=e[r][0];if("C"===i||"A"===i||"Q"===i){t=!0;break}}return t}(t),r=function(e){for(var t=[],n=[],r=[],i=0;i<e.length;i++){var a=e[i],o=a[0];"M"===o?(r.length&&(n.push(r),r=[]),r.push([a[1],a[2]])):"Z"===o?r.length&&(t.push(r),r=[]):r.push([a[1],a[2]])}return r.length>0&&n.push(r),{polygons:t,polylines:n}}(t),i=r.polygons,a=r.polylines,o=function(e){for(var t=[],n=null,r=null,i=null,a=0,o=e.length,s=0;s<o;s++){var l=e[s];r=e[s+1];var u=l[0],c={command:u,prePoint:n,params:l,startTangent:null,endTangent:null,currentPoint:null,nextPoint:null,arcParams:null,box:null,cubicParams:null};switch(u){case"M":i=[l[1],l[2]],a=s;break;case"A":var h=Jn(n,l);c.arcParams=h}if("Z"===u)n=i,r=e[a+1];else{var d=l.length;n=[l[d-2],l[d-1]]}r&&"Z"===r[0]&&(r=e[a],t[a]&&(t[a].prePoint=n)),c.currentPoint=n,t[a]&&Hn(n,t[a].currentPoint)&&(t[a].prePoint=c.prePoint);var f=r?[r[r.length-2],r[r.length-1]]:null;c.nextPoint=f;var v=c.prePoint;if(["L","H","V"].includes(u))c.startTangent=[v[0]-n[0],v[1]-n[1]],c.endTangent=[n[0]-v[0],n[1]-v[1]];else if("Q"===u){var p=[l[1],l[2]];c.startTangent=[v[0]-p[0],v[1]-p[1]],c.endTangent=[n[0]-p[0],n[1]-p[1]]}else if("T"===u){var g=t[s-1],m=zn(g.currentPoint,v);"Q"===g.command?(c.command="Q",c.startTangent=[v[0]-m[0],v[1]-m[1]],c.endTangent=[n[0]-m[0],n[1]-m[1]]):(c.command="TL",c.startTangent=[v[0]-n[0],v[1]-n[1]],c.endTangent=[n[0]-v[0],n[1]-v[1]])}else if("C"===u){var y=[l[1],l[2]],E=[l[3],l[4]];c.startTangent=[v[0]-y[0],v[1]-y[1]],c.endTangent=[n[0]-E[0],n[1]-E[1]],0===c.startTangent[0]&&0===c.startTangent[1]&&(c.startTangent=[y[0]-E[0],y[1]-E[1]]),0===c.endTangent[0]&&0===c.endTangent[1]&&(c.endTangent=[E[0]-y[0],E[1]-y[1]])}else if("S"===u){var _=t[s-1],T=zn(_.currentPoint,v),S=[l[1],l[2]];"C"===_.command?(c.command="C",c.startTangent=[v[0]-T[0],v[1]-T[1]],c.endTangent=[n[0]-S[0],n[1]-S[1]]):(c.command="SQ",c.startTangent=[v[0]-S[0],v[1]-S[1]],c.endTangent=[n[0]-S[0],n[1]-S[1]])}else if("A"===u){var R=Kn(c,0),A=R.x,x=R.y,k=Kn(c,1,!1),N=k.x,M=k.y;c.startTangent=[A,x],c.endTangent=[N,M]}t.push(c)}return t}(t),s=function(e,t){for(var n=[],r=[],i=[],a=0;a<e.length;a++){var o=e[a],s=o.currentPoint,l=o.params,u=o.prePoint,c=void 0;switch(o.command){case"Q":c=ie(u[0],u[1],l[1],l[2],l[3],l[4]);break;case"C":c=ee(u[0],u[1],l[1],l[2],l[3],l[4],l[5],l[6]);break;case"A":var h=o.arcParams;c=K(h.cx,h.cy,h.rx,h.ry,h.xRotation,h.startAngle,h.endAngle);break;default:n.push(s[0]),r.push(s[1])}c&&(o.box=c,n.push(c.x,c.x+c.width),r.push(c.y,c.y+c.height)),t&&("L"===o.command||"M"===o.command)&&o.prePoint&&o.nextPoint&&i.push(o)}n=n.filter((function(e){return!Number.isNaN(e)&&e!==1/0&&e!==-1/0})),r=r.filter((function(e){return!Number.isNaN(e)&&e!==1/0&&e!==-1/0}));var d=(0,x.Z)(n),f=(0,x.Z)(r),v=(0,k.Z)(n),p=(0,k.Z)(r);if(0===i.length)return{x:d,y:f,width:v-d,height:p-f};for(var g=0;g<i.length;g++){var m=i[g],y=m.currentPoint;y[0]===d?d-=Xn(m,t).xExtra:y[0]===v&&(v+=Xn(m,t).xExtra),y[1]===f?f-=Xn(m,t).yExtra:y[1]===p&&(p+=Xn(m,t).yExtra)}return{x:d,y:f,width:v-d,height:p-f}}(o,0),l=s.x,u=s.y,c=s.width,h=s.height;return{absolutePath:t,hasArc:n,segments:o,polygons:i,polylines:a,totalLength:0,rect:{x:Number.isFinite(l)?l:0,y:Number.isFinite(u)?u:0,width:Number.isFinite(c)?c:0,height:Number.isFinite(h)?h:0}}},tr=Lt(er);function nr(e){return(0,S.Z)(e)?tr(e):er(e)}function rr(e,t,n){var r=e.curve,i=t.curve;r&&0!==r.length||(r=(0,b.Y)(e.absolutePath,!1),e.curve=r),i&&0!==i.length||(i=(0,b.Y)(t.absolutePath,!1),t.curve=i);var a=[r,i];r.length!==i.length&&(a=(0,P.x)(r,i));var o=(0,O.b)(a[0])!==(0,O.b)(a[1])?(0,I.G)(a[0]):(0,w.U)(a[0]);return[o,(0,L.g)(a[1],o),function(e){return e}]}function ir(e,t){return{points:(0,S.Z)(e)?e.split(" ").map((function(e){var t=e.split(","),n=(0,h.Z)(t,2),r=n[0],i=n[1];return[Number(r),Number(i)]})):e,totalLength:0,segments:[]}}function ar(e,t){return[e.points,t.points,function(e){return e}]}var or=null,sr=/\s*(\w+)\(([^)]*)\)/g;function lr(e){return function(t){var n=0;return e.map((function(e){return e===or?t[n++]:e}))}}function ur(e){return e}var cr={matrix:["NNNNNN",[or,or,0,0,or,or,0,0,0,0,1,0,or,or,0,1],ur],matrix3d:["NNNNNNNNNNNNNNNN",ur],rotate:["A"],rotateX:["A"],rotateY:["A"],rotateZ:["A"],rotate3d:["NNNA"],perspective:["L"],scale:["Nn",lr([or,or,new $t(1)]),ur],scaleX:["N",lr([or,new $t(1),new $t(1)]),lr([or,new $t(1)])],scaleY:["N",lr([new $t(1),or,new $t(1)]),lr([new $t(1),or])],scaleZ:["N",lr([new $t(1),new $t(1),or])],scale3d:["NNN",ur],skew:["Aa",null,ur],skewX:["A",null,lr([or,Jt])],skewY:["A",null,lr([Jt,or])],translate:["Tt",lr([or,or,Qt]),ur],translateX:["T",lr([or,Qt,Qt]),lr([or,Qt])],translateY:["T",lr([Qt,or,Qt]),lr([Qt,or])],translateZ:["L",lr([Qt,Qt,or])],translate3d:["TTL",ur]};function hr(e){for(var t=[],n=e.length,r=0;r<n;r++){var i=e[r],a=i[0],o=i.slice(1);if("translate"===a||"skew"===a?1===o.length&&o.push(0):"scale"===a&&1===o.length&&o.push(o[0]),!cr[a])return[];var s=o.map((function(e){return sn(e)}));t.push({t:a,d:s})}return t}function dr(e){if(Array.isArray(e))return hr(e);if("none"===(e=(e||"none").trim()))return[];var t,n=[],r=0;for(sr.lastIndex=0;t=sr.exec(e);){if(t.index!==r)return[];r=t.index+t[0].length;var i=t[1],a=cr[i];if(!a)return[];var o=t[2].split(","),s=a[0];if(s.length<o.length)return[];for(var l=[],u=0;u<s.length;u++){var c=o[u],h=s[u],d=void 0;if(void 0===(d=c?{A:function(e){return"0"===e.trim()?Jt:Mn(e)},N:Fn,T:kn,L:An}[h.toUpperCase()](c):{a:Jt,n:l[0],t:Qt}[h]))return[];l.push(d)}if(n.push({t:i,d:l}),sr.lastIndex===e.length)return n}return[]}function fr(e){if(Array.isArray(e))return hr(e);if("none"===(e=(e||"none").trim()))return[];var t,n=[],r=0;for(sr.lastIndex=0;t=sr.exec(e);){if(t.index!==r)return[];r=t.index+t[0].length;var i=t[1],a=cr[i];if(!a)return[];var o=t[2].split(","),s=a[0];if(s.length<o.length)return[];for(var l=[],u=0;u<s.length;u++){var c=o[u],h=s[u],d=void 0;if(void 0===(d=c?{A:function(e){return"0"===e.trim()?Jt:Nn(e)},N:Bn,T:xn,L:Rn}[h.toUpperCase()](c):{a:Jt,n:l[0],t:Qt}[h]))return[];l.push(d)}if(n.push({t:i,d:l}),sr.lastIndex===e.length)return n}return[]}function vr(e){var t,n,r,i;switch(e.t){case"rotateX":return i=Ce(bn(e.d[0])),[1,0,0,0,0,Math.cos(i),Math.sin(i),0,0,-Math.sin(i),Math.cos(i),0,0,0,0,1];case"rotateY":return i=Ce(bn(e.d[0])),[Math.cos(i),0,-Math.sin(i),0,0,1,0,0,Math.sin(i),0,Math.cos(i),0,0,0,0,1];case"rotate":case"rotateZ":return i=Ce(bn(e.d[0])),[Math.cos(i),Math.sin(i),0,0,-Math.sin(i),Math.cos(i),0,0,0,0,1,0,0,0,0,1];case"rotate3d":t=e.d[0].value,n=e.d[1].value,r=e.d[2].value,i=Ce(bn(e.d[3]));var a=t*t+n*n+r*r;if(0===a)t=1,n=0,r=0;else if(1!==a){var o=Math.sqrt(a);t/=o,n/=o,r/=o}var s=Math.sin(i/2),l=s*Math.cos(i/2),u=s*s;return[1-2*(n*n+r*r)*u,2*(t*n*u+r*l),2*(t*r*u-n*l),0,2*(t*n*u-r*l),1-2*(t*t+r*r)*u,2*(n*r*u+t*l),0,2*(t*r*u+n*l),2*(n*r*u-t*l),1-2*(t*t+n*n)*u,0,0,0,0,1];case"scale":return[e.d[0].value,0,0,0,0,e.d[1].value,0,0,0,0,1,0,0,0,0,1];case"scaleX":return[e.d[0].value,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"scaleY":return[1,0,0,0,0,e.d[0].value,0,0,0,0,1,0,0,0,0,1];case"scaleZ":return[1,0,0,0,0,1,0,0,0,0,e.d[0].value,0,0,0,0,1];case"scale3d":return[e.d[0].value,0,0,0,0,e.d[1].value,0,0,0,0,e.d[2].value,0,0,0,0,1];case"skew":var c=Ce(bn(e.d[0])),h=Ce(bn(e.d[1]));return[1,Math.tan(h),0,0,Math.tan(c),1,0,0,0,0,1,0,0,0,0,1];case"skewX":return i=Ce(bn(e.d[0])),[1,0,0,0,Math.tan(i),1,0,0,0,0,1,0,0,0,0,1];case"skewY":return i=Ce(bn(e.d[0])),[1,Math.tan(i),0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"translate":return[1,0,0,0,0,1,0,0,0,0,1,0,t=On(e.d[0],0,null)||0,n=On(e.d[1],0,null)||0,0,1];case"translateX":return[1,0,0,0,0,1,0,0,0,0,1,0,t=On(e.d[0],0,null)||0,0,0,1];case"translateY":return[1,0,0,0,0,1,0,0,0,0,1,0,0,n=On(e.d[0],0,null)||0,0,1];case"translateZ":return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,r=On(e.d[0],0,null)||0,1];case"translate3d":return[1,0,0,0,0,1,0,0,0,0,1,0,t=On(e.d[0],0,null)||0,n=On(e.d[1],0,null)||0,r=On(e.d[2],0,null)||0,1];case"perspective":var d=On(e.d[0],0,null)||0;return[1,0,0,0,0,1,0,0,0,0,1,d?-1/d:0,0,0,0,1];case"matrix":return[e.d[0].value,e.d[1].value,0,0,e.d[2].value,e.d[3].value,0,0,0,0,1,0,e.d[4].value,e.d[5].value,0,1];case"matrix3d":return e.d.map((function(e){return e.value}))}}function pr(e,t){return[e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],e[0]*t[4]+e[4]*t[5]+e[8]*t[6]+e[12]*t[7],e[1]*t[4]+e[5]*t[5]+e[9]*t[6]+e[13]*t[7],e[2]*t[4]+e[6]*t[5]+e[10]*t[6]+e[14]*t[7],e[3]*t[4]+e[7]*t[5]+e[11]*t[6]+e[15]*t[7],e[0]*t[8]+e[4]*t[9]+e[8]*t[10]+e[12]*t[11],e[1]*t[8]+e[5]*t[9]+e[9]*t[10]+e[13]*t[11],e[2]*t[8]+e[6]*t[9]+e[10]*t[10]+e[14]*t[11],e[3]*t[8]+e[7]*t[9]+e[11]*t[10]+e[15]*t[11],e[0]*t[12]+e[4]*t[13]+e[8]*t[14]+e[12]*t[15],e[1]*t[12]+e[5]*t[13]+e[9]*t[14]+e[13]*t[15],e[2]*t[12]+e[6]*t[13]+e[10]*t[14]+e[14]*t[15],e[3]*t[12]+e[7]*t[13]+e[11]*t[14]+e[15]*t[15]]}function gr(e){var t=[0,0,0],n=[1,1,1],r=[0,0,0],i=[0,0,0,1],a=[0,0,0,1];return function(e,t,n,r,i,a){if(!function(e,t){var n=t[15];if(0===n)return!1;for(var r=1/n,i=0;i<16;i++)e[i]=t[i]*r;return!0}(Le,e))return!1;if(p.copy(De,Le),De[3]=0,De[7]=0,De[11]=0,De[15]=1,Math.abs(p.determinant(De))<1e-8)return!1;var o,s,l=Le[3],u=Le[7],c=Le[11],h=Le[12],d=Le[13],g=Le[14],m=Le[15];if(0!==l||0!==u||0!==c){if(Be[0]=l,Be[1]=u,Be[2]=c,Be[3]=m,!p.invert(De,De))return!1;p.transpose(De,De),v.transformMat4(i,Be,De)}else i[0]=i[1]=i[2]=0,i[3]=1;if(t[0]=h,t[1]=d,t[2]=g,s=Le,(o=Fe)[0][0]=s[0],o[0][1]=s[1],o[0][2]=s[2],o[1][0]=s[4],o[1][1]=s[5],o[1][2]=s[6],o[2][0]=s[8],o[2][1]=s[9],o[2][2]=s[10],n[0]=f.length(Fe[0]),f.normalize(Fe[0],Fe[0]),r[0]=f.dot(Fe[0],Fe[1]),Ze(Fe[1],Fe[1],Fe[0],1,-r[0]),n[1]=f.length(Fe[1]),f.normalize(Fe[1],Fe[1]),r[0]/=n[1],r[1]=f.dot(Fe[0],Fe[2]),Ze(Fe[2],Fe[2],Fe[0],1,-r[1]),r[2]=f.dot(Fe[1],Fe[2]),Ze(Fe[2],Fe[2],Fe[1],1,-r[2]),n[2]=f.length(Fe[2]),f.normalize(Fe[2],Fe[2]),r[1]/=n[2],r[2]/=n[2],f.cross(Ue,Fe[1],Fe[2]),f.dot(Fe[0],Ue)<0)for(var y=0;y<3;y++)n[y]*=-1,Fe[y][0]*=-1,Fe[y][1]*=-1,Fe[y][2]*=-1;a[0]=.5*Math.sqrt(Math.max(1+Fe[0][0]-Fe[1][1]-Fe[2][2],0)),a[1]=.5*Math.sqrt(Math.max(1-Fe[0][0]+Fe[1][1]-Fe[2][2],0)),a[2]=.5*Math.sqrt(Math.max(1-Fe[0][0]-Fe[1][1]+Fe[2][2],0)),a[3]=.5*Math.sqrt(Math.max(1+Fe[0][0]+Fe[1][1]+Fe[2][2],0)),Fe[2][1]>Fe[1][2]&&(a[0]=-a[0]),Fe[0][2]>Fe[2][0]&&(a[1]=-a[1]),Fe[1][0]>Fe[0][1]&&(a[2]=-a[2])}(function(e){return 0===e.length?[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]:e.map(vr).reduce(pr)}(e),t,n,r,i,a),[[t,n,r,a,i]]}var mr=function(){function e(e,t){for(var n=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],r=0;r<4;r++)for(var i=0;i<4;i++)for(var a=0;a<4;a++)n[r][i]+=t[r][a]*e[a][i];return n}return function(t,n,r,i,a){for(var o=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],s=0;s<4;s++)o[s][3]=a[s];for(var l=0;l<3;l++)for(var u=0;u<3;u++)o[3][l]+=t[u]*o[u][l];var c=i[0],h=i[1],d=i[2],f=i[3],v=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];v[0][0]=1-2*(h*h+d*d),v[0][1]=2*(c*h-d*f),v[0][2]=2*(c*d+h*f),v[1][0]=2*(c*h+d*f),v[1][1]=1-2*(c*c+d*d),v[1][2]=2*(h*d-c*f),v[2][0]=2*(c*d-h*f),v[2][1]=2*(h*d+c*f),v[2][2]=1-2*(c*c+h*h),o=e(o,v);var p,g=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];r[2]&&(g[2][1]=r[2],o=e(o,g)),r[1]&&(g[2][1]=0,g[2][0]=r[0],o=e(o,g)),r[0]&&(g[2][0]=0,g[1][0]=r[0],o=e(o,g));for(var m=0;m<3;m++)for(var y=0;y<3;y++)o[m][y]*=n[m];return 0===(p=o)[0][2]&&0===p[0][3]&&0===p[1][2]&&0===p[1][3]&&0===p[2][0]&&0===p[2][1]&&1===p[2][2]&&0===p[2][3]&&0===p[3][2]&&1===p[3][3]?[o[0][0],o[0][1],o[1][0],o[1][1],o[3][0],o[3][1]]:o[0].concat(o[1],o[2],o[3])}}();function yr(e){return e.toFixed(6).replace(".000000","")}function Er(e,t){var n,r;return e.decompositionPair!==t&&(e.decompositionPair=t,n=gr(e)),t.decompositionPair!==e&&(t.decompositionPair=e,r=gr(t)),null===n[0]||null===r[0]?[[!1],[!0],function(n){return n?t[0].d:e[0].d}]:(n[0].push(0),r[0].push(1),[n,r,function(e){var t=function(e,t,n){var r=function(e,t){for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[r];return n}(e,t);r=(0,R.Z)(r,-1,1);var i=[];if(1===r)i=e;else for(var a=Math.acos(r),o=1*Math.sin(n*a)/Math.sqrt(1-r*r),s=0;s<4;s++)i.push(e[s]*(Math.cos(n*a)-r*o)+t[s]*o);return i}(n[0][3],r[0][3],e[5]);return mr(e[0],e[1],e[2],t,e[4]).map(yr).join(",")}])}function _r(e){return e.replace(/[XY]/,"")}function Tr(e){return e.replace(/(X|Y|Z|3d)?$/,"3d")}function Sr(e,t,n){var r=!1;if(!e.length||!t.length){e.length||(r=!0,e=t,t=[]);for(var i=function(){var n=e[a],r=n.t,i=n.d,o="scale"===r.substring(0,5)?1:0;t.push({t:r,d:i.map((function(e){return"number"==typeof e?sn(o):sn(o,e.unit)}))})},a=0;a<e.length;a++)i()}var o,s,l=[],u=[],c=[];if(e.length!==t.length){var h=Er(e,t);l=[h[0]],u=[h[1]],c=[["matrix",[h[2]]]]}else for(var d=0;d<e.length;d++){var f=e[d].t,v=t[d].t,p=e[d].d,g=t[d].d,m=cr[f],y=cr[v],E=void 0;if(s=v,"perspective"===(o=f)&&"perspective"===s||!("matrix"!==o&&"matrix3d"!==o||"matrix"!==s&&"matrix3d"!==s)){var _=Er([e[d]],[t[d]]);l.push(_[0]),u.push(_[1]),c.push(["matrix",[_[2]]])}else{if(f===v)E=f;else if(m[2]&&y[2]&&_r(f)===_r(v))E=_r(f),p=m[2](p),g=y[2](g);else{if(!m[1]||!y[1]||Tr(f)!==Tr(v)){var T=Er(e,t);l=[T[0]],u=[T[1]],c=[["matrix",[T[2]]]];break}E=Tr(f),p=m[1](p),g=y[1](g)}for(var S=[],R=[],A=[],x=0;x<p.length;x++){var k=Cn(p[x],g[x],n,!1,x);S[x]=k[0],R[x]=k[1],A.push(k[2])}l.push(S),u.push(R),c.push([E,A])}}if(r){var N=l;l=u,u=N}return[l,u,function(e){return e.map((function(e,t){var n=e.map((function(e,n){return c[t][1][n](e)})).join(",");return"matrix"===c[t][0]&&16===n.split(",").length&&(c[t][0]="matrix3d"),"matrix3d"===c[t][0]&&6===n.split(",").length&&(c[t][0]="matrix"),"".concat(c[t][0],"(").concat(n,")")})).join(" ")}]}var Rr=Lt((function(e){if((0,S.Z)(e)){if("text-anchor"===e)return[sn(0,"px"),sn(0,"px")];var t=e.split(" ");return 1===t.length&&("top"===t[0]||"bottom"===t[0]?(t[1]=t[0],t[0]="center"):t[1]="center"),2!==t.length?null:[kn(Ar(t[0])),kn(Ar(t[1]))]}return[sn(e[0]||0,"px"),sn(e[1]||0,"px")]}));function Ar(e){return"center"===e?"50%":"left"===e||"top"===e?"0%":"right"===e||"bottom"===e?"100%":e}var xr=[{n:"display",k:["none"]},{n:"opacity",int:!0,inh:!0,d:"1",syntax:et.OPACITY_VALUE},{n:"fillOpacity",int:!0,inh:!0,d:"1",syntax:et.OPACITY_VALUE},{n:"strokeOpacity",int:!0,inh:!0,d:"1",syntax:et.OPACITY_VALUE},{n:"fill",int:!0,k:["none"],d:"none",syntax:et.PAINT},{n:"fillRule",k:["nonzero","evenodd"],d:"nonzero"},{n:"stroke",int:!0,k:["none"],d:"none",syntax:et.PAINT,l:!0},{n:"shadowType",k:["inner","outer","both"],d:"outer",l:!0},{n:"shadowColor",int:!0,syntax:et.COLOR},{n:"shadowOffsetX",int:!0,l:!0,d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"shadowOffsetY",int:!0,l:!0,d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"shadowBlur",int:!0,l:!0,d:"0",syntax:et.SHADOW_BLUR},{n:"lineWidth",int:!0,inh:!0,d:"1",l:!0,a:["strokeWidth"],syntax:et.LENGTH_PERCENTAGE},{n:"increasedLineWidthForHitTesting",inh:!0,d:"0",l:!0,syntax:et.LENGTH_PERCENTAGE},{n:"lineJoin",inh:!0,l:!0,a:["strokeLinejoin"],k:["miter","bevel","round"],d:"miter"},{n:"lineCap",inh:!0,l:!0,a:["strokeLinecap"],k:["butt","round","square"],d:"butt"},{n:"lineDash",int:!0,inh:!0,k:["none"],a:["strokeDasharray"],syntax:et.LENGTH_PERCENTAGE_12},{n:"lineDashOffset",int:!0,inh:!0,d:"0",a:["strokeDashoffset"],syntax:et.LENGTH_PERCENTAGE},{n:"offsetPath",syntax:et.DEFINED_PATH},{n:"offsetDistance",int:!0,syntax:et.OFFSET_DISTANCE},{n:"dx",int:!0,l:!0,d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"dy",int:!0,l:!0,d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"zIndex",ind:!0,int:!0,d:"0",k:["auto"],syntax:et.Z_INDEX},{n:"visibility",k:["visible","hidden"],ind:!0,inh:!0,int:!0,d:"visible"},{n:"pointerEvents",inh:!0,k:["none","auto","stroke","fill","painted","visible","visiblestroke","visiblefill","visiblepainted","all"],d:"auto"},{n:"filter",ind:!0,l:!0,k:["none"],d:"none",syntax:et.FILTER},{n:"clipPath",syntax:et.DEFINED_PATH},{n:"textPath",syntax:et.DEFINED_PATH},{n:"textPathSide",k:["left","right"],d:"left"},{n:"textPathStartOffset",l:!0,d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"transform",p:100,int:!0,k:["none"],d:"none",syntax:et.TRANSFORM},{n:"transformOrigin",p:100,d:"0 0",l:!0,syntax:et.TRANSFORM_ORIGIN},{n:"cx",int:!0,l:!0,d:"0",syntax:et.COORDINATE},{n:"cy",int:!0,l:!0,d:"0",syntax:et.COORDINATE},{n:"cz",int:!0,l:!0,d:"0",syntax:et.COORDINATE},{n:"r",int:!0,l:!0,d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"rx",int:!0,l:!0,d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"ry",int:!0,l:!0,d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"x",int:!0,l:!0,d:"0",syntax:et.COORDINATE},{n:"y",int:!0,l:!0,d:"0",syntax:et.COORDINATE},{n:"z",int:!0,l:!0,d:"0",syntax:et.COORDINATE},{n:"width",int:!0,l:!0,k:["auto","fit-content","min-content","max-content"],d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"height",int:!0,l:!0,k:["auto","fit-content","min-content","max-content"],d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"radius",int:!0,l:!0,d:"0",syntax:et.LENGTH_PERCENTAGE_14},{n:"x1",int:!0,l:!0,syntax:et.COORDINATE},{n:"y1",int:!0,l:!0,syntax:et.COORDINATE},{n:"z1",int:!0,l:!0,syntax:et.COORDINATE},{n:"x2",int:!0,l:!0,syntax:et.COORDINATE},{n:"y2",int:!0,l:!0,syntax:et.COORDINATE},{n:"z2",int:!0,l:!0,syntax:et.COORDINATE},{n:"d",int:!0,l:!0,d:"",syntax:et.PATH,p:50},{n:"points",int:!0,l:!0,syntax:et.LIST_OF_POINTS,p:50},{n:"text",l:!0,d:"",syntax:et.TEXT,p:50},{n:"textTransform",l:!0,inh:!0,k:["capitalize","uppercase","lowercase","none"],d:"none",syntax:et.TEXT_TRANSFORM,p:51},{n:"font",l:!0},{n:"fontSize",int:!0,inh:!0,d:"16px",l:!0,syntax:et.LENGTH_PERCENTAGE},{n:"fontFamily",l:!0,inh:!0,d:"sans-serif"},{n:"fontStyle",l:!0,inh:!0,k:["normal","italic","oblique"],d:"normal"},{n:"fontWeight",l:!0,inh:!0,k:["normal","bold","bolder","lighter"],d:"normal"},{n:"fontVariant",l:!0,inh:!0,k:["normal","small-caps"],d:"normal"},{n:"lineHeight",l:!0,syntax:et.LENGTH,int:!0,d:"0"},{n:"letterSpacing",l:!0,syntax:et.LENGTH,int:!0,d:"0"},{n:"miterLimit",l:!0,syntax:et.NUMBER,d:function(e){return e===ue.PATH||e===ue.POLYGON||e===ue.POLYLINE?"4":"10"}},{n:"wordWrap",l:!0},{n:"wordWrapWidth",l:!0},{n:"maxLines",l:!0},{n:"textOverflow",l:!0,d:"clip"},{n:"leading",l:!0},{n:"textBaseline",l:!0,inh:!0,k:["top","hanging","middle","alphabetic","ideographic","bottom"],d:"alphabetic"},{n:"textAlign",l:!0,inh:!0,k:["start","center","middle","end","left","right"],d:"start"},{n:"markerStart",syntax:et.MARKER},{n:"markerEnd",syntax:et.MARKER},{n:"markerMid",syntax:et.MARKER},{n:"markerStartOffset",syntax:et.LENGTH,l:!0,int:!0,d:"0"},{n:"markerEndOffset",syntax:et.LENGTH,l:!0,int:!0,d:"0"}],kr=new Set(xr.filter((function(e){return!!e.l})).map((function(e){return e.n}))),Nr={},Mr=function(){return(0,a.Z)((function e(t){var n=this;(0,o.Z)(this,e),this.runtime=t,xr.forEach((function(e){n.registerMetadata(e)}))}),[{key:"registerMetadata",value:function(e){[e.n].concat((0,c.Z)(e.a||[])).forEach((function(t){Nr[t]=e}))}},{key:"getPropertySyntax",value:function(e){return this.runtime.CSSPropertySyntaxFactory[e]}},{key:"processProperties",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{skipUpdateAttribute:!1,skipParse:!1,forceUpdateGeometry:!1,usedAttributes:[],memoize:!0};Object.assign(e.attributes,t);var r=e.parsedStyle.clipPath,i=e.parsedStyle.offsetPath;Cr(e,t);var a=!!n.forceUpdateGeometry;if(!a)for(var o in t)if(kr.has(o)){a=!0;break}var s=br(e);s.has("fill")&&t.fill&&(e.parsedStyle.fill=_n(t.fill)),s.has("stroke")&&t.stroke&&(e.parsedStyle.stroke=_n(t.stroke)),s.has("shadowColor")&&t.shadowColor&&(e.parsedStyle.shadowColor=_n(t.shadowColor)),s.has("filter")&&t.filter&&(e.parsedStyle.filter=Ln(t.filter)),s.has("radius")&&!(0,T.Z)(t.radius)&&(e.parsedStyle.radius=Pn(t.radius,4)),s.has("lineDash")&&!(0,T.Z)(t.lineDash)&&(e.parsedStyle.lineDash=Pn(t.lineDash,"even")),s.has("points")&&t.points&&(e.parsedStyle.points=ir(t.points)),s.has("d")&&""===t.d&&(e.parsedStyle.d=(0,u.Z)({},Je)),s.has("d")&&t.d&&(e.parsedStyle.d=nr(t.d)),s.has("textTransform")&&t.textTransform&&this.runtime.CSSPropertySyntaxFactory[et.TEXT_TRANSFORM].calculator(null,null,{value:t.textTransform},e,null),s.has("clipPath")&&!(0,D.Z)(t.clipPath)&&this.runtime.CSSPropertySyntaxFactory[et.DEFINED_PATH].calculator("clipPath",r,t.clipPath,e,this.runtime),s.has("offsetPath")&&t.offsetPath&&this.runtime.CSSPropertySyntaxFactory[et.DEFINED_PATH].calculator("offsetPath",i,t.offsetPath,e,this.runtime),s.has("transform")&&t.transform&&(e.parsedStyle.transform=dr(t.transform)),s.has("transformOrigin")&&t.transformOrigin&&(e.parsedStyle.transformOrigin=Rr(t.transformOrigin)),s.has("markerStart")&&t.markerStart&&(e.parsedStyle.markerStart=this.runtime.CSSPropertySyntaxFactory[et.MARKER].calculator(null,t.markerStart,t.markerStart,null,null)),s.has("markerEnd")&&t.markerEnd&&(e.parsedStyle.markerEnd=this.runtime.CSSPropertySyntaxFactory[et.MARKER].calculator(null,t.markerEnd,t.markerEnd,null,null)),s.has("markerMid")&&t.markerMid&&(e.parsedStyle.markerMid=this.runtime.CSSPropertySyntaxFactory[et.MARKER].calculator("",t.markerMid,t.markerMid,null,null)),s.has("zIndex")&&!(0,T.Z)(t.zIndex)&&this.runtime.CSSPropertySyntaxFactory[et.Z_INDEX].postProcessor(e),s.has("offsetDistance")&&!(0,T.Z)(t.offsetDistance)&&this.runtime.CSSPropertySyntaxFactory[et.OFFSET_DISTANCE].postProcessor(e),s.has("transform")&&t.transform&&this.runtime.CSSPropertySyntaxFactory[et.TRANSFORM].postProcessor(e),s.has("transformOrigin")&&t.transformOrigin&&this.runtime.CSSPropertySyntaxFactory[et.TRANSFORM_ORIGIN].postProcessor(e),a&&(e.dirty(!0,!0),n.forceUpdateGeometry||this.runtime.sceneGraphService.dirtyToRoot(e))}},{key:"updateGeometry",value:function(e){var t=e.nodeName,n=this.runtime.geometryUpdaterFactory[t];if(n){var r=e.geometry;r.contentBounds||(r.contentBounds=new Ee),r.renderBounds||(r.renderBounds=new Ee);var i=e.parsedStyle,a=n.update(i,e),o=a.cx,s=void 0===o?0:o,l=a.cy,u=void 0===l?0:l,c=a.cz,h=void 0===c?0:c,d=a.hwidth,v=void 0===d?0:d,p=a.hheight,g=void 0===p?0:p,m=a.hdepth,y=void 0===m?0:m,E=[Math.abs(v),Math.abs(g),y],_=i.stroke,T=i.lineWidth,S=void 0===T?1:T,R=i.increasedLineWidthForHitTesting,A=void 0===R?0:R,x=i.shadowType,k=void 0===x?"outer":x,N=i.shadowColor,M=i.filter,C=void 0===M?[]:M,b=i.transformOrigin,P=[s,u,h];r.contentBounds.update(P,E);var O=t===ue.POLYLINE||t===ue.POLYGON||t===ue.PATH?Math.SQRT2:.5;if(_&&!_.isNone){var I=((S||0)+(A||0))*O;E[0]+=I,E[1]+=I}if(r.renderBounds.update(P,E),N&&k&&"inner"!==k){var w=r.renderBounds,L=w.min,D=w.max,B=i.shadowBlur||0,F=i.shadowOffsetX||0,U=i.shadowOffsetY||0,Z=L[0]-B+F,G=D[0]+B+F,V=L[1]-B+U,W=D[1]+B+U;L[0]=Math.min(L[0],Z),D[0]=Math.max(D[0],G),L[1]=Math.min(L[1],V),D[1]=Math.max(D[1],W),r.renderBounds.setMinMax(L,D)}C.forEach((function(e){var t=e.name,n=e.params;if("blur"===t){var i=n[0].value;r.renderBounds.update(r.renderBounds.center,f.add(r.renderBounds.halfExtents,r.renderBounds.halfExtents,[i,i,0]))}else if("drop-shadow"===t){var a=n[0].value,o=n[1].value,s=n[2].value,l=r.renderBounds,u=l.min,c=l.max,h=u[0]-s+a,d=c[0]+s+a,v=u[1]-s+o,p=c[1]+s+o;u[0]=Math.min(u[0],h),c[0]=Math.max(c[0],d),u[1]=Math.min(u[1],v),c[1]=Math.max(c[1],p),r.renderBounds.setMinMax(u,c)}})),e.geometry.dirty=!1;var H=g<0,X=(v<0?-1:1)*(b?On(b[0],0,e,!0):0),z=(H?-1:1)*(b?On(b[1],1,e,!0):0);(X||z)&&e.setOrigin(X,z)}}},{key:"updateSizeAttenuation",value:function(e,t){e.style.isSizeAttenuation?(e.style.rawLineWidth||(e.style.rawLineWidth=e.style.lineWidth),e.style.lineWidth=(e.style.rawLineWidth||1)/t,e.nodeName===ue.CIRCLE&&(e.style.rawR||(e.style.rawR=e.style.r),e.style.r=(e.style.rawR||1)/t)):(e.style.rawLineWidth&&(e.style.lineWidth=e.style.rawLineWidth,delete e.style.rawLineWidth),e.nodeName===ue.CIRCLE&&e.style.rawR&&(e.style.r=e.style.rawR,delete e.style.rawR))}}])}();function Cr(e,t){var n=br(e);for(var r in t)n.has(r)&&(e.parsedStyle[r]=t[r])}function br(e){return e.constructor.PARSED_STYLE_LIST}var Pr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Un}),[{key:"calculator",value:function(e,t,n,r){return bn(n)}}])}(),Or=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r,i){return n instanceof Kt&&(n=null),i.sceneGraphService.updateDisplayObjectDependency(e,t,n,r),"clipPath"===e&&r.forEach((function(e){0===e.childNodes.length&&i.sceneGraphService.dirtyToRoot(e)})),n}}])}(),Ir=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.parser=_n,this.mixer=Tn}),[{key:"calculator",value:function(e,t,n,r){return n instanceof Kt?"none"===n.value?rn:an:n}}])}(),wr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n){return n instanceof Kt?[]:n}}])}();function Lr(e){var t=e.parsedStyle.fontSize;return(0,T.Z)(t)?null:t}var Dr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Un}),[{key:"calculator",value:function(e,t,n,r,i){if((0,E.Z)(n))return n;if(!$t.isRelativeUnit(n.unit))return n.value;if(n.unit===Dt.kPercentage)return 0;if(n.unit===Dt.kEms){if(r.parentNode){var a=Lr(r.parentNode);if(a)return a*=n.value}return 0}if(n.unit===Dt.kRems){var o;if(null!=r&&null!==(o=r.ownerDocument)&&void 0!==o&&o.documentElement){var s=Lr(r.ownerDocument.documentElement);if(s)return s*=n.value}return 0}}}])}(),Br=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Gn}),[{key:"calculator",value:function(e,t,n){return n.map((function(e){return e.value}))}}])}(),Fr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Gn}),[{key:"calculator",value:function(e,t,n){return n.map((function(e){return e.value}))}}])}(),Ur=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){var i;n instanceof Kt&&(n=null);var a=null===(i=n)||void 0===i?void 0:i.cloneNode(!0);return a&&(a.style.isMarker=!0),a}}])}(),Zr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Un}),[{key:"calculator",value:function(e,t,n){return n.value}}])}(),Gr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Zn(0,1)}),[{key:"calculator",value:function(e,t,n){return n.value}},{key:"postProcessor",value:function(e){var t=e.parsedStyle,n=t.offsetPath,r=t.offsetDistance;if(n){var i=n.nodeName;if(i===ue.LINE||i===ue.PATH||i===ue.POLYLINE){var a=n.getPoint(r);a&&e.setLocalPosition(a.x,a.y)}}}}])}(),Vr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Zn(0,1)}),[{key:"calculator",value:function(e,t,n){return n.value}}])}(),Wr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.parser=nr,this.mixer=rr}),[{key:"calculator",value:function(e,t,n){return n instanceof Kt&&"unset"===n.value?{absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:new Re(0,0,0,0)}:n}}])}(),Hr=(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=ar})),Xr=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).mixer=Zn(0,1/0),e}return(0,l.Z)(t,e),(0,a.Z)(t)}(Dr),zr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){return n instanceof Kt?"unset"===n.value?"":n.value:"".concat(n)}},{key:"postProcessor",value:function(e){e.nodeValue="".concat(e.parsedStyle.text)||""}}])}(),Yr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){var i=r.getAttribute("text");if(i){var a=i;"capitalize"===n.value?a=i.charAt(0).toUpperCase()+i.slice(1):"lowercase"===n.value?a=i.toLowerCase():"uppercase"===n.value&&(a=i.toUpperCase()),r.parsedStyle.text=a}return n.value}}])}();new WeakMap;"undefined"!=typeof window&&window.document;function jr(e){var t=e;do{var n;if(null===(n=t.parsedStyle)||void 0===n?void 0:n.clipPath)return t;t=t.parentElement}while(null!==t);return null}var Kr={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},qr="object"===("undefined"==typeof performance?"undefined":i()(performance))&&performance.now?performance:Date;function $r(e){return e.nodeName===ue.FRAGMENT||e.getRootNode().nodeName===ue.FRAGMENT}var Qr=1,Jr="object"===("undefined"==typeof self?"undefined":i()(self))&&self.self===self?self:"object"===(void 0===n.g?"undefined":i()(n.g))&&n.g.global===n.g?n.g:{},ei=Date.now(),ti={},ni=Date.now(),ri=function(e){if("function"!=typeof e)throw new TypeError("".concat(e," is not a function"));var t=Date.now(),n=t-ni,r=n>16?0:16-n,i=Qr++;return ti[i]=e,Object.keys(ti).length>1||setTimeout((function(){ni=t;var e=ti;ti={},Object.keys(e).forEach((function(t){return e[t](Jr.performance&&"function"==typeof Jr.performance.now?Jr.performance.now():Date.now()-ei)}))}),r),i},ii=function(e){delete ti[e]},ai=function(e){return"string"!=typeof e?ri:""===e?Jr.requestAnimationFrame:Jr["".concat(e,"RequestAnimationFrame")]},oi=function(e,t){for(var n=0;void 0!==e[n];){if(t(e[n]))return e[n];n+=1}}(["","webkit","moz","ms","o"],(function(e){return!!ai(e)})),si=ai(oi),li=function(e){return"string"!=typeof e?ii:""===e?Jr.cancelAnimationFrame:Jr["".concat(e,"CancelAnimationFrame")]||Jr["".concat(e,"CancelRequestAnimationFrame")]}(oi);Jr.requestAnimationFrame=si,Jr.cancelAnimationFrame=li;var ui=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],ci=/([\"\'])[^\'\"]+\1/;function hi(e){var t=e.fontSize,n=void 0===t?16:t,r=e.fontFamily,i=void 0===r?"sans-serif":r,a=e.fontStyle,o=void 0===a?"normal":a,s=e.fontVariant,l=void 0===s?"normal":s,u=e.fontWeight;return{fontSize:n,fontFamily:i,fontStyle:o,fontVariant:l,fontWeight:void 0===u?"normal":u}}var di=Lt((function(e){for(var t=hi(e),n=t.fontSize,r=t.fontFamily,i=t.fontStyle,a=t.fontVariant,o=t.fontWeight,s=(0,E.Z)(n)&&"".concat(n,"px")||"16px",l=r.split(","),u=l.length-1;u>=0;u--){var c=l[u].trim();!ci.test(c)&&ui.indexOf(c)<0&&(c='"'.concat(c,'"')),l[u]=c}return"".concat(i," ").concat(a," ").concat(o," ").concat(s," ").concat(l.join(","))}),(function(e){var t=hi(e),n=t.fontSize,r=t.fontFamily,i=t.fontStyle,a=t.fontVariant,o=t.fontWeight;return"".concat(i,"_").concat(a,"_").concat(o,"_").concat(n,"_").concat(r)})),fi=function(e){return Math.max(e,1e-6)};function vi(e,t,n){return p.identity(e),e[4]=Math.tan(t),e[1]=Math.tan(n),e}var pi=p.create(),gi=p.create(),mi={scale:function(e){p.fromScaling(pi,[e[0].value,e[1].value,1].map((function(e){return fi(e)})))},scaleX:function(e){p.fromScaling(pi,[e[0].value,1,1].map((function(e){return fi(e)})))},scaleY:function(e){p.fromScaling(pi,[1,e[0].value,1].map((function(e){return fi(e)})))},scaleZ:function(e){p.fromScaling(pi,[1,1,e[0].value].map((function(e){return fi(e)})))},scale3d:function(e){p.fromScaling(pi,[e[0].value,e[1].value,e[2].value].map((function(e){return fi(e)})))},translate:function(e){p.fromTranslation(pi,[e[0].value,e[1].value,0])},translateX:function(e){p.fromTranslation(pi,[e[0].value,0,0])},translateY:function(e){p.fromTranslation(pi,[0,e[0].value,0])},translateZ:function(e){p.fromTranslation(pi,[0,0,e[0].value])},translate3d:function(e){p.fromTranslation(pi,[e[0].value,e[1].value,e[2].value])},rotate:function(e){p.fromZRotation(pi,Ce(bn(e[0])))},rotateX:function(e){p.fromXRotation(pi,Ce(bn(e[0])))},rotateY:function(e){p.fromYRotation(pi,Ce(bn(e[0])))},rotateZ:function(e){p.fromZRotation(pi,Ce(bn(e[0])))},rotate3d:function(e){p.fromRotation(pi,Ce(bn(e[3])),[e[0].value,e[1].value,e[2].value])},skew:function(e){vi(pi,Ce(e[0].value),Ce(e[1].value))},skewX:function(e){vi(pi,Ce(e[0].value),0)},skewY:function(e){vi(pi,0,Ce(e[0].value))},matrix:function(e){p.set(pi,e[0].value,e[1].value,0,0,e[2].value,e[3].value,0,0,0,0,1,0,e[4].value,e[5].value,0,1)},matrix3d:function(e){p.set.apply(p,[pi].concat((0,c.Z)(e.map((function(e){return e.value})))))}},yi=f.fromValues(1,1,1),Ei=f.create(),_i={translate:function(e,t){Ta.sceneGraphService.setLocalScale(e,yi,!1),Ta.sceneGraphService.setLocalEulerAngles(e,Ei,void 0,void 0,!1),Ta.sceneGraphService.setLocalPosition(e,[t[0].value,t[1].value,0],!1),Ta.sceneGraphService.dirtyLocalTransform(e,e.transformable)}};function Ti(e,t){if(e.length){if(1===e.length&&_i[e[0].t])return void _i[e[0].t](t,e[0].d);for(var n=p.identity(gi),r=0;r<e.length;r++){var i=e[r],a=i.t,o=i.d,s=mi[a];s&&(s(o),p.mul(n,n,pi))}t.setLocalTransform(n)}else t.resetLocalTransform();return t.getLocalTransform()}var Si=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.parser=fr,this.mixer=Sr}),[{key:"calculator",value:function(e,t,n,r){return n instanceof Kt?[]:n}},{key:"postProcessor",value:function(e){Ti(e.parsedStyle.transform,e)}}])}(),Ri=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"postProcessor",value:function(e){var t=e.parsedStyle.transformOrigin;t[0].unit===Dt.kPixels&&t[1].unit===Dt.kPixels?e.setOrigin(t[0].value,t[1].value):e.getGeometryBounds()}}])}(),Ai=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){return n.value}},{key:"postProcessor",value:function(e){if(e.parentNode){var t=e.parentNode,n=t.renderable,r=t.sortable;n&&t.dirty(),r&&(r.dirty=!0,r.dirtyReason=je.Z_INDEX_CHANGED)}}}])}(),xi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.cx,r=void 0===n?0:n,i=e.cy,a=void 0===i?0:i,o=e.r,s=void 0===o?0:o;return{cx:r,cy:a,hwidth:s,hheight:s}}}])}(),ki=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.cx,r=void 0===n?0:n,i=e.cy,a=void 0===i?0:i,o=e.rx,s=void 0===o?0:o,l=e.ry;return{cx:r,cy:a,hwidth:s,hheight:void 0===l?0:l}}}])}(),Ni=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e){var t=e.x1,n=e.y1,r=e.x2,i=e.y2,a=Math.min(t,r),o=Math.max(t,r),s=Math.min(n,i),l=(o-a)/2,u=(Math.max(n,i)-s)/2;return{cx:a+l,cy:s+u,hwidth:l,hheight:u}}}])}(),Mi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e){var t=e.d.rect,n=t.x,r=t.y,i=t.width/2,a=t.height/2;return{cx:n+i,cy:r+a,hwidth:i,hheight:a}}}])}(),Ci=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e){if(e.points&&(0,B.Z)(e.points.points)){var t=e.points.points,n=Math.min.apply(Math,(0,c.Z)(t.map((function(e){return e[0]})))),r=Math.max.apply(Math,(0,c.Z)(t.map((function(e){return e[0]})))),i=Math.min.apply(Math,(0,c.Z)(t.map((function(e){return e[1]})))),a=(r-n)/2,o=(Math.max.apply(Math,(0,c.Z)(t.map((function(e){return e[1]}))))-i)/2;return{cx:n+a,cy:i+o,hwidth:a,hheight:o}}return{cx:0,cy:0,hwidth:0,hheight:0}}}])}(),bi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.x,r=void 0===n?0:n,i=e.y,a=void 0===i?0:i,o=e.src,s=e.width,l=void 0===s?0:s,u=e.height,c=l,h=void 0===u?0:u;return o&&!(0,S.Z)(o)&&(c||(c=o.width,e.width=c),h||(h=o.height,e.height=h)),{cx:r+c/2,cy:a+h/2,hwidth:c/2,hheight:h/2}}}])}(),Pi=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.globalRuntime=t}),[{key:"isReadyToMeasure",value:function(e,t){return e.text}},{key:"update",value:function(e,t){var n,r=e.text,i=e.textAlign,a=void 0===i?"start":i,o=e.lineWidth,s=void 0===o?1:o,l=e.textBaseline,u=void 0===l?"alphabetic":l,c=e.dx,h=void 0===c?0:c,d=e.dy,f=void 0===d?0:d,v=e.x,p=void 0===v?0:v,g=e.y,m=void 0===g?0:g;if(!this.isReadyToMeasure(e,t))return e.metrics={font:"",width:0,height:0,lines:[],lineWidths:[],lineHeight:0,maxLineWidth:0,fontProperties:{ascent:0,descent:0,fontSize:0},lineMetrics:[]},{hwidth:0,hheight:0,cx:0,cy:0};var y=((null==t||null===(n=t.ownerDocument)||void 0===n||null===(n=n.defaultView)||void 0===n?void 0:n.getConfig())||{}).offscreenCanvas,E=this.globalRuntime.textService.measureText(r,e,y);e.metrics=E;var _=E.width/2,T=E.height/2,S=p+_;"center"===a||"middle"===a?S+=s/2-_:"right"!==a&&"end"!==a||(S+=s-2*_);var R=m-T;return"middle"===u?R+=T:"top"===u||"hanging"===u?R+=2*T:"alphabetic"===u||"bottom"!==u&&"ideographic"!==u||(R+=0),h&&(S+=h),f&&(R+=f),{cx:S,cy:R,hwidth:_,hheight:T}}}])}(),Oi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){return{cx:0,cy:0,hwidth:0,hheight:0}}}])}(),Ii=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.x,r=void 0===n?0:n,i=e.y,a=void 0===i?0:i,o=e.width,s=void 0===o?0:o,l=e.height,u=void 0===l?0:l;return{cx:r+s/2,cy:a+u/2,hwidth:s/2,hheight:u/2}}}])}();var wi=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.eventPhase=e.prototype.NONE,this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.defaultPrevented=!1,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Se,this.page=new Se,this.canvas=new Se,this.viewport=new Se,this.composed=!1,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}),[{key:"name",get:function(){return this.type}},{key:"layerX",get:function(){return this.layer.x}},{key:"layerY",get:function(){return this.layer.y}},{key:"pageX",get:function(){return this.page.x}},{key:"pageY",get:function(){return this.page.y}},{key:"x",get:function(){return this.canvas.x}},{key:"y",get:function(){return this.canvas.y}},{key:"canvasX",get:function(){return this.canvas.x}},{key:"canvasY",get:function(){return this.canvas.y}},{key:"viewportX",get:function(){return this.viewport.x}},{key:"viewportY",get:function(){return this.viewport.y}},{key:"composedPath",value:function(){return!this.manager||this.path&&this.path[0]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}},{key:"propagationPath",get:function(){return this.composedPath()}},{key:"preventDefault",value:function(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}},{key:"stopImmediatePropagation",value:function(){this.propagationImmediatelyStopped=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"initEvent",value:function(){}},{key:"initUIEvent",value:function(){}},{key:"clone",value:function(){throw new Error(Ae)}}])}(),Li=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).client=new Se,e.movement=new Se,e.offset=new Se,e.global=new Se,e.screen=new Se,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clientX",get:function(){return this.client.x}},{key:"clientY",get:function(){return this.client.y}},{key:"movementX",get:function(){return this.movement.x}},{key:"movementY",get:function(){return this.movement.y}},{key:"offsetX",get:function(){return this.offset.x}},{key:"offsetY",get:function(){return this.offset.y}},{key:"globalX",get:function(){return this.global.x}},{key:"globalY",get:function(){return this.global.y}},{key:"screenX",get:function(){return this.screen.x}},{key:"screenY",get:function(){return this.screen.y}},{key:"getModifierState",value:function(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}},{key:"initMouseEvent",value:function(){throw new Error(Ae)}}])}(wi),Di=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).width=0,e.height=0,e.isPrimary=!1,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getCoalescedEvents",value:function(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}},{key:"getPredictedEvents",value:function(){throw new Error("getPredictedEvents is not supported!")}},{key:"clone",value:function(){return this.manager.clonePointerEvent(this)}}])}(Li),Bi=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return this.manager.cloneWheelEvent(this)}}])}(Li),Fi=function(e){function t(e,n){var r;return(0,o.Z)(this,t),(r=(0,s.Z)(this,t,[null])).type=e,r.detail=null==n?void 0:n.detail,n&&!("detail"in n)&&(r.detail=n),Object.assign(r,n),r}return(0,l.Z)(t,e),(0,a.Z)(t)}(wi),Ui=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.emitter=new d.Z}),[{key:"on",value:function(e,t,n){return this.addEventListener(e,t,n),this}},{key:"addEventListener",value:function(e,t,n){var r=!1,i=!1;if((0,F.Z)(n))r=n;else if(n){var a=n.capture;r=void 0!==a&&a;var o=n.once;i=void 0!==o&&o}r&&(e+="capture"),t=(0,U.Z)(t)?t:t.handleEvent;var s=(0,U.Z)(t)?void 0:t;return i?this.emitter.once(e,t,s):this.emitter.on(e,t,s),this}},{key:"off",value:function(e,t,n){return e?this.removeEventListener(e,t,n):this.removeAllEventListeners(),this}},{key:"removeAllEventListeners",value:function(){var e;null===(e=this.emitter)||void 0===e||e.removeAllListeners()}},{key:"removeEventListener",value:function(e,t,n){var r;if(!this.emitter)return this;((0,F.Z)(n)?n:null==n?void 0:n.capture)&&(e+="capture"),t=(0,U.Z)(t)?t:null===(r=t)||void 0===r?void 0:r.handleEvent;var i=(0,U.Z)(t)?void 0:t;return this.emitter.off(e,t,i),this}},{key:"emit",value:function(e,t){this.dispatchEvent(new Fi(e,t))}},{key:"dispatchEventToSelf",value:function(e){e.target||(e.target=this),e.currentTarget=this,this.emitter.emit(e.type,e)}},{key:"dispatchEvent",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;if(r)return this.dispatchEventToSelf(e),!0;if(this.document)t=this;else if(this.defaultView)t=this.defaultView;else{var i;t=null===(i=this.ownerDocument)||void 0===i?void 0:i.defaultView}if(t){if(e.manager=t.getEventService(),!e.manager)return!1;e.defaultPrevented=!1,e.path?e.path.length=0:e.page=[],n||(e.target=this),e.manager.dispatchEvent(e,e.type,n)}else this.dispatchEventToSelf(e);return!e.defaultPrevented}}])}(),Zi=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).shadow=!1,e.ownerDocument=null,e.isConnected=!1,e.baseURI="",e.childNodes=[],e.nodeType=0,e.nodeName="",e.nodeValue=null,e.mutations=void 0,e.parentNode=null,e.destroyed=!1,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"textContent",get:function(){var e="";this.nodeName===ue.TEXT&&(e+=this.style.text);var t,n=(0,se.Z)(this.childNodes);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.nodeName===ue.TEXT?e+=r.nodeValue:e+=r.textContent}}catch(e){n.e(e)}finally{n.f()}return e},set:function(e){var t=this;this.childNodes.slice().forEach((function(e){t.removeChild(e)})),this.nodeName===ue.TEXT&&(this.style.text="".concat(e))}},{key:"getRootNode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.parentNode?this.parentNode.getRootNode(e):e.composed&&this.host?this.host.getRootNode(e):this}},{key:"hasChildNodes",value:function(){return this.childNodes.length>0}},{key:"isDefaultNamespace",value:function(e){throw new Error(Ae)}},{key:"lookupNamespaceURI",value:function(e){throw new Error(Ae)}},{key:"lookupPrefix",value:function(e){throw new Error(Ae)}},{key:"normalize",value:function(){throw new Error(Ae)}},{key:"isEqualNode",value:function(e){return this===e}},{key:"isSameNode",value:function(e){return this.isEqualNode(e)}},{key:"parent",get:function(){return this.parentNode}},{key:"parentElement",get:function(){return null}},{key:"nextSibling",get:function(){return null}},{key:"previousSibling",get:function(){return null}},{key:"firstChild",get:function(){return this.childNodes.length>0?this.childNodes[0]:null}},{key:"lastChild",get:function(){return this.childNodes.length>0?this.childNodes[this.childNodes.length-1]:null}},{key:"compareDocumentPosition",value:function(e){if(e===this)return 0;for(var n=e,r=this,i=[n],a=[r];null!==(o=n.parentNode)&&void 0!==o?o:r.parentNode;){var o;n=n.parentNode?(i.push(n.parentNode),n.parentNode):n,r=r.parentNode?(a.push(r.parentNode),r.parentNode):r}if(n!==r)return t.DOCUMENT_POSITION_DISCONNECTED|t.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC|t.DOCUMENT_POSITION_PRECEDING;var s=i.length>a.length?i:a,l=s===i?a:i;if(s[s.length-l.length]===l[0])return s===i?t.DOCUMENT_POSITION_CONTAINED_BY|t.DOCUMENT_POSITION_FOLLOWING:t.DOCUMENT_POSITION_CONTAINS|t.DOCUMENT_POSITION_PRECEDING;for(var u=s.length-l.length,c=l.length-1;c>=0;c--){var h=l[c],d=s[u+c];if(d!==h){var f=h.parentNode.childNodes;return f.indexOf(h)<f.indexOf(d)?l===i?t.DOCUMENT_POSITION_PRECEDING:t.DOCUMENT_POSITION_FOLLOWING:s===i?t.DOCUMENT_POSITION_PRECEDING:t.DOCUMENT_POSITION_FOLLOWING}}return t.DOCUMENT_POSITION_FOLLOWING}},{key:"contain",value:function(e){return this.contains(e)}},{key:"contains",value:function(e){for(var t=e;t&&this!==t;)t=t.parentNode;return!!t}},{key:"getAncestor",value:function(e){for(var t=this;e>0&&t;)t=t.parentNode,e--;return t}},{key:"forEach",value:function(e){for(var t=[this];t.length>0;){var n=t.pop();if(!1===e(n))break;for(var r=n.childNodes.length-1;r>=0;r--)t.push(n.childNodes[r])}}}],[{key:"isNode",value:function(e){return!!e.childNodes}}])}(Ui);Zi.DOCUMENT_POSITION_DISCONNECTED=1,Zi.DOCUMENT_POSITION_PRECEDING=2,Zi.DOCUMENT_POSITION_FOLLOWING=4,Zi.DOCUMENT_POSITION_CONTAINS=8,Zi.DOCUMENT_POSITION_CONTAINED_BY=16,Zi.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC=32;var Gi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"getOrCreateCanvas",value:function(e,t){if(this.canvas)return this.canvas;if(e||Ta.offscreenCanvas)this.canvas=e||Ta.offscreenCanvas,this.context=this.canvas.getContext("2d",(0,u.Z)({willReadFrequently:!0},t));else try{this.canvas=new window.OffscreenCanvas(0,0),this.context=this.canvas.getContext("2d",(0,u.Z)({willReadFrequently:!0},t)),this.context&&this.context.measureText||(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"))}catch(e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d",(0,u.Z)({willReadFrequently:!0},t))}return this.canvas.width=10,this.canvas.height=10,this.canvas}},{key:"getOrCreateContext",value:function(e,t){return this.context||this.getOrCreateCanvas(e,t),this.context}}],[{key:"createCanvas",value:function(){try{return new window.OffscreenCanvas(0,0)}catch(e){}try{return document.createElement("canvas")}catch(e){}return null}}])}(),Vi=function(e){return e[e.CAMERA_CHANGED=0]="CAMERA_CHANGED",e[e.DISPLAY_OBJECT_CHANGED=1]="DISPLAY_OBJECT_CHANGED",e[e.NONE=2]="NONE",e}({}),Wi=/\[\s*(.*)=(.*)\s*\]/,Hi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"selectOne",value:function(e,t){var n=this;if(e.startsWith("."))return t.find((function(t){return((null==t?void 0:t.classList)||[]).indexOf(n.getIdOrClassname(e))>-1}));if(e.startsWith("#"))return t.find((function(t){return t.id===n.getIdOrClassname(e)}));if(e.startsWith("[")){var r=this.getAttribute(e),i=r.name,a=r.value;return i?t.find((function(e){return t!==e&&("name"===i?e.name===a:n.attributeToString(e,i)===a)})):null}return t.find((function(n){return t!==n&&n.nodeName===e}))}},{key:"selectAll",value:function(e,t){var n=this;if(e.startsWith("."))return t.findAll((function(r){return t!==r&&((null==r?void 0:r.classList)||[]).indexOf(n.getIdOrClassname(e))>-1}));if(e.startsWith("#"))return t.findAll((function(r){return t!==r&&r.id===n.getIdOrClassname(e)}));if(e.startsWith("[")){var r=this.getAttribute(e),i=r.name,a=r.value;return i?t.findAll((function(e){return t!==e&&("name"===i?e.name===a:n.attributeToString(e,i)===a)})):[]}return t.findAll((function(n){return t!==n&&n.nodeName===e}))}},{key:"is",value:function(e,t){if(e.startsWith("."))return t.className===this.getIdOrClassname(e);if(e.startsWith("#"))return t.id===this.getIdOrClassname(e);if(e.startsWith("[")){var n=this.getAttribute(e),r=n.name,i=n.value;return"name"===r?t.name===i:this.attributeToString(t,r)===i}return t.nodeName===e}},{key:"getIdOrClassname",value:function(e){return e.substring(1)}},{key:"getAttribute",value:function(e){var t=e.match(Wi),n="",r="";return t&&t.length>2&&(n=t[1].replace(/"/g,""),r=t[2].replace(/"/g,"")),{name:n,value:r}}},{key:"attributeToString",value:function(e,t){if(!e.getAttribute)return"";var n=e.getAttribute(t);return(0,T.Z)(n)?"":n.toString?n.toString():""}}])}(),Xi=function(e){return e.ATTR_MODIFIED="DOMAttrModified",e.INSERTED="DOMNodeInserted",e.MOUNTED="DOMNodeInsertedIntoDocument",e.REMOVED="removed",e.UNMOUNTED="DOMNodeRemovedFromDocument",e.REPARENT="reparent",e.DESTROY="destroy",e.BOUNDS_CHANGED="bounds-changed",e.CULLED="culled",e}({}),zi=function(e){function t(e,n,r,i,a,l,u,c){var h;return(0,o.Z)(this,t),(h=(0,s.Z)(this,t,[null])).relatedNode=n,h.prevValue=r,h.newValue=i,h.attrName=a,h.attrChange=l,h.prevParsedValue=u,h.newParsedValue=c,h.type=e,h}return(0,l.Z)(t,e),(0,a.Z)(t)}(wi);zi.ADDITION=2,zi.MODIFICATION=1,zi.REMOVAL=3;var Yi,ji,Ki,qi=new zi(Xi.REPARENT,null,"","","",0,"",""),$i=y.create(),Qi=f.create(),Ji=f.fromValues(1,1,1),ea=p.create(),ta=y.create(),na=f.create(),ra=p.create(),ia=m.create(),aa=f.create(),oa=m.create(),sa=f.create(),la=f.create(),ua=f.create(),ca=p.create(),ha=m.create(),da=m.create(),fa=m.create(),va=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.displayObjectDependencyMap=new WeakMap,this.runtime=t}),[{key:"matches",value:function(e,t){return this.runtime.sceneGraphSelector.is(e,t)}},{key:"querySelector",value:function(e,t){return this.runtime.sceneGraphSelector.selectOne(e,t)}},{key:"querySelectorAll",value:function(e,t){return this.runtime.sceneGraphSelector.selectAll(e,t)}},{key:"attach",value:function(e,t,n){var r,i=!1;e.parentNode&&(i=e.parentNode!==t,this.detach(e));var a=e.nodeName===ue.FRAGMENT,o=$r(t);e.parentNode=t;var s=a?e.childNodes:[e];(0,E.Z)(n)?s.forEach((function(e){t.childNodes.splice(n,0,e),e.parentNode=t})):s.forEach((function(e){t.childNodes.push(e),e.parentNode=t}));var l=t.sortable;if((null!=l&&null!==(r=l.sorted)&&void 0!==r&&r.length||l.dirty||e.parsedStyle.zIndex)&&(-1===l.dirtyChildren.indexOf(e)&&l.dirtyChildren.push(e),l.dirty=!0,l.dirtyReason=je.ADDED),!o){if(a)this.dirtyFragment(e);else{var u=e.transformable;u&&this.dirtyWorldTransform(e,u)}if(i){var c,h=!0===(null===(c=t.ownerDocument)||void 0===c||null===(c=c.defaultView)||void 0===c||null===(c=c.getConfig())||void 0===c||null===(c=c.future)||void 0===c?void 0:c.experimentalCancelEventPropagation);e.dispatchEvent(qi,h,h)}}}},{key:"detach",value:function(e){var t,n;if(e.parentNode){var r=e.transformable,i=e.parentNode.sortable;(null!=i&&null!==(t=i.sorted)&&void 0!==t&&t.length||null!==(n=e.style)&&void 0!==n&&n.zIndex)&&(-1===i.dirtyChildren.indexOf(e)&&i.dirtyChildren.push(e),i.dirty=!0,i.dirtyReason=je.REMOVED);var a=e.parentNode.childNodes.indexOf(e);a>-1&&e.parentNode.childNodes.splice(a,1),r&&this.dirtyWorldTransform(e,r),e.parentNode=null}}},{key:"getLocalPosition",value:function(e){return e.transformable.localPosition}},{key:"getLocalRotation",value:function(e){return e.transformable.localRotation}},{key:"getLocalScale",value:function(e){return e.transformable.localScale}},{key:"getLocalSkew",value:function(e){return e.transformable.localSkew}},{key:"getLocalTransform",value:function(e){var t=e.transformable;return Qe(t),t.localTransform}},{key:"setLocalPosition",value:function(e,t){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.transformable;la[0]=t[0],la[1]=t[1],la[2]=null!==(n=t[2])&&void 0!==n?n:0,f.equals(i.localPosition,la)||(f.copy(i.localPosition,la),r&&this.dirtyLocalTransform(e,i))}},{key:"translateLocal",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;f.equals(t,Qi)||(f.transformQuat(t,t,i.localRotation),f.add(i.localPosition,i.localPosition,t),this.dirtyLocalTransform(e,i))}},{key:"setLocalRotation",value:function(e,t,n,r,i){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];"number"==typeof t&&(t=m.set(ia,t,n,r,i));var o=e.transformable;m.copy(o.localRotation,t),a&&this.dirtyLocalTransform(e,o)}},{key:"rotateLocal",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;m.fromEuler(da,t[0],t[1],t[2]),m.mul(i.localRotation,i.localRotation,da),this.dirtyLocalTransform(e,i)}},{key:"setLocalScale",value:function(e,t){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.transformable;f.set(na,t[0],t[1],null!==(n=t[2])&&void 0!==n?n:i.localScale[2]),f.equals(na,i.localScale)||(f.copy(i.localScale,na),r&&this.dirtyLocalTransform(e,i))}},{key:"scaleLocal",value:function(e,t){var n,r=e.transformable;f.multiply(r.localScale,r.localScale,f.set(na,t[0],t[1],null!==(n=t[2])&&void 0!==n?n:1)),this.dirtyLocalTransform(e,r)}},{key:"setLocalSkew",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];"number"==typeof t&&(t=y.set(ta,t,n));var i=e.transformable;y.copy(i.localSkew,t),r&&this.dirtyLocalTransform(e,i)}},{key:"setLocalEulerAngles",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];"number"==typeof t&&(t=f.fromValues(t,n,r));var a=e.transformable;m.fromEuler(a.localRotation,t[0],t[1],t[2]),i&&this.dirtyLocalTransform(e,a)}},{key:"setLocalTransform",value:function(e,t){var n=p.getTranslation(aa,t),r=p.getRotation(oa,t),i=p.getScaling(sa,t);this.setLocalScale(e,i,!1),this.setLocalPosition(e,n,!1),this.setLocalRotation(e,r,void 0,void 0,void 0,!1),this.dirtyLocalTransform(e,e.transformable)}},{key:"resetLocalTransform",value:function(e){this.setLocalScale(e,Ji,!1),this.setLocalPosition(e,Qi,!1),this.setLocalEulerAngles(e,Qi,void 0,void 0,!1),this.setLocalSkew(e,$i,void 0,!1),this.dirtyLocalTransform(e,e.transformable)}},{key:"getPosition",value:function(e){var t=e.transformable;return p.getTranslation(t.position,this.getWorldTransform(e,t))}},{key:"getRotation",value:function(e){var t=e.transformable;return p.getRotation(t.rotation,this.getWorldTransform(e,t))}},{key:"getScale",value:function(e){var t=e.transformable;return p.getScaling(t.scaling,this.getWorldTransform(e,t))}},{key:"getOrigin",value:function(e){return e.getGeometryBounds(),e.transformable.origin}},{key:"getWorldTransform",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transformable;return t.localDirtyFlag||t.dirtyFlag?(e.parentNode&&e.parentNode.transformable&&this.getWorldTransform(e.parentNode),this.internalUpdateTransform(e),t.worldTransform):t.worldTransform}},{key:"setPosition",value:function(e,t){var n,r=e.transformable;if(ua[0]=t[0],ua[1]=t[1],ua[2]=null!==(n=t[2])&&void 0!==n?n:0,!f.equals(this.getPosition(e),ua)){if(f.copy(r.position,ua),null!==e.parentNode&&e.parentNode.transformable){var i=e.parentNode.transformable;p.copy(ca,i.worldTransform),p.invert(ca,ca),f.transformMat4(r.localPosition,ua,ca)}else f.copy(r.localPosition,ua);this.dirtyLocalTransform(e,r)}}},{key:"translate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.set(na,t,n,r)),f.equals(t,Qi)||(f.add(na,this.getPosition(e),t),this.setPosition(e,na))}},{key:"setRotation",value:function(e,t,n,r,i){var a=e.transformable;if("number"==typeof t&&(t=m.fromValues(t,n,r,i)),null!==e.parentNode&&e.parentNode.transformable){var o=this.getRotation(e.parentNode);m.copy(ia,o),m.invert(ia,ia),m.multiply(a.localRotation,ia,t),m.normalize(a.localRotation,a.localRotation),this.dirtyLocalTransform(e,a)}else this.setLocalRotation(e,t)}},{key:"rotate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;if(null!==e.parentNode&&e.parentNode.transformable){var a=ia;m.fromEuler(a,t[0],t[1],t[2]);var o=this.getRotation(e),s=this.getRotation(e.parentNode);m.copy(fa,s),m.invert(fa,fa),m.multiply(a,fa,a),m.multiply(i.localRotation,a,o),m.normalize(i.localRotation,i.localRotation),this.dirtyLocalTransform(e,i)}else this.rotateLocal(e,t)}},{key:"setOrigin",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=[t,n,r]);var i=e.transformable;if(t[0]!==i.origin[0]||t[1]!==i.origin[1]||t[2]!==i.origin[2]){var a=i.origin;a[0]=t[0],a[1]=t[1],a[2]=t[2]||0,this.dirtyLocalTransform(e,i)}}},{key:"setEulerAngles",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;if(null!==e.parentNode&&e.parentNode.transformable){m.fromEuler(i.localRotation,t[0],t[1],t[2]);var a=this.getRotation(e.parentNode);m.copy(ha,m.invert(ia,a)),m.mul(i.localRotation,i.localRotation,ha),this.dirtyLocalTransform(e,i)}else this.setLocalEulerAngles(e,t)}},{key:"getGeometryBounds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e,r=n.geometry;r.dirty&&Ta.styleValueRegistry.updateGeometry(e);var i=t?r.renderBounds:r.contentBounds||null;return i||new Ee}},{key:"getTransformedGeometryBounds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.getGeometryBounds(e,t);if(!Ee.isEmpty(r)){var i=n||new Ee;return i.setFromTransformedAABB(r,this.getWorldTransform(e)),i}return null}},{key:"getBounds",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e,i=r.renderable;if(!i.boundsDirty&&!n&&i.bounds)return i.bounds;if(!i.renderBoundsDirty&&n&&i.renderBounds)return i.renderBounds;var a=n?i.renderBounds:i.bounds,o=this.getTransformedGeometryBounds(e,n,a),s=e.childNodes;if(s.forEach((function(e){var r=t.getBounds(e,n);r&&(o?o.add(r):(o=a||new Ee).update(r.center,r.halfExtents))})),o||(o=new Ee),n){var l=jr(e);if(l){var u=l.parsedStyle.clipPath.getBounds(n);o?u&&(o=u.intersection(o)):o.update(u.center,u.halfExtents)}}return n?(i.renderBounds=o,i.renderBoundsDirty=!1):(i.bounds=o,i.boundsDirty=!1),o}},{key:"getLocalBounds",value:function(e){if(e.parentNode){var t=ea;e.parentNode.transformable&&(t=p.invert(ra,this.getWorldTransform(e.parentNode)));var n=this.getBounds(e);if(!Ee.isEmpty(n)){var r=new Ee;return r.setFromTransformedAABB(n,t),r}}return this.getBounds(e)}},{key:"getBoundingClientRect",value:function(e){var t,n,r=this.getGeometryBounds(e);Ee.isEmpty(r)||(n=new Ee).setFromTransformedAABB(r,this.getWorldTransform(e));var i=null===(t=e.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t?void 0:t.getContextService().getBoundingClientRect();if(n){var a=n.getMin(),o=(0,h.Z)(a,2),s=o[0],l=o[1],u=n.getMax(),c=(0,h.Z)(u,2),d=c[0],f=c[1];return new Re(s+((null==i?void 0:i.left)||0),l+((null==i?void 0:i.top)||0),d-s,f-l)}return new Re((null==i?void 0:i.left)||0,(null==i?void 0:i.top)||0,0,0)}},{key:"internalUpdateTransform",value:function(e){var t,n=null===(t=e.parentNode)||void 0===t?void 0:t.transformable;Qe(e.transformable),function(e,t){e.dirtyFlag&&(t?p.multiply(e.worldTransform,t.worldTransform,e.localTransform):p.copy(e.worldTransform,e.localTransform),e.dirtyFlag=!1)}(e.transformable,n)}},{key:"internalUpdateElement",value:function(e,t){var n,r,i,a,o,s,l=!0===(null===(n=e.ownerDocument)||void 0===n||null===(n=n.defaultView)||void 0===n||null===(n=n.getConfig())||void 0===n||null===(n=n.future)||void 0===n?void 0:n.experimentalAttributeUpdateOptimization),u=t[t.length-1],c=(null==u?void 0:u.transformDirty)||(null===(r=e.transformable)||void 0===r?void 0:r.localDirtyFlag);e.transformable&&((o=e.transformable).dirtyFlag||(o.dirtyFlag=c));(this.internalUpdateTransform(e),c)&&(null===(s=e.dirty)||void 0===s||s.call(e,!0,!0));var h=(null===(i=e.renderable)||void 0===i?void 0:i.boundsDirty)||(null===(a=e.renderable)||void 0===a?void 0:a.renderBoundsDirty);if((c||h)&&!1===(null==u?void 0:u.shapeUpdated)&&l)for(var d=t.length-1;d>=0;){var f,v,p=t[d];if(p.shapeUpdated)break;null===(f=(v=p.node).dirty)||void 0===f||f.call(v,!0,!0),p.shapeUpdated=!0,d-=1}return c}},{key:"syncHierarchy",value:function(e){for(var t,n,r=[e],i=e.parentNode?[{node:e.parentNode,transformDirty:(null===(t=e.parentNode.transformable)||void 0===t?void 0:t.localDirtyFlag)||(null===(n=e.parentNode.transformable)||void 0===n?void 0:n.dirtyFlag),shapeUpdated:!1}]:[];r.length>0;){for(var a=r.pop(),o=i[i.length-1];i.length>0&&a.parentNode!==o.node;)o=i.pop();var s=this.internalUpdateElement(a,i);if(a.childNodes.length>0){for(var l=a.childNodes.length-1;l>=0;l--)r.push(a.childNodes[l]);i.push({node:a,transformDirty:s,shapeUpdated:!1})}}}},{key:"dirtyLocalTransform",value:function(e,t){$r(e)||t.localDirtyFlag||(t.localDirtyFlag=!0,t.dirtyFlag||this.dirtyWorldTransform(e,t))}},{key:"dirtyWorldTransform",value:function(e,t){this.dirtyWorldInternal(e,t),this.dirtyToRoot(e,!0)}},{key:"dirtyWorldInternal",value:function(e,t){var n,r=this,i=!0===(null===(n=e.ownerDocument)||void 0===n||null===(n=n.defaultView)||void 0===n||null===(n=n.getConfig())||void 0===n||null===(n=n.future)||void 0===n?void 0:n.experimentalAttributeUpdateOptimization);t.dirtyFlag||(t.dirtyFlag=!0,e.dirty(!0,!0),i||e.childNodes.forEach((function(e){var t=e.transformable;r.dirtyWorldInternal(e,t)})))}},{key:"dirtyToRoot",value:function(e){for(var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e,i=!0===(null===(t=e.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t||null===(t=t.getConfig())||void 0===t||null===(t=t.future)||void 0===t?void 0:t.experimentalAttributeUpdateOptimization);r;){var a,o;if(null===(a=(o=r).dirty)||void 0===a||a.call(o,!0,!0),i)break;r=r.parentNode}n&&e.forEach((function(e){var t;null===(t=e.dirty)||void 0===t||t.call(e,!0,!0)})),this.informDependentDisplayObjects(e);var s=e.mutations||[],l=s.find((function(e){return"attributes"===e.type&&e._boundsChangeData}));l?l._boundsChangeData={affectChildren:l._boundsChangeData.affectChildren||n}:(l={type:"attributes",target:e,_boundsChangeData:{affectChildren:n}},s.push(l)),e.mutations=s}},{key:"dirtyFragment",value:function(e){var t,n,r=e.transformable;r&&(r.dirtyFlag=!0,r.localDirtyFlag=!0),null===(t=(n=e).dirty)||void 0===t||t.call(n,!0,!0);for(var i=e.childNodes.length,a=0;a<i;a++)this.dirtyFragment(e.childNodes[a])}},{key:"notifyMutationObservers",value:function(e){var t=new Set;if(e.getRoot().forEach((function(e){(e.mutations||[]).forEach((function(n){"attributes"===n.type&&n._boundsChangeData&&(n._boundsChangeData.affectChildren?e.forEach((function(e){var r=(0,u.Z)({},n);r.target=e,t.add(r)})):t.add(n))})),e.mutations=void 0})),t.size>0){var n=new Fi(Xi.BOUNDS_CHANGED,{detail:Array.from(t)});e.dispatchEvent(n,!0,!0)}}},{key:"updateDisplayObjectDependency",value:function(e,t,n,r){if(t&&t!==n){var i=this.displayObjectDependencyMap.get(t);if(i&&i[e]){var a=i[e].indexOf(r);i[e].splice(a,1)}}if(n){var o=this.displayObjectDependencyMap.get(n);o||(this.displayObjectDependencyMap.set(n,{}),o=this.displayObjectDependencyMap.get(n)),o[e]||(o[e]=[]),o[e].push(r)}}},{key:"informDependentDisplayObjects",value:function(e){var t,n=this,r=this.displayObjectDependencyMap.get(e);if(r){var i=null===(t=e.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t||null===(t=t.getConfig())||void 0===t||null===(t=t.future)||void 0===t?void 0:t.experimentalCancelEventPropagation;Object.keys(r).forEach((function(e){r[e].forEach((function(t){n.dirtyToRoot(t,!0),t.dispatchEvent(new zi(Xi.ATTR_MODIFIED,t,n,n,e,zi.MODIFICATION,n,n),i,i),t.isCustomElement&&t.isConnected&&t.attributeChangedCallback&&t.attributeChangedCallback(e,n,n)}))}))}}}])}(),pa=function(){return(0,a.Z)((function e(t){if((0,o.Z)(this,e),t<=0)throw new Error("LRU capacity must be a positive number.");this.capacity=t,this.cache=new Map}),[{key:"get",value:function(e){if(this.cache.has(e)){var t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),t}}},{key:"put",value:function(e,t){if(this.cache.has(e)&&this.cache.delete(e),this.cache.set(e,t),this.cache.size>this.capacity){var n=this.cache.keys().next().value;this.cache.delete(n)}}},{key:"len",value:function(){return this.cache.size}},{key:"clear",value:function(){this.cache.clear()}}])}(),ga={MetricsString:"|q",BaselineSymbol:"M",BaselineMultiplier:1.4,HeightMultiplier:2,Newlines:[10,13],BreakingSpaces:[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288]},ma=/[a-zA-Z0-9\u00C0-\u00D6\u00D8-\u00f6\u00f8-\u00ff!"#$%&'()*+,-./:;]/,ya=new RegExp("".concat(/[!%),.:;?\]}'""]/.source,"|").concat(/[!),.:;?\]}'""]/.source,"|").concat(/[)\]'"?!:;,.]/.source,"|").concat(/[!%),.:;?\]}'"]/.source)),Ea=new RegExp("".concat(/[$('"]/.source,"|").concat(/[([{'"]/.source,"|").concat(/[(['"...]/.source,"|").concat(/[$([{'"#]/.source)),_a=function(){return(0,a.Z)((function e(t){var n=this;(0,o.Z)(this,e),this.fontMetricsCache={},this.shouldBreakByKinsokuShorui=function(e,t){return!n.isBreakingSpace(t)&&!(!e||!Ea.exec(t)&&!ya.exec(e))},this.trimByKinsokuShorui=function(e){var t=(0,c.Z)(e),n=t[t.length-2];if(!n)return e;var r=n[n.length-1];return t[t.length-2]=n.slice(0,-1),t[t.length-1]=r+t[t.length-1],t},this.runtime=t,this.charWidthCache=new pa(100)}),[{key:"measureFont",value:function(e,t){if(this.fontMetricsCache[e])return this.fontMetricsCache[e];var n={ascent:0,descent:0,fontSize:0},r=this.runtime.offscreenCanvasCreator.getOrCreateCanvas(t),i=this.runtime.offscreenCanvasCreator.getOrCreateContext(t,{willReadFrequently:!0});i.font=e;var a=ga.MetricsString+ga.BaselineSymbol,o=Math.ceil(i.measureText(a).width),s=Math.ceil(i.measureText(ga.BaselineSymbol).width),l=ga.HeightMultiplier*s;s=s*ga.BaselineMultiplier|0,r.width=o,r.height=l,i.fillStyle="#f00",i.fillRect(0,0,o,l),i.font=e,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(a,0,s);var u=i.getImageData(0,0,o||1,l||1).data,c=u.length,h=4*o,d=0,f=0,v=!1;for(d=0;d<s;++d){for(var p=0;p<h;p+=4)if(255!==u[f+p]){v=!0;break}if(v)break;f+=h}for(n.ascent=s-d,f=c-h,v=!1,d=l;d>s;--d){for(var g=0;g<h;g+=4)if(255!==u[f+g]){v=!0;break}if(v)break;f-=h}return n.descent=d-s,n.fontSize=n.ascent+n.descent,this.fontMetricsCache[e]=n,n}},{key:"measureText",value:function(e,t,n){var r=t.fontSize,i=void 0===r?16:r,a=t.wordWrap,o=void 0!==a&&a,s=t.lineHeight,l=t.lineWidth,u=void 0===l?1:l,c=t.textBaseline,h=void 0===c?"alphabetic":c,d=t.textAlign,f=void 0===d?"start":d,v=t.letterSpacing,p=void 0===v?0:v,g=t.textPath;t.textPathSide,t.textPathStartOffset;var m=t.leading,y=void 0===m?0:m,E=di(t),_=this.measureFont(E,n);0===_.fontSize&&(_.fontSize=i,_.ascent=i);var T=this.runtime.offscreenCanvasCreator.getOrCreateContext(n);T.font=E,t.isOverflowing=!1;var S=(o?this.wordWrap(e,t,n):e).split(/(?:\r\n|\r|\n)/),R=new Array(S.length),A=0;if(!g){for(var x=0;x<S.length;x++){var k=T.measureText(S[x]).width+(S[x].length-1)*p;R[x]=k,A=Math.max(A,k)}var N=A+u,M=s||_.fontSize+u,C=Math.max(M,_.fontSize+u)+(S.length-1)*(M+y),b=0;return"middle"===h?b=-C/2:"bottom"===h||"alphabetic"===h||"ideographic"===h?b=-C:"top"!==h&&"hanging"!==h||(b=0),{font:E,width:N,height:C,lines:S,lineWidths:R,lineHeight:M+=y,maxLineWidth:A,fontProperties:_,lineMetrics:R.map((function(e,t){var n=0;return"center"===f||"middle"===f?n-=e/2:"right"!==f&&"end"!==f||(n-=e),new Re(n-u/2,b+t*M,e+u,M)}))}}g.getTotalLength();for(var P=0;P<S.length;P++)T.measureText(S[P]).width,S[P].length}},{key:"wordWrap",value:function(e,t,n){var r=this,i=Array.from(e);if(0===i.length)return"";var a=this,o=t.wordWrapWidth,s=void 0===o?0:o,l=t.letterSpacing,u=void 0===l?0:l,c=t.maxLines,h=void 0===c?1/0:c,d=t.textOverflow,f=this.runtime.offscreenCanvasCreator.getOrCreateContext(n),v=s+u,p="";"ellipsis"===d?p="...":d&&"clip"!==d&&(p=d);var g=[""],m=0,y=0,E=-1,_=di(t),T=this.charWidthCache.get(_);T||(T=new pa(500),this.charWidthCache.put(_,T));var S=function(e){return r.getFromCache(e,u,T,f)},R=S(p);function A(e,t,n,r){for(;S(e)<r&&t<i.length-1&&!a.isNewline(i[t+1]);)e+=i[t+=1];for(;S(e)>r&&t>=n;)t-=1,e=e.slice(0,-1);return{lineTxt:e,txtLastCharIndex:t}}function x(e,t){if(!(R<=0||R>v))if(g[e]){var n=A(g[e],t,E+1,v-R);g[e]=n.lineTxt+p}else g[e]=p}for(var k=0;k<i.length;k++){var N=i[k],M=i[k-1],C=i[k+1],b=S(N);if(this.isNewline(N)){if(m+1>=h){k<i.length-1&&x(m,k-1),t.isOverflowing=!0;break}E=k-1,y=0,g[m+=1]=""}else{if(b>v){x(m,k-1),t.isOverflowing=!0;break}if(y>0&&y+b>v){var P=A(g[m],k-1,E+1,v);if(P.txtLastCharIndex!==k-1){if(g[m]=P.lineTxt,P.txtLastCharIndex===i.length-1)break;k=P.txtLastCharIndex+1,N=i[k],M=i[k-1],C=i[k+1],b=S(N)}if(m+1>=h){x(m,k-1),t.isOverflowing=!0;break}if(E=k-1,y=0,g[m+=1]="",this.isBreakingSpace(N))continue;this.canBreakInLastChar(N)||(g=this.trimToBreakable(g),y=this.sumTextWidthByCache(g[m]||"",S)),this.shouldBreakByKinsokuShorui(N,C)&&(g=this.trimByKinsokuShorui(g),y+=S(M||""))}y+=b,g[m]+=N}}return g.join("\n")}},{key:"isBreakingSpace",value:function(e){return"string"==typeof e&&ga.BreakingSpaces.indexOf(e.charCodeAt(0))>=0}},{key:"isNewline",value:function(e){return"string"==typeof e&&ga.Newlines.indexOf(e.charCodeAt(0))>=0}},{key:"trimToBreakable",value:function(e){var t=(0,c.Z)(e),n=t[t.length-2],r=this.findBreakableIndex(n);if(-1===r||!n)return t;var i=n.slice(r,r+1),a=r+1,o=r+(this.isBreakingSpace(i)?0:1);return t[t.length-1]+=n.slice(a,n.length),t[t.length-2]=n.slice(0,o),t}},{key:"canBreakInLastChar",value:function(e){return!e||!ma.test(e)}},{key:"sumTextWidthByCache",value:function(e,t){return e.split("").reduce((function(e,n){return e+t(n)}),0)}},{key:"findBreakableIndex",value:function(e){for(var t=e.length-1;t>=0;t--)if(!ma.test(e[t]))return t;return-1}},{key:"getFromCache",value:function(e,t,n,r){var i=n.get(e);if("number"!=typeof i){var a=e.length*t;i=r.measureText(e).width+a,n.put(e,i)}return i}},{key:"clearCache",value:function(){this.fontMetricsCache={},this.charWidthCache.clear()}}])}(),Ta={},Sa=(ji=new bi,Ki=new Ci,Yi={},(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(Yi,ue.FRAGMENT,null),ue.CIRCLE,new xi),ue.ELLIPSE,new ki),ue.RECT,ji),ue.IMAGE,ji),ue.GROUP,new Oi),ue.LINE,new Ni),ue.TEXT,new Pi(Ta)),ue.POLYLINE,Ki),ue.POLYGON,Ki),(0,V.Z)((0,V.Z)((0,V.Z)(Yi,ue.PATH,new Mi),ue.HTML,new Ii),ue.MESH,null)),Ra=function(e){var t=new Ir,n=new Dr;return e={},(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(e,et.PERCENTAGE,null),et.NUMBER,new Zr),et.ANGLE,new Pr),et.DEFINED_PATH,new Or),et.PAINT,t),et.COLOR,t),et.FILTER,new wr),et.LENGTH,n),et.LENGTH_PERCENTAGE,n),et.LENGTH_PERCENTAGE_12,new Br),(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(e,et.LENGTH_PERCENTAGE_14,new Fr),et.COORDINATE,new Dr),et.OFFSET_DISTANCE,new Gr),et.OPACITY_VALUE,new Vr),et.PATH,new Wr),et.LIST_OF_POINTS,new Hr),et.SHADOW_BLUR,new Xr),et.TEXT,new zr),et.TEXT_TRANSFORM,new Yr),et.TRANSFORM,new Si),(0,V.Z)((0,V.Z)((0,V.Z)(e,et.TRANSFORM_ORIGIN,new Ri),et.Z_INDEX,new Ai),et.MARKER,new Ur)}();Ta.CameraContribution=ze,Ta.AnimationTimeline=null,Ta.EasingFunction=null,Ta.offscreenCanvasCreator=new Gi,Ta.sceneGraphSelector=new Hi,Ta.sceneGraphService=new va(Ta),Ta.textService=new _a(Ta),Ta.geometryUpdaterFactory=Sa,Ta.CSSPropertySyntaxFactory=Ra,Ta.styleValueRegistry=new Mr(Ta),Ta.layoutRegistry=null,Ta.globalThis="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},Ta.enableStyleSyntax=!0,Ta.enableSizeAttenuation=!1;var Aa=0;var xa=new zi(Xi.INSERTED,null,"","","",0,"",""),ka=new zi(Xi.REMOVED,null,"","","",0,"",""),Na=new Fi(Xi.DESTROY),Ma=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).entity=Aa++,e.transformable={dirtyFlag:!1,localDirtyFlag:!1,localPosition:[0,0,0],localRotation:[0,0,0,1],localScale:[1,1,1],localTransform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],localSkew:[0,0],position:[0,0,0],rotation:[0,0,0,1],scaling:[1,1,1],worldTransform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],origin:[0,0,0]},e.renderable={bounds:void 0,boundsDirty:!0,renderBounds:void 0,renderBoundsDirty:!0,dirtyRenderBounds:void 0,dirty:!1},e.geometry={contentBounds:void 0,renderBounds:void 0,dirty:!0},e.cullable={strategy:Ye.Standard,visibilityPlaneMask:-1,visible:!0,enable:!0},e.sortable={dirty:!1,sorted:void 0,renderOrder:0,dirtyChildren:[],dirtyReason:void 0},e.namespaceURI="g",e.scrollLeft=0,e.scrollTop=0,e.clientTop=0,e.clientLeft=0,e.style={},e.computedStyle={},e.parsedStyle={},e.attributes={},e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"dirty",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;this.renderable.dirty=e,void 0!==t&&(this.renderable.boundsDirty=t,this.renderable.renderBoundsDirty=t,this.geometry.dirty=t)}},{key:"className",get:function(){return this.getAttribute("class")||""},set:function(e){this.setAttribute("class",e)}},{key:"classList",get:function(){return this.className.split(" ").filter((function(e){return""!==e}))}},{key:"tagName",get:function(){return this.nodeName}},{key:"children",get:function(){return this.childNodes}},{key:"childElementCount",get:function(){return this.childNodes.length}},{key:"firstElementChild",get:function(){return this.firstChild}},{key:"lastElementChild",get:function(){return this.lastChild}},{key:"parentElement",get:function(){return this.parentNode}},{key:"nextSibling",get:function(){if(this.parentNode){var e=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[e+1]||null}return null}},{key:"previousSibling",get:function(){if(this.parentNode){var e=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[e-1]||null}return null}},{key:"cloneNode",value:function(e){throw new Error(Ae)}},{key:"appendChild",value:function(e,t){var n;if(e.destroyed)throw new Error("Cannot append a destroyed element.");return Ta.sceneGraphService.attach(e,this,t),null!==(n=this.ownerDocument)&&void 0!==n&&n.defaultView&&($r(this)||e.nodeName!==ue.FRAGMENT?this.ownerDocument.defaultView.mountChildren(e):this.ownerDocument.defaultView.mountFragment(e)),this.isMutationObserved&&(xa.relatedNode=this,e.dispatchEvent(xa)),e}},{key:"insertBefore",value:function(e,t){if(t){e.parentElement&&e.parentElement.removeChild(e);var n=this.childNodes.indexOf(t);-1===n?this.appendChild(e):this.appendChild(e,n)}else this.appendChild(e);return e}},{key:"replaceChild",value:function(e,t){var n=this.childNodes.indexOf(t);return this.removeChild(t),this.appendChild(e,n),t}},{key:"removeChild",value:function(e){var t,n,r=!0===(null===(t=this.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t||null===(t=t.getConfig().future)||void 0===t?void 0:t.experimentalCancelEventPropagation);return ka.relatedNode=this,e.dispatchEvent(ka,r,r),null!==(n=e.ownerDocument)&&void 0!==n&&n.defaultView&&e.ownerDocument.defaultView.unmountChildren(e),Ta.sceneGraphService.detach(e),e}},{key:"removeChildren",value:function(){for(var e=this.childNodes.length-1;e>=0;e--){var t=this.childNodes[e];this.removeChild(t)}}},{key:"destroyChildren",value:function(){for(var e=this.childNodes.length-1;e>=0;e--){var t=this.childNodes[e];t.childNodes.length>0&&t.destroyChildren(),t.destroy()}}},{key:"matches",value:function(e){return Ta.sceneGraphService.matches(e,this)}},{key:"getElementById",value:function(e){return Ta.sceneGraphService.querySelector("#".concat(e),this)}},{key:"getElementsByName",value:function(e){return Ta.sceneGraphService.querySelectorAll('[name="'.concat(e,'"]'),this)}},{key:"getElementsByClassName",value:function(e){return Ta.sceneGraphService.querySelectorAll(".".concat(e),this)}},{key:"getElementsByTagName",value:function(e){return Ta.sceneGraphService.querySelectorAll(e,this)}},{key:"querySelector",value:function(e){return Ta.sceneGraphService.querySelector(e,this)}},{key:"querySelectorAll",value:function(e){return Ta.sceneGraphService.querySelectorAll(e,this)}},{key:"closest",value:function(e){var t=this;do{if(Ta.sceneGraphService.matches(e,t))return t;t=t.parentElement}while(null!==t);return null}},{key:"find",value:function(e){var t=this,n=null;return this.forEach((function(r){return r===t||!e(r)||(n=r,!1)})),n}},{key:"findAll",value:function(e){var t=this,n=[];return this.forEach((function(r){r!==t&&e(r)&&n.push(r)})),n}},{key:"after",value:function(){var e=this;if(this.parentNode){for(var t=this.parentNode.childNodes.indexOf(this),n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];r.forEach((function(n,r){var i;return null===(i=e.parentNode)||void 0===i?void 0:i.appendChild(n,t+r+1)}))}}},{key:"before",value:function(){if(this.parentNode){for(var e,t=this.parentNode.childNodes.indexOf(this),n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var a=r[0],o=(0,H.Z)(r).slice(1);this.parentNode.appendChild(a,t),(e=a).after.apply(e,(0,c.Z)(o))}}},{key:"replaceWith",value:function(){this.after.apply(this,arguments),this.remove()}},{key:"append",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t){return e.appendChild(t)}))}},{key:"prepend",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t,n){return e.appendChild(t,n)}))}},{key:"replaceChildren",value:function(){for(;this.childNodes.length&&this.firstChild;)this.removeChild(this.firstChild);this.append.apply(this,arguments)}},{key:"remove",value:function(){return this.parentNode?this.parentNode.removeChild(this):this}},{key:"destroy",value:function(){var e,t=!0===(null===(e=this.ownerDocument)||void 0===e||null===(e=e.defaultView)||void 0===e||null===(e=e.getConfig().future)||void 0===e?void 0:e.experimentalCancelEventPropagation);this.destroyChildren(),this.dispatchEvent(Na,t,t),this.remove(),this.emitter.removeAllListeners(),this.destroyed=!0}},{key:"getGeometryBounds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Ta.sceneGraphService.getGeometryBounds(this,e)}},{key:"getTransformedGeometryBounds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Ta.sceneGraphService.getTransformedGeometryBounds(this,e)}},{key:"getBounds",value:function(){return Ta.sceneGraphService.getBounds(this)}},{key:"getRenderBounds",value:function(){return Ta.sceneGraphService.getBounds(this,!0)}},{key:"getLocalBounds",value:function(){return Ta.sceneGraphService.getLocalBounds(this)}},{key:"getBoundingClientRect",value:function(){return Ta.sceneGraphService.getBoundingClientRect(this)}},{key:"getClientRects",value:function(){return[this.getBoundingClientRect()]}},{key:"computedStyleMap",value:function(){return new Map(Object.entries(this.computedStyle))}},{key:"getAttributeNames",value:function(){return Object.keys(this.attributes)}},{key:"getAttribute",value:function(e){if("symbol"!==i()(e)){var t=this.attributes[e];return t}}},{key:"hasAttribute",value:function(e){return this.getAttributeNames().includes(e)}},{key:"hasAttributes",value:function(){return!!this.getAttributeNames().length}},{key:"removeAttribute",value:function(e){this.setAttribute(e,null),delete this.attributes[e]}},{key:"setAttribute",value:function(e,t){this.attributes[e]=t}},{key:"getAttributeNS",value:function(e,t){throw new Error(Ae)}},{key:"getAttributeNode",value:function(e){throw new Error(Ae)}},{key:"getAttributeNodeNS",value:function(e,t){throw new Error(Ae)}},{key:"hasAttributeNS",value:function(e,t){throw new Error(Ae)}},{key:"removeAttributeNS",value:function(e,t){throw new Error(Ae)}},{key:"removeAttributeNode",value:function(e){throw new Error(Ae)}},{key:"setAttributeNS",value:function(e,t,n){throw new Error(Ae)}},{key:"setAttributeNode",value:function(e){throw new Error(Ae)}},{key:"setAttributeNodeNS",value:function(e){throw new Error(Ae)}},{key:"toggleAttribute",value:function(e,t){throw new Error(Ae)}}])}(Zi);function Ca(e){return!(null==e||!e.nodeName)}var ba=Ta.globalThis.Proxy?Ta.globalThis.Proxy:function(){},Pa=new zi(Xi.ATTR_MODIFIED,null,null,null,null,zi.MODIFICATION,null,null),Oa=f.create(),Ia=m.create(),wa=function(e){function t(e){var n;return(0,o.Z)(this,t),(n=(0,s.Z)(this,t)).isCustomElement=!1,n.isMutationObserved=!1,n.activeAnimations=[],n.config=e,n.id=e.id||"",n.name=e.name||"",(e.className||e.class)&&(n.className=e.className||e.class),n.nodeName=e.type||ue.GROUP,e.initialParsedStyle&&Object.assign(n.parsedStyle,e.initialParsedStyle),n.initAttributes(e.style),Ta.enableStyleSyntax&&(n.style=new ba({setProperty:function(e,t){n.setAttribute(e,t)},getPropertyValue:function(e){return n.getAttribute(e)},removeProperty:function(e){n.removeAttribute(e)},item:function(){return""}},{get:function(e,t){return void 0!==e[t]?e[t]:n.getAttribute(t)},set:function(e,t,r){return n.setAttribute(t,r),!0}})),n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"destroy",value:function(){(0,W.Z)(t,"destroy",this,3)([]),this.getAnimations().forEach((function(e){e.cancel()}))}},{key:"cloneNode",value:function(e,t){var n=(0,u.Z)({},this.attributes);for(var r in n){var i=n[r];Ca(i)&&"clipPath"!==r&&"offsetPath"!==r&&"textPath"!==r&&(n[r]=i.cloneNode(e)),t&&(n[r]=t(r,i))}var a=new this.constructor((0,u.Z)((0,u.Z)({},this.config),{},{style:n}));return a.setLocalTransform(this.getLocalTransform()),e&&this.children.forEach((function(t){if(!t.style.isMarker){var n=t.cloneNode(e);a.appendChild(n)}})),a}},{key:"initAttributes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={forceUpdateGeometry:!0};Ta.styleValueRegistry.processProperties(this,e,t),this.dirty()}},{key:"setAttribute",value:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];(0,D.Z)(n)||(r||n!==this.attributes[e])&&(this.internalSetAttribute(e,n,{memoize:i}),(0,W.Z)(t,"setAttribute",this,3)([e,n]))}},{key:"setAttributes",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.skipDispatchAttrModifiedEvent,a=void 0!==i&&i;if(a||(t=(0,u.Z)({},this.attributes),n=(0,u.Z)({},this.parsedStyle)),Ta.styleValueRegistry.processProperties(this,e,r),this.dirty(),!a)for(var o in e)this.dispatchAttrModifiedEvent(o,t[o],e[o],n[o])}},{key:"internalSetAttribute",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.attributes[e],i=this.parsedStyle[e];Ta.styleValueRegistry.processProperties(this,(0,V.Z)({},e,t),n),this.dirty(),this.dispatchAttrModifiedEvent(e,r,t,i)}},{key:"dispatchAttrModifiedEvent",value:function(e,t,n,r){var i,a=this.parsedStyle[e];if(this.isConnected)if(Pa.relatedNode=this,Pa.prevValue=t,Pa.newValue=n,Pa.attrName=e,Pa.prevParsedValue=r,Pa.newParsedValue=a,this.isMutationObserved)this.dispatchEvent(Pa);else{var o,s=!0===(null===(o=this.ownerDocument.defaultView.getConfig().future)||void 0===o?void 0:o.experimentalCancelEventPropagation);Pa.target=this,this.ownerDocument.defaultView.dispatchEvent(Pa,!0,s)}(this.isCustomElement&&this.isConnected||!this.isCustomElement)&&(null===(i=this.attributeChangedCallback)||void 0===i||i.call(this,e,t,n,r,a))}},{key:"getBBox",value:function(){var e=this.getBounds(),t=e.getMin(),n=(0,h.Z)(t,2),r=n[0],i=n[1],a=e.getMax(),o=(0,h.Z)(a,2),s=o[0],l=o[1];return new Re(r,i,s-r,l-i)}},{key:"setOrigin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Ta.sceneGraphService.setOrigin(this,Ne(e,t,n,!1)),this}},{key:"getOrigin",value:function(){return Ta.sceneGraphService.getOrigin(this)}},{key:"setPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Ta.sceneGraphService.setPosition(this,Ne(e,t,n,!1)),this}},{key:"setLocalPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Ta.sceneGraphService.setLocalPosition(this,Ne(e,t,n,!1)),this}},{key:"translate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Ta.sceneGraphService.translate(this,Ne(e,t,n,!1)),this}},{key:"translateLocal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Ta.sceneGraphService.translateLocal(this,Ne(e,t,n,!1)),this}},{key:"getPosition",value:function(){return Ta.sceneGraphService.getPosition(this)}},{key:"getLocalPosition",value:function(){return Ta.sceneGraphService.getLocalPosition(this)}},{key:"scale",value:function(e,t,n){return this.scaleLocal(e,t,n)}},{key:"scaleLocal",value:function(e,t,n){return"number"==typeof e&&(e=Ne(e,t=t||e,n=n||e,!1)),Ta.sceneGraphService.scaleLocal(this,e),this}},{key:"setLocalScale",value:function(e,t,n){return"number"==typeof e&&(e=Ne(e,t=t||e,n=n||e,!1)),Ta.sceneGraphService.setLocalScale(this,e),this}},{key:"getLocalScale",value:function(){return Ta.sceneGraphService.getLocalScale(this)}},{key:"getScale",value:function(){return Ta.sceneGraphService.getScale(this)}},{key:"getEulerAngles",value:function(){var e=Ie(Oa,Ta.sceneGraphService.getWorldTransform(this));return Pe((0,h.Z)(e,3)[2])}},{key:"getLocalEulerAngles",value:function(){var e=Ie(Oa,Ta.sceneGraphService.getLocalRotation(this));return Pe((0,h.Z)(e,3)[2])}},{key:"setEulerAngles",value:function(e){return Ta.sceneGraphService.setEulerAngles(this,0,0,e),this}},{key:"setLocalEulerAngles",value:function(e){return Ta.sceneGraphService.setLocalEulerAngles(this,0,0,e),this}},{key:"rotateLocal",value:function(e,t,n){return(0,T.Z)(t)&&(0,T.Z)(n)?Ta.sceneGraphService.rotateLocal(this,0,0,e):Ta.sceneGraphService.rotateLocal(this,e,t,n),this}},{key:"rotate",value:function(e,t,n){return(0,T.Z)(t)&&(0,T.Z)(n)?Ta.sceneGraphService.rotate(this,0,0,e):Ta.sceneGraphService.rotate(this,e,t,n),this}},{key:"setRotation",value:function(e,t,n,r){return Ta.sceneGraphService.setRotation(this,e,t,n,r),this}},{key:"setLocalRotation",value:function(e,t,n,r){return Ta.sceneGraphService.setLocalRotation(this,e,t,n,r),this}},{key:"setLocalSkew",value:function(e,t){return Ta.sceneGraphService.setLocalSkew(this,e,t),this}},{key:"getRotation",value:function(){return Ta.sceneGraphService.getRotation(this)}},{key:"getLocalRotation",value:function(){return Ta.sceneGraphService.getLocalRotation(this)}},{key:"getLocalSkew",value:function(){return Ta.sceneGraphService.getLocalSkew(this)}},{key:"getLocalTransform",value:function(){return Ta.sceneGraphService.getLocalTransform(this)}},{key:"getWorldTransform",value:function(){return Ta.sceneGraphService.getWorldTransform(this)}},{key:"setLocalTransform",value:function(e){return Ta.sceneGraphService.setLocalTransform(this,e),this}},{key:"resetLocalTransform",value:function(){Ta.sceneGraphService.resetLocalTransform(this)}},{key:"getAnimations",value:function(){return this.activeAnimations}},{key:"animate",value:function(e,t){var n,r=null===(n=this.ownerDocument)||void 0===n?void 0:n.timeline;return r?r.play(this,e,t):null}},{key:"isVisible",value:function(){var e;return"hidden"!==(null===(e=this.parsedStyle)||void 0===e?void 0:e.visibility)}},{key:"interactive",get:function(){return this.isInteractive()},set:function(e){this.style.pointerEvents=e?"auto":"none"}},{key:"isInteractive",value:function(){var e;return"none"!==(null===(e=this.parsedStyle)||void 0===e?void 0:e.pointerEvents)}},{key:"isCulled",value:function(){return!(!this.cullable||!this.cullable.enable||this.cullable.visible)}},{key:"toFront",value:function(){return this.parentNode&&(this.style.zIndex=Math.max.apply(Math,(0,c.Z)(this.parentNode.children.map((function(e){return Number(e.style.zIndex)}))))+1),this}},{key:"toBack",value:function(){return this.parentNode&&(this.style.zIndex=Math.min.apply(Math,(0,c.Z)(this.parentNode.children.map((function(e){return Number(e.style.zIndex)}))))-1),this}},{key:"getConfig",value:function(){return this.config}},{key:"attr",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n[0],a=n[1];return i?(0,Z.Z)(i)?(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),this):2===n.length?(this.setAttribute(i,a),this):this.attributes[i]:this.attributes}},{key:"getMatrix",value:function(e){var t=e||this.getWorldTransform(),n=p.getTranslation(Oa,t),r=(0,h.Z)(n,2),i=r[0],a=r[1],o=p.getScaling(Oa,t),s=(0,h.Z)(o,2),l=s[0],u=s[1],c=p.getRotation(Ia,t),d=Ie(Oa,c),f=(0,h.Z)(d,3),v=f[0],m=f[2];return function(e,t,n,r,i){var a=Math.cos(e),o=Math.sin(e);return g.fromValues(r*a,i*o,0,-r*o,i*a,0,t,n,1)}(v||m,i,a,l,u)}},{key:"getLocalMatrix",value:function(){return this.getMatrix(this.getLocalTransform())}},{key:"setMatrix",value:function(e){var t=we(e),n=(0,h.Z)(t,5),r=n[0],i=n[1],a=n[2],o=n[3],s=n[4];this.setEulerAngles(s).setPosition(r,i).setLocalScale(a,o)}},{key:"setLocalMatrix",value:function(e){var t=we(e),n=(0,h.Z)(t,5),r=n[0],i=n[1],a=n[2],o=n[3],s=n[4];this.setLocalEulerAngles(s).setLocalPosition(r,i).setLocalScale(a,o)}},{key:"show",value:function(){this.forEach((function(e){e.style.visibility="visible"}))}},{key:"hide",value:function(){this.forEach((function(e){e.style.visibility="hidden"}))}},{key:"getCount",value:function(){return this.childElementCount}},{key:"getParent",value:function(){return this.parentElement}},{key:"getChildren",value:function(){return this.children}},{key:"getFirst",value:function(){return this.firstElementChild}},{key:"getLast",value:function(){return this.lastElementChild}},{key:"getChildByIndex",value:function(e){return this.children[e]||null}},{key:"add",value:function(e,t){return this.appendChild(e,t)}},{key:"set",value:function(e,t){this.config[e]=t}},{key:"get",value:function(e){return this.config[e]}},{key:"moveTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.setPosition(e,t,n),this}},{key:"move",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.setPosition(e,t,n),this}},{key:"setZIndex",value:function(e){return this.style.zIndex=e,this}}])}(Ma);wa.PARSED_STYLE_LIST=new Set(["class","className","clipPath","cursor","display","draggable","droppable","fill","fillOpacity","fillRule","filter","increasedLineWidthForHitTesting","lineCap","lineDash","lineDashOffset","lineJoin","lineWidth","miterLimit","hitArea","offsetDistance","offsetPath","offsetX","offsetY","opacity","pointerEvents","shadowColor","shadowType","shadowBlur","shadowOffsetX","shadowOffsetY","stroke","strokeOpacity","strokeWidth","strokeLinecap","strokeLineJoin","strokeDasharray","strokeDashoffset","transform","transformOrigin","textTransform","visibility","zIndex"]);var La=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:ue.CIRCLE},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(wa);La.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(wa.PARSED_STYLE_LIST),["cx","cy","cz","r","isBillboard","isSizeAttenuation"]));var Da=["style"],Ba=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,le.Z)(n,Da);return(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({style:r},i)])).isCustomElement=!0,e}return(0,l.Z)(t,e),(0,a.Z)(t)}(wa);Ba.PARSED_STYLE_LIST=new Set(["class","className","clipPath","cursor","draggable","droppable","opacity","pointerEvents","transform","transformOrigin","zIndex","visibility"]);var Fa=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:ue.ELLIPSE},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(wa);Fa.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(wa.PARSED_STYLE_LIST),["cx","cy","cz","rx","ry","isBillboard","isSizeAttenuation"])),(function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,[{type:ue.FRAGMENT}])}return(0,l.Z)(t,e),(0,a.Z)(t)}(wa)).PARSED_STYLE_LIST=new Set(["class","className"]);var Ua=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:ue.GROUP},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(wa);Ua.PARSED_STYLE_LIST=new Set(["class","className","clipPath","cursor","draggable","droppable","opacity","pointerEvents","transform","transformOrigin","zIndex","visibility"]);var Za=["style"],Ga=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,le.Z)(n,Za);return(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:ue.HTML,style:r},i)])).cullable.enable=!1,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getDomElement",value:function(){return this.parsedStyle.$el}},{key:"getClientRects",value:function(){return[this.getBoundingClientRect()]}},{key:"getLocalBounds",value:function(){if(this.parentNode){var e=p.invert(p.create(),this.parentNode.getWorldTransform()),t=this.getBounds();if(!Ee.isEmpty(t)){var n=new Ee;return n.setFromTransformedAABB(t,e),n}}return this.getBounds()}}])}(wa);Ga.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(wa.PARSED_STYLE_LIST),["x","y","$el","innerHTML","width","height"]));var Va=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:ue.IMAGE},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(wa);Va.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(wa.PARSED_STYLE_LIST),["x","y","z","src","width","height","isBillboard","billboardRotation","isSizeAttenuation","keepAspectRatio"]));var Wa=["style"],Ha=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,le.Z)(n,Wa);(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:ue.LINE,style:(0,u.Z)({x1:0,y1:0,x2:0,y2:0,z1:0,z2:0},r)},i)])).markerStartAngle=0,e.markerEndAngle=0;var a=e.parsedStyle,l=a.markerStart,c=a.markerEnd;return l&&Ca(l)&&(e.markerStartAngle=l.getLocalEulerAngles(),e.appendChild(l)),c&&Ca(c)&&(e.markerEndAngle=c.getLocalEulerAngles(),e.appendChild(c)),e.transformMarker(!0),e.transformMarker(!1),e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"attributeChangedCallback",value:function(e,t,n,r,i){"x1"===e||"y1"===e||"x2"===e||"y2"===e||"markerStartOffset"===e||"markerEndOffset"===e?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===e?(r&&Ca(r)&&(this.markerStartAngle=0,r.remove()),i&&Ca(i)&&(this.markerStartAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!0))):"markerEnd"===e&&(r&&Ca(r)&&(this.markerEndAngle=0,r.remove()),i&&Ca(i)&&(this.markerEndAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!1)))}},{key:"transformMarker",value:function(e){var t=this.parsedStyle,n=t.markerStart,r=t.markerEnd,i=t.markerStartOffset,a=t.markerEndOffset,o=t.x1,s=t.x2,l=t.y1,u=t.y2,c=e?n:r;if(c&&Ca(c)){var h,d,f,v,p,g,m;e?(v=o,p=l,d=s-o,f=u-l,g=i||0,m=this.markerStartAngle):(v=s,p=u,d=o-s,f=l-u,g=a||0,m=this.markerEndAngle),h=Math.atan2(f,d),c.setLocalEulerAngles(180*h/Math.PI+m),c.setLocalPosition(v+Math.cos(h)*g,p+Math.sin(h)*g)}}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.parsedStyle,r=n.x1,i=n.y1,a=n.x2,o=n.y2,s=$(r,i,a,o,e),l=s.x,u=s.y,c=f.transformMat4(f.create(),f.fromValues(l,u,0),t?this.getWorldTransform():this.getLocalTransform());return new Se(c[0],c[1])}},{key:"getPointAtLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getPoint(e/this.getTotalLength(),t)}},{key:"getTotalLength",value:function(){var e=this.parsedStyle;return q(e.x1,e.y1,e.x2,e.y2)}}])}(wa);Ha.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(wa.PARSED_STYLE_LIST),["x1","y1","x2","y2","z1","z2","isBillboard","isSizeAttenuation","markerStart","markerEnd","markerStartOffset","markerEndOffset"]));var Xa=["style"],za=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,le.Z)(n,Xa);(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:ue.PATH,style:r,initialParsedStyle:{miterLimit:4,d:(0,u.Z)({},Je)}},i)])).markerStartAngle=0,e.markerEndAngle=0,e.markerMidList=[];var a=e.parsedStyle,l=a.markerStart,c=a.markerEnd,h=a.markerMid;return l&&Ca(l)&&(e.markerStartAngle=l.getLocalEulerAngles(),e.appendChild(l)),h&&Ca(h)&&e.placeMarkerMid(h),c&&Ca(c)&&(e.markerEndAngle=c.getLocalEulerAngles(),e.appendChild(c)),e.transformMarker(!0),e.transformMarker(!1),e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"attributeChangedCallback",value:function(e,t,n,r,i){"d"===e?(this.transformMarker(!0),this.transformMarker(!1),this.placeMarkerMid(this.parsedStyle.markerMid)):"markerStartOffset"===e||"markerEndOffset"===e?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===e?(r&&Ca(r)&&(this.markerStartAngle=0,r.remove()),i&&Ca(i)&&(this.markerStartAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!0))):"markerEnd"===e?(r&&Ca(r)&&(this.markerEndAngle=0,r.remove()),i&&Ca(i)&&(this.markerEndAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!1))):"markerMid"===e&&this.placeMarkerMid(i)}},{key:"transformMarker",value:function(e){var t=this.parsedStyle,n=t.markerStart,r=t.markerEnd,i=t.markerStartOffset,a=t.markerEndOffset,o=e?n:r;if(o&&Ca(o)){var s,l,u,c,d,f,v;if(e){var p=this.getStartTangent(),g=(0,h.Z)(p,2),m=g[0],y=g[1];c=y[0],d=y[1],l=m[0]-y[0],u=m[1]-y[1],f=i||0,v=this.markerStartAngle}else{var E=this.getEndTangent(),_=(0,h.Z)(E,2),T=_[0],S=_[1];c=S[0],d=S[1],l=T[0]-S[0],u=T[1]-S[1],f=a||0,v=this.markerEndAngle}s=Math.atan2(u,l),o.setLocalEulerAngles(180*s/Math.PI+v),o.setLocalPosition(c+Math.cos(s)*f,d+Math.sin(s)*f)}}},{key:"placeMarkerMid",value:function(e){var t=this.parsedStyle.d.segments;if(this.markerMidList.forEach((function(e){e.remove()})),e&&Ca(e))for(var n=1;n<t.length-1;n++){var r=(0,h.Z)(t[n].currentPoint,2),i=r[0],a=r[1],o=1===n?e:e.cloneNode(!0);this.markerMidList.push(o),this.appendChild(o),o.setLocalPosition(i,a)}}},{key:"getTotalLength",value:function(){return Vn(this)}},{key:"getPointAtLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.parsedStyle.d.absolutePath,r=(0,G.r)(n,e),i=r.x,a=r.y,o=f.transformMat4(f.create(),f.fromValues(i,a,0),t?this.getWorldTransform():this.getLocalTransform());return new Se(o[0],o[1])}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getPointAtLength(e*Vn(this),t)}},{key:"getStartTangent",value:function(){var e=this.parsedStyle.d.segments,t=[];if(e.length>1){var n=e[0].currentPoint,r=e[1].currentPoint,i=e[1].startTangent;t=[],i?(t.push([n[0]-i[0],n[1]-i[1]]),t.push([n[0],n[1]])):(t.push([r[0],r[1]]),t.push([n[0],n[1]]))}return t}},{key:"getEndTangent",value:function(){var e=this.parsedStyle.d.segments,t=e.length,n=[];if(t>1){var r=e[t-2].currentPoint,i=e[t-1].currentPoint,a=e[t-1].endTangent;n=[],a?(n.push([i[0]-a[0],i[1]-a[1]]),n.push([i[0],i[1]])):(n.push([r[0],r[1]]),n.push([i[0],i[1]]))}return n}}])}(wa);za.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(wa.PARSED_STYLE_LIST),["d","markerStart","markerMid","markerEnd","markerStartOffset","markerEndOffset","isBillboard","isSizeAttenuation"]));var Ya=["style"],ja=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,le.Z)(n,Ya);(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:ue.POLYGON,style:r,initialParsedStyle:{points:{points:[],totalLength:0,segments:[]},miterLimit:4,isClosed:!0}},i)])).markerStartAngle=0,e.markerEndAngle=0,e.markerMidList=[];var a=e.parsedStyle,l=a.markerStart,c=a.markerEnd,h=a.markerMid;return l&&Ca(l)&&(e.markerStartAngle=l.getLocalEulerAngles(),e.appendChild(l)),h&&Ca(h)&&e.placeMarkerMid(h),c&&Ca(c)&&(e.markerEndAngle=c.getLocalEulerAngles(),e.appendChild(c)),e.transformMarker(!0),e.transformMarker(!1),e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"attributeChangedCallback",value:function(e,t,n,r,i){"points"===e?(this.transformMarker(!0),this.transformMarker(!1),this.placeMarkerMid(this.parsedStyle.markerMid)):"markerStartOffset"===e||"markerEndOffset"===e?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===e?(r&&Ca(r)&&(this.markerStartAngle=0,r.remove()),i&&Ca(i)&&(this.markerStartAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!0))):"markerEnd"===e?(r&&Ca(r)&&(this.markerEndAngle=0,r.remove()),i&&Ca(i)&&(this.markerEndAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!1))):"markerMid"===e&&this.placeMarkerMid(i)}},{key:"transformMarker",value:function(e){var t=this.parsedStyle,n=t.markerStart,r=t.markerEnd,i=t.markerStartOffset,a=t.markerEndOffset,o=(t.points||{}).points,s=e?n:r;if(s&&Ca(s)&&o){var l,u,c,h,d,f,v;if(h=o[0][0],d=o[0][1],e)u=o[1][0]-o[0][0],c=o[1][1]-o[0][1],f=i||0,v=this.markerStartAngle;else{var p=o.length;this.parsedStyle.isClosed?(u=o[p-1][0]-o[0][0],c=o[p-1][1]-o[0][1]):(h=o[p-1][0],d=o[p-1][1],u=o[p-2][0]-o[p-1][0],c=o[p-2][1]-o[p-1][1]),f=a||0,v=this.markerEndAngle}l=Math.atan2(c,u),s.setLocalEulerAngles(180*l/Math.PI+v),s.setLocalPosition(h+Math.cos(l)*f,d+Math.sin(l)*f)}}},{key:"placeMarkerMid",value:function(e){var t=(this.parsedStyle.points||{}).points;if(this.markerMidList.forEach((function(e){e.remove()})),this.markerMidList=[],e&&Ca(e)&&t)for(var n=1;n<(this.parsedStyle.isClosed?t.length:t.length-1);n++){var r=t[n][0],i=t[n][1],a=1===n?e:e.cloneNode(!0);this.markerMidList.push(a),this.appendChild(a),a.setLocalPosition(r,i)}}}])}(wa);ja.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(wa.PARSED_STYLE_LIST),["points","markerStart","markerMid","markerEnd","markerStartOffset","markerEndOffset","isClosed","isBillboard","isSizeAttenuation"]));var Ka=["style"],qa=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.style,r=(0,le.Z)(e,Ka);return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:ue.POLYLINE,style:n,initialParsedStyle:{points:{points:[],totalLength:0,segments:[]},miterLimit:4,isClosed:!1}},r)])}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getTotalLength",value:function(){return Wn(this)}},{key:"getPointAtLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getPoint(e/this.getTotalLength(),t)}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.parsedStyle.points.points;if(0===this.parsedStyle.points.segments.length){var r,i,a=[],o=0,s=this.getTotalLength();n.forEach((function(e,t){n[t+1]&&((r=[0,0])[0]=o/s,i=q(e[0],e[1],n[t+1][0],n[t+1][1]),o+=i,r[1]=o/s,a.push(r))})),this.parsedStyle.points.segments=a}var l=0,u=0;this.parsedStyle.points.segments.forEach((function(t,n){e>=t[0]&&e<=t[1]&&(l=(e-t[0])/(t[1]-t[0]),u=n)}));var c=$(n[u][0],n[u][1],n[u+1][0],n[u+1][1],l),h=c.x,d=c.y,v=f.transformMat4(f.create(),f.fromValues(h,d,0),t?this.getWorldTransform():this.getLocalTransform());return new Se(v[0],v[1])}},{key:"getStartTangent",value:function(){var e=this.parsedStyle.points.points,t=[];return t.push([e[1][0],e[1][1]]),t.push([e[0][0],e[0][1]]),t}},{key:"getEndTangent",value:function(){var e=this.parsedStyle.points.points,t=e.length-1,n=[];return n.push([e[t-1][0],e[t-1][1]]),n.push([e[t][0],e[t][1]]),n}}])}(ja);qa.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(ja.PARSED_STYLE_LIST),["points","markerStart","markerMid","markerEnd","markerStartOffset","markerEndOffset","isBillboard"]));var $a=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:ue.RECT},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(wa);$a.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(wa.PARSED_STYLE_LIST),["x","y","z","width","height","isBillboard","isSizeAttenuation","radius"]));var Qa=["style"],Ja=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.style,r=(0,le.Z)(e,Qa);return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:ue.TEXT,style:(0,u.Z)({fill:"black"},n)},r)])}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getComputedTextLength",value:function(){var e;return this.getGeometryBounds(),(null===(e=this.parsedStyle.metrics)||void 0===e?void 0:e.maxLineWidth)||0}},{key:"getLineBoundingRects",value:function(){var e;return this.getGeometryBounds(),(null===(e=this.parsedStyle.metrics)||void 0===e?void 0:e.lineMetrics)||[]}},{key:"isOverflowing",value:function(){return this.getGeometryBounds(),!!this.parsedStyle.isOverflowing}}])}(wa);Ja.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(wa.PARSED_STYLE_LIST),["x","y","z","isBillboard","billboardRotation","isSizeAttenuation","text","textAlign","textBaseline","fontStyle","fontSize","fontFamily","fontWeight","fontVariant","lineHeight","letterSpacing","leading","wordWrap","wordWrapWidth","maxLines","textOverflow","isOverflowing","textPath","textDecorationLine","textDecorationColor","textDecorationStyle","textDecorationThickness","textPathSide","textPathStartOffset","metrics","dx","dy"]));var eo=function(){function e(t){(0,o.Z)(this,e),this.strategies=t}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=t.config,r=t.camera,i=t.renderingService,a=t.renderingContext,o=this.strategies;i.hooks.cull.tap(e.tag,(function(e){if(e){var t,i=e.cullable;if(0===o.length?i.visible=a.unculledEntities.indexOf(e.entity)>-1:i.visible=o.every((function(t){return t.isVisible(r,e)})),!e.isCulled()&&e.isVisible())return e;var s=!0===(null===(t=n.future)||void 0===t?void 0:t.experimentalCancelEventPropagation);return e.dispatchEvent(new Fi(Xi.CULLED),s,s),null}return e})),i.hooks.afterRender.tap(e.tag,(function(e){e.cullable.visibilityPlaneMask=-1}))}}])}();eo.tag="Culling";var to=function(){function e(){var t=this;(0,o.Z)(this,e),this.autoPreventDefault=!1,this.rootPointerEvent=new Di(null),this.rootWheelEvent=new Bi(null),this.onPointerMove=function(e){var n,r=null===(n=t.context.renderingContext.root)||void 0===n||null===(n=n.ownerDocument)||void 0===n?void 0:n.defaultView;if(!r.supportsTouchEvents||"touch"!==e.pointerType){var i,a=t.normalizeToPointerEvent(e,r),o=(0,se.Z)(a);try{for(o.s();!(i=o.n()).done;){var s=i.value,l=t.bootstrapEvent(t.rootPointerEvent,s,r,e);t.context.eventService.mapEvent(l)}}catch(e){o.e(e)}finally{o.f()}t.setCursor(t.context.eventService.cursor)}},this.onClick=function(e){var n,r,i=null===(n=t.context.renderingContext.root)||void 0===n||null===(n=n.ownerDocument)||void 0===n?void 0:n.defaultView,a=t.normalizeToPointerEvent(e,i),o=(0,se.Z)(a);try{for(o.s();!(r=o.n()).done;){var s=r.value,l=t.bootstrapEvent(t.rootPointerEvent,s,i,e);t.context.eventService.mapEvent(l)}}catch(e){o.e(e)}finally{o.f()}t.setCursor(t.context.eventService.cursor)}}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=this;this.context=t;var r=t.renderingService,i=this.context.renderingContext.root.ownerDocument.defaultView;this.context.eventService.setPickHandler((function(e){return n.context.renderingService.hooks.pickSync.call({position:e,picked:[],topmost:!0}).picked[0]||null})),r.hooks.pointerWheel.tap(e.tag,(function(e){var t=n.normalizeWheelEvent(e);n.context.eventService.mapEvent(t)})),r.hooks.pointerDown.tap(e.tag,(function(e){if(!i.supportsTouchEvents||"touch"!==e.pointerType){var t=n.normalizeToPointerEvent(e,i);if(n.autoPreventDefault&&t[0].isNormalized)(e.cancelable||!("cancelable"in e))&&e.preventDefault();var r,a=(0,se.Z)(t);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=n.bootstrapEvent(n.rootPointerEvent,o,i,e);n.context.eventService.mapEvent(s)}}catch(e){a.e(e)}finally{a.f()}n.setCursor(n.context.eventService.cursor)}})),r.hooks.pointerUp.tap(e.tag,(function(e){if(!i.supportsTouchEvents||"touch"!==e.pointerType){var t,r=n.context.contextService.getDomElement(),a=n.context.eventService.isNativeEventFromCanvas(r,e)?"":"outside",o=n.normalizeToPointerEvent(e,i),s=(0,se.Z)(o);try{for(s.s();!(t=s.n()).done;){var l=t.value,u=n.bootstrapEvent(n.rootPointerEvent,l,i,e);u.type+=a,n.context.eventService.mapEvent(u)}}catch(e){s.e(e)}finally{s.f()}n.setCursor(n.context.eventService.cursor)}})),r.hooks.pointerMove.tap(e.tag,this.onPointerMove),r.hooks.pointerOver.tap(e.tag,this.onPointerMove),r.hooks.pointerOut.tap(e.tag,this.onPointerMove),r.hooks.click.tap(e.tag,this.onClick),r.hooks.pointerCancel.tap(e.tag,(function(e){var t,r=n.normalizeToPointerEvent(e,i),a=(0,se.Z)(r);try{for(a.s();!(t=a.n()).done;){var o=t.value,s=n.bootstrapEvent(n.rootPointerEvent,o,i,e);n.context.eventService.mapEvent(s)}}catch(e){a.e(e)}finally{a.f()}n.setCursor(n.context.eventService.cursor)}))}},{key:"bootstrapEvent",value:function(e,t,n,r){e.view=n,e.originalEvent=null,e.nativeEvent=r,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t);var i=this.context.eventService.client2Viewport({x:t.clientX,y:t.clientY}),a=i.x,o=i.y;e.viewport.x=a,e.viewport.y=o;var s=this.context.eventService.viewport2Canvas(e.viewport),l=s.x,u=s.y;return e.canvas.x=l,e.canvas.y=u,e.global.copyFrom(e.canvas),e.offset.copyFrom(e.canvas),e.isTrusted=r.isTrusted,"pointerleave"===e.type&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=Kr[e.type]||e.type),e}},{key:"normalizeWheelEvent",value:function(e){var t=this.rootWheelEvent;this.transferMouseData(t,e),t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ;var n=this.context.eventService.client2Viewport({x:e.clientX,y:e.clientY}),r=n.x,i=n.y;t.viewport.x=r,t.viewport.y=i;var a=this.context.eventService.viewport2Canvas(t.viewport),o=a.x,s=a.y;return t.canvas.x=o,t.canvas.y=s,t.global.copyFrom(t.canvas),t.offset.copyFrom(t.canvas),t.nativeEvent=e,t.type=e.type,t}},{key:"transferMouseData",value:function(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=qr.now(),e.type=t.type,e.altKey=t.altKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey,e.ctrlKey=t.ctrlKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.screen.x=t.screenX,e.screen.y=t.screenY,e.relatedTarget=null}},{key:"setCursor",value:function(e){this.context.contextService.applyCursorStyle(e||this.context.config.cursor||"default")}},{key:"normalizeToPointerEvent",value:function(e,t){var n=[];if(t.isTouchEvent(e))for(var r=0;r<e.changedTouches.length;r++){var i=e.changedTouches[r];(0,D.Z)(i.button)&&(i.button=0),(0,D.Z)(i.buttons)&&(i.buttons=1),(0,D.Z)(i.isPrimary)&&(i.isPrimary=1===e.touches.length&&"touchstart"===e.type),(0,D.Z)(i.width)&&(i.width=i.radiusX||1),(0,D.Z)(i.height)&&(i.height=i.radiusY||1),(0,D.Z)(i.tiltX)&&(i.tiltX=0),(0,D.Z)(i.tiltY)&&(i.tiltY=0),(0,D.Z)(i.pointerType)&&(i.pointerType="touch"),(0,D.Z)(i.pointerId)&&(i.pointerId=i.identifier||0),(0,D.Z)(i.pressure)&&(i.pressure=i.force||.5),(0,D.Z)(i.twist)&&(i.twist=0),(0,D.Z)(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,i.type=e.type,n.push(i)}else if(t.isMouseEvent(e)){var a=e;(0,D.Z)(a.isPrimary)&&(a.isPrimary=!0),(0,D.Z)(a.width)&&(a.width=1),(0,D.Z)(a.height)&&(a.height=1),(0,D.Z)(a.tiltX)&&(a.tiltX=0),(0,D.Z)(a.tiltY)&&(a.tiltY=0),(0,D.Z)(a.pointerType)&&(a.pointerType="mouse"),(0,D.Z)(a.pointerId)&&(a.pointerId=1),(0,D.Z)(a.pressure)&&(a.pressure=.5),(0,D.Z)(a.twist)&&(a.twist=0),(0,D.Z)(a.tangentialPressure)&&(a.tangentialPressure=0),a.isNormalized=!0,n.push(a)}else n.push(e);return n}}])}();to.tag="Event";ue.CIRCLE,ue.ELLIPSE,ue.IMAGE,ue.RECT,ue.LINE,ue.POLYLINE,ue.POLYGON,ue.TEXT,ue.PATH,ue.HTML;var no=function(){function e(){(0,o.Z)(this,e),this.mutationRecords=[],this.isFirstTimeRendering=!0,this.isFirstTimeRenderingFinished=!1}return(0,a.Z)(e,[{key:"apply",value:function(t){var n,r=this,i=t.renderingService,a=t.renderingContext.root.ownerDocument.defaultView,o=function(e){i.dirty()},s=function(e){var t,n=e.detail;(t=r.mutationRecords).push.apply(t,(0,c.Z)(n)),i.dirty()},l=function(e){var t=e.target;Ta.enableSizeAttenuation&&Ta.styleValueRegistry.updateSizeAttenuation(t,a.getCamera().getZoom())},u=function(e){var t=e.target;Ta.sceneGraphService.dirtyToRoot(t),i.dirty()};i.hooks.init.tap(e.tag,(function(){a.addEventListener(Xi.MOUNTED,l),a.addEventListener(Xi.UNMOUNTED,u),a.addEventListener(Xi.ATTR_MODIFIED,o),a.addEventListener(Xi.BOUNDS_CHANGED,s)})),i.hooks.destroy.tap(e.tag,(function(){a.removeEventListener(Xi.MOUNTED,l),a.removeEventListener(Xi.UNMOUNTED,u),a.removeEventListener(Xi.ATTR_MODIFIED,o),a.removeEventListener(Xi.BOUNDS_CHANGED,s),r.mutationRecords=[]}));var h=null!==(n=Ta.globalThis.requestIdleCallback)&&void 0!==n?n:si.bind(Ta.globalThis);i.hooks.endFrame.tap(e.tag,(function(){r.isFirstTimeRendering&&(r.isFirstTimeRendering=!1,h((function(){r.isFirstTimeRenderingFinished=!0}))),r.mutationRecords=[]}))}}])}();no.tag="Prepare";var ro=function(e){return e.READY="ready",e.BEFORE_RENDER="beforerender",e.RERENDER="rerender",e.AFTER_RENDER="afterrender",e.BEFORE_DESTROY="beforedestroy",e.AFTER_DESTROY="afterdestroy",e.RESIZE="resize",e.DIRTY_RECTANGLE="dirtyrectangle",e.RENDERER_CHANGED="rendererchanged",e}({});new Fi(Xi.MOUNTED),new Fi(Xi.UNMOUNTED),new Fi(ro.BEFORE_RENDER),new Fi(ro.RERENDER),new Fi(ro.AFTER_RENDER),new WeakMap;var io=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.cacheStore=new Map}),[{key:"onRefAdded",value:function(e){}},{key:"has",value:function(e){return this.cacheStore.has(e)}},{key:"put",value:function(e,t,n){return!this.cacheStore.has(e)&&(this.cacheStore.set(e,{value:t,counter:new Set([n.entity])}),this.onRefAdded(n),!0)}},{key:"get",value:function(e,t){var n=this.cacheStore.get(e);return n?(n.counter.has(t.entity)||(n.counter.add(t.entity),this.onRefAdded(t)),n.value):null}},{key:"update",value:function(e,t,n){var r=this.cacheStore.get(e);return!!r&&(r.value=(0,u.Z)((0,u.Z)({},r.value),t),r.counter.has(n.entity)||(r.counter.add(n.entity),this.onRefAdded(n)),!0)}},{key:"release",value:function(e,t){var n=this.cacheStore.get(e);return!!n&&(n.counter.delete(t.entity),n.counter.size<=0&&this.cacheStore.delete(e),!0)}},{key:"releaseRef",value:function(e){var t=this;Array.from(this.cacheStore.keys()).forEach((function(n){t.release(n,e)}))}},{key:"getSize",value:function(){return this.cacheStore.size}},{key:"clear",value:function(){this.cacheStore.clear()}}])}(),ao=[],oo=[],so=function(){function e(){(0,o.Z)(this,e)}return(0,a.Z)(e,null,[{key:"stop",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.api;e.rafId&&(t.cancelAnimationFrame(e.rafId),e.rafId=null)}},{key:"executeTask",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.api;ao.length<=0&&oo.length<=0||(oo.forEach((function(e){return e()})),oo=ao.splice(0,e.TASK_NUM_PER_FRAME),e.rafId=t.requestAnimationFrame((function(){e.executeTask(t)})))}},{key:"sliceImage",value:function(t,n,r,i){for(var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.api,s=t.naturalWidth||t.width,l=t.naturalHeight||t.height,u=n-a,c=r-a,h=Math.ceil(s/u),d=Math.ceil(l/c),f={tileSize:[n,r],gridSize:[d,h],tiles:Array(d).fill(null).map((function(){return Array(h).fill(null)}))},v=function(e){for(var a=function(a){ao.push((function(){var h=a*u,d=e*c,v=[Math.min(n,s-h),Math.min(r,l-d)],p=v[0],g=v[1],m=o.createCanvas();m.width=n,m.height=r,m.getContext("2d").drawImage(t,h,d,p,g,0,0,p,g),f.tiles[e][a]={x:h,y:d,tileX:a,tileY:e,data:m},i()}))},d=0;d<h;d++)a(d)},p=0;p<d;p++)v(p);return e.stop(),e.executeTask(),f}}])}();so.TASK_NUM_PER_FRAME=10;var lo=new io;lo.onRefAdded=function(e){var t=this;e.addEventListener(Xi.DESTROY,(function(){t.releaseRef(e)}),{once:!0})};var uo=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e),this.gradientCache={},this.patternCache={},this.context=t,this.runtime=n}),[{key:"getImageSync",value:function(e,t,n){var r=(0,S.Z)(e)?e:e.src;if(lo.has(r)){var i=lo.get(r,t);if(i.img.complete)return null==n||n(i),i}return this.getOrCreateImage(e,t).then((function(e){null==n||n(e)})).catch((function(e){console.error(e)})),null}},{key:"getOrCreateImage",value:function(e,t){var n=this,r=(0,S.Z)(e)?e:e.src;if(!(0,S.Z)(e)&&!lo.has(r)){var i={img:e,size:[e.naturalWidth||e.width,e.naturalHeight||e.height],tileSize:co(e)};lo.put(r,i,t)}if(lo.has(r)){var a=lo.get(r,t);return a.img.complete?Promise.resolve(a):new Promise((function(e,t){a.img.addEventListener("load",(function(){a.size=[a.img.naturalWidth||a.img.width,a.img.naturalHeight||a.img.height],a.tileSize=co(a.img),e(a)})),a.img.addEventListener("error",(function(e){t(e)}))}))}return new Promise((function(e,i){var a=n.context.config.createImage();if(a){var o={img:a,size:[0,0],tileSize:co(a)};lo.put(r,o,t),a.onload=function(){o.size=[a.naturalWidth||a.width,a.naturalHeight||a.height],o.tileSize=co(o.img),e(o)},a.onerror=function(e){i(e)},a.crossOrigin="Anonymous",a.src=r}}))}},{key:"createDownSampledImage",value:(t=(0,oe.Z)((0,ae.Z)().mark((function e(t,n){var r,i,a,o,s,l,c,d,f,v,p,g,m,y;return(0,ae.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.getOrCreateImage(t,n);case 1:if(void 0===(r=e.sent).downSamplingRate){e.next=2;break}return e.abrupt("return",r);case 2:if(i=this.context.config.enableLargeImageOptimization,o=(a="boolean"==typeof i?{}:i).maxDownSampledImageSize,s=void 0===o?2048:o,l=a.downSamplingRateThreshold,c=void 0===l?.5:l,d=this.runtime.globalThis.createImageBitmap,f=(0,h.Z)(r.size,2),v=f[0],p=f[1],g=r.img,m=Math.min((s+s)/(v+p),Math.max(.01,Math.min(c,.5))),y=(0,u.Z)((0,u.Z)({},r),{},{downSamplingRate:m}),lo.update(r.img.src,y,n),!d){e.next=7;break}return e.prev=3,e.next=4,d(r.img,{resizeWidth:v*m,resizeHeight:p*m});case 4:g=e.sent,e.next=6;break;case 5:e.prev=5,e.catch(3),m=1;case 6:e.next=8;break;case 7:m=1;case 8:return y=(0,u.Z)((0,u.Z)({},this.getImageSync(t,n)),{},{downSampled:g,downSamplingRate:m}),lo.update(r.img.src,y,n),e.abrupt("return",y);case 9:case"end":return e.stop()}}),e,this,[[3,5]])}))),function(e,n){return t.apply(this,arguments)})},{key:"createImageTiles",value:(e=(0,oe.Z)((0,ae.Z)().mark((function e(t,n,r,i){var a,o,s,l,c;return(0,ae.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.getOrCreateImage(t,i);case 1:return a=e.sent,o=i.ownerDocument.defaultView,s=o.requestAnimationFrame,l=o.cancelAnimationFrame,so.api={requestAnimationFrame:s,cancelAnimationFrame:l,createCanvas:function(){return Gi.createCanvas()}},c=(0,u.Z)((0,u.Z)({},a),so.sliceImage(a.img,a.tileSize[0],a.tileSize[0],r)),lo.update(a.img.src,c,i),e.abrupt("return",c);case 2:case"end":return e.stop()}}),e,this)}))),function(t,n,r,i){return e.apply(this,arguments)})},{key:"releaseImage",value:function(e,t){lo.release((0,S.Z)(e)?e:e.src,t)}},{key:"releaseImageRef",value:function(e){lo.releaseRef(e)}},{key:"getOrCreatePatternSync",value:function(e,t,n,r,i,a,o){var s=this.generatePatternKey(t);if(s&&this.patternCache[s])return this.patternCache[s];var l,u=t.image,c=t.repetition,h=t.transform,d=!1;if((0,S.Z)(u)){var f=this.getImageSync(u,e,o);l=null==f?void 0:f.img}else r?(l=r,d=!0):l=u;var v,g=l&&n.createPattern(l,c);g&&(v=h?Ti(dr(h),new wa({})):p.identity(p.create()),d&&p.scale(v,v,[1/i,1/i,1]),g.setTransform({a:v[0],b:v[1],c:v[4],d:v[5],e:v[12]+a[0],f:v[13]+a[1]}));return s&&g&&(this.patternCache[s]=g),g}},{key:"getOrCreateGradient",value:function(e,t){var n=this.generateGradientKey(e),r=e.type,i=e.steps,a=e.min,o=e.width,s=e.height,l=e.angle,u=e.cx,c=e.cy,h=e.size;if(this.gradientCache[n])return this.gradientCache[n];var d=null;if(r===Yt.LinearGradient){var f=function(e,t,n,r){var i=Ce(r.value),a=0+t/2,o=0+n/2,s=Math.abs(t*Math.cos(i))+Math.abs(n*Math.sin(i));return{x1:e[0]+a-Math.cos(i)*s/2,y1:e[1]+o-Math.sin(i)*s/2,x2:e[0]+a+Math.cos(i)*s/2,y2:e[1]+o+Math.sin(i)*s/2}}(a,o,s,l),v=f.x1,p=f.y1,g=f.x2,m=f.y2;d=t.createLinearGradient(v,p,g,m)}else if(r===Yt.RadialGradient){var y=function(e,t,n,r,i,a){var o=r.value,s=i.value;r.unit===Dt.kPercentage&&(o=r.value/100*t),i.unit===Dt.kPercentage&&(s=i.value/100*n);var l=Math.max((0,_.y)([0,0],[o,s]),(0,_.y)([0,n],[o,s]),(0,_.y)([t,n],[o,s]),(0,_.y)([t,0],[o,s]));return a&&(a instanceof $t?l=a.value:a instanceof Kt&&("closest-side"===a.value?l=Math.min(o,t-o,s,n-s):"farthest-side"===a.value?l=Math.max(o,t-o,s,n-s):"closest-corner"===a.value&&(l=Math.min((0,_.y)([0,0],[o,s]),(0,_.y)([0,n],[o,s]),(0,_.y)([t,n],[o,s]),(0,_.y)([t,0],[o,s]))))),{x:o+e[0],y:s+e[1],r:l}}(a,o,s,u,c,h),E=y.x,T=y.y,S=y.r;d=t.createRadialGradient(E,T,0,E,T,S)}return d&&(i.forEach((function(e){var t,n=e.offset,r=e.color;n.unit===Dt.kPercentage&&(null===(t=d)||void 0===t||t.addColorStop(n.value/100,r.toString()))})),this.gradientCache[n]=d),this.gradientCache[n]}},{key:"generateGradientKey",value:function(e){var t=e.type,n=e.min,r=e.width,i=e.height,a=e.steps,o=e.angle,s=e.cx,l=e.cy,u=e.size;return"gradient-".concat(t,"-").concat((null==o?void 0:o.toString())||0,"-").concat((null==s?void 0:s.toString())||0,"-").concat((null==l?void 0:l.toString())||0,"-").concat((null==u?void 0:u.toString())||0,"-").concat(n[0],"-").concat(n[1],"-").concat(r,"-").concat(i,"-").concat(a.map((function(e){var t=e.offset,n=e.color;return"".concat(t).concat(n)})).join("-"))}},{key:"generatePatternKey",value:function(e){var t=e.image,n=e.repetition;return(0,S.Z)(t)?"pattern-".concat(t,"-").concat(n):"rect"===t.nodeName?"pattern-".concat(t.entity,"-").concat(n):void 0}}]);var e,t}();function co(e){if(!e.complete)return[0,0];var t=e.naturalWidth||e.width,n=e.naturalHeight||e.height,r=256;return[256,512].forEach((function(e){Math.ceil(n/e)*Math.ceil(t/e)<1e3&&(r=e)})),[r,r]}uo.isSupportTile=!!Gi.createCanvas();var ho=function(){function e(){(0,o.Z)(this,e)}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=t.renderingService,r=t.renderingContext,i=t.imagePool,a=r.root.ownerDocument.defaultView,o=function(e,t,n){var r=e.parsedStyle,i=r.width,a=r.height;i&&!a?e.setAttribute("height",n/t*i):!i&&a&&e.setAttribute("width",t/n*a)},s=function(e){var t=e.target,r=t.nodeName,a=t.attributes;if(r===ue.IMAGE){var s=a.src,l=a.keepAspectRatio;i.getImageSync(s,t,(function(e){var r=e.img,i=r.width,a=r.height;l&&o(t,i,a),t.dirty(),n.dirty()}))}},l=function(e){var t=e.target,r=e.attrName,a=e.prevValue,s=e.newValue;t.nodeName===ue.IMAGE&&"src"===r&&(a!==s&&i.releaseImage(a,t),(0,S.Z)(s)&&i.getOrCreateImage(s,t).then((function(e){var r=e.img,i=r.width,a=r.height;t.attributes.keepAspectRatio&&o(t,i,a),t.dirty(),n.dirty()})).catch((function(){})))};n.hooks.init.tap(e.tag,(function(){a.addEventListener(Xi.MOUNTED,s),a.addEventListener(Xi.ATTR_MODIFIED,l)})),n.hooks.destroy.tap(e.tag,(function(){a.removeEventListener(Xi.MOUNTED,s),a.removeEventListener(Xi.ATTR_MODIFIED,l)}))}}])}();ho.tag="LoadImage";var fo=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).name="image-loader",e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(e){this.context.imagePool=new uo(this.context,e),this.addRenderingPlugin(new ho)}},{key:"destroy",value:function(){this.removeAllRenderingPlugins()}}])}(he),vo=Object.freeze({__proto__:null,ImagePool:uo,Plugin:fo}),po=function(){function e(){(0,o.Z)(this,e),this.displayObjectHTMLElementMap=new WeakMap}return(0,a.Z)(e,[{key:"joinTransformMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return"matrix(".concat([e[0],e[1],e[4],e[5],e[12]+t[0],e[13]+t[1]].join(","),")")}},{key:"apply",value:function(t,n){var r=this,i=t.camera,a=t.renderingContext,o=t.renderingService;this.context=t;var s=a.root.ownerDocument.defaultView,l=s.context.eventService.nativeHTMLMap,u=function(e,t){t.style.transform=r.joinTransformMatrix(e.getWorldTransform(),e.getOrigin())},c=function(e){var t=e.target;if(t.nodeName===ue.HTML){r.$camera||(r.$camera=r.createCamera(i));var n=r.getOrCreateEl(t);r.$camera.appendChild(n),Object.keys(t.attributes).forEach((function(e){r.updateAttribute(e,t)})),u(t,n),l.set(n,t)}},h=function(e){var t=e.target;if(t.nodeName===ue.HTML&&r.$camera){var n=r.getOrCreateEl(t);n&&(n.remove(),l.delete(n))}},d=function(e){var t=e.target;if(t.nodeName===ue.HTML){var n=e.attrName;r.updateAttribute(n,t)}},f=function(e){for(var t=e.detail,n=0;n<t.length;n++){var i=t[n].target;(i.nodeName===ue.FRAGMENT?i.childNodes:[i]).forEach((function(e){if(e.nodeName===ue.HTML){var t=r.getOrCreateEl(e);u(e,t)}}))}},v=function(){if(r.$camera){var e=r.context.config,t=e.width,n=e.height;r.$camera.parentElement.style.width="".concat(t||0,"px"),r.$camera.parentElement.style.height="".concat(n||0,"px")}};o.hooks.init.tap(e.tag,(function(){s.addEventListener(ro.RESIZE,v),s.addEventListener(Xi.MOUNTED,c),s.addEventListener(Xi.UNMOUNTED,h),s.addEventListener(Xi.ATTR_MODIFIED,d),s.addEventListener(Xi.BOUNDS_CHANGED,f)})),o.hooks.endFrame.tap(e.tag,(function(){r.$camera&&a.renderReasons.has(Vi.CAMERA_CHANGED)&&(r.$camera.style.transform=r.joinTransformMatrix(i.getOrthoMatrix()))})),o.hooks.destroy.tap(e.tag,(function(){r.$camera&&r.$camera.remove(),s.removeEventListener(ro.RESIZE,v),s.removeEventListener(Xi.MOUNTED,c),s.removeEventListener(Xi.UNMOUNTED,h),s.removeEventListener(Xi.ATTR_MODIFIED,d),s.removeEventListener(Xi.BOUNDS_CHANGED,f)}))}},{key:"createCamera",value:function(e){var t=this.context.config,n=t.document,r=t.width,i=t.height,a=this.context.contextService.getDomElement(),o=a.parentNode;if(o){var s="g-canvas-camera",l=o.querySelector("#".concat(s));if(!l){var u=(n||document).createElement("div");u.style.overflow="hidden",u.style.pointerEvents="none",u.style.position="absolute",u.style.left="0px",u.style.top="0px",u.style.width="".concat(r||0,"px"),u.style.height="".concat(i||0,"px");var c=(n||document).createElement("div");l=c,c.id=s,c.style.position="absolute",c.style.left="".concat(a.offsetLeft||0,"px"),c.style.top="".concat(a.offsetTop||0,"px"),c.style.transformOrigin="left top",c.style.transform=this.joinTransformMatrix(e.getOrthoMatrix()),c.style.pointerEvents="none",c.style.width="100%",c.style.height="100%",u.appendChild(c),o.appendChild(u)}return l}return null}},{key:"getOrCreateEl",value:function(e){var t=this.context.config.document,n=this.displayObjectHTMLElementMap.get(e);return n||(n=(t||document).createElement("div"),e.parsedStyle.$el=n,this.displayObjectHTMLElementMap.set(e,n),e.id&&(n.id=e.id),e.name&&n.setAttribute("name",e.name),e.className&&(n.className=e.className),n.style.position="absolute",n.style["will-change"]="transform",n.style.transform=this.joinTransformMatrix(e.getWorldTransform(),e.getOrigin())),n}},{key:"updateAttribute",value:function(e,t){var n=this.getOrCreateEl(t);switch(e){case"innerHTML":var r=t.parsedStyle.innerHTML;(0,S.Z)(r)?n.innerHTML=r:(n.innerHTML="",n.appendChild(r));break;case"x":n.style.left="".concat(t.parsedStyle.x,"px");break;case"y":n.style.top="".concat(t.parsedStyle.y,"px");break;case"transformOrigin":var i=t.parsedStyle.transformOrigin;n.style["transform-origin"]="".concat(i[0].buildCSSText(null,null,"")," ").concat(i[1].buildCSSText(null,null,""));break;case"width":var a=t.parsedStyle.width;n.style.width=(0,E.Z)(a)?"".concat(a,"px"):a.toString();break;case"height":var o=t.parsedStyle.height;n.style.height=(0,E.Z)(o)?"".concat(o,"px"):o.toString();break;case"zIndex":var s=t.parsedStyle.zIndex;n.style["z-index"]="".concat(s);break;case"visibility":var l=t.parsedStyle.visibility;n.style.visibility=l;break;case"pointerEvents":var u=t.parsedStyle.pointerEvents,c=void 0===u?"auto":u;n.style.pointerEvents=c;break;case"opacity":var h=t.parsedStyle.opacity;n.style.opacity="".concat(h);break;case"fill":var d=t.parsedStyle.fill,f="";En(d)?f=d.isNone?"transparent":t.getAttribute("fill"):Array.isArray(d)?f=t.getAttribute("fill"):yn(d),n.style.background=f;break;case"stroke":var v=t.parsedStyle.stroke,p="";En(v)?p=v.isNone?"transparent":t.getAttribute("stroke"):Array.isArray(v)?p=t.getAttribute("stroke"):yn(v),n.style["border-color"]=p,n.style["border-style"]="solid";break;case"lineWidth":var g=t.parsedStyle.lineWidth;n.style["border-width"]="".concat(g||0,"px");break;case"lineDash":n.style["border-style"]="dashed";break;case"filter":var m=t.style.filter;n.style.filter=m;break;default:(0,T.Z)(t.style[e])||""===t.style[e]||(n.style[e]=t.style[e])}}}])}();po.tag="HTMLRendering";var go=function(){function e(){(0,o.Z)(this,e)}return(0,a.Z)(e,[{key:"apply",value:function(t,n){var r=this,i=t.renderingService,a=t.renderingContext,o=t.config;this.context=t;var s=a.root.ownerDocument.defaultView,l=function(e){i.hooks.pointerMove.call(e)},u=function(e){i.hooks.pointerUp.call(e)},c=function(e){i.hooks.pointerDown.call(e)},h=function(e){i.hooks.pointerOver.call(e)},d=function(e){i.hooks.pointerOut.call(e)},f=function(e){i.hooks.pointerCancel.call(e)},v=function(e){i.hooks.pointerWheel.call(e)},p=function(e){i.hooks.click.call(e)};i.hooks.init.tap(e.tag,(function(){var e=r.context.contextService.getDomElement();n.globalThis.navigator.msPointerEnabled?(e.style.msContentZooming="none",e.style.msTouchAction="none"):s.supportsPointerEvents&&(e.style.touchAction="none"),s.supportsPointerEvents?function(e){n.globalThis.document.addEventListener("pointermove",l,!0),e.addEventListener("pointerdown",c,!0),e.addEventListener("pointerleave",d,!0),e.addEventListener("pointerover",h,!0),n.globalThis.addEventListener("pointerup",u,!0),n.globalThis.addEventListener("pointercancel",f,!0)}(e):function(e){n.globalThis.document.addEventListener("mousemove",l,!0),e.addEventListener("mousedown",c,!0),e.addEventListener("mouseout",d,!0),e.addEventListener("mouseover",h,!0),n.globalThis.addEventListener("mouseup",u,!0)}(e),s.supportsTouchEvents&&function(e){e.addEventListener("touchstart",c,!0),e.addEventListener("touchend",u,!0),e.addEventListener("touchmove",l,!0),e.addEventListener("touchcancel",f,!0)}(e),o.useNativeClickEvent&&e.addEventListener("click",p,!0),e.addEventListener("wheel",v,{passive:!0,capture:!0})})),i.hooks.destroy.tap(e.tag,(function(){var e=r.context.contextService.getDomElement();n.globalThis.navigator.msPointerEnabled?(e.style.msContentZooming="",e.style.msTouchAction=""):s.supportsPointerEvents&&(e.style.touchAction=""),s.supportsPointerEvents?function(e){n.globalThis.document.removeEventListener("pointermove",l,!0),e.removeEventListener("pointerdown",c,!0),e.removeEventListener("pointerleave",d,!0),e.removeEventListener("pointerover",h,!0),n.globalThis.removeEventListener("pointerup",u,!0),n.globalThis.removeEventListener("pointercancel",f,!0)}(e):function(e){n.globalThis.document.removeEventListener("mousemove",l,!0),e.removeEventListener("mousedown",c,!0),e.removeEventListener("mouseout",d,!0),e.removeEventListener("mouseover",h,!0),n.globalThis.removeEventListener("mouseup",u,!0)}(e),s.supportsTouchEvents&&function(e){e.removeEventListener("touchstart",c,!0),e.removeEventListener("touchend",u,!0),e.removeEventListener("touchmove",l,!0),e.removeEventListener("touchcancel",f,!0)}(e),o.useNativeClickEvent&&e.removeEventListener("click",p,!0),e.removeEventListener("wheel",v,!0)}))}}])}();go.tag="DOMInteraction";var mo=function(){function e(){(0,o.Z)(this,e)}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=t.renderingService,r=t.contextService,i=t.config,a=r.getDomElement(),o=function(e){n.hooks.pointerDown.call(e)},s=function(e){n.hooks.pointerUp.call(e)},l=function(e){n.hooks.pointerMove.call(e)},u=function(e){n.hooks.pointerOver.call(e)},c=function(e){n.hooks.pointerOut.call(e)},h=function(e){n.hooks.click.call(e)},d=function(e){n.hooks.pointerCancel.call(e)};n.hooks.init.tap(e.tag,(function(){a.addEventListener("touchstart",o,!0),a.addEventListener("touchend",s,!0),a.addEventListener("touchmove",l,!0),a.addEventListener("touchcancel",d,!0),a.addEventListener("mouseout",c,!0),a.addEventListener("mouseover",u,!0),i.useNativeClickEvent&&a.addEventListener("click",h,!0)})),n.hooks.destroy.tap(e.tag,(function(){a.removeEventListener("touchstart",o,!0),a.removeEventListener("touchend",s,!0),a.removeEventListener("touchmove",l,!0),a.removeEventListener("touchcancel",d,!0),a.removeEventListener("mouseout",c,!0),a.removeEventListener("mouseover",u,!0),i.useNativeClickEvent&&a.removeEventListener("click",h,!0)}))}}])}();mo.tag="MobileInteraction";var yo=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).name="mobile-interaction",e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){this.addRenderingPlugin(new mo)}},{key:"destroy",value:function(){this.removeAllRenderingPlugins()}}])}(he),Eo=Object.freeze({__proto__:null,Plugin:yo});function _o(e,t,n,r){var i=e-n,a=t-r;return Math.sqrt(i*i+a*a)}function To(e,t){var n=Math.min.apply(Math,(0,c.Z)(e)),r=Math.min.apply(Math,(0,c.Z)(t));return{x:n,y:r,width:Math.max.apply(Math,(0,c.Z)(e))-n,height:Math.max.apply(Math,(0,c.Z)(t))-r}}function So(e,t,n,r,i,a){return n*Math.cos(i)*Math.cos(a)-r*Math.sin(i)*Math.sin(a)+e}function Ro(e,t,n,r,i,a){return n*Math.sin(i)*Math.cos(a)+r*Math.cos(i)*Math.sin(a)+t}function Ao(e,t,n,r,i,a,o){for(var s=function(e,t,n){return Math.atan(-t/e*Math.tan(n))}(n,r,i),l=1/0,u=-1/0,c=[a,o],h=2*-Math.PI;h<=2*Math.PI;h+=Math.PI){var d=s+h;a<o?a<d&&d<o&&c.push(d):o<d&&d<a&&c.push(d)}for(var f=0;f<c.length;f++){var v=So(e,0,n,r,i,c[f]);v<l&&(l=v),v>u&&(u=v)}for(var p=function(e,t,n){return Math.atan(t/(e*Math.tan(n)))}(n,r,i),g=1/0,m=-1/0,y=[a,o],E=2*-Math.PI;E<=2*Math.PI;E+=Math.PI){var _=p+E;a<o?a<_&&_<o&&y.push(_):o<_&&_<a&&y.push(_)}for(var T=0;T<y.length;T++){var S=Ro(0,t,n,r,i,y[T]);S<g&&(g=S),S>m&&(m=S)}return{x:l,y:g,width:u-l,height:m-g}}function xo(e,t,n,r,i,a){var o=-1,s=1/0,l=[n,r],u=20;a&&a>200&&(u=a/10);for(var h=1/u,d=h/10,f=0;f<=u;f++){var v=f*h,p=[i.apply(void 0,(0,c.Z)(e.concat([v]))),i.apply(void 0,(0,c.Z)(t.concat([v])))],g=_o(l[0],l[1],p[0],p[1]);g<s&&(o=v,s=g)}if(0===o)return{x:e[0],y:t[0]};if(1===o){var m=e.length;return{x:e[m-1],y:t[m-1]}}s=1/0;for(var y=0;y<32&&!(d<1e-4);y++){var E=o-d,_=o+d,T=[i.apply(void 0,(0,c.Z)(e.concat([E]))),i.apply(void 0,(0,c.Z)(t.concat([E])))],S=_o(l[0],l[1],T[0],T[1]);if(E>=0&&S<s)o=E,s=S;else{var R=[i.apply(void 0,(0,c.Z)(e.concat([_]))),i.apply(void 0,(0,c.Z)(t.concat([_])))],A=_o(l[0],l[1],R[0],R[1]);_<=1&&A<s?(o=_,s=A):d*=.5}}return{x:i.apply(void 0,(0,c.Z)(e.concat([o]))),y:i.apply(void 0,(0,c.Z)(t.concat([o])))}}function ko(e,t,n,r){return _o(e,t,n,r)}function No(e,t,n,r,i){return{x:(1-i)*e+i*n,y:(1-i)*t+i*r}}function Mo(e,t,n,r,i,a){var o=[n-e,r-t];if(y.exactEquals(o,[0,0]))return Math.sqrt((i-e)*(i-e)+(a-t)*(a-t));var s=[-o[1],o[0]];y.normalize(s,s);var l=[i-e,a-t];return Math.abs(y.dot(l,s))}function Co(e,t,n,r,i){var a=1-i;return a*a*a*e+3*t*i*a*a+3*n*i*i*a+r*i*i*i}function bo(e,t,n,r){var i,a,o,s=-3*e+9*t-9*n+3*r,l=6*e-12*t+6*n,u=3*t-3*e,c=[];if((0,N.Z)(s,0))(0,N.Z)(l,0)||(i=-u/l)>=0&&i<=1&&c.push(i);else{var h=l*l-4*s*u;(0,N.Z)(h,0)?c.push(-l/(2*s)):h>0&&(a=(-l-(o=Math.sqrt(h)))/(2*s),(i=(-l+o)/(2*s))>=0&&i<=1&&c.push(i),a>=0&&a<=1&&c.push(a))}return c}function Po(e,t,n,r,i,a,o,s){for(var l=[e,o],u=[t,s],c=bo(e,n,i,o),h=bo(t,r,a,s),d=0;d<c.length;d++)l.push(Co(e,n,i,o,c[d]));for(var f=0;f<h.length;f++)u.push(Co(t,r,a,s,h[f]));return To(l,u)}function Oo(e,t,n,r,i,a,o,s,l,u,c){var h=function(e,t,n,r,i,a,o,s,l,u,c){return xo([e,n,i,o],[t,r,a,s],l,u,Co,c)}(e,t,n,r,i,a,o,s,l,u,c);return _o(h.x,h.y,l,u)}function Io(e){if(e.length<2)return 0;for(var t=0,n=0;n<e.length-1;n++){var r=e[n],i=e[n+1];t+=_o(r[0],r[1],i[0],i[1])}return t}function wo(e,t,n,r){var i=1-r;return i*i*e+2*r*i*t+r*r*n}function Lo(e,t,n){var r=e+n-2*t;if((0,N.Z)(r,0))return[.5];var i=(e-t)/r;return i<=1&&i>=0?[i]:[]}function Do(e,t,n,r,i,a){var o=Lo(e,n,i)[0],s=Lo(t,r,a)[0],l=[e,i],u=[t,a];return void 0!==o&&l.push(wo(e,n,i,o)),void 0!==s&&u.push(wo(t,r,a,s)),To(l,u)}function Bo(e,t,n,r,i,a,o,s){var l=function(e,t,n,r,i,a,o,s){return xo([e,n,i],[t,r,a],o,s,wo)}(e,t,n,r,i,a,o,s);return _o(l.x,l.y,o,s)}var Fo=function(e){return e.GROUP="g",e.FRAGMENT="fragment",e.CIRCLE="circle",e.ELLIPSE="ellipse",e.IMAGE="image",e.RECT="rect",e.LINE="line",e.POLYLINE="polyline",e.POLYGON="polygon",e.TEXT="text",e.PATH="path",e.HTML="html",e.MESH="mesh",e}({}),Uo=function(e){return e[e.ZERO=0]="ZERO",e[e.NEGATIVE_ONE=1]="NEGATIVE_ONE",e}({}),Zo=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.plugins=[]}),[{key:"addRenderingPlugin",value:function(e){this.plugins.push(e),this.context.renderingPlugins.push(e)}},{key:"removeAllRenderingPlugins",value:function(){var e=this;this.plugins.forEach((function(t){var n=e.context.renderingPlugins.indexOf(t);n>=0&&e.context.renderingPlugins.splice(n,1)}))}}])}(),Go=f.add,Vo=f.copy,Wo=f.max,Ho=f.min,Xo=f.scale,zo=f.sub,Yo=function(){function e(){(0,o.Z)(this,e),this.center=[0,0,0],this.halfExtents=[0,0,0],this.min=[0,0,0],this.max=[0,0,0]}return(0,a.Z)(e,[{key:"update",value:function(e,t){Vo(this.center,e),Vo(this.halfExtents,t),zo(this.min,this.center,this.halfExtents),Go(this.max,this.center,this.halfExtents)}},{key:"setMinMax",value:function(e,t){Go(this.center,t,e),Xo(this.center,this.center,.5),zo(this.halfExtents,t,e),Xo(this.halfExtents,this.halfExtents,.5),Vo(this.min,e),Vo(this.max,t)}},{key:"getMin",value:function(){return this.min}},{key:"getMax",value:function(){return this.max}},{key:"add",value:function(t){if(!e.isEmpty(t))if(e.isEmpty(this))this.setMinMax(t.getMin(),t.getMax());else{var n=this.center,r=n[0],i=n[1],a=n[2],o=this.halfExtents,s=o[0],l=o[1],u=o[2],c=r-s,h=r+s,d=i-l,f=i+l,v=a-u,p=a+u,g=t.center,m=g[0],y=g[1],E=g[2],_=t.halfExtents,T=_[0],S=_[1],R=_[2],A=m-T,x=m+T,k=y-S,N=y+S,M=E-R,C=E+R;A<c&&(c=A),x>h&&(h=x),k<d&&(d=k),N>f&&(f=N),M<v&&(v=M),C>p&&(p=C),n[0]=.5*(c+h),n[1]=.5*(d+f),n[2]=.5*(v+p),o[0]=.5*(h-c),o[1]=.5*(f-d),o[2]=.5*(p-v),this.min[0]=c,this.min[1]=d,this.min[2]=v,this.max[0]=h,this.max[1]=f,this.max[2]=p}}},{key:"setFromTransformedAABB",value:function(e,t){var n=this.center,r=this.halfExtents,i=e.center,a=e.halfExtents,o=t[0],s=t[4],l=t[8],u=t[1],c=t[5],h=t[9],d=t[2],f=t[6],v=t[10],p=Math.abs(o),g=Math.abs(s),m=Math.abs(l),y=Math.abs(u),E=Math.abs(c),_=Math.abs(h),T=Math.abs(d),S=Math.abs(f),R=Math.abs(v);n[0]=t[12]+o*i[0]+s*i[1]+l*i[2],n[1]=t[13]+u*i[0]+c*i[1]+h*i[2],n[2]=t[14]+d*i[0]+f*i[1]+v*i[2],r[0]=p*a[0]+g*a[1]+m*a[2],r[1]=y*a[0]+E*a[1]+_*a[2],r[2]=T*a[0]+S*a[1]+R*a[2],zo(this.min,n,r),Go(this.max,n,r)}},{key:"intersects",value:function(e){var t=this.getMax(),n=this.getMin(),r=e.getMax(),i=e.getMin();return n[0]<=r[0]&&t[0]>=i[0]&&n[1]<=r[1]&&t[1]>=i[1]&&n[2]<=r[2]&&t[2]>=i[2]}},{key:"intersection",value:function(t){if(!this.intersects(t))return null;var n=new e,r=Wo([0,0,0],this.getMin(),t.getMin()),i=Ho([0,0,0],this.getMax(),t.getMax());return n.setMinMax(r,i),n}},{key:"getNegativeFarPoint",value:function(e){return 273===e.pnVertexFlag?Vo([0,0,0],this.min):272===e.pnVertexFlag?[this.min[0],this.min[1],this.max[2]]:257===e.pnVertexFlag?[this.min[0],this.max[1],this.min[2]]:256===e.pnVertexFlag?[this.min[0],this.max[1],this.max[2]]:17===e.pnVertexFlag?[this.max[0],this.min[1],this.min[2]]:16===e.pnVertexFlag?[this.max[0],this.min[1],this.max[2]]:1===e.pnVertexFlag?[this.max[0],this.max[1],this.min[2]]:[this.max[0],this.max[1],this.max[2]]}},{key:"getPositiveFarPoint",value:function(e){return 273===e.pnVertexFlag?Vo([0,0,0],this.max):272===e.pnVertexFlag?[this.max[0],this.max[1],this.min[2]]:257===e.pnVertexFlag?[this.max[0],this.min[1],this.max[2]]:256===e.pnVertexFlag?[this.max[0],this.min[1],this.min[2]]:17===e.pnVertexFlag?[this.min[0],this.max[1],this.max[2]]:16===e.pnVertexFlag?[this.min[0],this.max[1],this.min[2]]:1===e.pnVertexFlag?[this.min[0],this.min[1],this.max[2]]:[this.min[0],this.min[1],this.min[2]]}}],[{key:"isEmpty",value:function(e){return!e||0===e.halfExtents[0]&&0===e.halfExtents[1]&&0===e.halfExtents[2]}}])}(),jo=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e),this.distance=t||0,this.normal=n||f.fromValues(0,1,0),this.updatePNVertexFlag()}),[{key:"updatePNVertexFlag",value:function(){this.pnVertexFlag=(Number(this.normal[0]>=0)<<8)+(Number(this.normal[1]>=0)<<4)+Number(this.normal[2]>=0)}},{key:"distanceToPoint",value:function(e){return f.dot(e,this.normal)-this.distance}},{key:"normalize",value:function(){var e=1/f.len(this.normal);f.scale(this.normal,this.normal,e),this.distance*=e}},{key:"intersectsLine",value:function(e,t,n){var r=this.distanceToPoint(e),i=r/(r-this.distanceToPoint(t)),a=i>=0&&i<=1;return a&&n&&f.lerp(n,e,t,i),a}}])}(),Ko=function(){return(0,a.Z)((function e(t){if((0,o.Z)(this,e),this.planes=[],t)this.planes=t;else for(var n=0;n<6;n++)this.planes.push(new jo)}),[{key:"extractFromVPMatrix",value:function(e){var t=(0,h.Z)(e,16),n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=t[9],v=t[10],p=t[11],g=t[12],m=t[13],y=t[14],E=t[15];f.set(this.planes[0].normal,a-n,u-o,p-c),this.planes[0].distance=E-g,f.set(this.planes[1].normal,a+n,u+o,p+c),this.planes[1].distance=E+g,f.set(this.planes[2].normal,a+r,u+s,p+d),this.planes[2].distance=E+m,f.set(this.planes[3].normal,a-r,u-s,p-d),this.planes[3].distance=E-m,f.set(this.planes[4].normal,a-i,u-l,p-v),this.planes[4].distance=E-y,f.set(this.planes[5].normal,a+i,u+l,p+v),this.planes[5].distance=E+y,this.planes.forEach((function(e){e.normalize(),e.updatePNVertexFlag()}))}}])}(),qo=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,o.Z)(this,e),this.x=0,this.y=0,this.x=t,this.y=n}return(0,a.Z)(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"copyFrom",value:function(e){this.x=e.x,this.y=e.y}}])}(),$o=function(){function e(t,n,r,i){(0,o.Z)(this,e),this.x=t,this.y=n,this.width=r,this.height=i,this.left=t,this.right=t+r,this.top=n,this.bottom=n+i}return(0,a.Z)(e,[{key:"toJSON",value:function(){}}],[{key:"fromRect",value:function(t){return new e(t.x,t.y,t.width,t.height)}},{key:"applyTransform",value:function(t,n){var r=v.fromValues(t.x,t.y,0,1),i=v.fromValues(t.x+t.width,t.y,0,1),a=v.fromValues(t.x,t.y+t.height,0,1),o=v.fromValues(t.x+t.width,t.y+t.height,0,1),s=v.create(),l=v.create(),u=v.create(),c=v.create();v.transformMat4(s,r,n),v.transformMat4(l,i,n),v.transformMat4(u,a,n),v.transformMat4(c,o,n);var h=Math.min(s[0],l[0],u[0],c[0]),d=Math.min(s[1],l[1],u[1],c[1]),f=Math.max(s[0],l[0],u[0],c[0]),p=Math.max(s[1],l[1],u[1],c[1]);return e.fromRect({x:h,y:d,width:f-h,height:p-d})}}])}(),Qo="Method not implemented.";function Jo(e){return void 0===e?0:e>360||e<-360?e%360:e}var es=f.create();function ts(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Array.isArray(e)&&3===e.length?r?f.clone(e):f.copy(es,e):(0,E.Z)(e)?r?f.fromValues(e,t,n):f.set(es,e,t,n):r?f.fromValues(e[0],e[1]||t,e[2]||n):f.set(es,e[0],e[1]||t,e[2]||n)}var ns=Math.PI/180;function rs(e){return e*ns}var is=180/Math.PI;function as(e){return e*is}var os=Math.PI/2;function ss(e,t){return 16===t.length?function(e,t){var n,r,i=p.getScaling(f.create(),t),a=(0,h.Z)(i,3),o=a[0],s=a[1],l=a[2],u=Math.asin(-t[2]/o);return u<os?u>-os?(n=Math.atan2(t[6]/s,t[10]/l),r=Math.atan2(t[1]/o,t[0]/o)):(r=0,n=-Math.atan2(t[4]/s,t[5]/s)):(r=0,n=Math.atan2(t[4]/s,t[5]/s)),e[0]=n,e[1]=u,e[2]=r,e}(e,t):function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=r*r,s=i*i,l=a*a,u=n*n+o+s+l,c=n*a-r*i;return c>.499995*u?(e[0]=os,e[1]=2*Math.atan2(r,n),e[2]=0):c<-.499995*u?(e[0]=-os,e[1]=2*Math.atan2(r,n),e[2]=0):(e[0]=Math.asin(2*(n*i-a*r)),e[1]=Math.atan2(2*(n*a+r*i),1-2*(s+l)),e[2]=Math.atan2(2*(n*r+i*a),1-2*(o+s))),e}(e,t)}function ls(e){var t=e[0],n=e[1],r=e[3],i=e[4],a=Math.sqrt(t*t+n*n),o=Math.sqrt(r*r+i*i);if(t*i-n*r<0&&(t<i?a=-a:o=-o),a){var s=1/a;t*=s,n*=s}if(o){var l=1/o;r*=l,i*=l}var u=as(Math.atan2(n,t));return[e[6],e[7],a,o,u]}var us=p.create(),cs=p.create(),hs=v.create(),ds=[f.create(),f.create(),f.create()],fs=f.create();function vs(e,t,n,r,i){e[0]=t[0]*r+n[0]*i,e[1]=t[1]*r+n[1]*i,e[2]=t[2]*r+n[2]*i}var ps=function(e){return e[e.ORBITING=0]="ORBITING",e[e.EXPLORING=1]="EXPLORING",e[e.TRACKING=2]="TRACKING",e}({}),gs=function(e){return e[e.DEFAULT=0]="DEFAULT",e[e.ROTATIONAL=1]="ROTATIONAL",e[e.TRANSLATIONAL=2]="TRANSLATIONAL",e[e.CINEMATIC=3]="CINEMATIC",e}({}),ms=function(e){return e[e.ORTHOGRAPHIC=0]="ORTHOGRAPHIC",e[e.PERSPECTIVE=1]="PERSPECTIVE",e}({}),ys="updated",Es=2e-4,_s=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.clipSpaceNearZ=Uo.NEGATIVE_ONE,this.eventEmitter=new d.Z,this.matrix=p.create(),this.right=f.fromValues(1,0,0),this.up=f.fromValues(0,1,0),this.forward=f.fromValues(0,0,1),this.position=f.fromValues(0,0,1),this.focalPoint=f.fromValues(0,0,0),this.distanceVector=f.fromValues(0,0,-1),this.distance=1,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.dollyingStep=0,this.maxDistance=1/0,this.minDistance=-1/0,this.zoom=1,this.rotateWorld=!1,this.fov=30,this.near=.1,this.far=1e3,this.aspect=1,this.projectionMatrix=p.create(),this.projectionMatrixInverse=p.create(),this.jitteredProjectionMatrix=void 0,this.enableUpdate=!0,this.type=ps.EXPLORING,this.trackingMode=gs.DEFAULT,this.projectionMode=ms.PERSPECTIVE,this.frustum=new Ko,this.orthoMatrix=p.create()}),[{key:"isOrtho",value:function(){return this.projectionMode===ms.ORTHOGRAPHIC}},{key:"getProjectionMode",value:function(){return this.projectionMode}},{key:"getPerspective",value:function(){return this.jitteredProjectionMatrix||this.projectionMatrix}},{key:"getPerspectiveInverse",value:function(){return this.projectionMatrixInverse}},{key:"getFrustum",value:function(){return this.frustum}},{key:"getPosition",value:function(){return this.position}},{key:"getFocalPoint",value:function(){return this.focalPoint}},{key:"getDollyingStep",value:function(){return this.dollyingStep}},{key:"getNear",value:function(){return this.near}},{key:"getFar",value:function(){return this.far}},{key:"getZoom",value:function(){return this.zoom}},{key:"getOrthoMatrix",value:function(){return this.orthoMatrix}},{key:"getView",value:function(){return this.view}},{key:"setEnableUpdate",value:function(e){this.enableUpdate=e}},{key:"setType",value:function(e,t){return this.type=e,this.type===ps.EXPLORING?this.setWorldRotation(!0):this.setWorldRotation(!1),this._getAngles(),this.type===ps.TRACKING&&void 0!==t&&this.setTrackingMode(t),this}},{key:"setProjectionMode",value:function(e){return this.projectionMode=e,this}},{key:"setTrackingMode",value:function(e){if(this.type!==ps.TRACKING)throw new Error("Impossible to set a tracking mode if the camera is not of tracking type");return this.trackingMode=e,this}},{key:"setWorldRotation",value:function(e){return this.rotateWorld=e,this._getAngles(),this}},{key:"getViewTransform",value:function(){return p.invert(p.create(),this.matrix)}},{key:"getWorldTransform",value:function(){return this.matrix}},{key:"jitterProjectionMatrix",value:function(e,t){var n=p.fromTranslation(p.create(),[e,t,0]);this.jitteredProjectionMatrix=p.multiply(p.create(),n,this.projectionMatrix)}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0}},{key:"setMatrix",value:function(e){return this.matrix=e,this._update(),this}},{key:"setProjectionMatrix",value:function(e){this.projectionMatrix=e}},{key:"setFov",value:function(e){return this.setPerspective(this.near,this.far,e,this.aspect),this}},{key:"setAspect",value:function(e){return this.setPerspective(this.near,this.far,this.fov,e),this}},{key:"setNear",value:function(e){return this.projectionMode===ms.PERSPECTIVE?this.setPerspective(e,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,e,this.far),this}},{key:"setFar",value:function(e){return this.projectionMode===ms.PERSPECTIVE?this.setPerspective(this.near,e,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,e),this}},{key:"setViewOffset",value:function(e,t,n,r,i,a){return this.aspect=e/t,void 0===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.projectionMode===ms.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"clearViewOffset",value:function(){return void 0!==this.view&&(this.view.enabled=!1),this.projectionMode===ms.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"setZoom",value:function(e){return this.zoom=e,this.projectionMode===ms.ORTHOGRAPHIC?this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far):this.projectionMode===ms.PERSPECTIVE&&this.setPerspective(this.near,this.far,this.fov,this.aspect),this}},{key:"setZoomByViewportPoint",value:function(e,t){var n=this.canvas.viewport2Canvas({x:t[0],y:t[1]}),r=n.x,i=n.y,a=this.roll;this.rotate(0,0,-a),this.setPosition(r,i),this.setFocalPoint(r,i),this.setZoom(e),this.rotate(0,0,a);var o=this.canvas.viewport2Canvas({x:t[0],y:t[1]}),s=o.x,l=o.y,u=f.fromValues(s-r,l-i,0),c=f.dot(u,this.right)/f.length(this.right),d=f.dot(u,this.up)/f.length(this.up),v=this.getPosition(),p=(0,h.Z)(v,2),g=p[0],m=p[1],y=this.getFocalPoint(),E=(0,h.Z)(y,2),_=E[0],T=E[1];return this.setPosition(g-c,m-d),this.setFocalPoint(_-c,T-d),this}},{key:"setPerspective",value:function(e,t,n,r){var i;this.projectionMode=ms.PERSPECTIVE,this.fov=n,this.near=e,this.far=t,this.aspect=r;var a=this.near*Math.tan(rs(.5*this.fov))/this.zoom,o=2*a,s=this.aspect*o,l=-.5*s;if(null!==(i=this.view)&&void 0!==i&&i.enabled){var u=this.view.fullWidth,c=this.view.fullHeight;l+=this.view.offsetX*s/u,a-=this.view.offsetY*o/c,s*=this.view.width/u,o*=this.view.height/c}return function(e,t,n,r,i,a,o){var s,l,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=2*a,h=n-t,d=r-i,f=c/h,v=c/d,p=(n+t)/h,g=(r+i)/d,m=o-a,y=o*a;u?(s=-o/m,l=-y/m):(s=-(o+a)/m,l=-2*y/m),e[0]=f,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=v,e[6]=0,e[7]=0,e[8]=p,e[9]=g,e[10]=s,e[11]=-1,e[12]=0,e[13]=0,e[14]=l,e[15]=0}(this.projectionMatrix,l,l+s,a-o,a,e,this.far,this.clipSpaceNearZ===Uo.ZERO),p.invert(this.projectionMatrixInverse,this.projectionMatrix),this.triggerUpdate(),this}},{key:"setOrthographic",value:function(e,t,n,r,i,a){var o;this.projectionMode=ms.ORTHOGRAPHIC,this.rright=t,this.left=e,this.top=n,this.bottom=r,this.near=i,this.far=a;var s=(this.rright-this.left)/(2*this.zoom),l=(this.top-this.bottom)/(2*this.zoom),u=(this.rright+this.left)/2,c=(this.top+this.bottom)/2,h=u-s,d=u+s,f=c+l,v=c-l;if(null!==(o=this.view)&&void 0!==o&&o.enabled){var g=(this.rright-this.left)/this.view.fullWidth/this.zoom,m=(this.top-this.bottom)/this.view.fullHeight/this.zoom;d=(h+=g*this.view.offsetX)+g*this.view.width,v=(f-=m*this.view.offsetY)-m*this.view.height}return this.clipSpaceNearZ===Uo.NEGATIVE_ONE?p.ortho(this.projectionMatrix,h,d,f,v,i,a):p.orthoZO(this.projectionMatrix,h,d,f,v,i,a),p.invert(this.projectionMatrixInverse,this.projectionMatrix),this._getOrthoMatrix(),this.triggerUpdate(),this}},{key:"setPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.position[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.position[2],r=ts(e,t,n);return this._setPosition(r),this.setFocalPoint(this.focalPoint),this.triggerUpdate(),this}},{key:"setFocalPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.focalPoint[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.focalPoint[2],r=f.fromValues(0,1,0);if(this.focalPoint=ts(e,t,n),this.trackingMode===gs.CINEMATIC){var i=f.subtract(f.create(),this.focalPoint,this.position);e=i[0],t=i[1],n=i[2];var a=f.length(i),o=as(Math.asin(t/a)),s=90+as(Math.atan2(n,e)),l=p.create();p.rotateY(l,l,rs(s)),p.rotateX(l,l,rs(o)),r=f.transformMat4(f.create(),[0,1,0],l)}return p.invert(this.matrix,p.lookAt(p.create(),this.position,this.focalPoint,r)),this._getAxes(),this._getDistance(),this._getAngles(),this.triggerUpdate(),this}},{key:"getDistance",value:function(){return this.distance}},{key:"getDistanceVector",value:function(){return this.distanceVector}},{key:"setDistance",value:function(e){if(this.distance===e||e<0)return this;this.distance=e,this.distance<Es&&(this.distance=Es),this.dollyingStep=this.distance/100;var t=f.create();e=this.distance;var n=this.forward,r=this.focalPoint;return t[0]=e*n[0]+r[0],t[1]=e*n[1]+r[1],t[2]=e*n[2]+r[2],this._setPosition(t),this.triggerUpdate(),this}},{key:"setMaxDistance",value:function(e){return this.maxDistance=e,this}},{key:"setMinDistance",value:function(e){return this.minDistance=e,this}},{key:"setAzimuth",value:function(e){return this.azimuth=Jo(e),this.computeMatrix(),this._getAxes(),this.type===ps.ORBITING||this.type===ps.EXPLORING?this._getPosition():this.type===ps.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this}},{key:"getAzimuth",value:function(){return this.azimuth}},{key:"setElevation",value:function(e){return this.elevation=Jo(e),this.computeMatrix(),this._getAxes(),this.type===ps.ORBITING||this.type===ps.EXPLORING?this._getPosition():this.type===ps.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this}},{key:"getElevation",value:function(){return this.elevation}},{key:"setRoll",value:function(e){return this.roll=Jo(e),this.computeMatrix(),this._getAxes(),this.type===ps.ORBITING||this.type===ps.EXPLORING?this._getPosition():this.type===ps.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this}},{key:"getRoll",value:function(){return this.roll}},{key:"_update",value:function(){this._getAxes(),this._getPosition(),this._getDistance(),this._getAngles(),this._getOrthoMatrix(),this.triggerUpdate()}},{key:"computeMatrix",value:function(){var e=m.setAxisAngle(m.create(),[0,0,1],rs(this.roll));p.identity(this.matrix);var t=m.setAxisAngle(m.create(),[1,0,0],rs((this.rotateWorld&&this.type!==ps.TRACKING||this.type===ps.TRACKING?1:-1)*this.elevation)),n=m.setAxisAngle(m.create(),[0,1,0],rs((this.rotateWorld&&this.type!==ps.TRACKING||this.type===ps.TRACKING?1:-1)*this.azimuth)),r=m.multiply(m.create(),n,t);r=m.multiply(m.create(),r,e);var i=p.fromQuat(p.create(),r);this.type===ps.ORBITING||this.type===ps.EXPLORING?(p.translate(this.matrix,this.matrix,this.focalPoint),p.multiply(this.matrix,this.matrix,i),p.translate(this.matrix,this.matrix,[0,0,this.distance])):this.type===ps.TRACKING&&(p.translate(this.matrix,this.matrix,this.position),p.multiply(this.matrix,this.matrix,i))}},{key:"_setPosition",value:function(e,t,n){this.position=ts(e,t,n);var r=this.matrix;r[12]=this.position[0],r[13]=this.position[1],r[14]=this.position[2],r[15]=1,this._getOrthoMatrix()}},{key:"_getAxes",value:function(){f.copy(this.right,ts(v.transformMat4(v.create(),[1,0,0,0],this.matrix))),f.copy(this.up,ts(v.transformMat4(v.create(),[0,1,0,0],this.matrix))),f.copy(this.forward,ts(v.transformMat4(v.create(),[0,0,1,0],this.matrix))),f.normalize(this.right,this.right),f.normalize(this.up,this.up),f.normalize(this.forward,this.forward)}},{key:"_getAngles",value:function(){var e=this.distanceVector[0],t=this.distanceVector[1],n=this.distanceVector[2],r=f.length(this.distanceVector);if(0===r)return this.elevation=0,void(this.azimuth=0);this.type===ps.TRACKING||this.rotateWorld?(this.elevation=as(Math.asin(t/r)),this.azimuth=as(Math.atan2(-e,-n))):(this.elevation=-as(Math.asin(t/r)),this.azimuth=-as(Math.atan2(-e,-n)))}},{key:"_getPosition",value:function(){f.copy(this.position,ts(v.transformMat4(v.create(),[0,0,0,1],this.matrix))),this._getDistance()}},{key:"_getFocalPoint",value:function(){f.transformMat3(this.distanceVector,[0,0,-this.distance],g.fromMat4(g.create(),this.matrix)),f.add(this.focalPoint,this.position,this.distanceVector),this._getDistance()}},{key:"_getDistance",value:function(){this.distanceVector=f.subtract(f.create(),this.focalPoint,this.position),this.distance=f.length(this.distanceVector),this.dollyingStep=this.distance/100}},{key:"_getOrthoMatrix",value:function(){if(this.projectionMode===ms.ORTHOGRAPHIC){var e=this.position,t=m.setAxisAngle(m.create(),[0,0,1],-this.roll*Math.PI/180);p.fromRotationTranslationScaleOrigin(this.orthoMatrix,t,f.fromValues((this.rright-this.left)/2-e[0],(this.top-this.bottom)/2-e[1],0),f.fromValues(this.zoom,this.zoom,1),e)}}},{key:"triggerUpdate",value:function(){if(this.enableUpdate){var e=this.getViewTransform(),t=p.multiply(p.create(),this.getPerspective(),e);this.getFrustum().extractFromVPMatrix(t),this.eventEmitter.emit(ys)}}},{key:"rotate",value:function(e,t,n){throw new Error(Qo)}},{key:"pan",value:function(e,t){throw new Error(Qo)}},{key:"dolly",value:function(e){throw new Error(Qo)}},{key:"createLandmark",value:function(e,t){throw new Error(Qo)}},{key:"gotoLandmark",value:function(e,t){throw new Error(Qo)}},{key:"cancelLandmarkAnimation",value:function(){throw new Error(Qo)}}])}(),Ts=function(e){return e[e.Standard=0]="Standard",e}({}),Ss=function(e){return e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED",e[e.Z_INDEX_CHANGED=2]="Z_INDEX_CHANGED",e}({}),Rs=f.create(),As=p.create(),xs=m.create();function ks(e){if(e.localDirtyFlag){if(0!==e.localSkew[0]||0!==e.localSkew[1]){p.fromRotationTranslationScaleOrigin(e.localTransform,e.localRotation,e.localPosition,f.fromValues(1,1,1),e.origin),0===e.localSkew[0]&&0===e.localSkew[1]||(p.identity(As),As[4]=Math.tan(e.localSkew[0]),As[1]=Math.tan(e.localSkew[1]),p.multiply(e.localTransform,e.localTransform,As));var t=p.fromRotationTranslationScaleOrigin(As,m.set(xs,0,0,0,1),f.set(Rs,1,1,1),e.localScale,e.origin);p.multiply(e.localTransform,e.localTransform,t)}else{var n=e.localTransform,r=e.localPosition,i=e.localRotation,a=e.localScale,o=e.origin,s=0!==r[0]||0!==r[1]||0!==r[2],l=1!==i[3]||0!==i[0]||0!==i[1]||0!==i[2],u=1!==a[0]||1!==a[1]||1!==a[2],c=0!==o[0]||0!==o[1]||0!==o[2];l||u||c?p.fromRotationTranslationScaleOrigin(n,i,r,a,o):s?p.fromTranslation(n,r):p.identity(n)}e.localDirtyFlag=!1}}var Ns={absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:new $o(0,0,0,0)},Ms=function(e){return e.COORDINATE="<coordinate>",e.COLOR="<color>",e.PAINT="<paint>",e.NUMBER="<number>",e.ANGLE="<angle>",e.OPACITY_VALUE="<opacity-value>",e.SHADOW_BLUR="<shadow-blur>",e.LENGTH="<length>",e.PERCENTAGE="<percentage>",e.LENGTH_PERCENTAGE="<length> | <percentage>",e.LENGTH_PERCENTAGE_12="[<length> | <percentage>]{1,2}",e.LENGTH_PERCENTAGE_14="[<length> | <percentage>]{1,4}",e.LIST_OF_POINTS="<list-of-points>",e.PATH="<path>",e.FILTER="<filter>",e.Z_INDEX="<z-index>",e.OFFSET_DISTANCE="<offset-distance>",e.DEFINED_PATH="<defined-path>",e.MARKER="<marker>",e.TRANSFORM="<transform>",e.TRANSFORM_ORIGIN="<transform-origin>",e.TEXT="<text>",e.TEXT_TRANSFORM="<text-transform>",e}({});function Cs(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function bs(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Ps(){}var Os=.7,Is=1.4285714285714286,ws="\\s*([+-]?\\d+)\\s*",Ls="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ds="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Bs=/^#([0-9a-f]{3,8})$/,Fs=new RegExp("^rgb\\(".concat(ws,",").concat(ws,",").concat(ws,"\\)$")),Us=new RegExp("^rgb\\(".concat(Ds,",").concat(Ds,",").concat(Ds,"\\)$")),Zs=new RegExp("^rgba\\(".concat(ws,",").concat(ws,",").concat(ws,",").concat(Ls,"\\)$")),Gs=new RegExp("^rgba\\(".concat(Ds,",").concat(Ds,",").concat(Ds,",").concat(Ls,"\\)$")),Vs=new RegExp("^hsl\\(".concat(Ls,",").concat(Ds,",").concat(Ds,"\\)$")),Ws=new RegExp("^hsla\\(".concat(Ls,",").concat(Ds,",").concat(Ds,",").concat(Ls,"\\)$")),Hs={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Xs(){return this.rgb().formatHex()}function zs(){return this.rgb().formatRgb()}function Ys(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Bs.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?js(t):3===n?new $s(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Ks(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Ks(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Fs.exec(e))?new $s(t[1],t[2],t[3],1):(t=Us.exec(e))?new $s(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Zs.exec(e))?Ks(t[1],t[2],t[3],t[4]):(t=Gs.exec(e))?Ks(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Vs.exec(e))?rl(t[1],t[2]/100,t[3]/100,1):(t=Ws.exec(e))?rl(t[1],t[2]/100,t[3]/100,t[4]):Hs.hasOwnProperty(e)?js(Hs[e]):"transparent"===e?new $s(NaN,NaN,NaN,0):null}function js(e){return new $s(e>>16&255,e>>8&255,255&e,1)}function Ks(e,t,n,r){return r<=0&&(e=t=n=NaN),new $s(e,t,n,r)}function qs(e){return e instanceof Ps||(e=Ys(e)),e?new $s((e=e.rgb()).r,e.g,e.b,e.opacity):new $s}function $s(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Qs(){return"#".concat(nl(this.r)).concat(nl(this.g)).concat(nl(this.b))}function Js(){var e=el(this.opacity);return"".concat(1===e?"rgb(":"rgba(").concat(tl(this.r),", ").concat(tl(this.g),", ").concat(tl(this.b)).concat(1===e?")":", ".concat(e,")"))}function el(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function tl(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function nl(e){return((e=tl(e))<16?"0":"")+e.toString(16)}function rl(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new al(e,t,n,r)}function il(e){if(e instanceof al)return new al(e.h,e.s,e.l,e.opacity);if(e instanceof Ps||(e=Ys(e)),!e)return new al;if(e instanceof al)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new al(o,s,l,e.opacity)}function al(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function ol(e){return(e=(e||0)%360)<0?e+360:e}function sl(e){return Math.max(0,Math.min(1,e||0))}function ll(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function ul(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];var o=t?t.apply(this,i):i[0],s=n.cache;if(s.has(o))return s.get(o);var l=e.apply(this,i);return n.cache=s.set(o,l)||s,l};return n.cache=new(ul.Cache||Map),ul.cacheList.push(n.cache),n}Cs(Ps,Ys,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Xs,formatHex:Xs,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return il(this).formatHsl()},formatRgb:zs,toString:zs}),Cs($s,(function(e,t,n,r){return 1===arguments.length?qs(e):new $s(e,t,n,null==r?1:r)}),bs(Ps,{brighter:function(e){return e=null==e?Is:Math.pow(Is,e),new $s(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?Os:Math.pow(Os,e),new $s(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},clamp:function(){return new $s(tl(this.r),tl(this.g),tl(this.b),el(this.opacity))},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Qs,formatHex:Qs,formatHex8:function(){return"#".concat(nl(this.r)).concat(nl(this.g)).concat(nl(this.b)).concat(nl(255*(isNaN(this.opacity)?1:this.opacity)))},formatRgb:Js,toString:Js})),Cs(al,(function(e,t,n,r){return 1===arguments.length?il(e):new al(e,t,n,null==r?1:r)}),bs(Ps,{brighter:function(e){return e=null==e?Is:Math.pow(Is,e),new al(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?Os:Math.pow(Os,e),new al(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new $s(ll(e>=240?e-240:e+120,i,r),ll(e,i,r),ll(e<120?e+240:e-120,i,r),this.opacity)},clamp:function(){return new al(ol(this.h),sl(this.s),sl(this.l),el(this.opacity))},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=el(this.opacity);return"".concat(1===e?"hsl(":"hsla(").concat(ol(this.h),", ").concat(100*sl(this.s),"%, ").concat(100*sl(this.l),"%").concat(1===e?")":", ".concat(e,")"))}})),ul.Cache=Map,ul.cacheList=[],ul.clearCache=function(){ul.cacheList.forEach((function(e){return e.clear()}))};var cl=function(e){return e[e.kUnknown=0]="kUnknown",e[e.kNumber=1]="kNumber",e[e.kPercentage=2]="kPercentage",e[e.kEms=3]="kEms",e[e.kPixels=4]="kPixels",e[e.kRems=5]="kRems",e[e.kDegrees=6]="kDegrees",e[e.kRadians=7]="kRadians",e[e.kGradians=8]="kGradians",e[e.kTurns=9]="kTurns",e[e.kMilliseconds=10]="kMilliseconds",e[e.kSeconds=11]="kSeconds",e[e.kInteger=12]="kInteger",e}({}),hl=function(e){return e[e.kUNumber=0]="kUNumber",e[e.kUPercent=1]="kUPercent",e[e.kULength=2]="kULength",e[e.kUAngle=3]="kUAngle",e[e.kUTime=4]="kUTime",e[e.kUOther=5]="kUOther",e}({}),dl=function(e){return e[e.kYes=0]="kYes",e[e.kNo=1]="kNo",e}({}),fl=function(e){return e[e.kYes=0]="kYes",e[e.kNo=1]="kNo",e}({}),vl=[{name:"em",unit_type:cl.kEms},{name:"px",unit_type:cl.kPixels},{name:"deg",unit_type:cl.kDegrees},{name:"rad",unit_type:cl.kRadians},{name:"grad",unit_type:cl.kGradians},{name:"ms",unit_type:cl.kMilliseconds},{name:"s",unit_type:cl.kSeconds},{name:"rem",unit_type:cl.kRems},{name:"turn",unit_type:cl.kTurns}],pl=function(e){return e[e.kUnknownType=0]="kUnknownType",e[e.kUnparsedType=1]="kUnparsedType",e[e.kKeywordType=2]="kKeywordType",e[e.kUnitType=3]="kUnitType",e[e.kSumType=4]="kSumType",e[e.kProductType=5]="kProductType",e[e.kNegateType=6]="kNegateType",e[e.kInvertType=7]="kInvertType",e[e.kMinType=8]="kMinType",e[e.kMaxType=9]="kMaxType",e[e.kClampType=10]="kClampType",e[e.kTransformType=11]="kTransformType",e[e.kPositionType=12]="kPositionType",e[e.kURLImageType=13]="kURLImageType",e[e.kColorType=14]="kColorType",e[e.kUnsupportedColorType=15]="kUnsupportedColorType",e}({}),gl=function(e){return e?"number"===e?cl.kNumber:"percent"===e||"%"===e?cl.kPercentage:function(e){return vl.find((function(t){return t.name===e})).unit_type}(e):cl.kUnknown},ml=function(e){var t=1;switch(e){case cl.kPixels:case cl.kDegrees:case cl.kSeconds:break;case cl.kMilliseconds:t=.001;break;case cl.kRadians:t=180/Math.PI;break;case cl.kGradians:t=.9;break;case cl.kTurns:t=360}return t},yl=function(e){switch(e){case cl.kNumber:case cl.kInteger:return"";case cl.kPercentage:return"%";case cl.kEms:return"em";case cl.kRems:return"rem";case cl.kPixels:return"px";case cl.kDegrees:return"deg";case cl.kRadians:return"rad";case cl.kGradians:return"grad";case cl.kMilliseconds:return"ms";case cl.kSeconds:return"s";case cl.kTurns:return"turn"}return""},El=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"toString",value:function(){return this.buildCSSText(dl.kNo,fl.kNo,"")}},{key:"isNumericValue",value:function(){return this.getType()>=pl.kUnitType&&this.getType()<=pl.kClampType}}],[{key:"isAngle",value:function(e){return e===cl.kDegrees||e===cl.kRadians||e===cl.kGradians||e===cl.kTurns}},{key:"isLength",value:function(e){return e>=cl.kEms&&e<cl.kDegrees}},{key:"isRelativeUnit",value:function(e){return e===cl.kPercentage||e===cl.kEms||e===cl.kRems}},{key:"isTime",value:function(e){return e===cl.kSeconds||e===cl.kMilliseconds}}])}(),_l=function(e){function t(e){var n;return(0,o.Z)(this,t),(n=(0,s.Z)(this,t)).colorSpace=e,n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getType",value:function(){return pl.kColorType}},{key:"to",value:function(e){return this}}])}(El),Tl=function(e){return e[e.Constant=0]="Constant",e[e.LinearGradient=1]="LinearGradient",e[e.RadialGradient=2]="RadialGradient",e}({}),Sl=function(e){function t(e,n){var r;return(0,o.Z)(this,t),(r=(0,s.Z)(this,t)).type=e,r.value=n,r}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.type,this.value)}},{key:"buildCSSText",value:function(e,t,n){return n}},{key:"getType",value:function(){return pl.kColorType}}])}(El),Rl=function(e){function t(e){var n;return(0,o.Z)(this,t),(n=(0,s.Z)(this,t)).value=e,n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.value)}},{key:"getType",value:function(){return pl.kKeywordType}},{key:"buildCSSText",value:function(e,t,n){return n+this.value}}])}(El),Al=function(e){return function(e){switch(e){case hl.kUNumber:return cl.kNumber;case hl.kULength:return cl.kPixels;case hl.kUPercent:return cl.kPercentage;case hl.kUTime:return cl.kSeconds;case hl.kUAngle:return cl.kDegrees;default:return cl.kUnknown}}(function(e){switch(e){case cl.kNumber:case cl.kInteger:return hl.kUNumber;case cl.kPercentage:return hl.kUPercent;case cl.kPixels:return hl.kULength;case cl.kMilliseconds:case cl.kSeconds:return hl.kUTime;case cl.kDegrees:case cl.kRadians:case cl.kGradians:case cl.kTurns:return hl.kUAngle;default:return hl.kUOther}}(e))},xl=function(e){function t(e){var n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cl.kNumber;return(0,o.Z)(this,t),n=(0,s.Z)(this,t),r="string"==typeof i?gl(i):i,n.unit=r,n.value=e,n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.value,this.unit)}},{key:"equals",value:function(e){var t=e;return this.value===t.value&&this.unit===t.unit}},{key:"getType",value:function(){return pl.kUnitType}},{key:"convertTo",value:function(e){if(this.unit===e)return new t(this.value,this.unit);var n=Al(this.unit);if(n!==Al(e)||n===cl.kUnknown)return null;var r=ml(this.unit)/ml(e);return new t(this.value*r,e)}},{key:"buildCSSText",value:function(e,t,n){var r;switch(this.unit){case cl.kUnknown:break;case cl.kInteger:r=Number(this.value).toFixed(0);break;case cl.kNumber:case cl.kPercentage:case cl.kEms:case cl.kRems:case cl.kPixels:case cl.kDegrees:case cl.kRadians:case cl.kGradians:case cl.kMilliseconds:case cl.kSeconds:case cl.kTurns:var i=this.value,a=yl(this.unit);if(i<-999999||i>999999){var o=yl(this.unit);r=!Number.isFinite(i)||Number.isNaN(i)?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(Number.isFinite(e)?"NaN":e>0?"infinity":"-infinity")+t}(i,o):i+(o||"")}else r="".concat(i).concat(a)}return n+=r}}])}(El),kl=new xl(0,"px");new xl(1,"px");var Nl=new xl(0,"deg"),Ml=function(e){function t(e,n,r){var i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(0,o.Z)(this,t),(i=(0,s.Z)(this,t,["rgb"])).r=e,i.g=n,i.b=r,i.alpha=a,i.isNone=l,i}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.r,this.g,this.b,this.alpha)}},{key:"buildCSSText",value:function(e,t,n){return"".concat(n,"rgba(").concat(this.r,",").concat(this.g,",").concat(this.b,",").concat(this.alpha,")")}}])}(_l),Cl=new Rl("unset"),bl={"":Cl,unset:Cl,initial:new Rl("initial"),inherit:new Rl("inherit")},Pl=new Ml(0,0,0,0,!0),Ol=new Ml(0,0,0,0),Il=ul((function(e,t,n,r){return new Ml(e,t,n,r)}),(function(e,t,n,r){return"rgba(".concat(e,",").concat(t,",").concat(n,",").concat(r,")")})),wl=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cl.kNumber;return new xl(e,t)};function Ll(e){var t=e.type,n=e.value;return"hex"===t?"#".concat(n):"literal"===t?n:"rgb"===t?"rgb(".concat(n.join(","),")"):"rgba(".concat(n.join(","),")")}new xl(50,"%");var Dl=function(){var e=/^(linear\-gradient)/i,t=/^(repeating\-linear\-gradient)/i,n=/^(radial\-gradient)/i,r=/^(repeating\-radial\-gradient)/i,i=/^(conic\-gradient)/i,a=/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,o=/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,s=/^(left|center|right|top|bottom)/i,l=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,u=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,c=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,h=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,d=/^\(/,f=/^\)/,v=/^,/,p=/^\#([0-9a-fA-F]+)/,g=/^([a-zA-Z]+)/,m=/^rgb/i,y=/^rgba/i,E=/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/,_="";function T(e){throw new Error("".concat(_,": ").concat(e))}function S(){var e=O(R);return _.length>0&&T("Invalid input not EOF"),e}function R(){return A("linear-gradient",e,k)||A("repeating-linear-gradient",t,k)||A("radial-gradient",n,N)||A("repeating-radial-gradient",r,N)||A("conic-gradient",i,N)}function A(e,t,n){return x(t,(function(t){var r=n();return r&&(F(v)||T("Missing comma before color stops")),{type:e,orientation:r,colorStops:O(I)}}))}function x(e,t){var n=F(e);if(n){F(d)||T("Missing (");var r=t(n);return F(f)||T("Missing )"),r}}function k(){return B("directional",a,1)||B("angular",h,1)}function N(){var e,t,n=M();return n&&((e=[]).push(n),t=_,F(v)&&((n=M())?e.push(n):_=t)),e}function M(){var e=function(){var e=B("shape",/^(circle)/i,0);e&&(e.style=D()||C());return e}()||function(){var e=B("shape",/^(ellipse)/i,0);e&&(e.style=L()||C());return e}();if(e)e.at=b();else{var t=C();if(t){e=t;var n=b();n&&(e.at=n)}else{var r=P();r&&(e={type:"default-radial",at:r})}}return e}function C(){return B("extent-keyword",o,1)}function b(){if(B("position",/^at/,0)){var e=P();return e||T("Missing positioning value"),e}}function P(){var e={x:L(),y:L()};if(e.x||e.y)return{type:"position",value:e}}function O(e){var t=e(),n=[];if(t)for(n.push(t);F(v);)(t=e())?n.push(t):T("One extra comma");return n}function I(){var e=B("hex",p,1)||x(y,(function(){return{type:"rgba",value:O(w)}}))||x(m,(function(){return{type:"rgb",value:O(w)}}))||B("literal",g,0);return e||T("Expected color definition"),e.length=L(),e}function w(){return F(E)[1]}function L(){return B("%",u,1)||B("position-keyword",s,1)||D()}function D(){return B("px",l,1)||B("em",c,1)}function B(e,t,n){var r=F(t);if(r)return{type:e,value:r[n]}}function F(e){var t=/^[\n\r\t\s]+/.exec(_);t&&U(t[0].length);var n=e.exec(_);return n&&U(n[0].length),n}function U(e){_=_.substring(e)}return function(e){return _=e,S()}}();var Bl=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,Fl=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,Ul=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,Zl=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;var Gl={left:180,top:-90,bottom:90,right:0,"left top":225,"top left":225,"left bottom":135,"bottom left":135,"right top":-45,"top right":-45,"right bottom":45,"bottom right":45},Vl=ul((function(e){var t;return t="angular"===e.type?Number(e.value):Gl[e.value]||0,wl(t,"deg")})),Wl=ul((function(e){var t=50,n=50,r="%",i="%";if("position"===(null==e?void 0:e.type)){var a=e.value,o=a.x,s=a.y;"position-keyword"===(null==o?void 0:o.type)&&("left"===o.value?t=0:"center"===o.value?t=50:"right"===o.value?t=100:"top"===o.value?n=0:"bottom"===o.value&&(n=100)),"position-keyword"===(null==s?void 0:s.type)&&("left"===s.value?t=0:"center"===s.value?n=50:"right"===s.value?t=100:"top"===s.value?n=0:"bottom"===s.value&&(n=100)),"px"!==(null==o?void 0:o.type)&&"%"!==(null==o?void 0:o.type)&&"em"!==(null==o?void 0:o.type)||(r=null==o?void 0:o.type,t=Number(o.value)),"px"!==(null==s?void 0:s.type)&&"%"!==(null==s?void 0:s.type)&&"em"!==(null==s?void 0:s.type)||(i=null==s?void 0:s.type,n=Number(s.value))}return{cx:wl(t,r),cy:wl(n,i)}})),Hl=ul((function(e){if(e.indexOf("linear")>-1||e.indexOf("radial")>-1)return Dl(e).map((function(e){var t=e.type,n=e.orientation,r=e.colorStops;!function(e){var t,n,r=e.length;e[r-1].length=null!==(t=e[r-1].length)&&void 0!==t?t:{type:"%",value:"100"},r>1&&(e[0].length=null!==(n=e[0].length)&&void 0!==n?n:{type:"%",value:"0"});for(var i=0,a=Number(e[0].length.value),o=1;o<r;o++){var s,l=null===(s=e[o].length)||void 0===s?void 0:s.value;if(!(0,T.Z)(l)&&!(0,T.Z)(a)){for(var u=1;u<o-i;u++)e[i+u].length={type:"%",value:"".concat(a+(Number(l)-a)*u/(o-i))};i=o,a=Number(l)}}}(r);var i,a=r.map((function(e){return{offset:wl(Number(e.length.value),"%"),color:Ll(e)}}));if("linear-gradient"===t)return new Sl(Tl.LinearGradient,{angle:n?Vl(n):Nl,steps:a});if("radial-gradient"===t&&(n||(n=[{type:"shape",value:"circle"}]),"shape"===n[0].type&&"circle"===n[0].value)){var o,s=Wl(n[0].at),l=s.cx,u=s.cy;if(n[0].style){var c=n[0].style,h=c.type,d=c.value;"extent-keyword"===h?(bl[i=d]||(bl[i]=new Rl(i)),o=bl[i]):o=wl(d,h)}return new Sl(Tl.RadialGradient,{cx:l,cy:u,size:o,steps:a})}}));var t=e[0];if("("===e[1]||"("===e[2])if("l"===t){var n=Bl.exec(e);if(n){var r,i=(null===(r=n[2].match(Zl))||void 0===r?void 0:r.map((function(e){return e.split(":")})))||[];return[new Sl(Tl.LinearGradient,{angle:wl(parseFloat(n[1]),"deg"),steps:i.map((function(e){var t=(0,h.Z)(e,2),n=t[0],r=t[1];return{offset:wl(100*Number(n),"%"),color:r}}))})]}}else if("r"===t){var a=function(e){var t=Fl.exec(e);if(t){var n,r=(null===(n=t[4].match(Zl))||void 0===n?void 0:n.map((function(e){return e.split(":")})))||[];return{cx:wl(50,"%"),cy:wl(50,"%"),steps:r.map((function(e){var t=(0,h.Z)(e,2),n=t[0],r=t[1];return{offset:wl(100*Number(n),"%"),color:r}}))}}return null}(e);if(a){if(!(0,S.Z)(a))return[new Sl(Tl.RadialGradient,a)];e=a}}else if("p"===t)return function(e){var t=Ul.exec(e);if(t){var n=t[1],r=t[2];switch(n){case"a":n="repeat";break;case"x":n="repeat-x";break;case"y":n="repeat-y";break;default:n="no-repeat"}return{image:r,repetition:n}}return null}(e)}));function Xl(e){return e&&!!e.image}function zl(e){return e&&!(0,T.Z)(e.r)&&!(0,T.Z)(e.g)&&!(0,T.Z)(e.b)}var Yl=ul((function(e){if(Xl(e))return(0,u.Z)({repetition:"repeat"},e);if((0,T.Z)(e)&&(e=""),"transparent"===e)return Ol;if("currentColor"===e)e="black";else if("none"===e)return Pl;var t=Hl(e);if(t)return t;var n=Ys(e),r=[0,0,0,0];return null!==n&&(r[0]=n.r||0,r[1]=n.g||0,r[2]=n.b||0,r[3]=n.opacity),Il.apply(void 0,r)}));function jl(e,t){if(zl(e)&&zl(t))return[[Number(e.r),Number(e.g),Number(e.b),Number(e.alpha)],[Number(t.r),Number(t.g),Number(t.b),Number(t.alpha)],function(e){var t=e.slice();if(t[3])for(var n=0;n<3;n++)t[n]=Math.round((0,R.Z)(t[n],0,255));return t[3]=(0,R.Z)(t[3],0,1),"rgba(".concat(t.join(","),")")}]}function Kl(e,t){if((0,T.Z)(t))return wl(0,"px");if(t="".concat(t).trim().toLowerCase(),isFinite(Number(t))){if("px".search(e)>=0)return wl(Number(t),"px");if("deg".search(e)>=0)return wl(Number(t),"deg")}var n=[];t=t.replace(e,(function(e){return n.push(e),"U".concat(e)}));var r="U(".concat(e.source,")");return n.map((function(e){return wl(Number(t.replace(new RegExp("U".concat(e),"g"),"").replace(new RegExp(r,"g"),"*0")),e)}))[0]}var ql=function(e){return Kl(new RegExp("px","g"),e)},$l=ul(ql);ul((function(e){return Kl(new RegExp("%","g"),e)}));var Ql=function(e){return(0,E.Z)(e)||isFinite(Number(e))?wl(Number(e)||0,"px"):Kl(new RegExp("px|%|em|rem","g"),e)},Jl=ul(Ql),eu=function(e){return Kl(new RegExp("deg|rad|grad|turn","g"),e)},tu=ul(eu);function nu(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a="",o=e.value||0,s=t.value||0,l=Al(e.unit),u=e.convertTo(l),c=t.convertTo(l);return u&&c?(o=u.value,s=c.value,a=yl(e.unit)):(xl.isLength(e.unit)||xl.isLength(t.unit))&&(o=au(e,i,n),s=au(t,i,n),a="px"),[o,s,function(e){return r&&(e=Math.max(e,0)),e+a}]}function ru(e){var t=0;return e.unit===cl.kDegrees?t=e.value:e.unit===cl.kRadians?t=as(Number(e.value)):e.unit===cl.kTurns?t=360*Number(e.value):e.value&&(t=e.value),t}function iu(e,t){var n;return Array.isArray(e)?n=e.map((function(e){return Number(e)})):(0,S.Z)(e)?n=e.split(" ").map((function(e){return Number(e)})):(0,E.Z)(e)&&(n=[e]),2===t?1===n.length?[n[0],n[0]]:[n[0],n[1]]:4===t?1===n.length?[n[0],n[0],n[0],n[0]]:2===n.length?[n[0],n[1],n[0],n[1]]:3===n.length?[n[0],n[1],n[2],n[1]]:[n[0],n[1],n[2],n[3]]:"even"===t&&n.length%2==1?[].concat((0,c.Z)(n),(0,c.Z)(n)):n}function au(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.unit===cl.kPixels)return Number(e.value);if(e.unit===cl.kPercentage&&n){var i=n.nodeName===Fo.GROUP?n.getLocalBounds():n.getGeometryBounds();return(r?i.min[t]:0)+e.value/100*i.halfExtents[t]*2}return 0}var ou=function(e){return Kl(/deg|rad|grad|turn|px|%/g,e)},su=["blur","brightness","drop-shadow","contrast","grayscale","sepia","saturate","hue-rotate","invert"];function lu(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if("none"===(e=e.toLowerCase().trim()))return[];for(var t,n=/\s*([\w-]+)\(([^)]*)\)/g,r=[],i=0;t=n.exec(e);){if(t.index!==i)return[];if(i=t.index+t[0].length,su.indexOf(t[1])>-1&&r.push({name:t[1],params:t[2].split(" ").map((function(e){return ou(e)||Yl(e)}))}),n.lastIndex===e.length)return r}return[]}function uu(e){return e.toString()}var cu=function(e){return"number"==typeof e?wl(e):/^\s*[-+]?(\d*\.)?\d+\s*$/.test(e)?wl(Number(e)):wl(0)},hu=ul(cu);function du(e,t){return[e,t,uu]}function fu(e,t){return function(n,r){return[n,r,function(n){return uu((0,R.Z)(n,e,t))}]}}function vu(e,t){if(e.length===t.length)return[e,t,function(e){return e}]}function pu(e){return 0===e.parsedStyle.d.totalLength&&(e.parsedStyle.d.totalLength=(0,A.D)(e.parsedStyle.d.absolutePath)),e.parsedStyle.d.totalLength}function gu(e){return 0===e.parsedStyle.points.totalLength&&(e.parsedStyle.points.totalLength=Io(e.parsedStyle.points.points)),e.parsedStyle.points.totalLength}function mu(e,t){return e[0]===t[0]&&e[1]===t[1]}function yu(e,t){var n=e.prePoint,r=e.currentPoint,i=e.nextPoint,a=Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2),o=Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2),s=Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2),l=Math.acos((a+o-s)/(2*Math.sqrt(a)*Math.sqrt(o)));if(!l||0===Math.sin(l)||(0,N.Z)(l,0))return{xExtra:0,yExtra:0};var u=Math.abs(Math.atan2(i[1]-r[1],i[0]-r[0])),c=Math.abs(Math.atan2(i[0]-r[0],i[1]-r[1]));return u=u>Math.PI/2?Math.PI-u:u,c=c>Math.PI/2?Math.PI-c:c,{xExtra:Math.cos(l/2-u)*(t/2*(1/Math.sin(l/2)))-t/2||0,yExtra:Math.cos(c-l/2)*(t/2*(1/Math.sin(l/2)))-t/2||0}}function Eu(e,t){return[t[0]+(t[0]-e[0]),t[1]+(t[1]-e[1])]}ul((function(e){return(0,S.Z)(e)?e.split(" ").map(hu):e.map(hu)}));var _u=function(e,t){var n=e.x*t.x+e.y*t.y,r=Math.sqrt((Math.pow(e.x,2)+Math.pow(e.y,2))*(Math.pow(t.x,2)+Math.pow(t.y,2)));return(e.x*t.y-e.y*t.x<0?-1:1)*Math.acos(n/r)},Tu=function(e,t,n,r,i,a,o,s){t=Math.abs(t),n=Math.abs(n);var l=rs(r=(0,M.Z)(r,360));if(e.x===o.x&&e.y===o.y)return{x:e.x,y:e.y,ellipticalArcAngle:0};if(0===t||0===n)return{x:0,y:0,ellipticalArcAngle:0};var u=(e.x-o.x)/2,c=(e.y-o.y)/2,h={x:Math.cos(l)*u+Math.sin(l)*c,y:-Math.sin(l)*u+Math.cos(l)*c},d=Math.pow(h.x,2)/Math.pow(t,2)+Math.pow(h.y,2)/Math.pow(n,2);d>1&&(t*=Math.sqrt(d),n*=Math.sqrt(d));var f=(Math.pow(t,2)*Math.pow(n,2)-Math.pow(t,2)*Math.pow(h.y,2)-Math.pow(n,2)*Math.pow(h.x,2))/(Math.pow(t,2)*Math.pow(h.y,2)+Math.pow(n,2)*Math.pow(h.x,2));f=f<0?0:f;var v=(i!==a?1:-1)*Math.sqrt(f),p=v*(t*h.y/n),g=v*(-n*h.x/t),m={x:Math.cos(l)*p-Math.sin(l)*g+(e.x+o.x)/2,y:Math.sin(l)*p+Math.cos(l)*g+(e.y+o.y)/2},y={x:(h.x-p)/t,y:(h.y-g)/n},E=_u({x:1,y:0},y),_=_u(y,{x:(-h.x-p)/t,y:(-h.y-g)/n});!a&&_>0?_-=2*Math.PI:a&&_<0&&(_+=2*Math.PI);var T=E+(_%=2*Math.PI)*s,S=t*Math.cos(T),R=n*Math.sin(T);return{x:Math.cos(l)*S-Math.sin(l)*R+m.x,y:Math.sin(l)*S+Math.cos(l)*R+m.y,ellipticalArcStartAngle:E,ellipticalArcEndAngle:E+_,ellipticalArcAngle:T,ellipticalArcCenter:m,resultantRx:t,resultantRy:n}};function Su(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.arcParams,i=r.rx,a=void 0===i?0:i,o=r.ry,s=void 0===o?0:o,l=r.xRotation,u=r.arcFlag,c=r.sweepFlag,h=Tu({x:e.prePoint[0],y:e.prePoint[1]},a,s,l,!!u,!!c,{x:e.currentPoint[0],y:e.currentPoint[1]},t),d=Tu({x:e.prePoint[0],y:e.prePoint[1]},a,s,l,!!u,!!c,{x:e.currentPoint[0],y:e.currentPoint[1]},n?t+.005:t-.005),f=d.x-h.x,v=d.y-h.y,p=Math.sqrt(f*f+v*v);return{x:-f/p,y:-v/p}}function Ru(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Au(e,t){return Ru(e)*Ru(t)?(e[0]*t[0]+e[1]*t[1])/(Ru(e)*Ru(t)):1}function xu(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(Au(e,t))}function ku(e,t){var n=t[1],r=t[2],i=(0,M.Z)(rs(t[3]),2*Math.PI),a=t[4],o=t[5],s=e[0],l=e[1],u=t[6],c=t[7],h=Math.cos(i)*(s-u)/2+Math.sin(i)*(l-c)/2,d=-1*Math.sin(i)*(s-u)/2+Math.cos(i)*(l-c)/2,f=h*h/(n*n)+d*d/(r*r);f>1&&(n*=Math.sqrt(f),r*=Math.sqrt(f));var v=n*n*(d*d)+r*r*(h*h),p=v?Math.sqrt((n*n*(r*r)-v)/v):1;a===o&&(p*=-1),isNaN(p)&&(p=0);var g=r?p*n*d/r:0,m=n?p*-r*h/n:0,y=(s+u)/2+Math.cos(i)*g-Math.sin(i)*m,E=(l+c)/2+Math.sin(i)*g+Math.cos(i)*m,_=[(h-g)/n,(d-m)/r],T=[(-1*h-g)/n,(-1*d-m)/r],S=xu([1,0],_),R=xu(_,T);return Au(_,T)<=-1&&(R=Math.PI),Au(_,T)>=1&&(R=0),0===o&&R>0&&(R-=2*Math.PI),1===o&&R<0&&(R+=2*Math.PI),{cx:y,cy:E,rx:mu(e,[u,c])?0:n,ry:mu(e,[u,c])?0:r,startAngle:S,endAngle:S+R,xRotation:i,arcFlag:a,sweepFlag:o}}var Nu=function(e){if(""===e||Array.isArray(e)&&0===e.length)return{absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:{x:0,y:0,width:0,height:0}};var t;try{t=(0,C.A)(e)}catch(n){t=(0,C.A)(""),console.error("[g]: Invalid SVG Path definition: ".concat(e))}!function(e){for(var t=0;t<e.length;t++){var n=e[t-1],r=e[t];if("M"===r[0]&&n){var i=n[0],a=[r[1],r[2]],o=void 0;"L"===i||"M"===i?o=[n[1],n[2]]:"C"!==i&&"A"!==i&&"Q"!==i||(o=[n[n.length-2],n[n.length-1]]),o&&mu(a,o)&&(e.splice(t,1),t--)}}}(t);var n=function(e){for(var t=!1,n=e.length,r=0;r<n;r++){var i=e[r][0];if("C"===i||"A"===i||"Q"===i){t=!0;break}}return t}(t),r=function(e){for(var t=[],n=[],r=[],i=0;i<e.length;i++){var a=e[i],o=a[0];"M"===o?(r.length&&(n.push(r),r=[]),r.push([a[1],a[2]])):"Z"===o?r.length&&(t.push(r),r=[]):r.push([a[1],a[2]])}return r.length>0&&n.push(r),{polygons:t,polylines:n}}(t),i=r.polygons,a=r.polylines,o=function(e){for(var t=[],n=null,r=null,i=null,a=0,o=e.length,s=0;s<o;s++){var l=e[s];r=e[s+1];var u=l[0],c={command:u,prePoint:n,params:l,startTangent:null,endTangent:null,currentPoint:null,nextPoint:null,arcParams:null,box:null,cubicParams:null};switch(u){case"M":i=[l[1],l[2]],a=s;break;case"A":var h=ku(n,l);c.arcParams=h}if("Z"===u)n=i,r=e[a+1];else{var d=l.length;n=[l[d-2],l[d-1]]}r&&"Z"===r[0]&&(r=e[a],t[a]&&(t[a].prePoint=n)),c.currentPoint=n,t[a]&&mu(n,t[a].currentPoint)&&(t[a].prePoint=c.prePoint);var f=r?[r[r.length-2],r[r.length-1]]:null;c.nextPoint=f;var v=c.prePoint;if(["L","H","V"].includes(u))c.startTangent=[v[0]-n[0],v[1]-n[1]],c.endTangent=[n[0]-v[0],n[1]-v[1]];else if("Q"===u){var p=[l[1],l[2]];c.startTangent=[v[0]-p[0],v[1]-p[1]],c.endTangent=[n[0]-p[0],n[1]-p[1]]}else if("T"===u){var g=t[s-1],m=Eu(g.currentPoint,v);"Q"===g.command?(c.command="Q",c.startTangent=[v[0]-m[0],v[1]-m[1]],c.endTangent=[n[0]-m[0],n[1]-m[1]]):(c.command="TL",c.startTangent=[v[0]-n[0],v[1]-n[1]],c.endTangent=[n[0]-v[0],n[1]-v[1]])}else if("C"===u){var y=[l[1],l[2]],E=[l[3],l[4]];c.startTangent=[v[0]-y[0],v[1]-y[1]],c.endTangent=[n[0]-E[0],n[1]-E[1]],0===c.startTangent[0]&&0===c.startTangent[1]&&(c.startTangent=[y[0]-E[0],y[1]-E[1]]),0===c.endTangent[0]&&0===c.endTangent[1]&&(c.endTangent=[E[0]-y[0],E[1]-y[1]])}else if("S"===u){var _=t[s-1],T=Eu(_.currentPoint,v),S=[l[1],l[2]];"C"===_.command?(c.command="C",c.startTangent=[v[0]-T[0],v[1]-T[1]],c.endTangent=[n[0]-S[0],n[1]-S[1]]):(c.command="SQ",c.startTangent=[v[0]-S[0],v[1]-S[1]],c.endTangent=[n[0]-S[0],n[1]-S[1]])}else if("A"===u){var R=Su(c,0),A=R.x,x=R.y,k=Su(c,1,!1),N=k.x,M=k.y;c.startTangent=[A,x],c.endTangent=[N,M]}t.push(c)}return t}(t),s=function(e,t){for(var n=[],r=[],i=[],a=0;a<e.length;a++){var o=e[a],s=o.currentPoint,l=o.params,u=o.prePoint,c=void 0;switch(o.command){case"Q":c=Do(u[0],u[1],l[1],l[2],l[3],l[4]);break;case"C":c=Po(u[0],u[1],l[1],l[2],l[3],l[4],l[5],l[6]);break;case"A":var h=o.arcParams;c=Ao(h.cx,h.cy,h.rx,h.ry,h.xRotation,h.startAngle,h.endAngle);break;default:n.push(s[0]),r.push(s[1])}c&&(o.box=c,n.push(c.x,c.x+c.width),r.push(c.y,c.y+c.height)),t&&("L"===o.command||"M"===o.command)&&o.prePoint&&o.nextPoint&&i.push(o)}n=n.filter((function(e){return!Number.isNaN(e)&&e!==1/0&&e!==-1/0})),r=r.filter((function(e){return!Number.isNaN(e)&&e!==1/0&&e!==-1/0}));var d=(0,x.Z)(n),f=(0,x.Z)(r),v=(0,k.Z)(n),p=(0,k.Z)(r);if(0===i.length)return{x:d,y:f,width:v-d,height:p-f};for(var g=0;g<i.length;g++){var m=i[g],y=m.currentPoint;y[0]===d?d-=yu(m,t).xExtra:y[0]===v&&(v+=yu(m,t).xExtra),y[1]===f?f-=yu(m,t).yExtra:y[1]===p&&(p+=yu(m,t).yExtra)}return{x:d,y:f,width:v-d,height:p-f}}(o,0),l=s.x,u=s.y,c=s.width,h=s.height;return{absolutePath:t,hasArc:n,segments:o,polygons:i,polylines:a,totalLength:0,rect:{x:Number.isFinite(l)?l:0,y:Number.isFinite(u)?u:0,width:Number.isFinite(c)?c:0,height:Number.isFinite(h)?h:0}}},Mu=ul(Nu);function Cu(e){return(0,S.Z)(e)?Mu(e):Nu(e)}function bu(e,t,n){var r=e.curve,i=t.curve;r&&0!==r.length||(r=(0,b.Y)(e.absolutePath,!1),e.curve=r),i&&0!==i.length||(i=(0,b.Y)(t.absolutePath,!1),t.curve=i);var a=[r,i];r.length!==i.length&&(a=(0,P.x)(r,i));var o=(0,O.b)(a[0])!==(0,O.b)(a[1])?(0,I.G)(a[0]):(0,w.U)(a[0]);return[o,(0,L.g)(a[1],o),function(e){return e}]}function Pu(e,t){return{points:(0,S.Z)(e)?e.split(" ").map((function(e){var t=e.split(","),n=(0,h.Z)(t,2),r=n[0],i=n[1];return[Number(r),Number(i)]})):e,totalLength:0,segments:[]}}function Ou(e,t){return[e.points,t.points,function(e){return e}]}var Iu=null,wu=/\s*(\w+)\(([^)]*)\)/g;function Lu(e){return function(t){var n=0;return e.map((function(e){return e===Iu?t[n++]:e}))}}function Du(e){return e}var Bu={matrix:["NNNNNN",[Iu,Iu,0,0,Iu,Iu,0,0,0,0,1,0,Iu,Iu,0,1],Du],matrix3d:["NNNNNNNNNNNNNNNN",Du],rotate:["A"],rotateX:["A"],rotateY:["A"],rotateZ:["A"],rotate3d:["NNNA"],perspective:["L"],scale:["Nn",Lu([Iu,Iu,new xl(1)]),Du],scaleX:["N",Lu([Iu,new xl(1),new xl(1)]),Lu([Iu,new xl(1)])],scaleY:["N",Lu([new xl(1),Iu,new xl(1)]),Lu([new xl(1),Iu])],scaleZ:["N",Lu([new xl(1),new xl(1),Iu])],scale3d:["NNN",Du],skew:["Aa",null,Du],skewX:["A",null,Lu([Iu,Nl])],skewY:["A",null,Lu([Nl,Iu])],translate:["Tt",Lu([Iu,Iu,kl]),Du],translateX:["T",Lu([Iu,kl,kl]),Lu([Iu,kl])],translateY:["T",Lu([kl,Iu,kl]),Lu([kl,Iu])],translateZ:["L",Lu([kl,kl,Iu])],translate3d:["TTL",Du]};function Fu(e){for(var t=[],n=e.length,r=0;r<n;r++){var i=e[r],a=i[0],o=i.slice(1);if("translate"===a||"skew"===a?1===o.length&&o.push(0):"scale"===a&&1===o.length&&o.push(o[0]),!Bu[a])return[];var s=o.map((function(e){return wl(e)}));t.push({t:a,d:s})}return t}function Uu(e){if(Array.isArray(e))return Fu(e);if("none"===(e=(e||"none").trim()))return[];var t,n=[],r=0;for(wu.lastIndex=0;t=wu.exec(e);){if(t.index!==r)return[];r=t.index+t[0].length;var i=t[1],a=Bu[i];if(!a)return[];var o=t[2].split(","),s=a[0];if(s.length<o.length)return[];for(var l=[],u=0;u<s.length;u++){var c=o[u],h=s[u],d=void 0;if(void 0===(d=c?{A:function(e){return"0"===e.trim()?Nl:tu(e)},N:hu,T:Jl,L:$l}[h.toUpperCase()](c):{a:Nl,n:l[0],t:kl}[h]))return[];l.push(d)}if(n.push({t:i,d:l}),wu.lastIndex===e.length)return n}return[]}function Zu(e){if(Array.isArray(e))return Fu(e);if("none"===(e=(e||"none").trim()))return[];var t,n=[],r=0;for(wu.lastIndex=0;t=wu.exec(e);){if(t.index!==r)return[];r=t.index+t[0].length;var i=t[1],a=Bu[i];if(!a)return[];var o=t[2].split(","),s=a[0];if(s.length<o.length)return[];for(var l=[],u=0;u<s.length;u++){var c=o[u],h=s[u],d=void 0;if(void 0===(d=c?{A:function(e){return"0"===e.trim()?Nl:eu(e)},N:cu,T:Ql,L:ql}[h.toUpperCase()](c):{a:Nl,n:l[0],t:kl}[h]))return[];l.push(d)}if(n.push({t:i,d:l}),wu.lastIndex===e.length)return n}return[]}function Gu(e){var t,n,r,i;switch(e.t){case"rotateX":return i=rs(ru(e.d[0])),[1,0,0,0,0,Math.cos(i),Math.sin(i),0,0,-Math.sin(i),Math.cos(i),0,0,0,0,1];case"rotateY":return i=rs(ru(e.d[0])),[Math.cos(i),0,-Math.sin(i),0,0,1,0,0,Math.sin(i),0,Math.cos(i),0,0,0,0,1];case"rotate":case"rotateZ":return i=rs(ru(e.d[0])),[Math.cos(i),Math.sin(i),0,0,-Math.sin(i),Math.cos(i),0,0,0,0,1,0,0,0,0,1];case"rotate3d":t=e.d[0].value,n=e.d[1].value,r=e.d[2].value,i=rs(ru(e.d[3]));var a=t*t+n*n+r*r;if(0===a)t=1,n=0,r=0;else if(1!==a){var o=Math.sqrt(a);t/=o,n/=o,r/=o}var s=Math.sin(i/2),l=s*Math.cos(i/2),u=s*s;return[1-2*(n*n+r*r)*u,2*(t*n*u+r*l),2*(t*r*u-n*l),0,2*(t*n*u-r*l),1-2*(t*t+r*r)*u,2*(n*r*u+t*l),0,2*(t*r*u+n*l),2*(n*r*u-t*l),1-2*(t*t+n*n)*u,0,0,0,0,1];case"scale":return[e.d[0].value,0,0,0,0,e.d[1].value,0,0,0,0,1,0,0,0,0,1];case"scaleX":return[e.d[0].value,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"scaleY":return[1,0,0,0,0,e.d[0].value,0,0,0,0,1,0,0,0,0,1];case"scaleZ":return[1,0,0,0,0,1,0,0,0,0,e.d[0].value,0,0,0,0,1];case"scale3d":return[e.d[0].value,0,0,0,0,e.d[1].value,0,0,0,0,e.d[2].value,0,0,0,0,1];case"skew":var c=rs(ru(e.d[0])),h=rs(ru(e.d[1]));return[1,Math.tan(h),0,0,Math.tan(c),1,0,0,0,0,1,0,0,0,0,1];case"skewX":return i=rs(ru(e.d[0])),[1,0,0,0,Math.tan(i),1,0,0,0,0,1,0,0,0,0,1];case"skewY":return i=rs(ru(e.d[0])),[1,Math.tan(i),0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"translate":return[1,0,0,0,0,1,0,0,0,0,1,0,t=au(e.d[0],0,null)||0,n=au(e.d[1],0,null)||0,0,1];case"translateX":return[1,0,0,0,0,1,0,0,0,0,1,0,t=au(e.d[0],0,null)||0,0,0,1];case"translateY":return[1,0,0,0,0,1,0,0,0,0,1,0,0,n=au(e.d[0],0,null)||0,0,1];case"translateZ":return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,r=au(e.d[0],0,null)||0,1];case"translate3d":return[1,0,0,0,0,1,0,0,0,0,1,0,t=au(e.d[0],0,null)||0,n=au(e.d[1],0,null)||0,r=au(e.d[2],0,null)||0,1];case"perspective":var d=au(e.d[0],0,null)||0;return[1,0,0,0,0,1,0,0,0,0,1,d?-1/d:0,0,0,0,1];case"matrix":return[e.d[0].value,e.d[1].value,0,0,e.d[2].value,e.d[3].value,0,0,0,0,1,0,e.d[4].value,e.d[5].value,0,1];case"matrix3d":return e.d.map((function(e){return e.value}))}}function Vu(e,t){return[e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],e[0]*t[4]+e[4]*t[5]+e[8]*t[6]+e[12]*t[7],e[1]*t[4]+e[5]*t[5]+e[9]*t[6]+e[13]*t[7],e[2]*t[4]+e[6]*t[5]+e[10]*t[6]+e[14]*t[7],e[3]*t[4]+e[7]*t[5]+e[11]*t[6]+e[15]*t[7],e[0]*t[8]+e[4]*t[9]+e[8]*t[10]+e[12]*t[11],e[1]*t[8]+e[5]*t[9]+e[9]*t[10]+e[13]*t[11],e[2]*t[8]+e[6]*t[9]+e[10]*t[10]+e[14]*t[11],e[3]*t[8]+e[7]*t[9]+e[11]*t[10]+e[15]*t[11],e[0]*t[12]+e[4]*t[13]+e[8]*t[14]+e[12]*t[15],e[1]*t[12]+e[5]*t[13]+e[9]*t[14]+e[13]*t[15],e[2]*t[12]+e[6]*t[13]+e[10]*t[14]+e[14]*t[15],e[3]*t[12]+e[7]*t[13]+e[11]*t[14]+e[15]*t[15]]}function Wu(e){var t=[0,0,0],n=[1,1,1],r=[0,0,0],i=[0,0,0,1],a=[0,0,0,1];return function(e,t,n,r,i,a){if(!function(e,t){var n=t[15];if(0===n)return!1;for(var r=1/n,i=0;i<16;i++)e[i]=t[i]*r;return!0}(us,e))return!1;if(p.copy(cs,us),cs[3]=0,cs[7]=0,cs[11]=0,cs[15]=1,Math.abs(p.determinant(cs))<1e-8)return!1;var o,s,l=us[3],u=us[7],c=us[11],h=us[12],d=us[13],g=us[14],m=us[15];if(0!==l||0!==u||0!==c){if(hs[0]=l,hs[1]=u,hs[2]=c,hs[3]=m,!p.invert(cs,cs))return!1;p.transpose(cs,cs),v.transformMat4(i,hs,cs)}else i[0]=i[1]=i[2]=0,i[3]=1;if(t[0]=h,t[1]=d,t[2]=g,s=us,(o=ds)[0][0]=s[0],o[0][1]=s[1],o[0][2]=s[2],o[1][0]=s[4],o[1][1]=s[5],o[1][2]=s[6],o[2][0]=s[8],o[2][1]=s[9],o[2][2]=s[10],n[0]=f.length(ds[0]),f.normalize(ds[0],ds[0]),r[0]=f.dot(ds[0],ds[1]),vs(ds[1],ds[1],ds[0],1,-r[0]),n[1]=f.length(ds[1]),f.normalize(ds[1],ds[1]),r[0]/=n[1],r[1]=f.dot(ds[0],ds[2]),vs(ds[2],ds[2],ds[0],1,-r[1]),r[2]=f.dot(ds[1],ds[2]),vs(ds[2],ds[2],ds[1],1,-r[2]),n[2]=f.length(ds[2]),f.normalize(ds[2],ds[2]),r[1]/=n[2],r[2]/=n[2],f.cross(fs,ds[1],ds[2]),f.dot(ds[0],fs)<0)for(var y=0;y<3;y++)n[y]*=-1,ds[y][0]*=-1,ds[y][1]*=-1,ds[y][2]*=-1;a[0]=.5*Math.sqrt(Math.max(1+ds[0][0]-ds[1][1]-ds[2][2],0)),a[1]=.5*Math.sqrt(Math.max(1-ds[0][0]+ds[1][1]-ds[2][2],0)),a[2]=.5*Math.sqrt(Math.max(1-ds[0][0]-ds[1][1]+ds[2][2],0)),a[3]=.5*Math.sqrt(Math.max(1+ds[0][0]+ds[1][1]+ds[2][2],0)),ds[2][1]>ds[1][2]&&(a[0]=-a[0]),ds[0][2]>ds[2][0]&&(a[1]=-a[1]),ds[1][0]>ds[0][1]&&(a[2]=-a[2])}(function(e){return 0===e.length?[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]:e.map(Gu).reduce(Vu)}(e),t,n,r,i,a),[[t,n,r,a,i]]}var Hu=function(){function e(e,t){for(var n=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],r=0;r<4;r++)for(var i=0;i<4;i++)for(var a=0;a<4;a++)n[r][i]+=t[r][a]*e[a][i];return n}return function(t,n,r,i,a){for(var o=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],s=0;s<4;s++)o[s][3]=a[s];for(var l=0;l<3;l++)for(var u=0;u<3;u++)o[3][l]+=t[u]*o[u][l];var c=i[0],h=i[1],d=i[2],f=i[3],v=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];v[0][0]=1-2*(h*h+d*d),v[0][1]=2*(c*h-d*f),v[0][2]=2*(c*d+h*f),v[1][0]=2*(c*h+d*f),v[1][1]=1-2*(c*c+d*d),v[1][2]=2*(h*d-c*f),v[2][0]=2*(c*d-h*f),v[2][1]=2*(h*d+c*f),v[2][2]=1-2*(c*c+h*h),o=e(o,v);var p,g=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];r[2]&&(g[2][1]=r[2],o=e(o,g)),r[1]&&(g[2][1]=0,g[2][0]=r[0],o=e(o,g)),r[0]&&(g[2][0]=0,g[1][0]=r[0],o=e(o,g));for(var m=0;m<3;m++)for(var y=0;y<3;y++)o[m][y]*=n[m];return 0===(p=o)[0][2]&&0===p[0][3]&&0===p[1][2]&&0===p[1][3]&&0===p[2][0]&&0===p[2][1]&&1===p[2][2]&&0===p[2][3]&&0===p[3][2]&&1===p[3][3]?[o[0][0],o[0][1],o[1][0],o[1][1],o[3][0],o[3][1]]:o[0].concat(o[1],o[2],o[3])}}();function Xu(e){return e.toFixed(6).replace(".000000","")}function zu(e,t){var n,r;return e.decompositionPair!==t&&(e.decompositionPair=t,n=Wu(e)),t.decompositionPair!==e&&(t.decompositionPair=e,r=Wu(t)),null===n[0]||null===r[0]?[[!1],[!0],function(n){return n?t[0].d:e[0].d}]:(n[0].push(0),r[0].push(1),[n,r,function(e){var t=function(e,t,n){var r=function(e,t){for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[r];return n}(e,t);r=(0,R.Z)(r,-1,1);var i=[];if(1===r)i=e;else for(var a=Math.acos(r),o=1*Math.sin(n*a)/Math.sqrt(1-r*r),s=0;s<4;s++)i.push(e[s]*(Math.cos(n*a)-r*o)+t[s]*o);return i}(n[0][3],r[0][3],e[5]);return Hu(e[0],e[1],e[2],t,e[4]).map(Xu).join(",")}])}function Yu(e){return e.replace(/[XY]/,"")}function ju(e){return e.replace(/(X|Y|Z|3d)?$/,"3d")}function Ku(e,t,n){var r=!1;if(!e.length||!t.length){e.length||(r=!0,e=t,t=[]);for(var i=function(){var n=e[a],r=n.t,i=n.d,o="scale"===r.substring(0,5)?1:0;t.push({t:r,d:i.map((function(e){return"number"==typeof e?wl(o):wl(o,e.unit)}))})},a=0;a<e.length;a++)i()}var o,s,l=[],u=[],c=[];if(e.length!==t.length){var h=zu(e,t);l=[h[0]],u=[h[1]],c=[["matrix",[h[2]]]]}else for(var d=0;d<e.length;d++){var f=e[d].t,v=t[d].t,p=e[d].d,g=t[d].d,m=Bu[f],y=Bu[v],E=void 0;if(s=v,"perspective"===(o=f)&&"perspective"===s||!("matrix"!==o&&"matrix3d"!==o||"matrix"!==s&&"matrix3d"!==s)){var _=zu([e[d]],[t[d]]);l.push(_[0]),u.push(_[1]),c.push(["matrix",[_[2]]])}else{if(f===v)E=f;else if(m[2]&&y[2]&&Yu(f)===Yu(v))E=Yu(f),p=m[2](p),g=y[2](g);else{if(!m[1]||!y[1]||ju(f)!==ju(v)){var T=zu(e,t);l=[T[0]],u=[T[1]],c=[["matrix",[T[2]]]];break}E=ju(f),p=m[1](p),g=y[1](g)}for(var S=[],R=[],A=[],x=0;x<p.length;x++){var k=nu(p[x],g[x],n,!1,x);S[x]=k[0],R[x]=k[1],A.push(k[2])}l.push(S),u.push(R),c.push([E,A])}}if(r){var N=l;l=u,u=N}return[l,u,function(e){return e.map((function(e,t){var n=e.map((function(e,n){return c[t][1][n](e)})).join(",");return"matrix"===c[t][0]&&16===n.split(",").length&&(c[t][0]="matrix3d"),"matrix3d"===c[t][0]&&6===n.split(",").length&&(c[t][0]="matrix"),"".concat(c[t][0],"(").concat(n,")")})).join(" ")}]}var qu=ul((function(e){if((0,S.Z)(e)){if("text-anchor"===e)return[wl(0,"px"),wl(0,"px")];var t=e.split(" ");return 1===t.length&&("top"===t[0]||"bottom"===t[0]?(t[1]=t[0],t[0]="center"):t[1]="center"),2!==t.length?null:[Jl($u(t[0])),Jl($u(t[1]))]}return[wl(e[0]||0,"px"),wl(e[1]||0,"px")]}));function $u(e){return"center"===e?"50%":"left"===e||"top"===e?"0%":"right"===e||"bottom"===e?"100%":e}var Qu=[{n:"display",k:["none"]},{n:"opacity",int:!0,inh:!0,d:"1",syntax:Ms.OPACITY_VALUE},{n:"fillOpacity",int:!0,inh:!0,d:"1",syntax:Ms.OPACITY_VALUE},{n:"strokeOpacity",int:!0,inh:!0,d:"1",syntax:Ms.OPACITY_VALUE},{n:"fill",int:!0,k:["none"],d:"none",syntax:Ms.PAINT},{n:"fillRule",k:["nonzero","evenodd"],d:"nonzero"},{n:"stroke",int:!0,k:["none"],d:"none",syntax:Ms.PAINT,l:!0},{n:"shadowType",k:["inner","outer","both"],d:"outer",l:!0},{n:"shadowColor",int:!0,syntax:Ms.COLOR},{n:"shadowOffsetX",int:!0,l:!0,d:"0",syntax:Ms.LENGTH_PERCENTAGE},{n:"shadowOffsetY",int:!0,l:!0,d:"0",syntax:Ms.LENGTH_PERCENTAGE},{n:"shadowBlur",int:!0,l:!0,d:"0",syntax:Ms.SHADOW_BLUR},{n:"lineWidth",int:!0,inh:!0,d:"1",l:!0,a:["strokeWidth"],syntax:Ms.LENGTH_PERCENTAGE},{n:"increasedLineWidthForHitTesting",inh:!0,d:"0",l:!0,syntax:Ms.LENGTH_PERCENTAGE},{n:"lineJoin",inh:!0,l:!0,a:["strokeLinejoin"],k:["miter","bevel","round"],d:"miter"},{n:"lineCap",inh:!0,l:!0,a:["strokeLinecap"],k:["butt","round","square"],d:"butt"},{n:"lineDash",int:!0,inh:!0,k:["none"],a:["strokeDasharray"],syntax:Ms.LENGTH_PERCENTAGE_12},{n:"lineDashOffset",int:!0,inh:!0,d:"0",a:["strokeDashoffset"],syntax:Ms.LENGTH_PERCENTAGE},{n:"offsetPath",syntax:Ms.DEFINED_PATH},{n:"offsetDistance",int:!0,syntax:Ms.OFFSET_DISTANCE},{n:"dx",int:!0,l:!0,d:"0",syntax:Ms.LENGTH_PERCENTAGE},{n:"dy",int:!0,l:!0,d:"0",syntax:Ms.LENGTH_PERCENTAGE},{n:"zIndex",ind:!0,int:!0,d:"0",k:["auto"],syntax:Ms.Z_INDEX},{n:"visibility",k:["visible","hidden"],ind:!0,inh:!0,int:!0,d:"visible"},{n:"pointerEvents",inh:!0,k:["none","auto","stroke","fill","painted","visible","visiblestroke","visiblefill","visiblepainted","all"],d:"auto"},{n:"filter",ind:!0,l:!0,k:["none"],d:"none",syntax:Ms.FILTER},{n:"clipPath",syntax:Ms.DEFINED_PATH},{n:"textPath",syntax:Ms.DEFINED_PATH},{n:"textPathSide",k:["left","right"],d:"left"},{n:"textPathStartOffset",l:!0,d:"0",syntax:Ms.LENGTH_PERCENTAGE},{n:"transform",p:100,int:!0,k:["none"],d:"none",syntax:Ms.TRANSFORM},{n:"transformOrigin",p:100,d:"0 0",l:!0,syntax:Ms.TRANSFORM_ORIGIN},{n:"cx",int:!0,l:!0,d:"0",syntax:Ms.COORDINATE},{n:"cy",int:!0,l:!0,d:"0",syntax:Ms.COORDINATE},{n:"cz",int:!0,l:!0,d:"0",syntax:Ms.COORDINATE},{n:"r",int:!0,l:!0,d:"0",syntax:Ms.LENGTH_PERCENTAGE},{n:"rx",int:!0,l:!0,d:"0",syntax:Ms.LENGTH_PERCENTAGE},{n:"ry",int:!0,l:!0,d:"0",syntax:Ms.LENGTH_PERCENTAGE},{n:"x",int:!0,l:!0,d:"0",syntax:Ms.COORDINATE},{n:"y",int:!0,l:!0,d:"0",syntax:Ms.COORDINATE},{n:"z",int:!0,l:!0,d:"0",syntax:Ms.COORDINATE},{n:"width",int:!0,l:!0,k:["auto","fit-content","min-content","max-content"],d:"0",syntax:Ms.LENGTH_PERCENTAGE},{n:"height",int:!0,l:!0,k:["auto","fit-content","min-content","max-content"],d:"0",syntax:Ms.LENGTH_PERCENTAGE},{n:"radius",int:!0,l:!0,d:"0",syntax:Ms.LENGTH_PERCENTAGE_14},{n:"x1",int:!0,l:!0,syntax:Ms.COORDINATE},{n:"y1",int:!0,l:!0,syntax:Ms.COORDINATE},{n:"z1",int:!0,l:!0,syntax:Ms.COORDINATE},{n:"x2",int:!0,l:!0,syntax:Ms.COORDINATE},{n:"y2",int:!0,l:!0,syntax:Ms.COORDINATE},{n:"z2",int:!0,l:!0,syntax:Ms.COORDINATE},{n:"d",int:!0,l:!0,d:"",syntax:Ms.PATH,p:50},{n:"points",int:!0,l:!0,syntax:Ms.LIST_OF_POINTS,p:50},{n:"text",l:!0,d:"",syntax:Ms.TEXT,p:50},{n:"textTransform",l:!0,inh:!0,k:["capitalize","uppercase","lowercase","none"],d:"none",syntax:Ms.TEXT_TRANSFORM,p:51},{n:"font",l:!0},{n:"fontSize",int:!0,inh:!0,d:"16px",l:!0,syntax:Ms.LENGTH_PERCENTAGE},{n:"fontFamily",l:!0,inh:!0,d:"sans-serif"},{n:"fontStyle",l:!0,inh:!0,k:["normal","italic","oblique"],d:"normal"},{n:"fontWeight",l:!0,inh:!0,k:["normal","bold","bolder","lighter"],d:"normal"},{n:"fontVariant",l:!0,inh:!0,k:["normal","small-caps"],d:"normal"},{n:"lineHeight",l:!0,syntax:Ms.LENGTH,int:!0,d:"0"},{n:"letterSpacing",l:!0,syntax:Ms.LENGTH,int:!0,d:"0"},{n:"miterLimit",l:!0,syntax:Ms.NUMBER,d:function(e){return e===Fo.PATH||e===Fo.POLYGON||e===Fo.POLYLINE?"4":"10"}},{n:"wordWrap",l:!0},{n:"wordWrapWidth",l:!0},{n:"maxLines",l:!0},{n:"textOverflow",l:!0,d:"clip"},{n:"leading",l:!0},{n:"textBaseline",l:!0,inh:!0,k:["top","hanging","middle","alphabetic","ideographic","bottom"],d:"alphabetic"},{n:"textAlign",l:!0,inh:!0,k:["start","center","middle","end","left","right"],d:"start"},{n:"markerStart",syntax:Ms.MARKER},{n:"markerEnd",syntax:Ms.MARKER},{n:"markerMid",syntax:Ms.MARKER},{n:"markerStartOffset",syntax:Ms.LENGTH,l:!0,int:!0,d:"0"},{n:"markerEndOffset",syntax:Ms.LENGTH,l:!0,int:!0,d:"0"}],Ju=new Set(Qu.filter((function(e){return!!e.l})).map((function(e){return e.n}))),ec={},tc=function(){return(0,a.Z)((function e(t){var n=this;(0,o.Z)(this,e),this.runtime=t,Qu.forEach((function(e){n.registerMetadata(e)}))}),[{key:"registerMetadata",value:function(e){[e.n].concat((0,c.Z)(e.a||[])).forEach((function(t){ec[t]=e}))}},{key:"getPropertySyntax",value:function(e){return this.runtime.CSSPropertySyntaxFactory[e]}},{key:"processProperties",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{skipUpdateAttribute:!1,skipParse:!1,forceUpdateGeometry:!1,usedAttributes:[],memoize:!0};Object.assign(e.attributes,t);var r=e.parsedStyle.clipPath,i=e.parsedStyle.offsetPath;nc(e,t);var a=!!n.forceUpdateGeometry;if(!a)for(var o in t)if(Ju.has(o)){a=!0;break}var s=rc(e);s.has("fill")&&t.fill&&(e.parsedStyle.fill=Yl(t.fill)),s.has("stroke")&&t.stroke&&(e.parsedStyle.stroke=Yl(t.stroke)),s.has("shadowColor")&&t.shadowColor&&(e.parsedStyle.shadowColor=Yl(t.shadowColor)),s.has("filter")&&t.filter&&(e.parsedStyle.filter=lu(t.filter)),s.has("radius")&&!(0,T.Z)(t.radius)&&(e.parsedStyle.radius=iu(t.radius,4)),s.has("lineDash")&&!(0,T.Z)(t.lineDash)&&(e.parsedStyle.lineDash=iu(t.lineDash,"even")),s.has("points")&&t.points&&(e.parsedStyle.points=Pu(t.points)),s.has("d")&&""===t.d&&(e.parsedStyle.d=(0,u.Z)({},Ns)),s.has("d")&&t.d&&(e.parsedStyle.d=Cu(t.d)),s.has("textTransform")&&t.textTransform&&this.runtime.CSSPropertySyntaxFactory[Ms.TEXT_TRANSFORM].calculator(null,null,{value:t.textTransform},e,null),s.has("clipPath")&&!(0,D.Z)(t.clipPath)&&this.runtime.CSSPropertySyntaxFactory[Ms.DEFINED_PATH].calculator("clipPath",r,t.clipPath,e,this.runtime),s.has("offsetPath")&&t.offsetPath&&this.runtime.CSSPropertySyntaxFactory[Ms.DEFINED_PATH].calculator("offsetPath",i,t.offsetPath,e,this.runtime),s.has("transform")&&t.transform&&(e.parsedStyle.transform=Uu(t.transform)),s.has("transformOrigin")&&t.transformOrigin&&(e.parsedStyle.transformOrigin=qu(t.transformOrigin)),s.has("markerStart")&&t.markerStart&&(e.parsedStyle.markerStart=this.runtime.CSSPropertySyntaxFactory[Ms.MARKER].calculator(null,t.markerStart,t.markerStart,null,null)),s.has("markerEnd")&&t.markerEnd&&(e.parsedStyle.markerEnd=this.runtime.CSSPropertySyntaxFactory[Ms.MARKER].calculator(null,t.markerEnd,t.markerEnd,null,null)),s.has("markerMid")&&t.markerMid&&(e.parsedStyle.markerMid=this.runtime.CSSPropertySyntaxFactory[Ms.MARKER].calculator("",t.markerMid,t.markerMid,null,null)),s.has("zIndex")&&!(0,T.Z)(t.zIndex)&&this.runtime.CSSPropertySyntaxFactory[Ms.Z_INDEX].postProcessor(e),s.has("offsetDistance")&&!(0,T.Z)(t.offsetDistance)&&this.runtime.CSSPropertySyntaxFactory[Ms.OFFSET_DISTANCE].postProcessor(e),s.has("transform")&&t.transform&&this.runtime.CSSPropertySyntaxFactory[Ms.TRANSFORM].postProcessor(e),s.has("transformOrigin")&&t.transformOrigin&&this.runtime.CSSPropertySyntaxFactory[Ms.TRANSFORM_ORIGIN].postProcessor(e),a&&(e.dirty(!0,!0),n.forceUpdateGeometry||this.runtime.sceneGraphService.dirtyToRoot(e))}},{key:"updateGeometry",value:function(e){var t=e.nodeName,n=this.runtime.geometryUpdaterFactory[t];if(n){var r=e.geometry;r.contentBounds||(r.contentBounds=new Yo),r.renderBounds||(r.renderBounds=new Yo);var i=e.parsedStyle,a=n.update(i,e),o=a.cx,s=void 0===o?0:o,l=a.cy,u=void 0===l?0:l,c=a.cz,h=void 0===c?0:c,d=a.hwidth,v=void 0===d?0:d,p=a.hheight,g=void 0===p?0:p,m=a.hdepth,y=void 0===m?0:m,E=[Math.abs(v),Math.abs(g),y],_=i.stroke,T=i.lineWidth,S=void 0===T?1:T,R=i.increasedLineWidthForHitTesting,A=void 0===R?0:R,x=i.shadowType,k=void 0===x?"outer":x,N=i.shadowColor,M=i.filter,C=void 0===M?[]:M,b=i.transformOrigin,P=[s,u,h];r.contentBounds.update(P,E);var O=t===Fo.POLYLINE||t===Fo.POLYGON||t===Fo.PATH?Math.SQRT2:.5;if(_&&!_.isNone){var I=((S||0)+(A||0))*O;E[0]+=I,E[1]+=I}if(r.renderBounds.update(P,E),N&&k&&"inner"!==k){var w=r.renderBounds,L=w.min,D=w.max,B=i.shadowBlur||0,F=i.shadowOffsetX||0,U=i.shadowOffsetY||0,Z=L[0]-B+F,G=D[0]+B+F,V=L[1]-B+U,W=D[1]+B+U;L[0]=Math.min(L[0],Z),D[0]=Math.max(D[0],G),L[1]=Math.min(L[1],V),D[1]=Math.max(D[1],W),r.renderBounds.setMinMax(L,D)}C.forEach((function(e){var t=e.name,n=e.params;if("blur"===t){var i=n[0].value;r.renderBounds.update(r.renderBounds.center,f.add(r.renderBounds.halfExtents,r.renderBounds.halfExtents,[i,i,0]))}else if("drop-shadow"===t){var a=n[0].value,o=n[1].value,s=n[2].value,l=r.renderBounds,u=l.min,c=l.max,h=u[0]-s+a,d=c[0]+s+a,v=u[1]-s+o,p=c[1]+s+o;u[0]=Math.min(u[0],h),c[0]=Math.max(c[0],d),u[1]=Math.min(u[1],v),c[1]=Math.max(c[1],p),r.renderBounds.setMinMax(u,c)}})),e.geometry.dirty=!1;var H=g<0,X=(v<0?-1:1)*(b?au(b[0],0,e,!0):0),z=(H?-1:1)*(b?au(b[1],1,e,!0):0);(X||z)&&e.setOrigin(X,z)}}},{key:"updateSizeAttenuation",value:function(e,t){e.style.isSizeAttenuation?(e.style.rawLineWidth||(e.style.rawLineWidth=e.style.lineWidth),e.style.lineWidth=(e.style.rawLineWidth||1)/t,e.nodeName===Fo.CIRCLE&&(e.style.rawR||(e.style.rawR=e.style.r),e.style.r=(e.style.rawR||1)/t)):(e.style.rawLineWidth&&(e.style.lineWidth=e.style.rawLineWidth,delete e.style.rawLineWidth),e.nodeName===Fo.CIRCLE&&e.style.rawR&&(e.style.r=e.style.rawR,delete e.style.rawR))}}])}();function nc(e,t){var n=rc(e);for(var r in t)n.has(r)&&(e.parsedStyle[r]=t[r])}function rc(e){return e.constructor.PARSED_STYLE_LIST}var ic=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=du}),[{key:"calculator",value:function(e,t,n,r){return ru(n)}}])}(),ac=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r,i){return n instanceof Rl&&(n=null),i.sceneGraphService.updateDisplayObjectDependency(e,t,n,r),"clipPath"===e&&r.forEach((function(e){0===e.childNodes.length&&i.sceneGraphService.dirtyToRoot(e)})),n}}])}(),oc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.parser=Yl,this.mixer=jl}),[{key:"calculator",value:function(e,t,n,r){return n instanceof Rl?"none"===n.value?Pl:Ol:n}}])}(),sc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n){return n instanceof Rl?[]:n}}])}();function lc(e){var t=e.parsedStyle.fontSize;return(0,T.Z)(t)?null:t}var uc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=du}),[{key:"calculator",value:function(e,t,n,r,i){if((0,E.Z)(n))return n;if(!xl.isRelativeUnit(n.unit))return n.value;if(n.unit===cl.kPercentage)return 0;if(n.unit===cl.kEms){if(r.parentNode){var a=lc(r.parentNode);if(a)return a*=n.value}return 0}if(n.unit===cl.kRems){var o;if(null!=r&&null!==(o=r.ownerDocument)&&void 0!==o&&o.documentElement){var s=lc(r.ownerDocument.documentElement);if(s)return s*=n.value}return 0}}}])}(),cc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=vu}),[{key:"calculator",value:function(e,t,n){return n.map((function(e){return e.value}))}}])}(),hc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=vu}),[{key:"calculator",value:function(e,t,n){return n.map((function(e){return e.value}))}}])}(),dc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){var i;n instanceof Rl&&(n=null);var a=null===(i=n)||void 0===i?void 0:i.cloneNode(!0);return a&&(a.style.isMarker=!0),a}}])}(),fc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=du}),[{key:"calculator",value:function(e,t,n){return n.value}}])}(),vc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=fu(0,1)}),[{key:"calculator",value:function(e,t,n){return n.value}},{key:"postProcessor",value:function(e){var t=e.parsedStyle,n=t.offsetPath,r=t.offsetDistance;if(n){var i=n.nodeName;if(i===Fo.LINE||i===Fo.PATH||i===Fo.POLYLINE){var a=n.getPoint(r);a&&e.setLocalPosition(a.x,a.y)}}}}])}(),pc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=fu(0,1)}),[{key:"calculator",value:function(e,t,n){return n.value}}])}(),gc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.parser=Cu,this.mixer=bu}),[{key:"calculator",value:function(e,t,n){return n instanceof Rl&&"unset"===n.value?{absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:new $o(0,0,0,0)}:n}}])}(),mc=(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Ou})),yc=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).mixer=fu(0,1/0),e}return(0,l.Z)(t,e),(0,a.Z)(t)}(uc),Ec=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){return n instanceof Rl?"unset"===n.value?"":n.value:"".concat(n)}},{key:"postProcessor",value:function(e){e.nodeValue="".concat(e.parsedStyle.text)||""}}])}(),_c=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){var i=r.getAttribute("text");if(i){var a=i;"capitalize"===n.value?a=i.charAt(0).toUpperCase()+i.slice(1):"lowercase"===n.value?a=i.toLowerCase():"uppercase"===n.value&&(a=i.toUpperCase()),r.parsedStyle.text=a}return n.value}}])}();new WeakMap;"undefined"!=typeof window&&window.document;function Tc(e){var t=e;do{var n;if(null===(n=t.parsedStyle)||void 0===n?void 0:n.clipPath)return t;t=t.parentElement}while(null!==t);return null}var Sc={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Rc="object"===("undefined"==typeof performance?"undefined":i()(performance))&&performance.now?performance:Date;function Ac(e){return e.nodeName===Fo.FRAGMENT||e.getRootNode().nodeName===Fo.FRAGMENT}function xc(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=!1,i=!1,a=!!t&&!t.isNone,o=!!n&&!n.isNone;return"visiblepainted"===e||"painted"===e||"auto"===e?(r=a,i=o):"visiblefill"===e||"fill"===e?r=!0:"visiblestroke"===e||"stroke"===e?i=!0:"visible"!==e&&"all"!==e||(r=!0,i=!0),[r,i]}var kc=1,Nc="object"===("undefined"==typeof self?"undefined":i()(self))&&self.self===self?self:"object"===(void 0===n.g?"undefined":i()(n.g))&&n.g.global===n.g?n.g:{},Mc=Date.now(),Cc={},bc=Date.now(),Pc=function(e){if("function"!=typeof e)throw new TypeError("".concat(e," is not a function"));var t=Date.now(),n=t-bc,r=n>16?0:16-n,i=kc++;return Cc[i]=e,Object.keys(Cc).length>1||setTimeout((function(){bc=t;var e=Cc;Cc={},Object.keys(e).forEach((function(t){return e[t](Nc.performance&&"function"==typeof Nc.performance.now?Nc.performance.now():Date.now()-Mc)}))}),r),i},Oc=function(e){delete Cc[e]},Ic=function(e){return"string"!=typeof e?Pc:""===e?Nc.requestAnimationFrame:Nc["".concat(e,"RequestAnimationFrame")]},wc=function(e,t){for(var n=0;void 0!==e[n];){if(t(e[n]))return e[n];n+=1}}(["","webkit","moz","ms","o"],(function(e){return!!Ic(e)})),Lc=Ic(wc),Dc=function(e){return"string"!=typeof e?Oc:""===e?Nc.cancelAnimationFrame:Nc["".concat(e,"CancelAnimationFrame")]||Nc["".concat(e,"CancelRequestAnimationFrame")]}(wc);Nc.requestAnimationFrame=Lc,Nc.cancelAnimationFrame=Dc;var Bc=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Fc=/([\"\'])[^\'\"]+\1/;function Uc(e){var t=e.fontSize,n=void 0===t?16:t,r=e.fontFamily,i=void 0===r?"sans-serif":r,a=e.fontStyle,o=void 0===a?"normal":a,s=e.fontVariant,l=void 0===s?"normal":s,u=e.fontWeight;return{fontSize:n,fontFamily:i,fontStyle:o,fontVariant:l,fontWeight:void 0===u?"normal":u}}var Zc=ul((function(e){for(var t=Uc(e),n=t.fontSize,r=t.fontFamily,i=t.fontStyle,a=t.fontVariant,o=t.fontWeight,s=(0,E.Z)(n)&&"".concat(n,"px")||"16px",l=r.split(","),u=l.length-1;u>=0;u--){var c=l[u].trim();!Fc.test(c)&&Bc.indexOf(c)<0&&(c='"'.concat(c,'"')),l[u]=c}return"".concat(i," ").concat(a," ").concat(o," ").concat(s," ").concat(l.join(","))}),(function(e){var t=Uc(e),n=t.fontSize,r=t.fontFamily,i=t.fontStyle,a=t.fontVariant,o=t.fontWeight;return"".concat(i,"_").concat(a,"_").concat(o,"_").concat(n,"_").concat(r)})),Gc=function(e){return Math.max(e,1e-6)};function Vc(e,t,n){return p.identity(e),e[4]=Math.tan(t),e[1]=Math.tan(n),e}var Wc=p.create(),Hc=p.create(),Xc={scale:function(e){p.fromScaling(Wc,[e[0].value,e[1].value,1].map((function(e){return Gc(e)})))},scaleX:function(e){p.fromScaling(Wc,[e[0].value,1,1].map((function(e){return Gc(e)})))},scaleY:function(e){p.fromScaling(Wc,[1,e[0].value,1].map((function(e){return Gc(e)})))},scaleZ:function(e){p.fromScaling(Wc,[1,1,e[0].value].map((function(e){return Gc(e)})))},scale3d:function(e){p.fromScaling(Wc,[e[0].value,e[1].value,e[2].value].map((function(e){return Gc(e)})))},translate:function(e){p.fromTranslation(Wc,[e[0].value,e[1].value,0])},translateX:function(e){p.fromTranslation(Wc,[e[0].value,0,0])},translateY:function(e){p.fromTranslation(Wc,[0,e[0].value,0])},translateZ:function(e){p.fromTranslation(Wc,[0,0,e[0].value])},translate3d:function(e){p.fromTranslation(Wc,[e[0].value,e[1].value,e[2].value])},rotate:function(e){p.fromZRotation(Wc,rs(ru(e[0])))},rotateX:function(e){p.fromXRotation(Wc,rs(ru(e[0])))},rotateY:function(e){p.fromYRotation(Wc,rs(ru(e[0])))},rotateZ:function(e){p.fromZRotation(Wc,rs(ru(e[0])))},rotate3d:function(e){p.fromRotation(Wc,rs(ru(e[3])),[e[0].value,e[1].value,e[2].value])},skew:function(e){Vc(Wc,rs(e[0].value),rs(e[1].value))},skewX:function(e){Vc(Wc,rs(e[0].value),0)},skewY:function(e){Vc(Wc,0,rs(e[0].value))},matrix:function(e){p.set(Wc,e[0].value,e[1].value,0,0,e[2].value,e[3].value,0,0,0,0,1,0,e[4].value,e[5].value,0,1)},matrix3d:function(e){p.set.apply(p,[Wc].concat((0,c.Z)(e.map((function(e){return e.value})))))}},zc=f.fromValues(1,1,1),Yc=f.create(),jc={translate:function(e,t){zh.sceneGraphService.setLocalScale(e,zc,!1),zh.sceneGraphService.setLocalEulerAngles(e,Yc,void 0,void 0,!1),zh.sceneGraphService.setLocalPosition(e,[t[0].value,t[1].value,0],!1),zh.sceneGraphService.dirtyLocalTransform(e,e.transformable)}};function Kc(e,t){if(e.length){if(1===e.length&&jc[e[0].t])return void jc[e[0].t](t,e[0].d);for(var n=p.identity(Hc),r=0;r<e.length;r++){var i=e[r],a=i.t,o=i.d,s=Xc[a];s&&(s(o),p.mul(n,n,Wc))}t.setLocalTransform(n)}else t.resetLocalTransform();return t.getLocalTransform()}var qc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.parser=Zu,this.mixer=Ku}),[{key:"calculator",value:function(e,t,n,r){return n instanceof Rl?[]:n}},{key:"postProcessor",value:function(e){Kc(e.parsedStyle.transform,e)}}])}(),$c=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"postProcessor",value:function(e){var t=e.parsedStyle.transformOrigin;t[0].unit===cl.kPixels&&t[1].unit===cl.kPixels?e.setOrigin(t[0].value,t[1].value):e.getGeometryBounds()}}])}(),Qc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){return n.value}},{key:"postProcessor",value:function(e){if(e.parentNode){var t=e.parentNode,n=t.renderable,r=t.sortable;n&&t.dirty(),r&&(r.dirty=!0,r.dirtyReason=Ss.Z_INDEX_CHANGED)}}}])}(),Jc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.cx,r=void 0===n?0:n,i=e.cy,a=void 0===i?0:i,o=e.r,s=void 0===o?0:o;return{cx:r,cy:a,hwidth:s,hheight:s}}}])}(),eh=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.cx,r=void 0===n?0:n,i=e.cy,a=void 0===i?0:i,o=e.rx,s=void 0===o?0:o,l=e.ry;return{cx:r,cy:a,hwidth:s,hheight:void 0===l?0:l}}}])}(),th=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e){var t=e.x1,n=e.y1,r=e.x2,i=e.y2,a=Math.min(t,r),o=Math.max(t,r),s=Math.min(n,i),l=(o-a)/2,u=(Math.max(n,i)-s)/2;return{cx:a+l,cy:s+u,hwidth:l,hheight:u}}}])}(),nh=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e){var t=e.d.rect,n=t.x,r=t.y,i=t.width/2,a=t.height/2;return{cx:n+i,cy:r+a,hwidth:i,hheight:a}}}])}(),rh=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e){if(e.points&&(0,B.Z)(e.points.points)){var t=e.points.points,n=Math.min.apply(Math,(0,c.Z)(t.map((function(e){return e[0]})))),r=Math.max.apply(Math,(0,c.Z)(t.map((function(e){return e[0]})))),i=Math.min.apply(Math,(0,c.Z)(t.map((function(e){return e[1]})))),a=(r-n)/2,o=(Math.max.apply(Math,(0,c.Z)(t.map((function(e){return e[1]}))))-i)/2;return{cx:n+a,cy:i+o,hwidth:a,hheight:o}}return{cx:0,cy:0,hwidth:0,hheight:0}}}])}(),ih=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.x,r=void 0===n?0:n,i=e.y,a=void 0===i?0:i,o=e.src,s=e.width,l=void 0===s?0:s,u=e.height,c=l,h=void 0===u?0:u;return o&&!(0,S.Z)(o)&&(c||(c=o.width,e.width=c),h||(h=o.height,e.height=h)),{cx:r+c/2,cy:a+h/2,hwidth:c/2,hheight:h/2}}}])}(),ah=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.globalRuntime=t}),[{key:"isReadyToMeasure",value:function(e,t){return e.text}},{key:"update",value:function(e,t){var n,r=e.text,i=e.textAlign,a=void 0===i?"start":i,o=e.lineWidth,s=void 0===o?1:o,l=e.textBaseline,u=void 0===l?"alphabetic":l,c=e.dx,h=void 0===c?0:c,d=e.dy,f=void 0===d?0:d,v=e.x,p=void 0===v?0:v,g=e.y,m=void 0===g?0:g;if(!this.isReadyToMeasure(e,t))return e.metrics={font:"",width:0,height:0,lines:[],lineWidths:[],lineHeight:0,maxLineWidth:0,fontProperties:{ascent:0,descent:0,fontSize:0},lineMetrics:[]},{hwidth:0,hheight:0,cx:0,cy:0};var y=((null==t||null===(n=t.ownerDocument)||void 0===n||null===(n=n.defaultView)||void 0===n?void 0:n.getConfig())||{}).offscreenCanvas,E=this.globalRuntime.textService.measureText(r,e,y);e.metrics=E;var _=E.width/2,T=E.height/2,S=p+_;"center"===a||"middle"===a?S+=s/2-_:"right"!==a&&"end"!==a||(S+=s-2*_);var R=m-T;return"middle"===u?R+=T:"top"===u||"hanging"===u?R+=2*T:"alphabetic"===u||"bottom"!==u&&"ideographic"!==u||(R+=0),h&&(S+=h),f&&(R+=f),{cx:S,cy:R,hwidth:_,hheight:T}}}])}(),oh=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){return{cx:0,cy:0,hwidth:0,hheight:0}}}])}(),sh=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.x,r=void 0===n?0:n,i=e.y,a=void 0===i?0:i,o=e.width,s=void 0===o?0:o,l=e.height,u=void 0===l?0:l;return{cx:r+s/2,cy:a+u/2,hwidth:s/2,hheight:u/2}}}])}();var lh=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.eventPhase=e.prototype.NONE,this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.defaultPrevented=!1,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new qo,this.page=new qo,this.canvas=new qo,this.viewport=new qo,this.composed=!1,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}),[{key:"name",get:function(){return this.type}},{key:"layerX",get:function(){return this.layer.x}},{key:"layerY",get:function(){return this.layer.y}},{key:"pageX",get:function(){return this.page.x}},{key:"pageY",get:function(){return this.page.y}},{key:"x",get:function(){return this.canvas.x}},{key:"y",get:function(){return this.canvas.y}},{key:"canvasX",get:function(){return this.canvas.x}},{key:"canvasY",get:function(){return this.canvas.y}},{key:"viewportX",get:function(){return this.viewport.x}},{key:"viewportY",get:function(){return this.viewport.y}},{key:"composedPath",value:function(){return!this.manager||this.path&&this.path[0]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}},{key:"propagationPath",get:function(){return this.composedPath()}},{key:"preventDefault",value:function(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}},{key:"stopImmediatePropagation",value:function(){this.propagationImmediatelyStopped=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"initEvent",value:function(){}},{key:"initUIEvent",value:function(){}},{key:"clone",value:function(){throw new Error(Qo)}}])}(),uh=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).client=new qo,e.movement=new qo,e.offset=new qo,e.global=new qo,e.screen=new qo,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clientX",get:function(){return this.client.x}},{key:"clientY",get:function(){return this.client.y}},{key:"movementX",get:function(){return this.movement.x}},{key:"movementY",get:function(){return this.movement.y}},{key:"offsetX",get:function(){return this.offset.x}},{key:"offsetY",get:function(){return this.offset.y}},{key:"globalX",get:function(){return this.global.x}},{key:"globalY",get:function(){return this.global.y}},{key:"screenX",get:function(){return this.screen.x}},{key:"screenY",get:function(){return this.screen.y}},{key:"getModifierState",value:function(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}},{key:"initMouseEvent",value:function(){throw new Error(Qo)}}])}(lh),ch=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).width=0,e.height=0,e.isPrimary=!1,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getCoalescedEvents",value:function(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}},{key:"getPredictedEvents",value:function(){throw new Error("getPredictedEvents is not supported!")}},{key:"clone",value:function(){return this.manager.clonePointerEvent(this)}}])}(uh),hh=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return this.manager.cloneWheelEvent(this)}}])}(uh),dh=function(e){function t(e,n){var r;return(0,o.Z)(this,t),(r=(0,s.Z)(this,t,[null])).type=e,r.detail=null==n?void 0:n.detail,n&&!("detail"in n)&&(r.detail=n),Object.assign(r,n),r}return(0,l.Z)(t,e),(0,a.Z)(t)}(lh),fh=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.emitter=new d.Z}),[{key:"on",value:function(e,t,n){return this.addEventListener(e,t,n),this}},{key:"addEventListener",value:function(e,t,n){var r=!1,i=!1;if((0,F.Z)(n))r=n;else if(n){var a=n.capture;r=void 0!==a&&a;var o=n.once;i=void 0!==o&&o}r&&(e+="capture"),t=(0,U.Z)(t)?t:t.handleEvent;var s=(0,U.Z)(t)?void 0:t;return i?this.emitter.once(e,t,s):this.emitter.on(e,t,s),this}},{key:"off",value:function(e,t,n){return e?this.removeEventListener(e,t,n):this.removeAllEventListeners(),this}},{key:"removeAllEventListeners",value:function(){var e;null===(e=this.emitter)||void 0===e||e.removeAllListeners()}},{key:"removeEventListener",value:function(e,t,n){var r;if(!this.emitter)return this;((0,F.Z)(n)?n:null==n?void 0:n.capture)&&(e+="capture"),t=(0,U.Z)(t)?t:null===(r=t)||void 0===r?void 0:r.handleEvent;var i=(0,U.Z)(t)?void 0:t;return this.emitter.off(e,t,i),this}},{key:"emit",value:function(e,t){this.dispatchEvent(new dh(e,t))}},{key:"dispatchEventToSelf",value:function(e){e.target||(e.target=this),e.currentTarget=this,this.emitter.emit(e.type,e)}},{key:"dispatchEvent",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;if(r)return this.dispatchEventToSelf(e),!0;if(this.document)t=this;else if(this.defaultView)t=this.defaultView;else{var i;t=null===(i=this.ownerDocument)||void 0===i?void 0:i.defaultView}if(t){if(e.manager=t.getEventService(),!e.manager)return!1;e.defaultPrevented=!1,e.path?e.path.length=0:e.page=[],n||(e.target=this),e.manager.dispatchEvent(e,e.type,n)}else this.dispatchEventToSelf(e);return!e.defaultPrevented}}])}(),vh=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).shadow=!1,e.ownerDocument=null,e.isConnected=!1,e.baseURI="",e.childNodes=[],e.nodeType=0,e.nodeName="",e.nodeValue=null,e.mutations=void 0,e.parentNode=null,e.destroyed=!1,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"textContent",get:function(){var e="";this.nodeName===Fo.TEXT&&(e+=this.style.text);var t,n=(0,se.Z)(this.childNodes);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.nodeName===Fo.TEXT?e+=r.nodeValue:e+=r.textContent}}catch(e){n.e(e)}finally{n.f()}return e},set:function(e){var t=this;this.childNodes.slice().forEach((function(e){t.removeChild(e)})),this.nodeName===Fo.TEXT&&(this.style.text="".concat(e))}},{key:"getRootNode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.parentNode?this.parentNode.getRootNode(e):e.composed&&this.host?this.host.getRootNode(e):this}},{key:"hasChildNodes",value:function(){return this.childNodes.length>0}},{key:"isDefaultNamespace",value:function(e){throw new Error(Qo)}},{key:"lookupNamespaceURI",value:function(e){throw new Error(Qo)}},{key:"lookupPrefix",value:function(e){throw new Error(Qo)}},{key:"normalize",value:function(){throw new Error(Qo)}},{key:"isEqualNode",value:function(e){return this===e}},{key:"isSameNode",value:function(e){return this.isEqualNode(e)}},{key:"parent",get:function(){return this.parentNode}},{key:"parentElement",get:function(){return null}},{key:"nextSibling",get:function(){return null}},{key:"previousSibling",get:function(){return null}},{key:"firstChild",get:function(){return this.childNodes.length>0?this.childNodes[0]:null}},{key:"lastChild",get:function(){return this.childNodes.length>0?this.childNodes[this.childNodes.length-1]:null}},{key:"compareDocumentPosition",value:function(e){if(e===this)return 0;for(var n=e,r=this,i=[n],a=[r];null!==(o=n.parentNode)&&void 0!==o?o:r.parentNode;){var o;n=n.parentNode?(i.push(n.parentNode),n.parentNode):n,r=r.parentNode?(a.push(r.parentNode),r.parentNode):r}if(n!==r)return t.DOCUMENT_POSITION_DISCONNECTED|t.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC|t.DOCUMENT_POSITION_PRECEDING;var s=i.length>a.length?i:a,l=s===i?a:i;if(s[s.length-l.length]===l[0])return s===i?t.DOCUMENT_POSITION_CONTAINED_BY|t.DOCUMENT_POSITION_FOLLOWING:t.DOCUMENT_POSITION_CONTAINS|t.DOCUMENT_POSITION_PRECEDING;for(var u=s.length-l.length,c=l.length-1;c>=0;c--){var h=l[c],d=s[u+c];if(d!==h){var f=h.parentNode.childNodes;return f.indexOf(h)<f.indexOf(d)?l===i?t.DOCUMENT_POSITION_PRECEDING:t.DOCUMENT_POSITION_FOLLOWING:s===i?t.DOCUMENT_POSITION_PRECEDING:t.DOCUMENT_POSITION_FOLLOWING}}return t.DOCUMENT_POSITION_FOLLOWING}},{key:"contain",value:function(e){return this.contains(e)}},{key:"contains",value:function(e){for(var t=e;t&&this!==t;)t=t.parentNode;return!!t}},{key:"getAncestor",value:function(e){for(var t=this;e>0&&t;)t=t.parentNode,e--;return t}},{key:"forEach",value:function(e){for(var t=[this];t.length>0;){var n=t.pop();if(!1===e(n))break;for(var r=n.childNodes.length-1;r>=0;r--)t.push(n.childNodes[r])}}}],[{key:"isNode",value:function(e){return!!e.childNodes}}])}(fh);vh.DOCUMENT_POSITION_DISCONNECTED=1,vh.DOCUMENT_POSITION_PRECEDING=2,vh.DOCUMENT_POSITION_FOLLOWING=4,vh.DOCUMENT_POSITION_CONTAINS=8,vh.DOCUMENT_POSITION_CONTAINED_BY=16,vh.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC=32;var ph=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"getOrCreateCanvas",value:function(e,t){if(this.canvas)return this.canvas;if(e||zh.offscreenCanvas)this.canvas=e||zh.offscreenCanvas,this.context=this.canvas.getContext("2d",(0,u.Z)({willReadFrequently:!0},t));else try{this.canvas=new window.OffscreenCanvas(0,0),this.context=this.canvas.getContext("2d",(0,u.Z)({willReadFrequently:!0},t)),this.context&&this.context.measureText||(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"))}catch(e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d",(0,u.Z)({willReadFrequently:!0},t))}return this.canvas.width=10,this.canvas.height=10,this.canvas}},{key:"getOrCreateContext",value:function(e,t){return this.context||this.getOrCreateCanvas(e,t),this.context}}],[{key:"createCanvas",value:function(){try{return new window.OffscreenCanvas(0,0)}catch(e){}try{return document.createElement("canvas")}catch(e){}return null}}])}(),gh=function(e){return e[e.CAMERA_CHANGED=0]="CAMERA_CHANGED",e[e.DISPLAY_OBJECT_CHANGED=1]="DISPLAY_OBJECT_CHANGED",e[e.NONE=2]="NONE",e}({}),mh=/\[\s*(.*)=(.*)\s*\]/,yh=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"selectOne",value:function(e,t){var n=this;if(e.startsWith("."))return t.find((function(t){return((null==t?void 0:t.classList)||[]).indexOf(n.getIdOrClassname(e))>-1}));if(e.startsWith("#"))return t.find((function(t){return t.id===n.getIdOrClassname(e)}));if(e.startsWith("[")){var r=this.getAttribute(e),i=r.name,a=r.value;return i?t.find((function(e){return t!==e&&("name"===i?e.name===a:n.attributeToString(e,i)===a)})):null}return t.find((function(n){return t!==n&&n.nodeName===e}))}},{key:"selectAll",value:function(e,t){var n=this;if(e.startsWith("."))return t.findAll((function(r){return t!==r&&((null==r?void 0:r.classList)||[]).indexOf(n.getIdOrClassname(e))>-1}));if(e.startsWith("#"))return t.findAll((function(r){return t!==r&&r.id===n.getIdOrClassname(e)}));if(e.startsWith("[")){var r=this.getAttribute(e),i=r.name,a=r.value;return i?t.findAll((function(e){return t!==e&&("name"===i?e.name===a:n.attributeToString(e,i)===a)})):[]}return t.findAll((function(n){return t!==n&&n.nodeName===e}))}},{key:"is",value:function(e,t){if(e.startsWith("."))return t.className===this.getIdOrClassname(e);if(e.startsWith("#"))return t.id===this.getIdOrClassname(e);if(e.startsWith("[")){var n=this.getAttribute(e),r=n.name,i=n.value;return"name"===r?t.name===i:this.attributeToString(t,r)===i}return t.nodeName===e}},{key:"getIdOrClassname",value:function(e){return e.substring(1)}},{key:"getAttribute",value:function(e){var t=e.match(mh),n="",r="";return t&&t.length>2&&(n=t[1].replace(/"/g,""),r=t[2].replace(/"/g,"")),{name:n,value:r}}},{key:"attributeToString",value:function(e,t){if(!e.getAttribute)return"";var n=e.getAttribute(t);return(0,T.Z)(n)?"":n.toString?n.toString():""}}])}(),Eh=function(e){return e.ATTR_MODIFIED="DOMAttrModified",e.INSERTED="DOMNodeInserted",e.MOUNTED="DOMNodeInsertedIntoDocument",e.REMOVED="removed",e.UNMOUNTED="DOMNodeRemovedFromDocument",e.REPARENT="reparent",e.DESTROY="destroy",e.BOUNDS_CHANGED="bounds-changed",e.CULLED="culled",e}({}),_h=function(e){function t(e,n,r,i,a,l,u,c){var h;return(0,o.Z)(this,t),(h=(0,s.Z)(this,t,[null])).relatedNode=n,h.prevValue=r,h.newValue=i,h.attrName=a,h.attrChange=l,h.prevParsedValue=u,h.newParsedValue=c,h.type=e,h}return(0,l.Z)(t,e),(0,a.Z)(t)}(lh);_h.ADDITION=2,_h.MODIFICATION=1,_h.REMOVAL=3;var Th=new _h(Eh.REPARENT,null,"","","",0,"",""),Sh=y.create(),Rh=f.create(),Ah=f.fromValues(1,1,1),xh=p.create(),kh=y.create(),Nh=f.create(),Mh=p.create(),Ch=m.create(),bh=f.create(),Ph=m.create(),Oh=f.create(),Ih=f.create(),wh=f.create(),Lh=p.create(),Dh=m.create(),Bh=m.create(),Fh=m.create(),Uh=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.displayObjectDependencyMap=new WeakMap,this.runtime=t}),[{key:"matches",value:function(e,t){return this.runtime.sceneGraphSelector.is(e,t)}},{key:"querySelector",value:function(e,t){return this.runtime.sceneGraphSelector.selectOne(e,t)}},{key:"querySelectorAll",value:function(e,t){return this.runtime.sceneGraphSelector.selectAll(e,t)}},{key:"attach",value:function(e,t,n){var r,i=!1;e.parentNode&&(i=e.parentNode!==t,this.detach(e));var a=e.nodeName===Fo.FRAGMENT,o=Ac(t);e.parentNode=t;var s=a?e.childNodes:[e];(0,E.Z)(n)?s.forEach((function(e){t.childNodes.splice(n,0,e),e.parentNode=t})):s.forEach((function(e){t.childNodes.push(e),e.parentNode=t}));var l=t.sortable;if((null!=l&&null!==(r=l.sorted)&&void 0!==r&&r.length||l.dirty||e.parsedStyle.zIndex)&&(-1===l.dirtyChildren.indexOf(e)&&l.dirtyChildren.push(e),l.dirty=!0,l.dirtyReason=Ss.ADDED),!o){if(a)this.dirtyFragment(e);else{var u=e.transformable;u&&this.dirtyWorldTransform(e,u)}if(i){var c,h=!0===(null===(c=t.ownerDocument)||void 0===c||null===(c=c.defaultView)||void 0===c||null===(c=c.getConfig())||void 0===c||null===(c=c.future)||void 0===c?void 0:c.experimentalCancelEventPropagation);e.dispatchEvent(Th,h,h)}}}},{key:"detach",value:function(e){var t,n;if(e.parentNode){var r=e.transformable,i=e.parentNode.sortable;(null!=i&&null!==(t=i.sorted)&&void 0!==t&&t.length||null!==(n=e.style)&&void 0!==n&&n.zIndex)&&(-1===i.dirtyChildren.indexOf(e)&&i.dirtyChildren.push(e),i.dirty=!0,i.dirtyReason=Ss.REMOVED);var a=e.parentNode.childNodes.indexOf(e);a>-1&&e.parentNode.childNodes.splice(a,1),r&&this.dirtyWorldTransform(e,r),e.parentNode=null}}},{key:"getLocalPosition",value:function(e){return e.transformable.localPosition}},{key:"getLocalRotation",value:function(e){return e.transformable.localRotation}},{key:"getLocalScale",value:function(e){return e.transformable.localScale}},{key:"getLocalSkew",value:function(e){return e.transformable.localSkew}},{key:"getLocalTransform",value:function(e){var t=e.transformable;return ks(t),t.localTransform}},{key:"setLocalPosition",value:function(e,t){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.transformable;Ih[0]=t[0],Ih[1]=t[1],Ih[2]=null!==(n=t[2])&&void 0!==n?n:0,f.equals(i.localPosition,Ih)||(f.copy(i.localPosition,Ih),r&&this.dirtyLocalTransform(e,i))}},{key:"translateLocal",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;f.equals(t,Rh)||(f.transformQuat(t,t,i.localRotation),f.add(i.localPosition,i.localPosition,t),this.dirtyLocalTransform(e,i))}},{key:"setLocalRotation",value:function(e,t,n,r,i){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];"number"==typeof t&&(t=m.set(Ch,t,n,r,i));var o=e.transformable;m.copy(o.localRotation,t),a&&this.dirtyLocalTransform(e,o)}},{key:"rotateLocal",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;m.fromEuler(Bh,t[0],t[1],t[2]),m.mul(i.localRotation,i.localRotation,Bh),this.dirtyLocalTransform(e,i)}},{key:"setLocalScale",value:function(e,t){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.transformable;f.set(Nh,t[0],t[1],null!==(n=t[2])&&void 0!==n?n:i.localScale[2]),f.equals(Nh,i.localScale)||(f.copy(i.localScale,Nh),r&&this.dirtyLocalTransform(e,i))}},{key:"scaleLocal",value:function(e,t){var n,r=e.transformable;f.multiply(r.localScale,r.localScale,f.set(Nh,t[0],t[1],null!==(n=t[2])&&void 0!==n?n:1)),this.dirtyLocalTransform(e,r)}},{key:"setLocalSkew",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];"number"==typeof t&&(t=y.set(kh,t,n));var i=e.transformable;y.copy(i.localSkew,t),r&&this.dirtyLocalTransform(e,i)}},{key:"setLocalEulerAngles",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];"number"==typeof t&&(t=f.fromValues(t,n,r));var a=e.transformable;m.fromEuler(a.localRotation,t[0],t[1],t[2]),i&&this.dirtyLocalTransform(e,a)}},{key:"setLocalTransform",value:function(e,t){var n=p.getTranslation(bh,t),r=p.getRotation(Ph,t),i=p.getScaling(Oh,t);this.setLocalScale(e,i,!1),this.setLocalPosition(e,n,!1),this.setLocalRotation(e,r,void 0,void 0,void 0,!1),this.dirtyLocalTransform(e,e.transformable)}},{key:"resetLocalTransform",value:function(e){this.setLocalScale(e,Ah,!1),this.setLocalPosition(e,Rh,!1),this.setLocalEulerAngles(e,Rh,void 0,void 0,!1),this.setLocalSkew(e,Sh,void 0,!1),this.dirtyLocalTransform(e,e.transformable)}},{key:"getPosition",value:function(e){var t=e.transformable;return p.getTranslation(t.position,this.getWorldTransform(e,t))}},{key:"getRotation",value:function(e){var t=e.transformable;return p.getRotation(t.rotation,this.getWorldTransform(e,t))}},{key:"getScale",value:function(e){var t=e.transformable;return p.getScaling(t.scaling,this.getWorldTransform(e,t))}},{key:"getOrigin",value:function(e){return e.getGeometryBounds(),e.transformable.origin}},{key:"getWorldTransform",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transformable;return t.localDirtyFlag||t.dirtyFlag?(e.parentNode&&e.parentNode.transformable&&this.getWorldTransform(e.parentNode),this.internalUpdateTransform(e),t.worldTransform):t.worldTransform}},{key:"setPosition",value:function(e,t){var n,r=e.transformable;if(wh[0]=t[0],wh[1]=t[1],wh[2]=null!==(n=t[2])&&void 0!==n?n:0,!f.equals(this.getPosition(e),wh)){if(f.copy(r.position,wh),null!==e.parentNode&&e.parentNode.transformable){var i=e.parentNode.transformable;p.copy(Lh,i.worldTransform),p.invert(Lh,Lh),f.transformMat4(r.localPosition,wh,Lh)}else f.copy(r.localPosition,wh);this.dirtyLocalTransform(e,r)}}},{key:"translate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.set(Nh,t,n,r)),f.equals(t,Rh)||(f.add(Nh,this.getPosition(e),t),this.setPosition(e,Nh))}},{key:"setRotation",value:function(e,t,n,r,i){var a=e.transformable;if("number"==typeof t&&(t=m.fromValues(t,n,r,i)),null!==e.parentNode&&e.parentNode.transformable){var o=this.getRotation(e.parentNode);m.copy(Ch,o),m.invert(Ch,Ch),m.multiply(a.localRotation,Ch,t),m.normalize(a.localRotation,a.localRotation),this.dirtyLocalTransform(e,a)}else this.setLocalRotation(e,t)}},{key:"rotate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;if(null!==e.parentNode&&e.parentNode.transformable){var a=Ch;m.fromEuler(a,t[0],t[1],t[2]);var o=this.getRotation(e),s=this.getRotation(e.parentNode);m.copy(Fh,s),m.invert(Fh,Fh),m.multiply(a,Fh,a),m.multiply(i.localRotation,a,o),m.normalize(i.localRotation,i.localRotation),this.dirtyLocalTransform(e,i)}else this.rotateLocal(e,t)}},{key:"setOrigin",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=[t,n,r]);var i=e.transformable;if(t[0]!==i.origin[0]||t[1]!==i.origin[1]||t[2]!==i.origin[2]){var a=i.origin;a[0]=t[0],a[1]=t[1],a[2]=t[2]||0,this.dirtyLocalTransform(e,i)}}},{key:"setEulerAngles",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;if(null!==e.parentNode&&e.parentNode.transformable){m.fromEuler(i.localRotation,t[0],t[1],t[2]);var a=this.getRotation(e.parentNode);m.copy(Dh,m.invert(Ch,a)),m.mul(i.localRotation,i.localRotation,Dh),this.dirtyLocalTransform(e,i)}else this.setLocalEulerAngles(e,t)}},{key:"getGeometryBounds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e,r=n.geometry;r.dirty&&zh.styleValueRegistry.updateGeometry(e);var i=t?r.renderBounds:r.contentBounds||null;return i||new Yo}},{key:"getTransformedGeometryBounds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.getGeometryBounds(e,t);if(!Yo.isEmpty(r)){var i=n||new Yo;return i.setFromTransformedAABB(r,this.getWorldTransform(e)),i}return null}},{key:"getBounds",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e,i=r.renderable;if(!i.boundsDirty&&!n&&i.bounds)return i.bounds;if(!i.renderBoundsDirty&&n&&i.renderBounds)return i.renderBounds;var a=n?i.renderBounds:i.bounds,o=this.getTransformedGeometryBounds(e,n,a),s=e.childNodes;if(s.forEach((function(e){var r=t.getBounds(e,n);r&&(o?o.add(r):(o=a||new Yo).update(r.center,r.halfExtents))})),o||(o=new Yo),n){var l=Tc(e);if(l){var u=l.parsedStyle.clipPath.getBounds(n);o?u&&(o=u.intersection(o)):o.update(u.center,u.halfExtents)}}return n?(i.renderBounds=o,i.renderBoundsDirty=!1):(i.bounds=o,i.boundsDirty=!1),o}},{key:"getLocalBounds",value:function(e){if(e.parentNode){var t=xh;e.parentNode.transformable&&(t=p.invert(Mh,this.getWorldTransform(e.parentNode)));var n=this.getBounds(e);if(!Yo.isEmpty(n)){var r=new Yo;return r.setFromTransformedAABB(n,t),r}}return this.getBounds(e)}},{key:"getBoundingClientRect",value:function(e){var t,n,r=this.getGeometryBounds(e);Yo.isEmpty(r)||(n=new Yo).setFromTransformedAABB(r,this.getWorldTransform(e));var i=null===(t=e.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t?void 0:t.getContextService().getBoundingClientRect();if(n){var a=n.getMin(),o=(0,h.Z)(a,2),s=o[0],l=o[1],u=n.getMax(),c=(0,h.Z)(u,2),d=c[0],f=c[1];return new $o(s+((null==i?void 0:i.left)||0),l+((null==i?void 0:i.top)||0),d-s,f-l)}return new $o((null==i?void 0:i.left)||0,(null==i?void 0:i.top)||0,0,0)}},{key:"internalUpdateTransform",value:function(e){var t,n=null===(t=e.parentNode)||void 0===t?void 0:t.transformable;ks(e.transformable),function(e,t){e.dirtyFlag&&(t?p.multiply(e.worldTransform,t.worldTransform,e.localTransform):p.copy(e.worldTransform,e.localTransform),e.dirtyFlag=!1)}(e.transformable,n)}},{key:"internalUpdateElement",value:function(e,t){var n,r,i,a,o,s,l=!0===(null===(n=e.ownerDocument)||void 0===n||null===(n=n.defaultView)||void 0===n||null===(n=n.getConfig())||void 0===n||null===(n=n.future)||void 0===n?void 0:n.experimentalAttributeUpdateOptimization),u=t[t.length-1],c=(null==u?void 0:u.transformDirty)||(null===(r=e.transformable)||void 0===r?void 0:r.localDirtyFlag);e.transformable&&((o=e.transformable).dirtyFlag||(o.dirtyFlag=c));(this.internalUpdateTransform(e),c)&&(null===(s=e.dirty)||void 0===s||s.call(e,!0,!0));var h=(null===(i=e.renderable)||void 0===i?void 0:i.boundsDirty)||(null===(a=e.renderable)||void 0===a?void 0:a.renderBoundsDirty);if((c||h)&&!1===(null==u?void 0:u.shapeUpdated)&&l)for(var d=t.length-1;d>=0;){var f,v,p=t[d];if(p.shapeUpdated)break;null===(f=(v=p.node).dirty)||void 0===f||f.call(v,!0,!0),p.shapeUpdated=!0,d-=1}return c}},{key:"syncHierarchy",value:function(e){for(var t,n,r=[e],i=e.parentNode?[{node:e.parentNode,transformDirty:(null===(t=e.parentNode.transformable)||void 0===t?void 0:t.localDirtyFlag)||(null===(n=e.parentNode.transformable)||void 0===n?void 0:n.dirtyFlag),shapeUpdated:!1}]:[];r.length>0;){for(var a=r.pop(),o=i[i.length-1];i.length>0&&a.parentNode!==o.node;)o=i.pop();var s=this.internalUpdateElement(a,i);if(a.childNodes.length>0){for(var l=a.childNodes.length-1;l>=0;l--)r.push(a.childNodes[l]);i.push({node:a,transformDirty:s,shapeUpdated:!1})}}}},{key:"dirtyLocalTransform",value:function(e,t){Ac(e)||t.localDirtyFlag||(t.localDirtyFlag=!0,t.dirtyFlag||this.dirtyWorldTransform(e,t))}},{key:"dirtyWorldTransform",value:function(e,t){this.dirtyWorldInternal(e,t),this.dirtyToRoot(e,!0)}},{key:"dirtyWorldInternal",value:function(e,t){var n,r=this,i=!0===(null===(n=e.ownerDocument)||void 0===n||null===(n=n.defaultView)||void 0===n||null===(n=n.getConfig())||void 0===n||null===(n=n.future)||void 0===n?void 0:n.experimentalAttributeUpdateOptimization);t.dirtyFlag||(t.dirtyFlag=!0,e.dirty(!0,!0),i||e.childNodes.forEach((function(e){var t=e.transformable;r.dirtyWorldInternal(e,t)})))}},{key:"dirtyToRoot",value:function(e){for(var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e,i=!0===(null===(t=e.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t||null===(t=t.getConfig())||void 0===t||null===(t=t.future)||void 0===t?void 0:t.experimentalAttributeUpdateOptimization);r;){var a,o;if(null===(a=(o=r).dirty)||void 0===a||a.call(o,!0,!0),i)break;r=r.parentNode}n&&e.forEach((function(e){var t;null===(t=e.dirty)||void 0===t||t.call(e,!0,!0)})),this.informDependentDisplayObjects(e);var s=e.mutations||[],l=s.find((function(e){return"attributes"===e.type&&e._boundsChangeData}));l?l._boundsChangeData={affectChildren:l._boundsChangeData.affectChildren||n}:(l={type:"attributes",target:e,_boundsChangeData:{affectChildren:n}},s.push(l)),e.mutations=s}},{key:"dirtyFragment",value:function(e){var t,n,r=e.transformable;r&&(r.dirtyFlag=!0,r.localDirtyFlag=!0),null===(t=(n=e).dirty)||void 0===t||t.call(n,!0,!0);for(var i=e.childNodes.length,a=0;a<i;a++)this.dirtyFragment(e.childNodes[a])}},{key:"notifyMutationObservers",value:function(e){var t=new Set;if(e.getRoot().forEach((function(e){(e.mutations||[]).forEach((function(n){"attributes"===n.type&&n._boundsChangeData&&(n._boundsChangeData.affectChildren?e.forEach((function(e){var r=(0,u.Z)({},n);r.target=e,t.add(r)})):t.add(n))})),e.mutations=void 0})),t.size>0){var n=new dh(Eh.BOUNDS_CHANGED,{detail:Array.from(t)});e.dispatchEvent(n,!0,!0)}}},{key:"updateDisplayObjectDependency",value:function(e,t,n,r){if(t&&t!==n){var i=this.displayObjectDependencyMap.get(t);if(i&&i[e]){var a=i[e].indexOf(r);i[e].splice(a,1)}}if(n){var o=this.displayObjectDependencyMap.get(n);o||(this.displayObjectDependencyMap.set(n,{}),o=this.displayObjectDependencyMap.get(n)),o[e]||(o[e]=[]),o[e].push(r)}}},{key:"informDependentDisplayObjects",value:function(e){var t,n=this,r=this.displayObjectDependencyMap.get(e);if(r){var i=null===(t=e.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t||null===(t=t.getConfig())||void 0===t||null===(t=t.future)||void 0===t?void 0:t.experimentalCancelEventPropagation;Object.keys(r).forEach((function(e){r[e].forEach((function(t){n.dirtyToRoot(t,!0),t.dispatchEvent(new _h(Eh.ATTR_MODIFIED,t,n,n,e,_h.MODIFICATION,n,n),i,i),t.isCustomElement&&t.isConnected&&t.attributeChangedCallback&&t.attributeChangedCallback(e,n,n)}))}))}}}])}(),Zh=function(){return(0,a.Z)((function e(t){if((0,o.Z)(this,e),t<=0)throw new Error("LRU capacity must be a positive number.");this.capacity=t,this.cache=new Map}),[{key:"get",value:function(e){if(this.cache.has(e)){var t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),t}}},{key:"put",value:function(e,t){if(this.cache.has(e)&&this.cache.delete(e),this.cache.set(e,t),this.cache.size>this.capacity){var n=this.cache.keys().next().value;this.cache.delete(n)}}},{key:"len",value:function(){return this.cache.size}},{key:"clear",value:function(){this.cache.clear()}}])}(),Gh={MetricsString:"|q",BaselineSymbol:"M",BaselineMultiplier:1.4,HeightMultiplier:2,Newlines:[10,13],BreakingSpaces:[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288]},Vh=/[a-zA-Z0-9\u00C0-\u00D6\u00D8-\u00f6\u00f8-\u00ff!"#$%&'()*+,-./:;]/,Wh=new RegExp("".concat(/[!%),.:;?\]}'""]/.source,"|").concat(/[!),.:;?\]}'""]/.source,"|").concat(/[)\]'"?!:;,.]/.source,"|").concat(/[!%),.:;?\]}'"]/.source)),Hh=new RegExp("".concat(/[$('"]/.source,"|").concat(/[([{'"]/.source,"|").concat(/[(['"...]/.source,"|").concat(/[$([{'"#]/.source)),Xh=function(){return(0,a.Z)((function e(t){var n=this;(0,o.Z)(this,e),this.fontMetricsCache={},this.shouldBreakByKinsokuShorui=function(e,t){return!n.isBreakingSpace(t)&&!(!e||!Hh.exec(t)&&!Wh.exec(e))},this.trimByKinsokuShorui=function(e){var t=(0,c.Z)(e),n=t[t.length-2];if(!n)return e;var r=n[n.length-1];return t[t.length-2]=n.slice(0,-1),t[t.length-1]=r+t[t.length-1],t},this.runtime=t,this.charWidthCache=new Zh(100)}),[{key:"measureFont",value:function(e,t){if(this.fontMetricsCache[e])return this.fontMetricsCache[e];var n={ascent:0,descent:0,fontSize:0},r=this.runtime.offscreenCanvasCreator.getOrCreateCanvas(t),i=this.runtime.offscreenCanvasCreator.getOrCreateContext(t,{willReadFrequently:!0});i.font=e;var a=Gh.MetricsString+Gh.BaselineSymbol,o=Math.ceil(i.measureText(a).width),s=Math.ceil(i.measureText(Gh.BaselineSymbol).width),l=Gh.HeightMultiplier*s;s=s*Gh.BaselineMultiplier|0,r.width=o,r.height=l,i.fillStyle="#f00",i.fillRect(0,0,o,l),i.font=e,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(a,0,s);var u=i.getImageData(0,0,o||1,l||1).data,c=u.length,h=4*o,d=0,f=0,v=!1;for(d=0;d<s;++d){for(var p=0;p<h;p+=4)if(255!==u[f+p]){v=!0;break}if(v)break;f+=h}for(n.ascent=s-d,f=c-h,v=!1,d=l;d>s;--d){for(var g=0;g<h;g+=4)if(255!==u[f+g]){v=!0;break}if(v)break;f-=h}return n.descent=d-s,n.fontSize=n.ascent+n.descent,this.fontMetricsCache[e]=n,n}},{key:"measureText",value:function(e,t,n){var r=t.fontSize,i=void 0===r?16:r,a=t.wordWrap,o=void 0!==a&&a,s=t.lineHeight,l=t.lineWidth,u=void 0===l?1:l,c=t.textBaseline,h=void 0===c?"alphabetic":c,d=t.textAlign,f=void 0===d?"start":d,v=t.letterSpacing,p=void 0===v?0:v,g=t.textPath;t.textPathSide,t.textPathStartOffset;var m=t.leading,y=void 0===m?0:m,E=Zc(t),_=this.measureFont(E,n);0===_.fontSize&&(_.fontSize=i,_.ascent=i);var T=this.runtime.offscreenCanvasCreator.getOrCreateContext(n);T.font=E,t.isOverflowing=!1;var S=(o?this.wordWrap(e,t,n):e).split(/(?:\r\n|\r|\n)/),R=new Array(S.length),A=0;if(!g){for(var x=0;x<S.length;x++){var k=T.measureText(S[x]).width+(S[x].length-1)*p;R[x]=k,A=Math.max(A,k)}var N=A+u,M=s||_.fontSize+u,C=Math.max(M,_.fontSize+u)+(S.length-1)*(M+y),b=0;return"middle"===h?b=-C/2:"bottom"===h||"alphabetic"===h||"ideographic"===h?b=-C:"top"!==h&&"hanging"!==h||(b=0),{font:E,width:N,height:C,lines:S,lineWidths:R,lineHeight:M+=y,maxLineWidth:A,fontProperties:_,lineMetrics:R.map((function(e,t){var n=0;return"center"===f||"middle"===f?n-=e/2:"right"!==f&&"end"!==f||(n-=e),new $o(n-u/2,b+t*M,e+u,M)}))}}g.getTotalLength();for(var P=0;P<S.length;P++)T.measureText(S[P]).width,S[P].length}},{key:"wordWrap",value:function(e,t,n){var r=this,i=Array.from(e);if(0===i.length)return"";var a=this,o=t.wordWrapWidth,s=void 0===o?0:o,l=t.letterSpacing,u=void 0===l?0:l,c=t.maxLines,h=void 0===c?1/0:c,d=t.textOverflow,f=this.runtime.offscreenCanvasCreator.getOrCreateContext(n),v=s+u,p="";"ellipsis"===d?p="...":d&&"clip"!==d&&(p=d);var g=[""],m=0,y=0,E=-1,_=Zc(t),T=this.charWidthCache.get(_);T||(T=new Zh(500),this.charWidthCache.put(_,T));var S=function(e){return r.getFromCache(e,u,T,f)},R=S(p);function A(e,t,n,r){for(;S(e)<r&&t<i.length-1&&!a.isNewline(i[t+1]);)e+=i[t+=1];for(;S(e)>r&&t>=n;)t-=1,e=e.slice(0,-1);return{lineTxt:e,txtLastCharIndex:t}}function x(e,t){if(!(R<=0||R>v))if(g[e]){var n=A(g[e],t,E+1,v-R);g[e]=n.lineTxt+p}else g[e]=p}for(var k=0;k<i.length;k++){var N=i[k],M=i[k-1],C=i[k+1],b=S(N);if(this.isNewline(N)){if(m+1>=h){k<i.length-1&&x(m,k-1),t.isOverflowing=!0;break}E=k-1,y=0,g[m+=1]=""}else{if(b>v){x(m,k-1),t.isOverflowing=!0;break}if(y>0&&y+b>v){var P=A(g[m],k-1,E+1,v);if(P.txtLastCharIndex!==k-1){if(g[m]=P.lineTxt,P.txtLastCharIndex===i.length-1)break;k=P.txtLastCharIndex+1,N=i[k],M=i[k-1],C=i[k+1],b=S(N)}if(m+1>=h){x(m,k-1),t.isOverflowing=!0;break}if(E=k-1,y=0,g[m+=1]="",this.isBreakingSpace(N))continue;this.canBreakInLastChar(N)||(g=this.trimToBreakable(g),y=this.sumTextWidthByCache(g[m]||"",S)),this.shouldBreakByKinsokuShorui(N,C)&&(g=this.trimByKinsokuShorui(g),y+=S(M||""))}y+=b,g[m]+=N}}return g.join("\n")}},{key:"isBreakingSpace",value:function(e){return"string"==typeof e&&Gh.BreakingSpaces.indexOf(e.charCodeAt(0))>=0}},{key:"isNewline",value:function(e){return"string"==typeof e&&Gh.Newlines.indexOf(e.charCodeAt(0))>=0}},{key:"trimToBreakable",value:function(e){var t=(0,c.Z)(e),n=t[t.length-2],r=this.findBreakableIndex(n);if(-1===r||!n)return t;var i=n.slice(r,r+1),a=r+1,o=r+(this.isBreakingSpace(i)?0:1);return t[t.length-1]+=n.slice(a,n.length),t[t.length-2]=n.slice(0,o),t}},{key:"canBreakInLastChar",value:function(e){return!e||!Vh.test(e)}},{key:"sumTextWidthByCache",value:function(e,t){return e.split("").reduce((function(e,n){return e+t(n)}),0)}},{key:"findBreakableIndex",value:function(e){for(var t=e.length-1;t>=0;t--)if(!Vh.test(e[t]))return t;return-1}},{key:"getFromCache",value:function(e,t,n,r){var i=n.get(e);if("number"!=typeof i){var a=e.length*t;i=r.measureText(e).width+a,n.put(e,i)}return i}},{key:"clearCache",value:function(){this.fontMetricsCache={},this.charWidthCache.clear()}}])}(),zh={},Yh=function(e){var t=new ih,n=new rh;return e={},(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(e,Fo.FRAGMENT,null),Fo.CIRCLE,new Jc),Fo.ELLIPSE,new eh),Fo.RECT,t),Fo.IMAGE,t),Fo.GROUP,new oh),Fo.LINE,new th),Fo.TEXT,new ah(zh)),Fo.POLYLINE,n),Fo.POLYGON,n),(0,V.Z)((0,V.Z)((0,V.Z)(e,Fo.PATH,new nh),Fo.HTML,new sh),Fo.MESH,null)}(),jh=function(e){var t=new oc,n=new uc;return e={},(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(e,Ms.PERCENTAGE,null),Ms.NUMBER,new fc),Ms.ANGLE,new ic),Ms.DEFINED_PATH,new ac),Ms.PAINT,t),Ms.COLOR,t),Ms.FILTER,new sc),Ms.LENGTH,n),Ms.LENGTH_PERCENTAGE,n),Ms.LENGTH_PERCENTAGE_12,new cc),(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(e,Ms.LENGTH_PERCENTAGE_14,new hc),Ms.COORDINATE,new uc),Ms.OFFSET_DISTANCE,new vc),Ms.OPACITY_VALUE,new pc),Ms.PATH,new gc),Ms.LIST_OF_POINTS,new mc),Ms.SHADOW_BLUR,new yc),Ms.TEXT,new Ec),Ms.TEXT_TRANSFORM,new _c),Ms.TRANSFORM,new qc),(0,V.Z)((0,V.Z)((0,V.Z)(e,Ms.TRANSFORM_ORIGIN,new $c),Ms.Z_INDEX,new Qc),Ms.MARKER,new dc)}();zh.CameraContribution=_s,zh.AnimationTimeline=null,zh.EasingFunction=null,zh.offscreenCanvasCreator=new ph,zh.sceneGraphSelector=new yh,zh.sceneGraphService=new Uh(zh),zh.textService=new Xh(zh),zh.geometryUpdaterFactory=Yh,zh.CSSPropertySyntaxFactory=jh,zh.styleValueRegistry=new tc(zh),zh.layoutRegistry=null,zh.globalThis="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},zh.enableStyleSyntax=!0,zh.enableSizeAttenuation=!1;var Kh=0;var qh=new _h(Eh.INSERTED,null,"","","",0,"",""),$h=new _h(Eh.REMOVED,null,"","","",0,"",""),Qh=new dh(Eh.DESTROY),Jh=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).entity=Kh++,e.transformable={dirtyFlag:!1,localDirtyFlag:!1,localPosition:[0,0,0],localRotation:[0,0,0,1],localScale:[1,1,1],localTransform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],localSkew:[0,0],position:[0,0,0],rotation:[0,0,0,1],scaling:[1,1,1],worldTransform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],origin:[0,0,0]},e.renderable={bounds:void 0,boundsDirty:!0,renderBounds:void 0,renderBoundsDirty:!0,dirtyRenderBounds:void 0,dirty:!1},e.geometry={contentBounds:void 0,renderBounds:void 0,dirty:!0},e.cullable={strategy:Ts.Standard,visibilityPlaneMask:-1,visible:!0,enable:!0},e.sortable={dirty:!1,sorted:void 0,renderOrder:0,dirtyChildren:[],dirtyReason:void 0},e.namespaceURI="g",e.scrollLeft=0,e.scrollTop=0,e.clientTop=0,e.clientLeft=0,e.style={},e.computedStyle={},e.parsedStyle={},e.attributes={},e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"dirty",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;this.renderable.dirty=e,void 0!==t&&(this.renderable.boundsDirty=t,this.renderable.renderBoundsDirty=t,this.geometry.dirty=t)}},{key:"className",get:function(){return this.getAttribute("class")||""},set:function(e){this.setAttribute("class",e)}},{key:"classList",get:function(){return this.className.split(" ").filter((function(e){return""!==e}))}},{key:"tagName",get:function(){return this.nodeName}},{key:"children",get:function(){return this.childNodes}},{key:"childElementCount",get:function(){return this.childNodes.length}},{key:"firstElementChild",get:function(){return this.firstChild}},{key:"lastElementChild",get:function(){return this.lastChild}},{key:"parentElement",get:function(){return this.parentNode}},{key:"nextSibling",get:function(){if(this.parentNode){var e=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[e+1]||null}return null}},{key:"previousSibling",get:function(){if(this.parentNode){var e=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[e-1]||null}return null}},{key:"cloneNode",value:function(e){throw new Error(Qo)}},{key:"appendChild",value:function(e,t){var n;if(e.destroyed)throw new Error("Cannot append a destroyed element.");return zh.sceneGraphService.attach(e,this,t),null!==(n=this.ownerDocument)&&void 0!==n&&n.defaultView&&(Ac(this)||e.nodeName!==Fo.FRAGMENT?this.ownerDocument.defaultView.mountChildren(e):this.ownerDocument.defaultView.mountFragment(e)),this.isMutationObserved&&(qh.relatedNode=this,e.dispatchEvent(qh)),e}},{key:"insertBefore",value:function(e,t){if(t){e.parentElement&&e.parentElement.removeChild(e);var n=this.childNodes.indexOf(t);-1===n?this.appendChild(e):this.appendChild(e,n)}else this.appendChild(e);return e}},{key:"replaceChild",value:function(e,t){var n=this.childNodes.indexOf(t);return this.removeChild(t),this.appendChild(e,n),t}},{key:"removeChild",value:function(e){var t,n,r=!0===(null===(t=this.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t||null===(t=t.getConfig().future)||void 0===t?void 0:t.experimentalCancelEventPropagation);return $h.relatedNode=this,e.dispatchEvent($h,r,r),null!==(n=e.ownerDocument)&&void 0!==n&&n.defaultView&&e.ownerDocument.defaultView.unmountChildren(e),zh.sceneGraphService.detach(e),e}},{key:"removeChildren",value:function(){for(var e=this.childNodes.length-1;e>=0;e--){var t=this.childNodes[e];this.removeChild(t)}}},{key:"destroyChildren",value:function(){for(var e=this.childNodes.length-1;e>=0;e--){var t=this.childNodes[e];t.childNodes.length>0&&t.destroyChildren(),t.destroy()}}},{key:"matches",value:function(e){return zh.sceneGraphService.matches(e,this)}},{key:"getElementById",value:function(e){return zh.sceneGraphService.querySelector("#".concat(e),this)}},{key:"getElementsByName",value:function(e){return zh.sceneGraphService.querySelectorAll('[name="'.concat(e,'"]'),this)}},{key:"getElementsByClassName",value:function(e){return zh.sceneGraphService.querySelectorAll(".".concat(e),this)}},{key:"getElementsByTagName",value:function(e){return zh.sceneGraphService.querySelectorAll(e,this)}},{key:"querySelector",value:function(e){return zh.sceneGraphService.querySelector(e,this)}},{key:"querySelectorAll",value:function(e){return zh.sceneGraphService.querySelectorAll(e,this)}},{key:"closest",value:function(e){var t=this;do{if(zh.sceneGraphService.matches(e,t))return t;t=t.parentElement}while(null!==t);return null}},{key:"find",value:function(e){var t=this,n=null;return this.forEach((function(r){return r===t||!e(r)||(n=r,!1)})),n}},{key:"findAll",value:function(e){var t=this,n=[];return this.forEach((function(r){r!==t&&e(r)&&n.push(r)})),n}},{key:"after",value:function(){var e=this;if(this.parentNode){for(var t=this.parentNode.childNodes.indexOf(this),n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];r.forEach((function(n,r){var i;return null===(i=e.parentNode)||void 0===i?void 0:i.appendChild(n,t+r+1)}))}}},{key:"before",value:function(){if(this.parentNode){for(var e,t=this.parentNode.childNodes.indexOf(this),n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var a=r[0],o=(0,H.Z)(r).slice(1);this.parentNode.appendChild(a,t),(e=a).after.apply(e,(0,c.Z)(o))}}},{key:"replaceWith",value:function(){this.after.apply(this,arguments),this.remove()}},{key:"append",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t){return e.appendChild(t)}))}},{key:"prepend",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t,n){return e.appendChild(t,n)}))}},{key:"replaceChildren",value:function(){for(;this.childNodes.length&&this.firstChild;)this.removeChild(this.firstChild);this.append.apply(this,arguments)}},{key:"remove",value:function(){return this.parentNode?this.parentNode.removeChild(this):this}},{key:"destroy",value:function(){var e,t=!0===(null===(e=this.ownerDocument)||void 0===e||null===(e=e.defaultView)||void 0===e||null===(e=e.getConfig().future)||void 0===e?void 0:e.experimentalCancelEventPropagation);this.destroyChildren(),this.dispatchEvent(Qh,t,t),this.remove(),this.emitter.removeAllListeners(),this.destroyed=!0}},{key:"getGeometryBounds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return zh.sceneGraphService.getGeometryBounds(this,e)}},{key:"getTransformedGeometryBounds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return zh.sceneGraphService.getTransformedGeometryBounds(this,e)}},{key:"getBounds",value:function(){return zh.sceneGraphService.getBounds(this)}},{key:"getRenderBounds",value:function(){return zh.sceneGraphService.getBounds(this,!0)}},{key:"getLocalBounds",value:function(){return zh.sceneGraphService.getLocalBounds(this)}},{key:"getBoundingClientRect",value:function(){return zh.sceneGraphService.getBoundingClientRect(this)}},{key:"getClientRects",value:function(){return[this.getBoundingClientRect()]}},{key:"computedStyleMap",value:function(){return new Map(Object.entries(this.computedStyle))}},{key:"getAttributeNames",value:function(){return Object.keys(this.attributes)}},{key:"getAttribute",value:function(e){if("symbol"!==i()(e)){var t=this.attributes[e];return t}}},{key:"hasAttribute",value:function(e){return this.getAttributeNames().includes(e)}},{key:"hasAttributes",value:function(){return!!this.getAttributeNames().length}},{key:"removeAttribute",value:function(e){this.setAttribute(e,null),delete this.attributes[e]}},{key:"setAttribute",value:function(e,t){this.attributes[e]=t}},{key:"getAttributeNS",value:function(e,t){throw new Error(Qo)}},{key:"getAttributeNode",value:function(e){throw new Error(Qo)}},{key:"getAttributeNodeNS",value:function(e,t){throw new Error(Qo)}},{key:"hasAttributeNS",value:function(e,t){throw new Error(Qo)}},{key:"removeAttributeNS",value:function(e,t){throw new Error(Qo)}},{key:"removeAttributeNode",value:function(e){throw new Error(Qo)}},{key:"setAttributeNS",value:function(e,t,n){throw new Error(Qo)}},{key:"setAttributeNode",value:function(e){throw new Error(Qo)}},{key:"setAttributeNodeNS",value:function(e){throw new Error(Qo)}},{key:"toggleAttribute",value:function(e,t){throw new Error(Qo)}}])}(vh);function ed(e){return!(null==e||!e.nodeName)}var td=zh.globalThis.Proxy?zh.globalThis.Proxy:function(){},nd=new _h(Eh.ATTR_MODIFIED,null,null,null,null,_h.MODIFICATION,null,null),rd=f.create(),id=m.create(),ad=function(e){function t(e){var n;return(0,o.Z)(this,t),(n=(0,s.Z)(this,t)).isCustomElement=!1,n.isMutationObserved=!1,n.activeAnimations=[],n.config=e,n.id=e.id||"",n.name=e.name||"",(e.className||e.class)&&(n.className=e.className||e.class),n.nodeName=e.type||Fo.GROUP,e.initialParsedStyle&&Object.assign(n.parsedStyle,e.initialParsedStyle),n.initAttributes(e.style),zh.enableStyleSyntax&&(n.style=new td({setProperty:function(e,t){n.setAttribute(e,t)},getPropertyValue:function(e){return n.getAttribute(e)},removeProperty:function(e){n.removeAttribute(e)},item:function(){return""}},{get:function(e,t){return void 0!==e[t]?e[t]:n.getAttribute(t)},set:function(e,t,r){return n.setAttribute(t,r),!0}})),n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"destroy",value:function(){(0,W.Z)(t,"destroy",this,3)([]),this.getAnimations().forEach((function(e){e.cancel()}))}},{key:"cloneNode",value:function(e,t){var n=(0,u.Z)({},this.attributes);for(var r in n){var i=n[r];ed(i)&&"clipPath"!==r&&"offsetPath"!==r&&"textPath"!==r&&(n[r]=i.cloneNode(e)),t&&(n[r]=t(r,i))}var a=new this.constructor((0,u.Z)((0,u.Z)({},this.config),{},{style:n}));return a.setLocalTransform(this.getLocalTransform()),e&&this.children.forEach((function(t){if(!t.style.isMarker){var n=t.cloneNode(e);a.appendChild(n)}})),a}},{key:"initAttributes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={forceUpdateGeometry:!0};zh.styleValueRegistry.processProperties(this,e,t),this.dirty()}},{key:"setAttribute",value:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];(0,D.Z)(n)||(r||n!==this.attributes[e])&&(this.internalSetAttribute(e,n,{memoize:i}),(0,W.Z)(t,"setAttribute",this,3)([e,n]))}},{key:"setAttributes",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.skipDispatchAttrModifiedEvent,a=void 0!==i&&i;if(a||(t=(0,u.Z)({},this.attributes),n=(0,u.Z)({},this.parsedStyle)),zh.styleValueRegistry.processProperties(this,e,r),this.dirty(),!a)for(var o in e)this.dispatchAttrModifiedEvent(o,t[o],e[o],n[o])}},{key:"internalSetAttribute",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.attributes[e],i=this.parsedStyle[e];zh.styleValueRegistry.processProperties(this,(0,V.Z)({},e,t),n),this.dirty(),this.dispatchAttrModifiedEvent(e,r,t,i)}},{key:"dispatchAttrModifiedEvent",value:function(e,t,n,r){var i,a=this.parsedStyle[e];if(this.isConnected)if(nd.relatedNode=this,nd.prevValue=t,nd.newValue=n,nd.attrName=e,nd.prevParsedValue=r,nd.newParsedValue=a,this.isMutationObserved)this.dispatchEvent(nd);else{var o,s=!0===(null===(o=this.ownerDocument.defaultView.getConfig().future)||void 0===o?void 0:o.experimentalCancelEventPropagation);nd.target=this,this.ownerDocument.defaultView.dispatchEvent(nd,!0,s)}(this.isCustomElement&&this.isConnected||!this.isCustomElement)&&(null===(i=this.attributeChangedCallback)||void 0===i||i.call(this,e,t,n,r,a))}},{key:"getBBox",value:function(){var e=this.getBounds(),t=e.getMin(),n=(0,h.Z)(t,2),r=n[0],i=n[1],a=e.getMax(),o=(0,h.Z)(a,2),s=o[0],l=o[1];return new $o(r,i,s-r,l-i)}},{key:"setOrigin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return zh.sceneGraphService.setOrigin(this,ts(e,t,n,!1)),this}},{key:"getOrigin",value:function(){return zh.sceneGraphService.getOrigin(this)}},{key:"setPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return zh.sceneGraphService.setPosition(this,ts(e,t,n,!1)),this}},{key:"setLocalPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return zh.sceneGraphService.setLocalPosition(this,ts(e,t,n,!1)),this}},{key:"translate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return zh.sceneGraphService.translate(this,ts(e,t,n,!1)),this}},{key:"translateLocal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return zh.sceneGraphService.translateLocal(this,ts(e,t,n,!1)),this}},{key:"getPosition",value:function(){return zh.sceneGraphService.getPosition(this)}},{key:"getLocalPosition",value:function(){return zh.sceneGraphService.getLocalPosition(this)}},{key:"scale",value:function(e,t,n){return this.scaleLocal(e,t,n)}},{key:"scaleLocal",value:function(e,t,n){return"number"==typeof e&&(e=ts(e,t=t||e,n=n||e,!1)),zh.sceneGraphService.scaleLocal(this,e),this}},{key:"setLocalScale",value:function(e,t,n){return"number"==typeof e&&(e=ts(e,t=t||e,n=n||e,!1)),zh.sceneGraphService.setLocalScale(this,e),this}},{key:"getLocalScale",value:function(){return zh.sceneGraphService.getLocalScale(this)}},{key:"getScale",value:function(){return zh.sceneGraphService.getScale(this)}},{key:"getEulerAngles",value:function(){var e=ss(rd,zh.sceneGraphService.getWorldTransform(this));return as((0,h.Z)(e,3)[2])}},{key:"getLocalEulerAngles",value:function(){var e=ss(rd,zh.sceneGraphService.getLocalRotation(this));return as((0,h.Z)(e,3)[2])}},{key:"setEulerAngles",value:function(e){return zh.sceneGraphService.setEulerAngles(this,0,0,e),this}},{key:"setLocalEulerAngles",value:function(e){return zh.sceneGraphService.setLocalEulerAngles(this,0,0,e),this}},{key:"rotateLocal",value:function(e,t,n){return(0,T.Z)(t)&&(0,T.Z)(n)?zh.sceneGraphService.rotateLocal(this,0,0,e):zh.sceneGraphService.rotateLocal(this,e,t,n),this}},{key:"rotate",value:function(e,t,n){return(0,T.Z)(t)&&(0,T.Z)(n)?zh.sceneGraphService.rotate(this,0,0,e):zh.sceneGraphService.rotate(this,e,t,n),this}},{key:"setRotation",value:function(e,t,n,r){return zh.sceneGraphService.setRotation(this,e,t,n,r),this}},{key:"setLocalRotation",value:function(e,t,n,r){return zh.sceneGraphService.setLocalRotation(this,e,t,n,r),this}},{key:"setLocalSkew",value:function(e,t){return zh.sceneGraphService.setLocalSkew(this,e,t),this}},{key:"getRotation",value:function(){return zh.sceneGraphService.getRotation(this)}},{key:"getLocalRotation",value:function(){return zh.sceneGraphService.getLocalRotation(this)}},{key:"getLocalSkew",value:function(){return zh.sceneGraphService.getLocalSkew(this)}},{key:"getLocalTransform",value:function(){return zh.sceneGraphService.getLocalTransform(this)}},{key:"getWorldTransform",value:function(){return zh.sceneGraphService.getWorldTransform(this)}},{key:"setLocalTransform",value:function(e){return zh.sceneGraphService.setLocalTransform(this,e),this}},{key:"resetLocalTransform",value:function(){zh.sceneGraphService.resetLocalTransform(this)}},{key:"getAnimations",value:function(){return this.activeAnimations}},{key:"animate",value:function(e,t){var n,r=null===(n=this.ownerDocument)||void 0===n?void 0:n.timeline;return r?r.play(this,e,t):null}},{key:"isVisible",value:function(){var e;return"hidden"!==(null===(e=this.parsedStyle)||void 0===e?void 0:e.visibility)}},{key:"interactive",get:function(){return this.isInteractive()},set:function(e){this.style.pointerEvents=e?"auto":"none"}},{key:"isInteractive",value:function(){var e;return"none"!==(null===(e=this.parsedStyle)||void 0===e?void 0:e.pointerEvents)}},{key:"isCulled",value:function(){return!(!this.cullable||!this.cullable.enable||this.cullable.visible)}},{key:"toFront",value:function(){return this.parentNode&&(this.style.zIndex=Math.max.apply(Math,(0,c.Z)(this.parentNode.children.map((function(e){return Number(e.style.zIndex)}))))+1),this}},{key:"toBack",value:function(){return this.parentNode&&(this.style.zIndex=Math.min.apply(Math,(0,c.Z)(this.parentNode.children.map((function(e){return Number(e.style.zIndex)}))))-1),this}},{key:"getConfig",value:function(){return this.config}},{key:"attr",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n[0],a=n[1];return i?(0,Z.Z)(i)?(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),this):2===n.length?(this.setAttribute(i,a),this):this.attributes[i]:this.attributes}},{key:"getMatrix",value:function(e){var t=e||this.getWorldTransform(),n=p.getTranslation(rd,t),r=(0,h.Z)(n,2),i=r[0],a=r[1],o=p.getScaling(rd,t),s=(0,h.Z)(o,2),l=s[0],u=s[1],c=p.getRotation(id,t),d=ss(rd,c),f=(0,h.Z)(d,3),v=f[0],m=f[2];return function(e,t,n,r,i){var a=Math.cos(e),o=Math.sin(e);return g.fromValues(r*a,i*o,0,-r*o,i*a,0,t,n,1)}(v||m,i,a,l,u)}},{key:"getLocalMatrix",value:function(){return this.getMatrix(this.getLocalTransform())}},{key:"setMatrix",value:function(e){var t=ls(e),n=(0,h.Z)(t,5),r=n[0],i=n[1],a=n[2],o=n[3],s=n[4];this.setEulerAngles(s).setPosition(r,i).setLocalScale(a,o)}},{key:"setLocalMatrix",value:function(e){var t=ls(e),n=(0,h.Z)(t,5),r=n[0],i=n[1],a=n[2],o=n[3],s=n[4];this.setLocalEulerAngles(s).setLocalPosition(r,i).setLocalScale(a,o)}},{key:"show",value:function(){this.forEach((function(e){e.style.visibility="visible"}))}},{key:"hide",value:function(){this.forEach((function(e){e.style.visibility="hidden"}))}},{key:"getCount",value:function(){return this.childElementCount}},{key:"getParent",value:function(){return this.parentElement}},{key:"getChildren",value:function(){return this.children}},{key:"getFirst",value:function(){return this.firstElementChild}},{key:"getLast",value:function(){return this.lastElementChild}},{key:"getChildByIndex",value:function(e){return this.children[e]||null}},{key:"add",value:function(e,t){return this.appendChild(e,t)}},{key:"set",value:function(e,t){this.config[e]=t}},{key:"get",value:function(e){return this.config[e]}},{key:"moveTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.setPosition(e,t,n),this}},{key:"move",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.setPosition(e,t,n),this}},{key:"setZIndex",value:function(e){return this.style.zIndex=e,this}}])}(Jh);ad.PARSED_STYLE_LIST=new Set(["class","className","clipPath","cursor","display","draggable","droppable","fill","fillOpacity","fillRule","filter","increasedLineWidthForHitTesting","lineCap","lineDash","lineDashOffset","lineJoin","lineWidth","miterLimit","hitArea","offsetDistance","offsetPath","offsetX","offsetY","opacity","pointerEvents","shadowColor","shadowType","shadowBlur","shadowOffsetX","shadowOffsetY","stroke","strokeOpacity","strokeWidth","strokeLinecap","strokeLineJoin","strokeDasharray","strokeDashoffset","transform","transformOrigin","textTransform","visibility","zIndex"]);var od=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:Fo.CIRCLE},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(ad);od.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(ad.PARSED_STYLE_LIST),["cx","cy","cz","r","isBillboard","isSizeAttenuation"]));var sd=["style"],ld=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,le.Z)(n,sd);return(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({style:r},i)])).isCustomElement=!0,e}return(0,l.Z)(t,e),(0,a.Z)(t)}(ad);ld.PARSED_STYLE_LIST=new Set(["class","className","clipPath","cursor","draggable","droppable","opacity","pointerEvents","transform","transformOrigin","zIndex","visibility"]);var ud=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:Fo.ELLIPSE},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(ad);ud.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(ad.PARSED_STYLE_LIST),["cx","cy","cz","rx","ry","isBillboard","isSizeAttenuation"]));var cd=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,[{type:Fo.FRAGMENT}])}return(0,l.Z)(t,e),(0,a.Z)(t)}(ad);cd.PARSED_STYLE_LIST=new Set(["class","className"]);var hd=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:Fo.GROUP},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(ad);hd.PARSED_STYLE_LIST=new Set(["class","className","clipPath","cursor","draggable","droppable","opacity","pointerEvents","transform","transformOrigin","zIndex","visibility"]);var dd=["style"],fd=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,le.Z)(n,dd);return(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:Fo.HTML,style:r},i)])).cullable.enable=!1,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getDomElement",value:function(){return this.parsedStyle.$el}},{key:"getClientRects",value:function(){return[this.getBoundingClientRect()]}},{key:"getLocalBounds",value:function(){if(this.parentNode){var e=p.invert(p.create(),this.parentNode.getWorldTransform()),t=this.getBounds();if(!Yo.isEmpty(t)){var n=new Yo;return n.setFromTransformedAABB(t,e),n}}return this.getBounds()}}])}(ad);fd.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(ad.PARSED_STYLE_LIST),["x","y","$el","innerHTML","width","height"]));var vd=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:Fo.IMAGE},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(ad);vd.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(ad.PARSED_STYLE_LIST),["x","y","z","src","width","height","isBillboard","billboardRotation","isSizeAttenuation","keepAspectRatio"]));var pd=["style"],gd=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,le.Z)(n,pd);(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:Fo.LINE,style:(0,u.Z)({x1:0,y1:0,x2:0,y2:0,z1:0,z2:0},r)},i)])).markerStartAngle=0,e.markerEndAngle=0;var a=e.parsedStyle,l=a.markerStart,c=a.markerEnd;return l&&ed(l)&&(e.markerStartAngle=l.getLocalEulerAngles(),e.appendChild(l)),c&&ed(c)&&(e.markerEndAngle=c.getLocalEulerAngles(),e.appendChild(c)),e.transformMarker(!0),e.transformMarker(!1),e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"attributeChangedCallback",value:function(e,t,n,r,i){"x1"===e||"y1"===e||"x2"===e||"y2"===e||"markerStartOffset"===e||"markerEndOffset"===e?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===e?(r&&ed(r)&&(this.markerStartAngle=0,r.remove()),i&&ed(i)&&(this.markerStartAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!0))):"markerEnd"===e&&(r&&ed(r)&&(this.markerEndAngle=0,r.remove()),i&&ed(i)&&(this.markerEndAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!1)))}},{key:"transformMarker",value:function(e){var t=this.parsedStyle,n=t.markerStart,r=t.markerEnd,i=t.markerStartOffset,a=t.markerEndOffset,o=t.x1,s=t.x2,l=t.y1,u=t.y2,c=e?n:r;if(c&&ed(c)){var h,d,f,v,p,g,m;e?(v=o,p=l,d=s-o,f=u-l,g=i||0,m=this.markerStartAngle):(v=s,p=u,d=o-s,f=l-u,g=a||0,m=this.markerEndAngle),h=Math.atan2(f,d),c.setLocalEulerAngles(180*h/Math.PI+m),c.setLocalPosition(v+Math.cos(h)*g,p+Math.sin(h)*g)}}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.parsedStyle,r=n.x1,i=n.y1,a=n.x2,o=n.y2,s=No(r,i,a,o,e),l=s.x,u=s.y,c=f.transformMat4(f.create(),f.fromValues(l,u,0),t?this.getWorldTransform():this.getLocalTransform());return new qo(c[0],c[1])}},{key:"getPointAtLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getPoint(e/this.getTotalLength(),t)}},{key:"getTotalLength",value:function(){var e=this.parsedStyle;return ko(e.x1,e.y1,e.x2,e.y2)}}])}(ad);gd.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(ad.PARSED_STYLE_LIST),["x1","y1","x2","y2","z1","z2","isBillboard","isSizeAttenuation","markerStart","markerEnd","markerStartOffset","markerEndOffset"]));var md=["style"],yd=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,le.Z)(n,md);(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:Fo.PATH,style:r,initialParsedStyle:{miterLimit:4,d:(0,u.Z)({},Ns)}},i)])).markerStartAngle=0,e.markerEndAngle=0,e.markerMidList=[];var a=e.parsedStyle,l=a.markerStart,c=a.markerEnd,h=a.markerMid;return l&&ed(l)&&(e.markerStartAngle=l.getLocalEulerAngles(),e.appendChild(l)),h&&ed(h)&&e.placeMarkerMid(h),c&&ed(c)&&(e.markerEndAngle=c.getLocalEulerAngles(),e.appendChild(c)),e.transformMarker(!0),e.transformMarker(!1),e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"attributeChangedCallback",value:function(e,t,n,r,i){"d"===e?(this.transformMarker(!0),this.transformMarker(!1),this.placeMarkerMid(this.parsedStyle.markerMid)):"markerStartOffset"===e||"markerEndOffset"===e?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===e?(r&&ed(r)&&(this.markerStartAngle=0,r.remove()),i&&ed(i)&&(this.markerStartAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!0))):"markerEnd"===e?(r&&ed(r)&&(this.markerEndAngle=0,r.remove()),i&&ed(i)&&(this.markerEndAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!1))):"markerMid"===e&&this.placeMarkerMid(i)}},{key:"transformMarker",value:function(e){var t=this.parsedStyle,n=t.markerStart,r=t.markerEnd,i=t.markerStartOffset,a=t.markerEndOffset,o=e?n:r;if(o&&ed(o)){var s,l,u,c,d,f,v;if(e){var p=this.getStartTangent(),g=(0,h.Z)(p,2),m=g[0],y=g[1];c=y[0],d=y[1],l=m[0]-y[0],u=m[1]-y[1],f=i||0,v=this.markerStartAngle}else{var E=this.getEndTangent(),_=(0,h.Z)(E,2),T=_[0],S=_[1];c=S[0],d=S[1],l=T[0]-S[0],u=T[1]-S[1],f=a||0,v=this.markerEndAngle}s=Math.atan2(u,l),o.setLocalEulerAngles(180*s/Math.PI+v),o.setLocalPosition(c+Math.cos(s)*f,d+Math.sin(s)*f)}}},{key:"placeMarkerMid",value:function(e){var t=this.parsedStyle.d.segments;if(this.markerMidList.forEach((function(e){e.remove()})),e&&ed(e))for(var n=1;n<t.length-1;n++){var r=(0,h.Z)(t[n].currentPoint,2),i=r[0],a=r[1],o=1===n?e:e.cloneNode(!0);this.markerMidList.push(o),this.appendChild(o),o.setLocalPosition(i,a)}}},{key:"getTotalLength",value:function(){return pu(this)}},{key:"getPointAtLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.parsedStyle.d.absolutePath,r=(0,G.r)(n,e),i=r.x,a=r.y,o=f.transformMat4(f.create(),f.fromValues(i,a,0),t?this.getWorldTransform():this.getLocalTransform());return new qo(o[0],o[1])}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getPointAtLength(e*pu(this),t)}},{key:"getStartTangent",value:function(){var e=this.parsedStyle.d.segments,t=[];if(e.length>1){var n=e[0].currentPoint,r=e[1].currentPoint,i=e[1].startTangent;t=[],i?(t.push([n[0]-i[0],n[1]-i[1]]),t.push([n[0],n[1]])):(t.push([r[0],r[1]]),t.push([n[0],n[1]]))}return t}},{key:"getEndTangent",value:function(){var e=this.parsedStyle.d.segments,t=e.length,n=[];if(t>1){var r=e[t-2].currentPoint,i=e[t-1].currentPoint,a=e[t-1].endTangent;n=[],a?(n.push([i[0]-a[0],i[1]-a[1]]),n.push([i[0],i[1]])):(n.push([r[0],r[1]]),n.push([i[0],i[1]]))}return n}}])}(ad);yd.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(ad.PARSED_STYLE_LIST),["d","markerStart","markerMid","markerEnd","markerStartOffset","markerEndOffset","isBillboard","isSizeAttenuation"]));var Ed=["style"],_d=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,le.Z)(n,Ed);(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:Fo.POLYGON,style:r,initialParsedStyle:{points:{points:[],totalLength:0,segments:[]},miterLimit:4,isClosed:!0}},i)])).markerStartAngle=0,e.markerEndAngle=0,e.markerMidList=[];var a=e.parsedStyle,l=a.markerStart,c=a.markerEnd,h=a.markerMid;return l&&ed(l)&&(e.markerStartAngle=l.getLocalEulerAngles(),e.appendChild(l)),h&&ed(h)&&e.placeMarkerMid(h),c&&ed(c)&&(e.markerEndAngle=c.getLocalEulerAngles(),e.appendChild(c)),e.transformMarker(!0),e.transformMarker(!1),e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"attributeChangedCallback",value:function(e,t,n,r,i){"points"===e?(this.transformMarker(!0),this.transformMarker(!1),this.placeMarkerMid(this.parsedStyle.markerMid)):"markerStartOffset"===e||"markerEndOffset"===e?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===e?(r&&ed(r)&&(this.markerStartAngle=0,r.remove()),i&&ed(i)&&(this.markerStartAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!0))):"markerEnd"===e?(r&&ed(r)&&(this.markerEndAngle=0,r.remove()),i&&ed(i)&&(this.markerEndAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!1))):"markerMid"===e&&this.placeMarkerMid(i)}},{key:"transformMarker",value:function(e){var t=this.parsedStyle,n=t.markerStart,r=t.markerEnd,i=t.markerStartOffset,a=t.markerEndOffset,o=(t.points||{}).points,s=e?n:r;if(s&&ed(s)&&o){var l,u,c,h,d,f,v;if(h=o[0][0],d=o[0][1],e)u=o[1][0]-o[0][0],c=o[1][1]-o[0][1],f=i||0,v=this.markerStartAngle;else{var p=o.length;this.parsedStyle.isClosed?(u=o[p-1][0]-o[0][0],c=o[p-1][1]-o[0][1]):(h=o[p-1][0],d=o[p-1][1],u=o[p-2][0]-o[p-1][0],c=o[p-2][1]-o[p-1][1]),f=a||0,v=this.markerEndAngle}l=Math.atan2(c,u),s.setLocalEulerAngles(180*l/Math.PI+v),s.setLocalPosition(h+Math.cos(l)*f,d+Math.sin(l)*f)}}},{key:"placeMarkerMid",value:function(e){var t=(this.parsedStyle.points||{}).points;if(this.markerMidList.forEach((function(e){e.remove()})),this.markerMidList=[],e&&ed(e)&&t)for(var n=1;n<(this.parsedStyle.isClosed?t.length:t.length-1);n++){var r=t[n][0],i=t[n][1],a=1===n?e:e.cloneNode(!0);this.markerMidList.push(a),this.appendChild(a),a.setLocalPosition(r,i)}}}])}(ad);_d.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(ad.PARSED_STYLE_LIST),["points","markerStart","markerMid","markerEnd","markerStartOffset","markerEndOffset","isClosed","isBillboard","isSizeAttenuation"]));var Td=["style"],Sd=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.style,r=(0,le.Z)(e,Td);return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:Fo.POLYLINE,style:n,initialParsedStyle:{points:{points:[],totalLength:0,segments:[]},miterLimit:4,isClosed:!1}},r)])}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getTotalLength",value:function(){return gu(this)}},{key:"getPointAtLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getPoint(e/this.getTotalLength(),t)}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.parsedStyle.points.points;if(0===this.parsedStyle.points.segments.length){var r,i,a=[],o=0,s=this.getTotalLength();n.forEach((function(e,t){n[t+1]&&((r=[0,0])[0]=o/s,i=ko(e[0],e[1],n[t+1][0],n[t+1][1]),o+=i,r[1]=o/s,a.push(r))})),this.parsedStyle.points.segments=a}var l=0,u=0;this.parsedStyle.points.segments.forEach((function(t,n){e>=t[0]&&e<=t[1]&&(l=(e-t[0])/(t[1]-t[0]),u=n)}));var c=No(n[u][0],n[u][1],n[u+1][0],n[u+1][1],l),h=c.x,d=c.y,v=f.transformMat4(f.create(),f.fromValues(h,d,0),t?this.getWorldTransform():this.getLocalTransform());return new qo(v[0],v[1])}},{key:"getStartTangent",value:function(){var e=this.parsedStyle.points.points,t=[];return t.push([e[1][0],e[1][1]]),t.push([e[0][0],e[0][1]]),t}},{key:"getEndTangent",value:function(){var e=this.parsedStyle.points.points,t=e.length-1,n=[];return n.push([e[t-1][0],e[t-1][1]]),n.push([e[t][0],e[t][1]]),n}}])}(_d);Sd.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(_d.PARSED_STYLE_LIST),["points","markerStart","markerMid","markerEnd","markerStartOffset","markerEndOffset","isBillboard"]));var Rd=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:Fo.RECT},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(ad);Rd.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(ad.PARSED_STYLE_LIST),["x","y","z","width","height","isBillboard","isSizeAttenuation","radius"]));var Ad=["style"],xd=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.style,r=(0,le.Z)(e,Ad);return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:Fo.TEXT,style:(0,u.Z)({fill:"black"},n)},r)])}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getComputedTextLength",value:function(){var e;return this.getGeometryBounds(),(null===(e=this.parsedStyle.metrics)||void 0===e?void 0:e.maxLineWidth)||0}},{key:"getLineBoundingRects",value:function(){var e;return this.getGeometryBounds(),(null===(e=this.parsedStyle.metrics)||void 0===e?void 0:e.lineMetrics)||[]}},{key:"isOverflowing",value:function(){return this.getGeometryBounds(),!!this.parsedStyle.isOverflowing}}])}(ad);xd.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(ad.PARSED_STYLE_LIST),["x","y","z","isBillboard","billboardRotation","isSizeAttenuation","text","textAlign","textBaseline","fontStyle","fontSize","fontFamily","fontWeight","fontVariant","lineHeight","letterSpacing","leading","wordWrap","wordWrapWidth","maxLines","textOverflow","isOverflowing","textPath","textDecorationLine","textDecorationColor","textDecorationStyle","textDecorationThickness","textPathSide","textPathStartOffset","metrics","dx","dy"]));var kd=function(){function e(t){(0,o.Z)(this,e),this.strategies=t}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=t.config,r=t.camera,i=t.renderingService,a=t.renderingContext,o=this.strategies;i.hooks.cull.tap(e.tag,(function(e){if(e){var t,i=e.cullable;if(0===o.length?i.visible=a.unculledEntities.indexOf(e.entity)>-1:i.visible=o.every((function(t){return t.isVisible(r,e)})),!e.isCulled()&&e.isVisible())return e;var s=!0===(null===(t=n.future)||void 0===t?void 0:t.experimentalCancelEventPropagation);return e.dispatchEvent(new dh(Eh.CULLED),s,s),null}return e})),i.hooks.afterRender.tap(e.tag,(function(e){e.cullable.visibilityPlaneMask=-1}))}}])}();kd.tag="Culling";var Nd=function(){function e(){var t=this;(0,o.Z)(this,e),this.autoPreventDefault=!1,this.rootPointerEvent=new ch(null),this.rootWheelEvent=new hh(null),this.onPointerMove=function(e){var n,r=null===(n=t.context.renderingContext.root)||void 0===n||null===(n=n.ownerDocument)||void 0===n?void 0:n.defaultView;if(!r.supportsTouchEvents||"touch"!==e.pointerType){var i,a=t.normalizeToPointerEvent(e,r),o=(0,se.Z)(a);try{for(o.s();!(i=o.n()).done;){var s=i.value,l=t.bootstrapEvent(t.rootPointerEvent,s,r,e);t.context.eventService.mapEvent(l)}}catch(e){o.e(e)}finally{o.f()}t.setCursor(t.context.eventService.cursor)}},this.onClick=function(e){var n,r,i=null===(n=t.context.renderingContext.root)||void 0===n||null===(n=n.ownerDocument)||void 0===n?void 0:n.defaultView,a=t.normalizeToPointerEvent(e,i),o=(0,se.Z)(a);try{for(o.s();!(r=o.n()).done;){var s=r.value,l=t.bootstrapEvent(t.rootPointerEvent,s,i,e);t.context.eventService.mapEvent(l)}}catch(e){o.e(e)}finally{o.f()}t.setCursor(t.context.eventService.cursor)}}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=this;this.context=t;var r=t.renderingService,i=this.context.renderingContext.root.ownerDocument.defaultView;this.context.eventService.setPickHandler((function(e){return n.context.renderingService.hooks.pickSync.call({position:e,picked:[],topmost:!0}).picked[0]||null})),r.hooks.pointerWheel.tap(e.tag,(function(e){var t=n.normalizeWheelEvent(e);n.context.eventService.mapEvent(t)})),r.hooks.pointerDown.tap(e.tag,(function(e){if(!i.supportsTouchEvents||"touch"!==e.pointerType){var t=n.normalizeToPointerEvent(e,i);if(n.autoPreventDefault&&t[0].isNormalized)(e.cancelable||!("cancelable"in e))&&e.preventDefault();var r,a=(0,se.Z)(t);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=n.bootstrapEvent(n.rootPointerEvent,o,i,e);n.context.eventService.mapEvent(s)}}catch(e){a.e(e)}finally{a.f()}n.setCursor(n.context.eventService.cursor)}})),r.hooks.pointerUp.tap(e.tag,(function(e){if(!i.supportsTouchEvents||"touch"!==e.pointerType){var t,r=n.context.contextService.getDomElement(),a=n.context.eventService.isNativeEventFromCanvas(r,e)?"":"outside",o=n.normalizeToPointerEvent(e,i),s=(0,se.Z)(o);try{for(s.s();!(t=s.n()).done;){var l=t.value,u=n.bootstrapEvent(n.rootPointerEvent,l,i,e);u.type+=a,n.context.eventService.mapEvent(u)}}catch(e){s.e(e)}finally{s.f()}n.setCursor(n.context.eventService.cursor)}})),r.hooks.pointerMove.tap(e.tag,this.onPointerMove),r.hooks.pointerOver.tap(e.tag,this.onPointerMove),r.hooks.pointerOut.tap(e.tag,this.onPointerMove),r.hooks.click.tap(e.tag,this.onClick),r.hooks.pointerCancel.tap(e.tag,(function(e){var t,r=n.normalizeToPointerEvent(e,i),a=(0,se.Z)(r);try{for(a.s();!(t=a.n()).done;){var o=t.value,s=n.bootstrapEvent(n.rootPointerEvent,o,i,e);n.context.eventService.mapEvent(s)}}catch(e){a.e(e)}finally{a.f()}n.setCursor(n.context.eventService.cursor)}))}},{key:"bootstrapEvent",value:function(e,t,n,r){e.view=n,e.originalEvent=null,e.nativeEvent=r,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t);var i=this.context.eventService.client2Viewport({x:t.clientX,y:t.clientY}),a=i.x,o=i.y;e.viewport.x=a,e.viewport.y=o;var s=this.context.eventService.viewport2Canvas(e.viewport),l=s.x,u=s.y;return e.canvas.x=l,e.canvas.y=u,e.global.copyFrom(e.canvas),e.offset.copyFrom(e.canvas),e.isTrusted=r.isTrusted,"pointerleave"===e.type&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=Sc[e.type]||e.type),e}},{key:"normalizeWheelEvent",value:function(e){var t=this.rootWheelEvent;this.transferMouseData(t,e),t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ;var n=this.context.eventService.client2Viewport({x:e.clientX,y:e.clientY}),r=n.x,i=n.y;t.viewport.x=r,t.viewport.y=i;var a=this.context.eventService.viewport2Canvas(t.viewport),o=a.x,s=a.y;return t.canvas.x=o,t.canvas.y=s,t.global.copyFrom(t.canvas),t.offset.copyFrom(t.canvas),t.nativeEvent=e,t.type=e.type,t}},{key:"transferMouseData",value:function(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=Rc.now(),e.type=t.type,e.altKey=t.altKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey,e.ctrlKey=t.ctrlKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.screen.x=t.screenX,e.screen.y=t.screenY,e.relatedTarget=null}},{key:"setCursor",value:function(e){this.context.contextService.applyCursorStyle(e||this.context.config.cursor||"default")}},{key:"normalizeToPointerEvent",value:function(e,t){var n=[];if(t.isTouchEvent(e))for(var r=0;r<e.changedTouches.length;r++){var i=e.changedTouches[r];(0,D.Z)(i.button)&&(i.button=0),(0,D.Z)(i.buttons)&&(i.buttons=1),(0,D.Z)(i.isPrimary)&&(i.isPrimary=1===e.touches.length&&"touchstart"===e.type),(0,D.Z)(i.width)&&(i.width=i.radiusX||1),(0,D.Z)(i.height)&&(i.height=i.radiusY||1),(0,D.Z)(i.tiltX)&&(i.tiltX=0),(0,D.Z)(i.tiltY)&&(i.tiltY=0),(0,D.Z)(i.pointerType)&&(i.pointerType="touch"),(0,D.Z)(i.pointerId)&&(i.pointerId=i.identifier||0),(0,D.Z)(i.pressure)&&(i.pressure=i.force||.5),(0,D.Z)(i.twist)&&(i.twist=0),(0,D.Z)(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,i.type=e.type,n.push(i)}else if(t.isMouseEvent(e)){var a=e;(0,D.Z)(a.isPrimary)&&(a.isPrimary=!0),(0,D.Z)(a.width)&&(a.width=1),(0,D.Z)(a.height)&&(a.height=1),(0,D.Z)(a.tiltX)&&(a.tiltX=0),(0,D.Z)(a.tiltY)&&(a.tiltY=0),(0,D.Z)(a.pointerType)&&(a.pointerType="mouse"),(0,D.Z)(a.pointerId)&&(a.pointerId=1),(0,D.Z)(a.pressure)&&(a.pressure=.5),(0,D.Z)(a.twist)&&(a.twist=0),(0,D.Z)(a.tangentialPressure)&&(a.tangentialPressure=0),a.isNormalized=!0,n.push(a)}else n.push(e);return n}}])}();Nd.tag="Event";Fo.CIRCLE,Fo.ELLIPSE,Fo.IMAGE,Fo.RECT,Fo.LINE,Fo.POLYLINE,Fo.POLYGON,Fo.TEXT,Fo.PATH,Fo.HTML;var Md=function(){function e(){(0,o.Z)(this,e),this.mutationRecords=[],this.isFirstTimeRendering=!0,this.isFirstTimeRenderingFinished=!1}return(0,a.Z)(e,[{key:"apply",value:function(t){var n,r=this,i=t.renderingService,a=t.renderingContext.root.ownerDocument.defaultView,o=function(e){i.dirty()},s=function(e){var t,n=e.detail;(t=r.mutationRecords).push.apply(t,(0,c.Z)(n)),i.dirty()},l=function(e){var t=e.target;zh.enableSizeAttenuation&&zh.styleValueRegistry.updateSizeAttenuation(t,a.getCamera().getZoom())},u=function(e){var t=e.target;zh.sceneGraphService.dirtyToRoot(t),i.dirty()};i.hooks.init.tap(e.tag,(function(){a.addEventListener(Eh.MOUNTED,l),a.addEventListener(Eh.UNMOUNTED,u),a.addEventListener(Eh.ATTR_MODIFIED,o),a.addEventListener(Eh.BOUNDS_CHANGED,s)})),i.hooks.destroy.tap(e.tag,(function(){a.removeEventListener(Eh.MOUNTED,l),a.removeEventListener(Eh.UNMOUNTED,u),a.removeEventListener(Eh.ATTR_MODIFIED,o),a.removeEventListener(Eh.BOUNDS_CHANGED,s),r.mutationRecords=[]}));var h=null!==(n=zh.globalThis.requestIdleCallback)&&void 0!==n?n:Lc.bind(zh.globalThis);i.hooks.endFrame.tap(e.tag,(function(){r.isFirstTimeRendering&&(r.isFirstTimeRendering=!1,h((function(){r.isFirstTimeRenderingFinished=!0}))),r.mutationRecords=[]}))}}])}();Md.tag="Prepare";var Cd=function(e){return e.READY="ready",e.BEFORE_RENDER="beforerender",e.RERENDER="rerender",e.AFTER_RENDER="afterrender",e.BEFORE_DESTROY="beforedestroy",e.AFTER_DESTROY="afterdestroy",e.RESIZE="resize",e.DIRTY_RECTANGLE="dirtyrectangle",e.RENDERER_CHANGED="rendererchanged",e}({});new dh(Eh.MOUNTED),new dh(Eh.UNMOUNTED),new dh(Cd.BEFORE_RENDER),new dh(Cd.RERENDER),new dh(Cd.AFTER_RENDER),new WeakMap;var bd=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.cacheStore=new Map}),[{key:"onRefAdded",value:function(e){}},{key:"has",value:function(e){return this.cacheStore.has(e)}},{key:"put",value:function(e,t,n){return!this.cacheStore.has(e)&&(this.cacheStore.set(e,{value:t,counter:new Set([n.entity])}),this.onRefAdded(n),!0)}},{key:"get",value:function(e,t){var n=this.cacheStore.get(e);return n?(n.counter.has(t.entity)||(n.counter.add(t.entity),this.onRefAdded(t)),n.value):null}},{key:"update",value:function(e,t,n){var r=this.cacheStore.get(e);return!!r&&(r.value=(0,u.Z)((0,u.Z)({},r.value),t),r.counter.has(n.entity)||(r.counter.add(n.entity),this.onRefAdded(n)),!0)}},{key:"release",value:function(e,t){var n=this.cacheStore.get(e);return!!n&&(n.counter.delete(t.entity),n.counter.size<=0&&this.cacheStore.delete(e),!0)}},{key:"releaseRef",value:function(e){var t=this;Array.from(this.cacheStore.keys()).forEach((function(n){t.release(n,e)}))}},{key:"getSize",value:function(){return this.cacheStore.size}},{key:"clear",value:function(){this.cacheStore.clear()}}])}(),Pd=[],Od=[],Id=function(){function e(){(0,o.Z)(this,e)}return(0,a.Z)(e,null,[{key:"stop",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.api;e.rafId&&(t.cancelAnimationFrame(e.rafId),e.rafId=null)}},{key:"executeTask",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.api;Pd.length<=0&&Od.length<=0||(Od.forEach((function(e){return e()})),Od=Pd.splice(0,e.TASK_NUM_PER_FRAME),e.rafId=t.requestAnimationFrame((function(){e.executeTask(t)})))}},{key:"sliceImage",value:function(t,n,r,i){for(var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.api,s=t.naturalWidth||t.width,l=t.naturalHeight||t.height,u=n-a,c=r-a,h=Math.ceil(s/u),d=Math.ceil(l/c),f={tileSize:[n,r],gridSize:[d,h],tiles:Array(d).fill(null).map((function(){return Array(h).fill(null)}))},v=function(e){for(var a=function(a){Pd.push((function(){var h=a*u,d=e*c,v=[Math.min(n,s-h),Math.min(r,l-d)],p=v[0],g=v[1],m=o.createCanvas();m.width=n,m.height=r,m.getContext("2d").drawImage(t,h,d,p,g,0,0,p,g),f.tiles[e][a]={x:h,y:d,tileX:a,tileY:e,data:m},i()}))},d=0;d<h;d++)a(d)},p=0;p<d;p++)v(p);return e.stop(),e.executeTask(),f}}])}();Id.TASK_NUM_PER_FRAME=10;var wd=new bd;wd.onRefAdded=function(e){var t=this;e.addEventListener(Eh.DESTROY,(function(){t.releaseRef(e)}),{once:!0})};var Ld=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e),this.gradientCache={},this.patternCache={},this.context=t,this.runtime=n}),[{key:"getImageSync",value:function(e,t,n){var r=(0,S.Z)(e)?e:e.src;if(wd.has(r)){var i=wd.get(r,t);if(i.img.complete)return null==n||n(i),i}return this.getOrCreateImage(e,t).then((function(e){null==n||n(e)})).catch((function(e){console.error(e)})),null}},{key:"getOrCreateImage",value:function(e,t){var n=this,r=(0,S.Z)(e)?e:e.src;if(!(0,S.Z)(e)&&!wd.has(r)){var i={img:e,size:[e.naturalWidth||e.width,e.naturalHeight||e.height],tileSize:Dd(e)};wd.put(r,i,t)}if(wd.has(r)){var a=wd.get(r,t);return a.img.complete?Promise.resolve(a):new Promise((function(e,t){a.img.addEventListener("load",(function(){a.size=[a.img.naturalWidth||a.img.width,a.img.naturalHeight||a.img.height],a.tileSize=Dd(a.img),e(a)})),a.img.addEventListener("error",(function(e){t(e)}))}))}return new Promise((function(e,i){var a=n.context.config.createImage();if(a){var o={img:a,size:[0,0],tileSize:Dd(a)};wd.put(r,o,t),a.onload=function(){o.size=[a.naturalWidth||a.width,a.naturalHeight||a.height],o.tileSize=Dd(o.img),e(o)},a.onerror=function(e){i(e)},a.crossOrigin="Anonymous",a.src=r}}))}},{key:"createDownSampledImage",value:(t=(0,oe.Z)((0,ae.Z)().mark((function e(t,n){var r,i,a,o,s,l,c,d,f,v,p,g,m,y;return(0,ae.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.getOrCreateImage(t,n);case 1:if(void 0===(r=e.sent).downSamplingRate){e.next=2;break}return e.abrupt("return",r);case 2:if(i=this.context.config.enableLargeImageOptimization,o=(a="boolean"==typeof i?{}:i).maxDownSampledImageSize,s=void 0===o?2048:o,l=a.downSamplingRateThreshold,c=void 0===l?.5:l,d=this.runtime.globalThis.createImageBitmap,f=(0,h.Z)(r.size,2),v=f[0],p=f[1],g=r.img,m=Math.min((s+s)/(v+p),Math.max(.01,Math.min(c,.5))),y=(0,u.Z)((0,u.Z)({},r),{},{downSamplingRate:m}),wd.update(r.img.src,y,n),!d){e.next=7;break}return e.prev=3,e.next=4,d(r.img,{resizeWidth:v*m,resizeHeight:p*m});case 4:g=e.sent,e.next=6;break;case 5:e.prev=5,e.catch(3),m=1;case 6:e.next=8;break;case 7:m=1;case 8:return y=(0,u.Z)((0,u.Z)({},this.getImageSync(t,n)),{},{downSampled:g,downSamplingRate:m}),wd.update(r.img.src,y,n),e.abrupt("return",y);case 9:case"end":return e.stop()}}),e,this,[[3,5]])}))),function(e,n){return t.apply(this,arguments)})},{key:"createImageTiles",value:(e=(0,oe.Z)((0,ae.Z)().mark((function e(t,n,r,i){var a,o,s,l,c;return(0,ae.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.getOrCreateImage(t,i);case 1:return a=e.sent,o=i.ownerDocument.defaultView,s=o.requestAnimationFrame,l=o.cancelAnimationFrame,Id.api={requestAnimationFrame:s,cancelAnimationFrame:l,createCanvas:function(){return ph.createCanvas()}},c=(0,u.Z)((0,u.Z)({},a),Id.sliceImage(a.img,a.tileSize[0],a.tileSize[0],r)),wd.update(a.img.src,c,i),e.abrupt("return",c);case 2:case"end":return e.stop()}}),e,this)}))),function(t,n,r,i){return e.apply(this,arguments)})},{key:"releaseImage",value:function(e,t){wd.release((0,S.Z)(e)?e:e.src,t)}},{key:"releaseImageRef",value:function(e){wd.releaseRef(e)}},{key:"getOrCreatePatternSync",value:function(e,t,n,r,i,a,o){var s=this.generatePatternKey(t);if(s&&this.patternCache[s])return this.patternCache[s];var l,u=t.image,c=t.repetition,h=t.transform,d=!1;if((0,S.Z)(u)){var f=this.getImageSync(u,e,o);l=null==f?void 0:f.img}else r?(l=r,d=!0):l=u;var v,g=l&&n.createPattern(l,c);g&&(v=h?Kc(Uu(h),new ad({})):p.identity(p.create()),d&&p.scale(v,v,[1/i,1/i,1]),g.setTransform({a:v[0],b:v[1],c:v[4],d:v[5],e:v[12]+a[0],f:v[13]+a[1]}));return s&&g&&(this.patternCache[s]=g),g}},{key:"getOrCreateGradient",value:function(e,t){var n=this.generateGradientKey(e),r=e.type,i=e.steps,a=e.min,o=e.width,s=e.height,l=e.angle,u=e.cx,c=e.cy,h=e.size;if(this.gradientCache[n])return this.gradientCache[n];var d=null;if(r===Tl.LinearGradient){var f=function(e,t,n,r){var i=rs(r.value),a=0+t/2,o=0+n/2,s=Math.abs(t*Math.cos(i))+Math.abs(n*Math.sin(i));return{x1:e[0]+a-Math.cos(i)*s/2,y1:e[1]+o-Math.sin(i)*s/2,x2:e[0]+a+Math.cos(i)*s/2,y2:e[1]+o+Math.sin(i)*s/2}}(a,o,s,l),v=f.x1,p=f.y1,g=f.x2,m=f.y2;d=t.createLinearGradient(v,p,g,m)}else if(r===Tl.RadialGradient){var y=function(e,t,n,r,i,a){var o=r.value,s=i.value;r.unit===cl.kPercentage&&(o=r.value/100*t),i.unit===cl.kPercentage&&(s=i.value/100*n);var l=Math.max((0,_.y)([0,0],[o,s]),(0,_.y)([0,n],[o,s]),(0,_.y)([t,n],[o,s]),(0,_.y)([t,0],[o,s]));return a&&(a instanceof xl?l=a.value:a instanceof Rl&&("closest-side"===a.value?l=Math.min(o,t-o,s,n-s):"farthest-side"===a.value?l=Math.max(o,t-o,s,n-s):"closest-corner"===a.value&&(l=Math.min((0,_.y)([0,0],[o,s]),(0,_.y)([0,n],[o,s]),(0,_.y)([t,n],[o,s]),(0,_.y)([t,0],[o,s]))))),{x:o+e[0],y:s+e[1],r:l}}(a,o,s,u,c,h),E=y.x,T=y.y,S=y.r;d=t.createRadialGradient(E,T,0,E,T,S)}return d&&(i.forEach((function(e){var t,n=e.offset,r=e.color;n.unit===cl.kPercentage&&(null===(t=d)||void 0===t||t.addColorStop(n.value/100,r.toString()))})),this.gradientCache[n]=d),this.gradientCache[n]}},{key:"generateGradientKey",value:function(e){var t=e.type,n=e.min,r=e.width,i=e.height,a=e.steps,o=e.angle,s=e.cx,l=e.cy,u=e.size;return"gradient-".concat(t,"-").concat((null==o?void 0:o.toString())||0,"-").concat((null==s?void 0:s.toString())||0,"-").concat((null==l?void 0:l.toString())||0,"-").concat((null==u?void 0:u.toString())||0,"-").concat(n[0],"-").concat(n[1],"-").concat(r,"-").concat(i,"-").concat(a.map((function(e){var t=e.offset,n=e.color;return"".concat(t).concat(n)})).join("-"))}},{key:"generatePatternKey",value:function(e){var t=e.image,n=e.repetition;return(0,S.Z)(t)?"pattern-".concat(t,"-").concat(n):"rect"===t.nodeName?"pattern-".concat(t.entity,"-").concat(n):void 0}}]);var e,t}();function Dd(e){if(!e.complete)return[0,0];var t=e.naturalWidth||e.width,n=e.naturalHeight||e.height,r=256;return[256,512].forEach((function(e){Math.ceil(n/e)*Math.ceil(t/e)<1e3&&(r=e)})),[r,r]}Ld.isSupportTile=!!ph.createCanvas();var Bd=function(){function e(){(0,o.Z)(this,e)}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=t.renderingService,r=t.renderingContext,i=t.imagePool,a=r.root.ownerDocument.defaultView,o=function(e,t,n){var r=e.parsedStyle,i=r.width,a=r.height;i&&!a?e.setAttribute("height",n/t*i):!i&&a&&e.setAttribute("width",t/n*a)},s=function(e){var t=e.target,r=t.nodeName,a=t.attributes;if(r===Fo.IMAGE){var s=a.src,l=a.keepAspectRatio;i.getImageSync(s,t,(function(e){var r=e.img,i=r.width,a=r.height;l&&o(t,i,a),t.dirty(),n.dirty()}))}},l=function(e){var t=e.target,r=e.attrName,a=e.prevValue,s=e.newValue;t.nodeName===Fo.IMAGE&&"src"===r&&(a!==s&&i.releaseImage(a,t),(0,S.Z)(s)&&i.getOrCreateImage(s,t).then((function(e){var r=e.img,i=r.width,a=r.height;t.attributes.keepAspectRatio&&o(t,i,a),t.dirty(),n.dirty()})).catch((function(){})))};n.hooks.init.tap(e.tag,(function(){a.addEventListener(Eh.MOUNTED,s),a.addEventListener(Eh.ATTR_MODIFIED,l)})),n.hooks.destroy.tap(e.tag,(function(){a.removeEventListener(Eh.MOUNTED,s),a.removeEventListener(Eh.ATTR_MODIFIED,l)}))}}])}();Bd.tag="LoadImage";var Fd=function(){function e(){(0,o.Z)(this,e),this.displayObjectHTMLElementMap=new WeakMap}return(0,a.Z)(e,[{key:"joinTransformMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return"matrix(".concat([e[0],e[1],e[4],e[5],e[12]+t[0],e[13]+t[1]].join(","),")")}},{key:"apply",value:function(t,n){var r=this,i=t.camera,a=t.renderingContext,o=t.renderingService;this.context=t;var s=a.root.ownerDocument.defaultView,l=s.context.eventService.nativeHTMLMap,u=function(e,t){t.style.transform=r.joinTransformMatrix(e.getWorldTransform(),e.getOrigin())},c=function(e){var t=e.target;if(t.nodeName===Fo.HTML){r.$camera||(r.$camera=r.createCamera(i));var n=r.getOrCreateEl(t);r.$camera.appendChild(n),Object.keys(t.attributes).forEach((function(e){r.updateAttribute(e,t)})),u(t,n),l.set(n,t)}},h=function(e){var t=e.target;if(t.nodeName===Fo.HTML&&r.$camera){var n=r.getOrCreateEl(t);n&&(n.remove(),l.delete(n))}},d=function(e){var t=e.target;if(t.nodeName===Fo.HTML){var n=e.attrName;r.updateAttribute(n,t)}},f=function(e){for(var t=e.detail,n=0;n<t.length;n++){var i=t[n].target;(i.nodeName===Fo.FRAGMENT?i.childNodes:[i]).forEach((function(e){if(e.nodeName===Fo.HTML){var t=r.getOrCreateEl(e);u(e,t)}}))}},v=function(){if(r.$camera){var e=r.context.config,t=e.width,n=e.height;r.$camera.parentElement.style.width="".concat(t||0,"px"),r.$camera.parentElement.style.height="".concat(n||0,"px")}};o.hooks.init.tap(e.tag,(function(){s.addEventListener(Cd.RESIZE,v),s.addEventListener(Eh.MOUNTED,c),s.addEventListener(Eh.UNMOUNTED,h),s.addEventListener(Eh.ATTR_MODIFIED,d),s.addEventListener(Eh.BOUNDS_CHANGED,f)})),o.hooks.endFrame.tap(e.tag,(function(){r.$camera&&a.renderReasons.has(gh.CAMERA_CHANGED)&&(r.$camera.style.transform=r.joinTransformMatrix(i.getOrthoMatrix()))})),o.hooks.destroy.tap(e.tag,(function(){r.$camera&&r.$camera.remove(),s.removeEventListener(Cd.RESIZE,v),s.removeEventListener(Eh.MOUNTED,c),s.removeEventListener(Eh.UNMOUNTED,h),s.removeEventListener(Eh.ATTR_MODIFIED,d),s.removeEventListener(Eh.BOUNDS_CHANGED,f)}))}},{key:"createCamera",value:function(e){var t=this.context.config,n=t.document,r=t.width,i=t.height,a=this.context.contextService.getDomElement(),o=a.parentNode;if(o){var s="g-canvas-camera",l=o.querySelector("#".concat(s));if(!l){var u=(n||document).createElement("div");u.style.overflow="hidden",u.style.pointerEvents="none",u.style.position="absolute",u.style.left="0px",u.style.top="0px",u.style.width="".concat(r||0,"px"),u.style.height="".concat(i||0,"px");var c=(n||document).createElement("div");l=c,c.id=s,c.style.position="absolute",c.style.left="".concat(a.offsetLeft||0,"px"),c.style.top="".concat(a.offsetTop||0,"px"),c.style.transformOrigin="left top",c.style.transform=this.joinTransformMatrix(e.getOrthoMatrix()),c.style.pointerEvents="none",c.style.width="100%",c.style.height="100%",u.appendChild(c),o.appendChild(u)}return l}return null}},{key:"getOrCreateEl",value:function(e){var t=this.context.config.document,n=this.displayObjectHTMLElementMap.get(e);return n||(n=(t||document).createElement("div"),e.parsedStyle.$el=n,this.displayObjectHTMLElementMap.set(e,n),e.id&&(n.id=e.id),e.name&&n.setAttribute("name",e.name),e.className&&(n.className=e.className),n.style.position="absolute",n.style["will-change"]="transform",n.style.transform=this.joinTransformMatrix(e.getWorldTransform(),e.getOrigin())),n}},{key:"updateAttribute",value:function(e,t){var n=this.getOrCreateEl(t);switch(e){case"innerHTML":var r=t.parsedStyle.innerHTML;(0,S.Z)(r)?n.innerHTML=r:(n.innerHTML="",n.appendChild(r));break;case"x":n.style.left="".concat(t.parsedStyle.x,"px");break;case"y":n.style.top="".concat(t.parsedStyle.y,"px");break;case"transformOrigin":var i=t.parsedStyle.transformOrigin;n.style["transform-origin"]="".concat(i[0].buildCSSText(null,null,"")," ").concat(i[1].buildCSSText(null,null,""));break;case"width":var a=t.parsedStyle.width;n.style.width=(0,E.Z)(a)?"".concat(a,"px"):a.toString();break;case"height":var o=t.parsedStyle.height;n.style.height=(0,E.Z)(o)?"".concat(o,"px"):o.toString();break;case"zIndex":var s=t.parsedStyle.zIndex;n.style["z-index"]="".concat(s);break;case"visibility":var l=t.parsedStyle.visibility;n.style.visibility=l;break;case"pointerEvents":var u=t.parsedStyle.pointerEvents,c=void 0===u?"auto":u;n.style.pointerEvents=c;break;case"opacity":var h=t.parsedStyle.opacity;n.style.opacity="".concat(h);break;case"fill":var d=t.parsedStyle.fill,f="";zl(d)?f=d.isNone?"transparent":t.getAttribute("fill"):Array.isArray(d)?f=t.getAttribute("fill"):Xl(d),n.style.background=f;break;case"stroke":var v=t.parsedStyle.stroke,p="";zl(v)?p=v.isNone?"transparent":t.getAttribute("stroke"):Array.isArray(v)?p=t.getAttribute("stroke"):Xl(v),n.style["border-color"]=p,n.style["border-style"]="solid";break;case"lineWidth":var g=t.parsedStyle.lineWidth;n.style["border-width"]="".concat(g||0,"px");break;case"lineDash":n.style["border-style"]="dashed";break;case"filter":var m=t.style.filter;n.style.filter=m;break;default:(0,T.Z)(t.style[e])||""===t.style[e]||(n.style[e]=t.style[e])}}}])}();Fd.tag="HTMLRendering";var Ud=function(){function e(){(0,o.Z)(this,e)}return(0,a.Z)(e,[{key:"apply",value:function(t,n){var r=this,i=t.renderingService,a=t.renderingContext,o=t.config;this.context=t;var s=a.root.ownerDocument.defaultView,l=function(e){i.hooks.pointerMove.call(e)},u=function(e){i.hooks.pointerUp.call(e)},c=function(e){i.hooks.pointerDown.call(e)},h=function(e){i.hooks.pointerOver.call(e)},d=function(e){i.hooks.pointerOut.call(e)},f=function(e){i.hooks.pointerCancel.call(e)},v=function(e){i.hooks.pointerWheel.call(e)},p=function(e){i.hooks.click.call(e)};i.hooks.init.tap(e.tag,(function(){var e=r.context.contextService.getDomElement();n.globalThis.navigator.msPointerEnabled?(e.style.msContentZooming="none",e.style.msTouchAction="none"):s.supportsPointerEvents&&(e.style.touchAction="none"),s.supportsPointerEvents?function(e){n.globalThis.document.addEventListener("pointermove",l,!0),e.addEventListener("pointerdown",c,!0),e.addEventListener("pointerleave",d,!0),e.addEventListener("pointerover",h,!0),n.globalThis.addEventListener("pointerup",u,!0),n.globalThis.addEventListener("pointercancel",f,!0)}(e):function(e){n.globalThis.document.addEventListener("mousemove",l,!0),e.addEventListener("mousedown",c,!0),e.addEventListener("mouseout",d,!0),e.addEventListener("mouseover",h,!0),n.globalThis.addEventListener("mouseup",u,!0)}(e),s.supportsTouchEvents&&function(e){e.addEventListener("touchstart",c,!0),e.addEventListener("touchend",u,!0),e.addEventListener("touchmove",l,!0),e.addEventListener("touchcancel",f,!0)}(e),o.useNativeClickEvent&&e.addEventListener("click",p,!0),e.addEventListener("wheel",v,{passive:!0,capture:!0})})),i.hooks.destroy.tap(e.tag,(function(){var e=r.context.contextService.getDomElement();n.globalThis.navigator.msPointerEnabled?(e.style.msContentZooming="",e.style.msTouchAction=""):s.supportsPointerEvents&&(e.style.touchAction=""),s.supportsPointerEvents?function(e){n.globalThis.document.removeEventListener("pointermove",l,!0),e.removeEventListener("pointerdown",c,!0),e.removeEventListener("pointerleave",d,!0),e.removeEventListener("pointerover",h,!0),n.globalThis.removeEventListener("pointerup",u,!0),n.globalThis.removeEventListener("pointercancel",f,!0)}(e):function(e){n.globalThis.document.removeEventListener("mousemove",l,!0),e.removeEventListener("mousedown",c,!0),e.removeEventListener("mouseout",d,!0),e.removeEventListener("mouseover",h,!0),n.globalThis.removeEventListener("mouseup",u,!0)}(e),s.supportsTouchEvents&&function(e){e.removeEventListener("touchstart",c,!0),e.removeEventListener("touchend",u,!0),e.removeEventListener("touchmove",l,!0),e.removeEventListener("touchcancel",f,!0)}(e),o.useNativeClickEvent&&e.removeEventListener("click",p,!0),e.removeEventListener("wheel",v,!0)}))}}])}();Ud.tag="DOMInteraction";var Zd=function(){function e(){(0,o.Z)(this,e)}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=t.renderingService,r=t.contextService,i=t.config,a=r.getDomElement(),o=function(e){n.hooks.pointerDown.call(e)},s=function(e){n.hooks.pointerUp.call(e)},l=function(e){n.hooks.pointerMove.call(e)},u=function(e){n.hooks.pointerOver.call(e)},c=function(e){n.hooks.pointerOut.call(e)},h=function(e){n.hooks.click.call(e)},d=function(e){n.hooks.pointerCancel.call(e)};n.hooks.init.tap(e.tag,(function(){a.addEventListener("touchstart",o,!0),a.addEventListener("touchend",s,!0),a.addEventListener("touchmove",l,!0),a.addEventListener("touchcancel",d,!0),a.addEventListener("mouseout",c,!0),a.addEventListener("mouseover",u,!0),i.useNativeClickEvent&&a.addEventListener("click",h,!0)})),n.hooks.destroy.tap(e.tag,(function(){a.removeEventListener("touchstart",o,!0),a.removeEventListener("touchend",s,!0),a.removeEventListener("touchmove",l,!0),a.removeEventListener("touchcancel",d,!0),a.removeEventListener("mouseout",c,!0),a.removeEventListener("mouseover",u,!0),i.useNativeClickEvent&&a.removeEventListener("click",h,!0)}))}}])}();Zd.tag="MobileInteraction";function Gd(e,t){if(!{}.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Vd=0;function Wd(e){return"__private_"+Vd+++"_"+e}var Hd=n(88164),Xd=Wd("renderState"),zd=function(){function e(t){(0,o.Z)(this,e),this.renderQueue=[],Object.defineProperty(this,Xd,{writable:!0,value:{restoreStack:[],prevObject:null,currentContext:new Map}}),this.clearFullScreenLastFrame=!1,this.clearFullScreen=!1,this.vpMatrix=p.create(),this.dprMatrix=p.create(),this.tmpMat4=p.create(),this.vec3a=f.create(),this.vec3b=f.create(),this.vec3c=f.create(),this.vec3d=f.create(),this.canvasRendererPluginOptions=t}return(0,a.Z)(e,[{key:"apply",value:function(t,n){var r=this;this.context=t;var i=this.context,a=i.config,o=i.camera,s=i.renderingService,l=i.renderingContext,u=i.pathGeneratorFactory,c=a.renderer.getConfig().enableRenderingOptimization;a.renderer.getConfig().enableDirtyCheck=!1,a.renderer.getConfig().enableDirtyRectangleRendering=!1,this.pathGeneratorFactory=u;var d=t.contextService,v=l.root.ownerDocument.defaultView;s.hooks.init.tap(e.tag,(function(){var e=d.getDPR(),t=a.width,n=a.height,i=d.getContext();r.clearRect(i,0,0,t*e,n*e,a.background)})),s.hooks.destroy.tap(e.tag,(function(){r.renderQueue=[],Gd(r,Xd)[Xd]={restoreStack:[],prevObject:null,currentContext:null}}));var g=function(e,t){for(var i=[e];i.length>0;){var a,o=i.pop();o.isVisible()&&!o.isCulled()&&(c?r.renderDisplayObjectOptimized(o,t,r.context,Gd(r,Xd)[Xd],n):r.renderDisplayObject(o,t,r.context,Gd(r,Xd)[Xd],n));for(var s=(null===(a=o.sortable)||void 0===a||null===(a=a.sorted)||void 0===a?void 0:a.length)>0?o.sortable.sorted:o.childNodes,l=s.length-1;l>=0;l--)i.push(s[l])}};s.hooks.endFrame.tap(e.tag,(function(){if(function(){var e,t=d.getContext(),n=d.getDPR(),i=a.width,o=a.height,l=r.canvasRendererPluginOptions,u=l.dirtyObjectNumThreshold,c=l.dirtyObjectRatioThreshold,h=s.getStats(),f=h.total,p=h.rendered,g=p/f;r.clearFullScreen=r.clearFullScreenLastFrame||!(null!==(e=v.context.renderingPlugins[1])&&void 0!==e&&e.isFirstTimeRenderingFinished)||s.disableDirtyRectangleRendering()||p>u&&g>c,t&&("function"==typeof t.resetTransform?t.resetTransform():t.setTransform(1,0,0,1,0,0),r.clearFullScreen&&r.clearRect(t,0,0,i*n,o*n,a.background))}(),0!==l.root.childNodes.length){c=a.renderer.getConfig().enableRenderingOptimization,Gd(r,Xd)[Xd]={restoreStack:[],prevObject:null,currentContext:Gd(r,Xd)[Xd].currentContext},Gd(r,Xd)[Xd].currentContext.clear(),r.clearFullScreenLastFrame=!1;var e=d.getContext(),t=d.getDPR();if(p.fromScaling(r.dprMatrix,[t,t,1]),p.multiply(r.vpMatrix,r.dprMatrix,o.getOrthoMatrix()),r.clearFullScreen)c?(e.save(),g(l.root,e),e.restore()):g(l.root,e);else{var i=r.safeMergeAABB(r.mergeDirtyAABBs(r.renderQueue));if(Yo.isEmpty(i))return void(r.renderQueue=[]);var u=r.convertAABB2Rect(i),m=u.x,y=u.y,E=u.width,_=u.height,T=f.transformMat4(r.vec3a,[m,y,0],r.vpMatrix),S=f.transformMat4(r.vec3b,[m+E,y,0],r.vpMatrix),R=f.transformMat4(r.vec3c,[m,y+_,0],r.vpMatrix),A=f.transformMat4(r.vec3d,[m+E,y+_,0],r.vpMatrix),x=Math.min(T[0],S[0],A[0],R[0]),k=Math.min(T[1],S[1],A[1],R[1]),N=Math.max(T[0],S[0],A[0],R[0]),M=Math.max(T[1],S[1],A[1],R[1]),C=Math.floor(x),b=Math.floor(k),P=Math.ceil(N-x),O=Math.ceil(M-k);e.save(),r.clearRect(e,C,b,P,O,a.background),e.beginPath(),e.rect(C,b,P,O),e.clip(),e.setTransform(r.vpMatrix[0],r.vpMatrix[1],r.vpMatrix[4],r.vpMatrix[5],r.vpMatrix[12],r.vpMatrix[13]),a.renderer.getConfig().enableDirtyRectangleRenderingDebug&&v.dispatchEvent(new dh(Cd.DIRTY_RECTANGLE,{dirtyRect:{x:C,y:b,width:P,height:O}}));var I=i.getMin(),w=(0,h.Z)(I,2),L=w[0],D=w[1],B=i.getMax(),F=(0,h.Z)(B,2),U=F[0],Z=F[1];l.root.ownerDocument.elementsFromBBox(L,D,U,Z).sort((function(e,t){return e.sortable.renderOrder-t.sortable.renderOrder})).forEach((function(t){t&&t.isVisible()&&!t.isCulled()&&r.renderDisplayObject(t,e,r.context,Gd(r,Xd)[Xd],n)})),e.restore(),r.renderQueue.forEach((function(e){r.saveDirtyAABB(e)})),r.renderQueue=[]}Gd(r,Xd)[Xd].restoreStack.forEach((function(){e.restore()})),Gd(r,Xd)[Xd].restoreStack=[]}else r.clearFullScreenLastFrame=!0})),s.hooks.render.tap(e.tag,(function(e){r.clearFullScreen||r.renderQueue.push(e)}))}},{key:"clearRect",value:function(e,t,n,r,i,a){e.clearRect(t,n,r,i),a&&(e.fillStyle=a,e.fillRect(t,n,r,i))}},{key:"renderDisplayObjectOptimized",value:function(e,t,n,r,i){var a=e.nodeName,o=!1,s=this.context.styleRendererFactory[a],l=this.pathGeneratorFactory[a],u=e.parsedStyle.clipPath;if(u){(!r.prevObject||!p.exactEquals(u.getWorldTransform(),r.prevObject.getWorldTransform()))&&(this.applyWorldTransform(t,u),r.prevObject=null);var c=this.pathGeneratorFactory[u.nodeName];c&&(t.save(),o=!0,t.beginPath(),c(t,u.parsedStyle),t.closePath(),t.clip())}if(s){(!r.prevObject||!p.exactEquals(e.getWorldTransform(),r.prevObject.getWorldTransform()))&&this.applyWorldTransform(t,e);var h=!r.prevObject;if(!h){var d=r.prevObject.nodeName;h=a===Fo.TEXT?d!==Fo.TEXT:a===Fo.IMAGE?d!==Fo.IMAGE:d===Fo.TEXT||d===Fo.IMAGE}s.applyStyleToContext(t,e,h,r),r.prevObject=e}l&&(t.beginPath(),l(t,e.parsedStyle),a!==Fo.LINE&&a!==Fo.PATH&&a!==Fo.POLYLINE&&t.closePath()),s&&s.drawToContext(t,e,Gd(this,Xd)[Xd],this,i),o&&t.restore(),e.dirty(!1)}},{key:"renderDisplayObject",value:function(e,t,n,r,i){var a=e.nodeName,o=r.restoreStack[r.restoreStack.length-1];!o||e.compareDocumentPosition(o)&vh.DOCUMENT_POSITION_CONTAINS||(t.restore(),r.restoreStack.pop());var s=this.context.styleRendererFactory[a],l=this.pathGeneratorFactory[a],u=e.parsedStyle.clipPath;if(u){this.applyWorldTransform(t,u);var c=this.pathGeneratorFactory[u.nodeName];c&&(t.save(),r.restoreStack.push(e),t.beginPath(),c(t,u.parsedStyle),t.closePath(),t.clip())}s&&(this.applyWorldTransform(t,e),t.save(),this.applyAttributesToContext(t,e)),l&&(t.beginPath(),l(t,e.parsedStyle),a!==Fo.LINE&&a!==Fo.PATH&&a!==Fo.POLYLINE&&t.closePath()),s&&(s.render(t,e.parsedStyle,e,n,this,i),t.restore()),e.dirty(!1)}},{key:"applyAttributesToContext",value:function(e,t){var n=t.parsedStyle,r=n.stroke,i=n.fill,a=n.opacity,o=n.lineDash,s=n.lineDashOffset;o&&e.setLineDash(o),(0,T.Z)(s)||(e.lineDashOffset=s),(0,T.Z)(a)||(e.globalAlpha*=a),(0,T.Z)(r)||Array.isArray(r)||r.isNone||(e.strokeStyle=t.attributes.stroke),(0,T.Z)(i)||Array.isArray(i)||i.isNone||(e.fillStyle=t.attributes.fill)}},{key:"convertAABB2Rect",value:function(e){var t=e.getMin(),n=e.getMax(),r=Math.floor(t[0]),i=Math.floor(t[1]);return{x:r,y:i,width:Math.ceil(n[0])-r,height:Math.ceil(n[1])-i}}},{key:"mergeDirtyAABBs",value:function(e){var t=new Yo;return e.forEach((function(e){var n=e.getRenderBounds();t.add(n);var r=e.renderable.dirtyRenderBounds;r&&t.add(r)})),t}},{key:"saveDirtyAABB",value:function(e){var t=e.renderable;t.dirtyRenderBounds||(t.dirtyRenderBounds=new Yo);var n=e.getRenderBounds();n&&t.dirtyRenderBounds.update(n.center,n.halfExtents)}},{key:"applyWorldTransform",value:function(e,t,n){n?(p.copy(this.tmpMat4,t.getLocalTransform()),p.multiply(this.tmpMat4,n,this.tmpMat4),p.multiply(this.tmpMat4,this.vpMatrix,this.tmpMat4)):(p.copy(this.tmpMat4,t.getWorldTransform()),p.multiply(this.tmpMat4,this.vpMatrix,this.tmpMat4)),e.setTransform(this.tmpMat4[0],this.tmpMat4[1],this.tmpMat4[4],this.tmpMat4[5],this.tmpMat4[12],this.tmpMat4[13])}},{key:"safeMergeAABB",value:function(){for(var e=new Yo,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){e.add(t)})),e}}])}();function Yd(e,t,n,r,i,a,o){var s,l;if("rect"===e.image.nodeName){var u=e.image.parsedStyle,c=u.width,h=u.height;l=r.contextService.getDPR();var d=r.config.offscreenCanvas;(s=a.offscreenCanvasCreator.getOrCreateCanvas(d)).width=c*l,s.height=h*l;var f=a.offscreenCanvasCreator.getOrCreateContext(d),v={restoreStack:[],prevObject:null,currentContext:new Map};e.image.forEach((function(e){i.renderDisplayObject(e,f,r,v,a)})),v.restoreStack.forEach((function(){f.restore()}))}return o.getOrCreatePatternSync(t,e,n,s,l,t.getGeometryBounds().min,(function(){t.dirty(),r.renderingService.dirty()}))}function jd(e,t,n,r){var i;if(e.type===Tl.LinearGradient||e.type===Tl.RadialGradient){var a=t.getGeometryBounds(),o=a&&2*a.halfExtents[0]||1,s=a&&2*a.halfExtents[1]||1,l=a&&a.min||[0,0];i=r.getOrCreateGradient((0,u.Z)((0,u.Z)({type:e.type},e.value),{},{min:l,width:o,height:s}),n)}return i}zd.tag="CanvasRenderer";var Kd=["shadowBlur","shadowOffsetX","shadowOffsetY"],qd=["lineCap","lineJoin","miterLimit"],$d={globalAlpha:1,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"#000",filter:"none",globalCompositeOperation:"source-over",strokeStyle:"#000",strokeOpacity:1,lineWidth:1,lineDash:[],lineDashOffset:0,lineCap:"butt",lineJoin:"miter",miterLimit:10,fillStyle:"#000",fillOpacity:1},Qd={};function Jd(e,t,n,r){var i=r.has(t)?r.get(t):$d[t];return i!==n&&("lineDash"===t?e.setLineDash(n):e[t]=n,r.set(t,n)),i}var ef=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.imagePool=t}),[{key:"applyAttributesToContext",value:function(e,t){}},{key:"render",value:function(e,t,n,r,i,a){}},{key:"applyCommonStyleToContext",value:function(e,t,n,r){var i=n?Qd:r.prevObject.parsedStyle,a=t.parsedStyle;(n||a.opacity!==i.opacity)&&Jd(e,"globalAlpha",(0,T.Z)(a.opacity)?$d.globalAlpha:a.opacity,r.currentContext),(n||a.blend!==i.blend)&&Jd(e,"globalCompositeOperation",(0,T.Z)(a.blend)?$d.globalCompositeOperation:a.blend,r.currentContext)}},{key:"applyStrokeFillStyleToContext",value:function(e,t,n,r){var i=n?Qd:r.prevObject.parsedStyle,a=t.parsedStyle,o=a.lineWidth,s=void 0===o?$d.lineWidth:o,l=a.fill&&!a.fill.isNone;if(a.stroke&&!a.stroke.isNone&&s>0){if(n||t.attributes.stroke!==r.prevObject.attributes.stroke)Jd(e,"strokeStyle",(0,T.Z)(a.stroke)||Array.isArray(a.stroke)||a.stroke.isNone?$d.strokeStyle:t.attributes.stroke,r.currentContext);(n||a.lineWidth!==i.lineWidth)&&Jd(e,"lineWidth",(0,T.Z)(a.lineWidth)?$d.lineWidth:a.lineWidth,r.currentContext),(n||a.lineDash!==i.lineDash)&&Jd(e,"lineDash",a.lineDash||$d.lineDash,r.currentContext),(n||a.lineDashOffset!==i.lineDashOffset)&&Jd(e,"lineDashOffset",(0,T.Z)(a.lineDashOffset)?$d.lineDashOffset:a.lineDashOffset,r.currentContext);for(var u=0;u<qd.length;u++){var c=qd[u];(n||a[c]!==i[c])&&Jd(e,c,(0,T.Z)(a[c])?$d[c]:a[c],r.currentContext)}}l&&(n||t.attributes.fill!==r.prevObject.attributes.fill)&&Jd(e,"fillStyle",(0,T.Z)(a.fill)||Array.isArray(a.fill)||a.fill.isNone?$d.fillStyle:t.attributes.fill,r.currentContext)}},{key:"applyStyleToContext",value:function(e,t,n,r){var i=t.nodeName;this.applyCommonStyleToContext(e,t,n,r),i===Fo.IMAGE||this.applyStrokeFillStyleToContext(e,t,n,r)}},{key:"applyShadowAndFilterStyleToContext",value:function(e,t,n,r){var i=t.parsedStyle;if(n){Jd(e,"shadowColor",i.shadowColor.toString(),r.currentContext);for(var a=0;a<Kd.length;a++){var o=Kd[a];Jd(e,o,i[o]||$d[o],r.currentContext)}}i.filter&&i.filter.length&&Jd(e,"filter",t.attributes.filter,r.currentContext)}},{key:"clearShadowAndFilterStyleForContext",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(t){Jd(e,"shadowColor",$d.shadowColor,r.currentContext);for(var a=0;a<Kd.length;a++){var o=Kd[a];Jd(e,o,$d[o],r.currentContext)}}if(n)if(t&&i){var s=e.filter;!(0,T.Z)(s)&&s.indexOf("drop-shadow")>-1&&Jd(e,"filter",s.replace(/drop-shadow\([^)]*\)/,"").trim()||$d.filter,r.currentContext)}else Jd(e,"filter",$d.filter,r.currentContext)}},{key:"fillToContext",value:function(e,t,n,r,i){var a=this,o=t.parsedStyle,s=o.fill,l=o.fillRule,u=null;if(Array.isArray(s)&&s.length>0)s.forEach((function(r){var i=Jd(e,"fillStyle",jd(r,t,e,a.imagePool),n.currentContext);u=null!=u?u:i,l?e.fill(l):e.fill()}));else{if(Xl(s)){var c=Yd(s,t,e,t.ownerDocument.defaultView.context,r,i,this.imagePool);c&&(e.fillStyle=c,u=!0)}l?e.fill(l):e.fill()}null!==u&&Jd(e,"fillStyle",u,n.currentContext)}},{key:"strokeToContext",value:function(e,t,n,r,i){var a=this,o=t.parsedStyle.stroke,s=null;if(Array.isArray(o)&&o.length>0)o.forEach((function(r){var i=Jd(e,"strokeStyle",jd(r,t,e,a.imagePool),n.currentContext);s=null!=s?s:i,e.stroke()}));else{if(Xl(o)){var l=Yd(o,t,e,t.ownerDocument.defaultView.context,r,i,this.imagePool);if(l){var u=Jd(e,"strokeStyle",l,n.currentContext);s=null!=s?s:u}}e.stroke()}null!==s&&Jd(e,"strokeStyle",s,n.currentContext)}},{key:"drawToContext",value:function(e,t,n,r,i){var a,o=t.nodeName,s=t.parsedStyle,l=s.opacity,u=void 0===l?$d.globalAlpha:l,c=s.fillOpacity,h=void 0===c?$d.fillOpacity:c,d=s.strokeOpacity,f=void 0===d?$d.strokeOpacity:d,v=s.lineWidth,p=void 0===v?$d.lineWidth:v,g=s.fill&&!s.fill.isNone,m=s.stroke&&!s.stroke.isNone&&p>0;if(g||m){var y=!(0,T.Z)(s.shadowColor)&&s.shadowBlur>0,E="inner"===s.shadowType,_=0===(null===(a=s.fill)||void 0===a?void 0:a.alpha),S=!(!s.filter||!s.filter.length),R=y&&m&&(o===Fo.PATH||o===Fo.LINE||o===Fo.POLYLINE||_||E),A=null;if(g)R||this.applyShadowAndFilterStyleToContext(e,t,y,n),A=Jd(e,"globalAlpha",u*h,n.currentContext),this.fillToContext(e,t,n,r,i),R||this.clearShadowAndFilterStyleForContext(e,y,S,n);if(m){var x=!1,k=Jd(e,"globalAlpha",u*f,n.currentContext);if(A=g?A:k,R&&(this.applyShadowAndFilterStyleToContext(e,t,y,n),x=!0,E)){var N=e.globalCompositeOperation;e.globalCompositeOperation="source-atop",this.strokeToContext(e,t,n,r,i),e.globalCompositeOperation=N,this.clearShadowAndFilterStyleForContext(e,y,S,n,!0)}this.strokeToContext(e,t,n,r,i),x&&this.clearShadowAndFilterStyleForContext(e,y,S,n)}null!==A&&Jd(e,"globalAlpha",A,n.currentContext)}}}])}(),tf=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"render",value:function(e,t,n,r,i,a){var o=t.fill,s=t.fillRule,l=t.opacity,u=void 0===l?1:l,c=t.fillOpacity,h=void 0===c?1:c,d=t.stroke,f=t.strokeOpacity,v=void 0===f?1:f,p=t.lineWidth,g=void 0===p?1:p,m=t.lineCap,y=t.lineJoin,E=t.shadowType,_=t.shadowColor,S=t.shadowBlur,R=t.filter,A=t.miterLimit,x=o&&!o.isNone,k=d&&!d.isNone&&g>0,N=0===(null==o?void 0:o.alpha),M=!(!R||!R.length),C=!(0,T.Z)(_)&&S>0,b=n.nodeName,P="inner"===E,O=k&&C&&(b===Fo.PATH||b===Fo.LINE||b===Fo.POLYLINE||N||P);x&&(e.globalAlpha=u*h,O||nf(n,e,C),rf(e,n,o,s,r,i,a,this.imagePool),O||this.clearShadowAndFilter(e,M,C)),k&&(e.globalAlpha=u*v,e.lineWidth=g,(0,T.Z)(A)||(e.miterLimit=A),(0,T.Z)(m)||(e.lineCap=m),(0,T.Z)(y)||(e.lineJoin=y),O&&(P&&(e.globalCompositeOperation="source-atop"),nf(n,e,!0),P&&(af(e,n,d,r,i,a,this.imagePool),e.globalCompositeOperation=$d.globalCompositeOperation,this.clearShadowAndFilter(e,M,!0))),af(e,n,d,r,i,a,this.imagePool))}},{key:"clearShadowAndFilter",value:function(e,t,n){if(n&&(e.shadowColor="transparent",e.shadowBlur=0),t){var r=e.filter;!(0,T.Z)(r)&&r.indexOf("drop-shadow")>-1&&(e.filter=r.replace(/drop-shadow\([^)]*\)/,"").trim()||"none")}}}])}(ef);function nf(e,t,n){var r=e.parsedStyle,i=r.filter,a=r.shadowColor,o=r.shadowBlur,s=r.shadowOffsetX,l=r.shadowOffsetY;i&&i.length&&(t.filter=e.style.filter),n&&(t.shadowColor=a.toString(),t.shadowBlur=o||0,t.shadowOffsetX=s||0,t.shadowOffsetY=l||0)}function rf(e,t,n,r,i,a,o,s){var l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];Array.isArray(n)?n.forEach((function(n){e.fillStyle=jd(n,t,e,s),l||(r?e.fill(r):e.fill())})):(Xl(n)&&(e.fillStyle=Yd(n,t,e,i,a,o,s)),l||(r?e.fill(r):e.fill()))}function af(e,t,n,r,i,a,o){var s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Array.isArray(n)?n.forEach((function(n){e.strokeStyle=jd(n,t,e,o),s||e.stroke()})):(Xl(n)&&(e.strokeStyle=Yd(n,t,e,r,i,a,o)),s||e.stroke())}var of=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"renderDownSampled",value:function(e,t,n,r){var i=r.src,a=r.imageCache;a.downSampled?e.drawImage(a.downSampled,Math.floor(r.drawRect[0]),Math.floor(r.drawRect[1]),Math.ceil(r.drawRect[2]),Math.ceil(r.drawRect[3])):this.imagePool.createDownSampledImage(i,n).then((function(){n.ownerDocument&&(n.dirty(),n.ownerDocument.defaultView.context.renderingService.dirty())})).catch((function(e){console.error(e)}))}},{key:"renderTile",value:function(e,t,n,r){var i=r.src,a=r.imageCache,o=r.imageRect,s=r.drawRect,l=a.size,u=e.getTransform(),c=u.a,h=u.b,d=u.c,f=u.d,v=u.e,p=u.f;if(e.resetTransform(),null!=a&&a.gridSize){for(var g=[l[0]/o[2],l[1]/o[3]],m=[a.tileSize[0]/g[0],a.tileSize[1]/g[1]],y=[Math.floor((s[0]-o[0])/m[0]),Math.ceil((s[0]+s[2]-o[0])/m[0])],E=y[0],_=y[1],T=[Math.floor((s[1]-o[1])/m[1]),Math.ceil((s[1]+s[3]-o[1])/m[1])],S=T[1],R=T[0];R<=S;R++)for(var A=E;A<=_;A++){var x=a.tiles[R][A];if(x){var k=[Math.floor(o[0]+x.tileX*m[0]),Math.floor(o[1]+x.tileY*m[1]),Math.ceil(m[0]),Math.ceil(m[1])];e.drawImage(x.data,k[0],k[1],k[2],k[3])}}e.setTransform(c,h,d,f,v,p)}else this.imagePool.createImageTiles(i,[],(function(){n.ownerDocument&&(n.dirty(),n.ownerDocument.defaultView.context.renderingService.dirty())}),n).catch((function(e){console.error(e)}))}},{key:"render",value:function(e,n,r){var i=n.x,a=void 0===i?0:i,o=n.y,s=void 0===o?0:o,l=n.width,u=n.height,c=n.src,d=n.shadowColor,v=n.shadowBlur,g=this.imagePool.getImageSync(c,r),m=null==g?void 0:g.img,y=l,E=u;if(m){var _,S,R,A,x,k,N,M,C,b,P,O,I,w,L,D,B,F,U,Z,G,V;y||(y=m.width),E||(E=m.height),nf(r,e,!(0,T.Z)(d)&&v>0);try{var W=r.ownerDocument.defaultView.getContextService().getDomElement(),H=W.width,X=W.height,z=e.getTransform(),Y=z.a,j=z.b,K=z.c,q=z.d,$=z.e,Q=z.f,J=p.fromValues(Y,K,0,0,j,q,0,0,0,0,1,0,$,Q,0,1),ee=(B=[a,s,y,E],F=J,U=f.transformMat4(f.create(),[B[0],B[1],0],F),Z=f.transformMat4(f.create(),[B[0]+B[2],B[1],0],F),G=f.transformMat4(f.create(),[B[0],B[1]+B[3],0],F),V=f.transformMat4(f.create(),[B[0]+B[2],B[1]+B[3],0],F),[Math.min(U[0],Z[0],G[0],V[0]),Math.min(U[1],Z[1],G[1],V[1]),Math.max(U[0],Z[0],G[0],V[0])-Math.min(U[0],Z[0],G[0],V[0]),Math.max(U[1],Z[1],G[1],V[1])-Math.min(U[1],Z[1],G[1],V[1])]),te=(_=[0,0,H,X],S=ee,R=(0,h.Z)(_,4),A=R[0],x=R[1],k=R[2],N=R[3],M=(0,h.Z)(S,4),C=M[0],b=M[1],P=M[2],O=M[3],I=Math.max(A,C),w=Math.max(x,b),L=Math.min(A+k,C+P),D=Math.min(x+N,b+O),L<=I||D<=w?null:[I,w,L-I,D-w]);if(!te)return;if(!r.ownerDocument.defaultView.getConfig().enableLargeImageOptimization)return void t.renderFull(e,n,r,{image:m,drawRect:[a,s,y,E]});if(ee[2]/g.size[0]<(g.downSamplingRate||.5))return void this.renderDownSampled(e,n,r,{src:c,imageCache:g,drawRect:[a,s,y,E]});if(!ImagePool.isSupportTile)return void t.renderFull(e,n,r,{image:m,drawRect:[a,s,y,E]});this.renderTile(e,n,r,{src:c,imageCache:g,imageRect:ee,drawRect:te})}catch(e){}}}},{key:"drawToContext",value:function(e,t,n,r,i){this.render(e,t.parsedStyle,t)}}],[{key:"renderFull",value:function(e,t,n,r){e.drawImage(r.image,Math.floor(r.drawRect[0]),Math.floor(r.drawRect[1]),Math.ceil(r.drawRect[2]),Math.ceil(r.drawRect[3]))}}])}(tf),sf=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"render",value:function(e,t,n,r,i,a){n.getBounds();var o=t.lineWidth,s=void 0===o?1:o,l=t.textAlign,u=void 0===l?"start":l,c=t.textBaseline,h=void 0===c?"alphabetic":c,d=t.lineJoin,f=void 0===d?"miter":d,v=t.miterLimit,p=void 0===v?10:v,g=t.letterSpacing,m=void 0===g?0:g,y=t.stroke,E=t.fill,_=t.fillRule,S=t.fillOpacity,R=void 0===S?1:S,A=t.strokeOpacity,x=void 0===A?1:A,k=t.opacity,N=void 0===k?1:k,M=t.metrics,C=t.x,b=void 0===C?0:C,P=t.y,O=void 0===P?0:P,I=t.dx,w=t.dy,L=t.shadowColor,D=t.shadowBlur,B=t.textDecorationLine,F=M.font,U=M.lines,Z=M.height,G=M.lineHeight,V=M.lineMetrics;e.font=F,e.lineWidth=s,e.textAlign="middle"===u?"center":u;var W=h;"alphabetic"===W&&(W="bottom"),e.lineJoin=f,(0,T.Z)(p)||(e.miterLimit=p);var H=O;"middle"===h?H+=-Z/2-G/2:"bottom"===h||"alphabetic"===h||"ideographic"===h?H+=-Z:"top"!==h&&"hanging"!==h||(H+=-G);var X=b+(I||0);H+=w||0,1===U.length&&("bottom"===W?(W="middle",H-=.5*Z):"top"===W&&(W="middle",H+=.5*Z)),e.textBaseline=W,nf(n,e,!(0,T.Z)(L)&&D>0);for(var z=0;z<U.length;z++){var Y=s/2+X;H+=G,(0,T.Z)(y)||y.isNone||!s||this.drawLetterSpacing(e,n,U[z],V[z],u,Y,H,m,E,_,R,y,x,N,!0,r,i,a),(0,T.Z)(E)||this.drawLetterSpacing(e,n,U[z],V[z],u,Y,H,m,E,_,R,y,x,N,!1,r,i,a)}B&&"none"!==B&&this.drawTextDecorations(e,t,n,U,G,X,O+(w||0),r,i,a)}},{key:"drawLetterSpacing",value:function(e,t,n,r,i,a,o,s,l,u,c,h,d,f,v,p,g,m){if(0!==s){var y=e.textAlign;e.textAlign="left";var E=a;"center"===i||"middle"===i?E=a-r.width/2:"right"!==i&&"end"!==i||(E=a-r.width);for(var _=Array.from(n),T=e.measureText(n).width,S=0,R=0;R<_.length;++R){var A=_[R];v?this.strokeText(e,t,A,E,o,h,d,p,g,m):this.fillText(e,t,A,E,o,l,u,c,f,p,g,m),E+=T-(S=e.measureText(n.substring(R+1)).width)+s,T=S}e.textAlign=y}else v?this.strokeText(e,t,n,a,o,h,d,p,g,m):this.fillText(e,t,n,a,o,l,u,c,f,p,g,m)}},{key:"fillText",value:function(e,t,n,r,i,a,o,s,l,u,c,h){var d;rf(e,t,a,o,u,c,h,this.imagePool,!0);var f=!(0,T.Z)(s)&&1!==s;f&&(d=e.globalAlpha,e.globalAlpha=s*l),e.fillText(n,r,i),f&&(e.globalAlpha=d)}},{key:"strokeText",value:function(e,t,n,r,i,a,o,s,l,u){var c;af(e,t,a,s,l,u,this.imagePool,!0);var h=!(0,T.Z)(o)&&1!==o;h&&(c=e.globalAlpha,e.globalAlpha=o),e.strokeText(n,r,i),h&&(e.globalAlpha=c)}},{key:"drawTextDecorations",value:function(e,t,n,r,i,a,o,s,l,u){var c=t.textDecorationLine,h=t.textDecorationColor,d=t.textDecorationStyle,f=t.textDecorationThickness,v=void 0===f?1:f,p=t.textAlign,g=void 0===p?"start":p,m=t.lineWidth,y=void 0===m?1:m,E=t.metrics;if(c&&"none"!==c){var _=E.lineMetrics,T=c.split(" ");switch(e.lineWidth=v,h&&(e.strokeStyle="rgba(".concat(h.r,", ").concat(h.g,", ").concat(h.b,", ").concat(h.alpha,")")),d){case"dashed":e.setLineDash([5,5]);break;case"dotted":e.setLineDash([2,2]);break;default:e.setLineDash([])}var S=o,R=t.textBaseline,A=void 0===R?"alphabetic":R;"middle"===A?S+=-E.height/2-i/2:"bottom"===A||"alphabetic"===A||"ideographic"===A?S+=-E.height:"top"!==A&&"hanging"!==A||(S+=-i);for(var x=0;x<r.length;x++){S+=i;var k=_[x];if(k){var N=y/2,M=a,C=a+k.width;"center"===g||"middle"===g?(M=a-k.width/2,C=a+k.width/2):"right"!==g&&"end"!==g||(M=a-k.width,C=a),M+=N,C+=N;var b,P=(0,se.Z)(T);try{for(P.s();!(b=P.n()).done;){var O=b.value,I=S;switch(O){case"underline":I+=2;break;case"overline":I-=i-2;break;case"line-through":I-=i/2;break;default:continue}"wavy"===d?this.drawWavyLine(e,M,C,I):(e.beginPath(),e.moveTo(M,I),e.lineTo(C,I),e.stroke())}}catch(e){P.e(e)}finally{P.f()}}}e.setLineDash([])}}},{key:"drawWavyLine",value:function(e,t,n,r){var i=10,a=Math.floor((n-t)/i);e.beginPath(),e.moveTo(t,r);for(var o=0;o<a;o++){var s=t+o*i+2.5,l=r+2,u=t+o*i+5,c=r;e.quadraticCurveTo(s,l,u,c);var h=t+o*i+7.5,d=r-2,f=t+(o+1)*i,v=r;e.quadraticCurveTo(h,d,f,v)}e.stroke()}},{key:"drawToContext",value:function(e,t,n,r,i){this.render(e,t.parsedStyle,t,t.ownerDocument.defaultView.context,r,i)}}])}(tf),lf=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(e=(0,s.Z)(this,t)).name="canvas-renderer",e.options=n,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){var e,t=(0,u.Z)({dirtyObjectNumThreshold:500,dirtyObjectRatioThreshold:.8},this.options),n=this.context.imagePool,r=new tf(n),i=(e={},(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(e,Fo.CIRCLE,r),Fo.ELLIPSE,r),Fo.RECT,r),Fo.IMAGE,new of(n)),Fo.TEXT,new sf(n)),Fo.LINE,r),Fo.POLYLINE,r),Fo.POLYGON,r),Fo.PATH,r),Fo.GROUP,void 0),(0,V.Z)((0,V.Z)((0,V.Z)(e,Fo.HTML,void 0),Fo.MESH,void 0),Fo.FRAGMENT,void 0));this.context.defaultStyleRendererFactory=i,this.context.styleRendererFactory=i,this.addRenderingPlugin(new zd(t))}},{key:"destroy",value:function(){this.removeAllRenderingPlugins(),delete this.context.defaultStyleRendererFactory,delete this.context.styleRendererFactory}}])}(Zo),uf=Object.freeze({__proto__:null,CircleRenderer:tf,DefaultRenderer:tf,EllipseRenderer:tf,ImageRenderer:of,LineRenderer:tf,PathRenderer:tf,Plugin:lf,PolygonRenderer:tf,PolylineRenderer:tf,RectRenderer:tf,TextRenderer:sf}),cf=f.create(),hf=f.create(),df=f.create(),ff=p.create(),vf=function(){function e(){var t=this;(0,o.Z)(this,e),this.isHit=function(e,n,r,i){var a=t.context.pointInPathPickerFactory[e.nodeName];if(a){var o=p.invert(ff,r),s=f.transformMat4(hf,f.set(df,n[0],n[1],0),o);if(a(e,new qo(s[0],s[1]),i,t.isPointInPath,t.context,t.runtime))return!0}return!1},this.isPointInPath=function(e,n){var r=t.runtime.offscreenCanvasCreator.getOrCreateContext(t.context.config.offscreenCanvas),i=t.context.pathGeneratorFactory[e.nodeName];return i&&(r.beginPath(),i(r,e.parsedStyle),r.closePath()),r.isPointInPath(n.x,n.y)}}return(0,a.Z)(e,[{key:"apply",value:function(t,n){var r,i=this,a=t.renderingService,o=t.renderingContext;this.context=t,this.runtime=n;var s=null===(r=o.root)||void 0===r?void 0:r.ownerDocument;a.hooks.pick.tapPromise(e.tag,function(){var e=(0,oe.Z)((0,ae.Z)().mark((function e(t){return(0,ae.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.pick(s,t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.hooks.pickSync.tap(e.tag,(function(e){return i.pick(s,e)}))}},{key:"pick",value:function(e,t){var n,r=t.topmost,i=t.position,a=i.x,o=i.y,s=f.set(cf,a,o,0),l=e.elementsFromBBox(s[0],s[1],s[0],s[1]),u=[],c=(0,se.Z)(l);try{for(c.s();!(n=c.n()).done;){var h=n.value,d=h.getWorldTransform();if(this.isHit(h,s,d,!1)){var v=Tc(h);if(v){var p=v.parsedStyle.clipPath;if(this.isHit(p,s,p.getWorldTransform(),!0)){if(r)return t.picked=[h],t;u.push(h)}}else{if(r)return t.picked=[h],t;u.push(h)}}}}catch(e){c.e(e)}finally{c.f()}return t.picked=u,t}}])}();function pf(e,t,n){var r=e.parsedStyle,i=r.cx,a=void 0===i?0:i,o=r.cy,s=void 0===o?0:o,l=r.r,u=r.fill,c=r.stroke,d=r.lineWidth,f=void 0===d?1:d,v=r.increasedLineWidthForHitTesting,p=void 0===v?0:v,g=r.pointerEvents,m=void 0===g?"auto":g,y=(f+p)/2,E=_o(a,s,t.x,t.y),_=xc(m,u,c),T=(0,h.Z)(_,2),S=T[0],R=T[1];return S&&R||n?E<=l+y:S?E<=l:!!R&&(E>=l-y&&E<=l+y)}function gf(e,t,n,r){return e/(n*n)+t/(r*r)}function mf(e,t,n){var r=e.parsedStyle,i=r.cx,a=void 0===i?0:i,o=r.cy,s=void 0===o?0:o,l=r.rx,u=r.ry,c=r.fill,d=r.stroke,f=r.lineWidth,v=void 0===f?1:f,p=r.increasedLineWidthForHitTesting,g=void 0===p?0:p,m=r.pointerEvents,y=void 0===m?"auto":m,E=t.x,_=t.y,T=xc(y,c,d),S=(0,h.Z)(T,2),R=S[0],A=S[1],x=(v+g)/2,k=(E-a)*(E-a),N=(_-s)*(_-s);return R&&A||n?gf(k,N,l+x,u+x)<=1:R?gf(k,N,l,u)<=1:!!A&&(gf(k,N,l-x,u-x)>=1&&gf(k,N,l+x,u+x)<=1)}function yf(e,t,n,r,i,a){return i>=e&&i<=e+n&&a>=t&&a<=t+r}function Ef(e,t,n,r,i,a,o,s){var l=(Math.atan2(s-t,o-e)+2*Math.PI)%(2*Math.PI),u={x:e+n*Math.cos(l),y:t+n*Math.sin(l)};return _o(u.x,u.y,o,s)<=a/2}function _f(e,t,n,r,i,a,o){var s=Math.min(e,n),l=Math.max(e,n),u=Math.min(t,r),c=Math.max(t,r),h=i/2;return a>=s-h&&a<=l+h&&o>=u-h&&o<=c+h&&Mo(e,t,n,r,a,o)<=i/2}function Tf(e,t,n,r,i){var a=e.length;if(a<2)return!1;for(var o=0;o<a-1;o++){if(_f(e[o][0],e[o][1],e[o+1][0],e[o+1][1],t,n,r))return!0}if(i){var s=e[0],l=e[a-1];if(_f(s[0],s[1],l[0],l[1],t,n,r))return!0}return!1}vf.tag="CanvasPicker";function Sf(e){return Math.abs(e)<1e-6?0:e<0?-1:1}function Rf(e,t,n){return(n[0]-e[0])*(t[1]-e[1])==(t[0]-e[0])*(n[1]-e[1])&&Math.min(e[0],t[0])<=n[0]&&n[0]<=Math.max(e[0],t[0])&&Math.min(e[1],t[1])<=n[1]&&n[1]<=Math.max(e[1],t[1])}function Af(e,t,n){var r=!1,i=e.length;if(i<=2)return!1;for(var a=0;a<i;a++){var o=e[a],s=e[(a+1)%i];if(Rf(o,s,[t,n]))return!0;Sf(o[1]-n)>0!=Sf(s[1]-n)>0&&Sf(t-(n-o[1])*(o[0]-s[0])/(o[1]-s[1])-o[0])<0&&(r=!r)}return r}function xf(e,t,n){for(var r=!1,i=0;i<e.length;i++){if(r=Af(e[i],t,n))break}return r}function kf(e,t,n){var r=e.parsedStyle,i=r.x1,a=r.y1,o=r.x2,s=r.y2,l=r.lineWidth,u=void 0===l?1:l,c=r.increasedLineWidthForHitTesting,d=void 0===c?0:c,f=r.pointerEvents,v=xc(void 0===f?"auto":f,r.fill,r.stroke);return!(!(0,h.Z)(v,2)[1]&&!n||!u)&&_f(i,a,o,s,u+d,t.x,t.y)}function Nf(e,t,n,r,i,a){var o=e.parsedStyle,s=o.lineWidth,l=void 0===s?1:s,u=o.increasedLineWidthForHitTesting,c=void 0===u?0:u,d=o.stroke,f=o.fill,v=o.d,p=o.pointerEvents,g=void 0===p?"auto":p,m=v.segments,y=v.hasArc,E=v.polylines,_=v.polygons,T=xc(g,(null==_?void 0:_.length)&&f,d),S=(0,h.Z)(T,2),R=S[0],A=S[1],x=pu(e),k=!1;return R||n?k=y?r(e,t):xf(_,t.x,t.y)||xf(E,t.x,t.y):((A||n)&&(k=function(e,t,n,r,i){for(var a=!1,o=t/2,s=0;s<e.length;s++){var l=e[s],u=l.currentPoint,c=l.params,h=l.prePoint,d=l.box;if(!d||yf(d.x-o,d.y-o,d.width+t,d.height+t,n,r))switch(l.command){case"L":case"Z":if(a=_f(h[0],h[1],u[0],u[1],t,n,r))return!0;break;case"Q":if(a=Bo(h[0],h[1],c[1],c[2],c[3],c[4],n,r)<=t/2)return!0;break;case"C":if(a=Oo(h[0],h[1],c[1],c[2],c[3],c[4],c[5],c[6],n,r,i)<=t/2)return!0;break;case"A":l.cubicParams||(l.cubicParams=(0,Hd.W)(h[0],h[1],c[1],c[2],c[3],c[4],c[5],c[6],c[7],void 0));for(var f=l.cubicParams,v=h,p=0;p<f.length;p+=6){var g=Oo(v[0],v[1],f[p],f[p+1],f[p+2],f[p+3],f[p+4],f[p+5],n,r,i);if(v=[f[p+4],f[p+5]],a=g<=t/2)return!0}}}return a}(m,l+c,t.x,t.y,x)),k)}function Mf(e,t,n){var r=e.parsedStyle,i=r.stroke,a=r.fill,o=r.lineWidth,s=void 0===o?1:o,l=r.increasedLineWidthForHitTesting,u=void 0===l?0:l,c=r.points,d=r.pointerEvents,f=xc(void 0===d?"auto":d,a,i),v=(0,h.Z)(f,2),p=v[0],g=!1;return(v[1]||n)&&(g=Tf(c.points,s+u,t.x,t.y,!0)),g||!p&&!n||(g=Af(c.points,t.x,t.y)),g}function Cf(e,t,n){var r=e.parsedStyle,i=r.lineWidth,a=void 0===i?1:i,o=r.increasedLineWidthForHitTesting,s=void 0===o?0:o,l=r.points,u=r.pointerEvents,c=xc(void 0===u?"auto":u,r.fill,r.stroke);return!(!(0,h.Z)(c,2)[1]&&!n||!a)&&Tf(l.points,a+s,t.x,t.y,!1)}function bf(e,t,n,r,i){var a=e.parsedStyle,o=a.radius,s=a.fill,l=a.stroke,u=a.lineWidth,c=void 0===u?1:u,d=a.increasedLineWidthForHitTesting,f=void 0===d?0:d,v=a.x,p=void 0===v?0:v,g=a.y,m=void 0===g?0:g,y=a.width,E=a.height,_=a.pointerEvents,T=xc(void 0===_?"auto":_,s,l),S=(0,h.Z)(T,2),A=S[0],x=S[1],k=c+f;if(o&&o.some((function(e){return 0!==e}))){var N=!1;return(x||n)&&(N=function(e,t,n,r,i,a,o,s){var l=(0,h.Z)(i,4),u=l[0],c=l[1],d=l[2],f=l[3];return _f(e+u,t,e+n-c,t,a,o,s)||_f(e+n,t+c,e+n,t+r-d,a,o,s)||_f(e+n-d,t+r,e+f,t+r,a,o,s)||_f(e,t+r-f,e,t+u,a,o,s)||Ef(e+n-c,t+c,c,Math.PI,Math.PI,a,o,s)||Ef(e+n-d,t+r-d,d,0,Math.PI,a,o,s)||Ef(e+f,t+r-f,f,Math.PI,Math.PI,a,o,s)||Ef(e+u,t+u,u,Math.PI,Math.PI,a,o,s)}(p,m,y,E,o.map((function(e){return(0,R.Z)(e,0,Math.min(Math.abs(y)/2,Math.abs(E)/2))})),k,t.x,t.y)),N||!A&&!n||(N=r(e,t)),N}var M=k/2;return A&&x||n?yf(p-M,m-M,y+M,E+M,t.x,t.y):A?yf(p,m,y,E,t.x,t.y):!!x&&function(e,t,n,r,i,a,o){var s=i/2;return yf(e-s,t-s,n,i,a,o)||yf(e+n-s,t-s,i,r,a,o)||yf(e+s,t+r-s,n,i,a,o)||yf(e-s,t+s,i,r,a,o)}(p,m,y,E,k,t.x,t.y)}function Pf(e,t,n,r,i,a){var o=e.parsedStyle,s=o.pointerEvents,l=void 0===s?"auto":s,c=o.x,h=void 0===c?0:c,d=o.y,f=void 0===d?0:d,v=o.width,p=o.height;if("non-transparent-pixel"===l){var g=i.config.offscreenCanvas,m=a.offscreenCanvasCreator.getOrCreateCanvas(g),y=a.offscreenCanvasCreator.getOrCreateContext(g,{willReadFrequently:!0});return m.width=v,m.height=p,i.defaultStyleRendererFactory[Fo.IMAGE].render(y,(0,u.Z)((0,u.Z)({},e.parsedStyle),{},{x:0,y:0}),e,void 0,void 0,void 0),y.getImageData(t.x-h,t.y-f,1,1).data.every((function(e){return 0!==e}))}return!0}function Of(e,t,n,r){var i=e.getGeometryBounds();return t.x>=i.min[0]&&t.y>=i.min[1]&&t.x<=i.max[0]&&t.y<=i.max[1]}var If=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).name="canvas-picker",e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){var e,t=(e={},(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(e,Fo.CIRCLE,pf),Fo.ELLIPSE,mf),Fo.RECT,bf),Fo.LINE,kf),Fo.POLYLINE,Cf),Fo.POLYGON,Mf),Fo.PATH,Nf),Fo.TEXT,Of),Fo.GROUP,null),Fo.IMAGE,Pf),(0,V.Z)((0,V.Z)(e,Fo.HTML,null),Fo.MESH,null));this.context.pointInPathPickerFactory=t,this.addRenderingPlugin(new vf)}},{key:"destroy",value:function(){delete this.context.pointInPathPickerFactory,this.removeAllRenderingPlugins()}}])}(Zo),wf=Object.freeze({__proto__:null,Plugin:If});function Lf(e,t){var n=t.cx,r=void 0===n?0:n,i=t.cy,a=void 0===i?0:i,o=t.r;e.arc(r,a,o,0,2*Math.PI,!1)}function Df(e,t){var n=t.cx,r=void 0===n?0:n,i=t.cy,a=void 0===i?0:i,o=t.rx,s=t.ry;if(e.ellipse)e.ellipse(r,a,o,s,0,0,2*Math.PI,!1);else{var l=o>s?o:s,u=o>s?1:o/s,c=o>s?s/o:1;e.save(),e.scale(u,c),e.arc(r,a,l,0,2*Math.PI)}}function Bf(e,t){var n,r,i=t.x1,a=t.y1,o=t.x2,s=t.y2,l=t.markerStart,u=t.markerEnd,c=t.markerStartOffset,h=t.markerEndOffset,d=0,f=0,v=0,p=0,g=0;l&&ed(l)&&c&&(n=o-i,r=s-a,g=Math.atan2(r,n),d=Math.cos(g)*(c||0),f=Math.sin(g)*(c||0)),u&&ed(u)&&h&&(n=i-o,r=a-s,g=Math.atan2(r,n),v=Math.cos(g)*(h||0),p=Math.sin(g)*(h||0)),e.moveTo(i+d,a+f),e.lineTo(o+v,s+p)}function Ff(e,t){var n,r,i=t.markerStart,a=t.markerEnd,o=t.markerStartOffset,s=t.markerEndOffset,l=t.d,u=l.absolutePath,c=l.segments,d=0,f=0,v=0,p=0,g=0;if(i&&ed(i)&&o){var m=i.parentNode.getStartTangent(),y=(0,h.Z)(m,2),E=y[0],_=y[1];n=E[0]-_[0],r=E[1]-_[1],g=Math.atan2(r,n),d=Math.cos(g)*(o||0),f=Math.sin(g)*(o||0)}if(a&&ed(a)&&s){var T=a.parentNode.getEndTangent(),S=(0,h.Z)(T,2),R=S[0],A=S[1];n=R[0]-A[0],r=R[1]-A[1],g=Math.atan2(r,n),v=Math.cos(g)*(s||0),p=Math.sin(g)*(s||0)}for(var x=0;x<u.length;x++){var k=u[x],N=k[0],M=u[x+1],C=0===x&&(0!==d||0!==f),b=(x===u.length-1||M&&("M"===M[0]||"Z"===M[0]))&&0!==v&&0!==p,P=C?[d,f]:[0,0],O=(0,h.Z)(P,2),I=O[0],w=O[1],L=b?[v,p]:[0,0],D=(0,h.Z)(L,2),B=D[0],F=D[1];switch(N){case"M":e.moveTo(k[1]+I,k[2]+w);break;case"L":e.lineTo(k[1]+B,k[2]+F);break;case"Q":e.quadraticCurveTo(k[1],k[2],k[3]+B,k[4]+F);break;case"C":e.bezierCurveTo(k[1],k[2],k[3],k[4],k[5]+B,k[6]+F);break;case"A":var U=c[x].arcParams,Z=U.cx,G=U.cy,V=U.rx,W=U.ry,H=U.startAngle,X=U.endAngle,z=U.xRotation,Y=U.sweepFlag;if(e.ellipse)e.ellipse(Z,G,V,W,z,H,X,!!(1-Y));else{var j=V>W?V:W,K=V>W?1:V/W,q=V>W?W/V:1;e.translate(Z,G),e.rotate(z),e.scale(K,q),e.arc(0,0,j,H,X,!!(1-Y)),e.scale(1/K,1/q),e.rotate(-z),e.translate(-Z,-G)}b&&e.lineTo(k[6]+v,k[7]+p);break;case"Z":e.closePath()}}}function Uf(e,t){var n,r,i=t.markerStart,a=t.markerEnd,o=t.markerStartOffset,s=t.markerEndOffset,l=t.points.points,u=l.length,c=l[0][0],h=l[0][1],d=l[u-1][0],f=l[u-1][1],v=0,p=0,g=0,m=0,y=0;i&&ed(i)&&o&&(n=l[1][0]-l[0][0],r=l[1][1]-l[0][1],y=Math.atan2(r,n),v=Math.cos(y)*(o||0),p=Math.sin(y)*(o||0)),a&&ed(a)&&s&&(n=l[u-1][0]-l[0][0],r=l[u-1][1]-l[0][1],y=Math.atan2(r,n),g=Math.cos(y)*(s||0),m=Math.sin(y)*(s||0)),e.moveTo(c+(v||g),h+(p||m));for(var E=1;E<u-1;E++){var _=l[E];e.lineTo(_[0],_[1])}e.lineTo(d,f)}function Zf(e,t){var n,r,i=t.markerStart,a=t.markerEnd,o=t.markerStartOffset,s=t.markerEndOffset,l=t.points.points,u=l.length,c=l[0][0],h=l[0][1],d=l[u-1][0],f=l[u-1][1],v=0,p=0,g=0,m=0,y=0;i&&ed(i)&&o&&(n=l[1][0]-l[0][0],r=l[1][1]-l[0][1],y=Math.atan2(r,n),v=Math.cos(y)*(o||0),p=Math.sin(y)*(o||0)),a&&ed(a)&&s&&(n=l[u-2][0]-l[u-1][0],r=l[u-2][1]-l[u-1][1],y=Math.atan2(r,n),g=Math.cos(y)*(s||0),m=Math.sin(y)*(s||0)),e.moveTo(c+v,h+p);for(var E=1;E<u-1;E++){var _=l[E];e.lineTo(_[0],_[1])}e.lineTo(d+g,f+m)}function Gf(e,t){var n=t.x,r=void 0===n?0:n,i=t.y,a=void 0===i?0:i,o=t.radius,s=t.width,l=t.height,u=s,c=l;if(o&&o.some((function(e){return 0!==e}))){var d=s>0?1:-1,f=l>0?1:-1,v=d+f===0,p=o.map((function(e){return(0,R.Z)(e,0,Math.min(Math.abs(u)/2,Math.abs(c)/2))})),g=(0,h.Z)(p,4),m=g[0],y=g[1],E=g[2],_=g[3];e.moveTo(d*m+r,a),e.lineTo(u-d*y+r,a),0!==y&&e.arc(u-d*y+r,f*y+a,y,-f*Math.PI/2,d>0?0:Math.PI,v),e.lineTo(u+r,c-f*E+a),0!==E&&e.arc(u-d*E+r,c-f*E+a,E,d>0?0:Math.PI,f>0?Math.PI/2:1.5*Math.PI,v),e.lineTo(d*_+r,c+a),0!==_&&e.arc(d*_+r,c-f*_+a,_,f>0?Math.PI/2:-Math.PI/2,d>0?Math.PI:0,v),e.lineTo(r,f*m+a),0!==m&&e.arc(d*m+r,f*m+a,m,d>0?Math.PI:0,f>0?1.5*Math.PI:Math.PI/2,v)}else e.rect(r,a,u,c)}var Vf=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).name="canvas-path-generator",e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){var e,t=(e={},(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(e,Fo.CIRCLE,Lf),Fo.ELLIPSE,Df),Fo.RECT,Gf),Fo.LINE,Bf),Fo.POLYLINE,Zf),Fo.POLYGON,Uf),Fo.PATH,Ff),Fo.TEXT,void 0),Fo.GROUP,void 0),Fo.IMAGE,void 0),(0,V.Z)((0,V.Z)((0,V.Z)(e,Fo.HTML,void 0),Fo.MESH,void 0),Fo.FRAGMENT,void 0));this.context.pathGeneratorFactory=t}},{key:"destroy",value:function(){delete this.context.pathGeneratorFactory}}])}(Zo),Wf=Object.freeze({__proto__:null,Plugin:Vf}),Hf=function(){function e(t){(0,o.Z)(this,e),this.dragndropPluginOptions=t}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=this,r=t.renderingService,i=t.renderingContext.root.ownerDocument,a=i.defaultView,o=function(e){var t=e.target,r=t===i,o=r&&n.dragndropPluginOptions.isDocumentDraggable?i:t.closest&&t.closest("[draggable=true]");if(o){var s=!1,l=e.timeStamp,u=[e.clientX,e.clientY],c=null,h=[e.clientX,e.clientY],d=function(){var e=(0,oe.Z)((0,ae.Z)().mark((function e(a){var d,f,v,p,g,m;return(0,ae.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}if(d=a.timeStamp-l,f=(0,_.y)([a.clientX,a.clientY],u),!(d<=n.dragndropPluginOptions.dragstartTimeThreshold||f<=n.dragndropPluginOptions.dragstartDistanceThreshold)){e.next=1;break}return e.abrupt("return");case 1:a.type="dragstart",o.dispatchEvent(a),s=!0;case 2:if(a.type="drag",a.dx=a.clientX-h[0],a.dy=a.clientY-h[1],o.dispatchEvent(a),h=[a.clientX,a.clientY],r){e.next=4;break}return v="pointer"===n.dragndropPluginOptions.overlap?[a.canvasX,a.canvasY]:t.getBounds().center,e.next=3,i.elementsFromPoint(v[0],v[1]);case 3:p=e.sent,g=p[p.indexOf(t)+1],m=(null==g?void 0:g.closest("[droppable=true]"))||(n.dragndropPluginOptions.isDocumentDroppable?i:null),c!==m&&(c&&(a.type="dragleave",a.target=c,c.dispatchEvent(a)),m&&(a.type="dragenter",a.target=m,m.dispatchEvent(a)),(c=m)&&(a.type="dragover",a.target=c,c.dispatchEvent(a)));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();a.addEventListener("pointermove",d);var f=function(e){if(s){e.detail={preventClick:!0};var t=e.clone();c&&(t.type="drop",t.target=c,c.dispatchEvent(t)),t.type="dragend",o.dispatchEvent(t),s=!1}a.removeEventListener("pointermove",d)};t.addEventListener("pointerup",f,{once:!0}),t.addEventListener("pointerupoutside",f,{once:!0})}};r.hooks.init.tap(e.tag,(function(){a.addEventListener("pointerdown",o)})),r.hooks.destroy.tap(e.tag,(function(){a.removeEventListener("pointerdown",o)}))}}])}();Hf.tag="Dragndrop";var Xf=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(e=(0,s.Z)(this,t)).name="dragndrop",e.options=n,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){this.addRenderingPlugin(new Hf((0,u.Z)({overlap:"pointer",isDocumentDraggable:!1,isDocumentDroppable:!1,dragstartDistanceThreshold:0,dragstartTimeThreshold:0},this.options)))}},{key:"destroy",value:function(){this.removeAllRenderingPlugins()}},{key:"setOptions",value:function(e){Object.assign(this.plugins[0].dragndropPluginOptions,e)}}])}(he),zf="object"===("undefined"==typeof performance?"undefined":i()(performance))&&performance.now?performance:Date,Yf=function(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.abs(n)>Math.abs(r)?n>0?"right":"left":r>0?"down":"up"},jf=function(e,t){var n=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y);return Math.sqrt(n*n+r*r)},Kf=function(){function e(t){var n=this;(0,o.Z)(this,e),this.evCache=[],this.startPoints=[],this.processEvent={},this.throttleTimer=0,this.emitThrottles=[],this._start=function(e,t){n.reset(),n.startTime=zf.now();var r=n.evCache,i=n.startPoints;if(e){var a,o=e.pointerId,s=e.x,l=e.y,u=r.findIndex((function(e){return o===e.pointerId}));-1!==u&&r.splice(u,1),r.push({pointerId:o,x:s,y:l,ev:e});for(var h=(0,c.Z)((null===(a=e.nativeEvent)||void 0===a?void 0:a.touches)||[]),d=function(e){if(h.find((function(t){return r[e].pointerId===t.identifier})))return 1;r.splice(e,1)},f=r.length-1;f>-1;f--)d(f)}i.length=r.length;for(var v=0;v<r.length;v++){var p=r[v],g={x:p.x,y:p.y};i[v]=g}if(1!==i.length){var m,y;n.startDistance=jf(i[0],i[1]),n.center=(m=i[0],y=i[1],{x:m.x+(y.x-m.x)/2,y:m.y+(y.y-m.y)/2})}else{var E=r[0].ev;n.pressTimeout=setTimeout((function(){var e="press",r="none";E.direction=r,E.deltaX=0,E.deltaY=0,E.points=i,n.emitStart(e,E,t),E.type=e,t.dispatchEvent(E),n.eventType=e,n.direction=r,n.movingTarget=t}),250)}},this._move=function(e,t){n.clearPressTimeout();var r=n.startPoints,i=n.evCache;if(r.length){for(var a=e.x,o=e.y,s=e.pointerId,l=0,u=i.length;l<u;l++)if(s===i[l].pointerId){i[l]={pointerId:s,x:a,y:o,ev:e};break}var c={x:a,y:o},h=i.map((function(e){return{x:e.x,y:e.y}})),d=zf.now();if(n.prevMoveTime=n.lastMoveTime,n.prevMovePoint=n.lastMovePoint,n.lastMoveTime=d,n.lastMovePoint=c,1===r.length){var f=r[0],v=a-f.x,p=o-f.y,g=n.direction||Yf(f,c);n.direction=g;var m=n.getEventType(c,t,e);return e.direction=g,e.deltaX=v,e.deltaY=p,e.points=h,n.emitStart(m,e,t),e.type=m,void n.refreshAndGetTarget(t).dispatchEvent(e)}var y=n.startDistance,E=jf(h[0],h[1]);e.zoom=E/y,e.center=n.center,e.points=h,n.emitStart("pinch",e,t),n._throttleEmit("pinch",e,t)}},this._end=function(e,t){var r=n.evCache,i=n.startPoints,a=r.map((function(e){return{x:e.x,y:e.y}}));if(e.points=a,n.emitEnd(e,n.refreshAndGetTarget(t)),1===r.length){var o=zf.now(),s=n.lastMoveTime;if(o-s<100){var l=s-(n.prevMoveTime||n.startTime);if(l>0){var u=n.prevMovePoint||i[0],c=n.lastMovePoint||i[0],h=jf(u,c)/l;h>.3&&(e.velocity=h,e.direction=Yf(u,c),e.type="swipe",t.dispatchEvent(e))}}}for(var d=0,f=r.length;d<f;d++)if(r[d].pointerId===e.pointerId){r.splice(d,1),i.splice(d,1);break}n.reset(),r.length>0&&n._start(void 0,t)},this._cancel=function(e,t){var r=n.evCache.map((function(e){return{x:e.x,y:e.y}}));e.points=r,n.emitEnd(e,n.refreshAndGetTarget(t)),n.evCache=[],n.reset()},this.options=t}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=this,r=t.renderingService,i=t.renderingContext.root.ownerDocument,a=i.defaultView;this.canvas=a;var o=function(e){return e===i&&n.options.isDocumentGestureEnabled?i:e},s=function(e){var t=o(e.target);t&&n._move(e,t)},l=function(e){var t=o(e.target);t&&n._start(e,t)},u=function(e){var t=o(e.target);t&&n._end(e,t)},c=function(e){var t=o(e.target);t&&n._cancel(e,t)},h=function(e){var t=o(e.target);t&&n._end(e,t)};r.hooks.init.tap(e.tag,(function(){a.addEventListener("pointermove",s),a.addEventListener("pointerdown",l),a.addEventListener("pointerup",u),a.addEventListener("pointercancel",c),a.addEventListener("pointerupoutside",h)})),r.hooks.destroy.tap(e.tag,(function(){a.removeEventListener("pointermove",s),a.removeEventListener("pointerdown",l),a.removeEventListener("pointerup",u),a.removeEventListener("pointercancel",c),a.removeEventListener("pointerupoutside",h)}))}},{key:"getEventType",value:function(e,t,n){var r,i=this.eventType,a=this.startTime,o=this.startPoints;if(i)return i;(this.movingTarget=t,this.isPanListenerInPath=n.path.some((function(e){var t;return!(null===(t=e.emitter)||void 0===t||null===(t=t.eventNames())||void 0===t||!t.includes("pan"))})),this.isPanListenerInPath)?r=zf.now()-a>250&&jf(o[0],e)<10?"press":"pan":r="press";return this.eventType=r,r}},{key:"enable",value:function(e){this.processEvent[e]=!0}},{key:"isProcess",value:function(e){return this.processEvent[e]}},{key:"emitStart",value:function(e,t,n){this.isProcess(e)||(this.enable(e),t.type="".concat(e,"start"),n.dispatchEvent(t))}},{key:"_throttleEmit",value:function(e,t,n){var r=this;this.pushEvent(e,t);var i=this.throttleTimer,a=this.emitThrottles,o=this.processEvent;i||(this.throttleTimer=this.canvas.requestAnimationFrame((function(){for(var e=0,t=a.length;e<t;e++){var i=a[e],s=i.type,l=i.ev;o[s]&&(l.type=s,n.dispatchEvent(l))}r.throttleTimer=0,r.emitThrottles.length=0})))}},{key:"emitEnd",value:function(e,t){var n=this.processEvent;Object.keys(n).forEach((function(r){e.type="".concat(r,"end"),t.dispatchEvent(e),delete n[r]}))}},{key:"pushEvent",value:function(e,t){for(var n=this.emitThrottles,r={type:e,ev:t},i=0,a=n.length;i<a;i++)if(n[i].type===e)return void n.splice(i,1,r);n.push(r)}},{key:"clearPressTimeout",value:function(){this.pressTimeout&&(clearTimeout(this.pressTimeout),this.pressTimeout=null)}},{key:"refreshAndGetTarget",value:function(e){return this.movingTarget?(this.movingTarget&&!this.movingTarget.isConnected&&(this.movingTarget=e),this.movingTarget):e}},{key:"reset",value:function(){this.clearPressTimeout(),this.startTime=0,this.startDistance=0,this.direction=null,this.eventType=null,this.prevMoveTime=0,this.prevMovePoint=null,this.lastMoveTime=0,this.lastMovePoint=null,this.movingTarget=null,this.isPanListenerInPath=null}}])}();Kf.tag="Gesture";var qf=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(e=(0,s.Z)(this,t)).name="gesture",e.options=n,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){this.addRenderingPlugin(new Kf((0,u.Z)({isDocumentGestureEnabled:!1},this.options)))}},{key:"destroy",value:function(){this.removeAllRenderingPlugins()}}])}(he);var $f=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.canvasConfig=t.config}),[{key:"init",value:(e=(0,oe.Z)((0,ae.Z)().mark((function e(){var t,n,r,i;return(0,ae.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.canvasConfig,n=t.canvas,r=t.devicePixelRatio,this.$canvas=n,this.context=this.$canvas.getContext("2d"),i=(i=r||1)>=1?Math.ceil(i):1,this.dpr=i,this.resize(this.canvasConfig.width,this.canvasConfig.height);case 1:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"getContext",value:function(){return this.context}},{key:"getDomElement",value:function(){return this.$canvas}},{key:"getDPR",value:function(){return this.dpr}},{key:"getBoundingClientRect",value:function(){if(this.$canvas.getBoundingClientRect)return this.$canvas.getBoundingClientRect()}},{key:"destroy",value:function(){this.context=null,this.$canvas=null}},{key:"resize",value:function(e,t){var n,r=this.canvasConfig.devicePixelRatio,a=this.$canvas;a.style&&(a.style.width="".concat(e,"px"),a.style.height="".concat(t,"px")),(n=a)&&"object"===i()(n)&&(1===n.nodeType&&n.nodeName||n.isCanvasElement)&&(a.width=e*r,a.height=t*r,1!==r&&this.context.scale(r,r))}},{key:"applyCursorStyle",value:function(e){}},{key:"toDataURL",value:function(){var e=(0,oe.Z)((0,ae.Z)().mark((function e(t){var n,r;return(0,ae.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.type,r=t.encoderOptions,e.abrupt("return",this.context.canvas.toDataURL(n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]);var e}(),Qf=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).name="mobile-canvas-context-register",e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){this.context.ContextService=$f}},{key:"destroy",value:function(){delete this.context.ContextService}}])}(he);var Jf=function(e){function t(e){var n;return(0,o.Z)(this,t),(n=(0,s.Z)(this,t,[e])).registerPlugin(new Qf),n.registerPlugin(new vo.Plugin),n.registerPlugin(new Wf.Plugin),n.registerPlugin(new uf.Plugin),n.registerPlugin(new Eo.Plugin),n.registerPlugin(new wf.Plugin),n.registerPlugin(new Xf({isDocumentDraggable:!!(0,T.Z)(null==e?void 0:e.isDocumentDraggable)||e.isDocumentDraggable,isDocumentDroppable:!!(0,T.Z)(null==e?void 0:e.isDocumentDroppable)||e.isDocumentDroppable,dragstartDistanceThreshold:(0,T.Z)(null==e?void 0:e.dragstartDistanceThreshold)?10:e.dragstartDistanceThreshold,dragstartTimeThreshold:(0,T.Z)(null==e?void 0:e.dragstartTimeThreshold)?50:e.dragstartTimeThreshold})),n.registerPlugin(new qf({isDocumentGestureEnabled:!0})),n}return(0,l.Z)(t,e),(0,a.Z)(t)}(de)},99349:function(e,t,n){n.d(t,{Th:function(){return j}});var r=n(51148),i=n(63118),a=n(65982),o=function(){function e(){}return e.prototype.apply=function(t){var n=t.renderingService,r=t.contextService,i=t.config,a=r.getDomElement(),o=function(e){n.hooks.pointerDown.call(e)},s=function(e){n.hooks.pointerUp.call(e)},l=function(e){n.hooks.pointerMove.call(e)},u=function(e){n.hooks.pointerOver.call(e)},c=function(e){n.hooks.pointerOut.call(e)},h=function(e){n.hooks.click.call(e)},d=function(e){n.hooks.pointerCancel.call(e)};n.hooks.init.tap(e.tag,(function(){a.addEventListener("touchstart",o,!0),a.addEventListener("touchend",s,!0),a.addEventListener("touchmove",l,!0),a.addEventListener("touchcancel",d,!0),a.addEventListener("mouseout",c,!0),a.addEventListener("mouseover",u,!0),i.useNativeClickEvent&&a.addEventListener("click",h,!0)})),n.hooks.destroy.tap(e.tag,(function(){a.removeEventListener("touchstart",o,!0),a.removeEventListener("touchend",s,!0),a.removeEventListener("touchmove",l,!0),a.removeEventListener("touchcancel",d,!0),a.removeEventListener("mouseout",c,!0),a.removeEventListener("mouseover",u,!0),i.useNativeClickEvent&&a.removeEventListener("click",h,!0)}))},e.tag="MobileInteraction",e}(),s=function(e){function t(){var t=e.apply(this,(0,r.__spreadArray)([],(0,r.__read)(arguments),!1))||this;return t.name="mobile-interaction",t}return(0,r.__extends)(t,e),t.prototype.init=function(){this.addRenderingPlugin(new o)},t.prototype.destroy=function(){this.removeAllRenderingPlugins()},t}(i.F6),l=function(){function e(){}return e.prototype.apply=function(t,n){var i=this,a=t.config.document,o=t.renderingService,s=t.svgElementMap;o.hooks.pick.tapPromise(e.tag,(function(e){return(0,r.__awaiter)(i,void 0,void 0,(function(){return(0,r.__generator)(this,(function(t){return[2,this.pick(s,a,e)]}))}))})),o.hooks.pickSync.tap(e.tag,(function(e){return i.pick(s,a,e)}))},e.prototype.pick=function(e,t,n){var i,a,o=n.topmost,s=n.position,l=s.clientX,u=s.clientY;try{var c=[];try{for(var h=(0,r.__values)((t||document).elementsFromPoint(l,u)),d=h.next();!d.done;d=h.next()){var f=d.value;if(f.shadowRoot&&f.shadowRoot!==t)return this.pick(e,f.shadowRoot,n);var v=e.get(f);if(v&&v.isInteractive()&&(c.push(v),o))return n.picked=c,n}}catch(e){i={error:e}}finally{try{d&&!d.done&&(a=h.return)&&a.call(h)}finally{if(i)throw i.error}}n.picked=c}catch(e){n.picked=[]}return n},e.tag="SVGPicker",e}(),u=function(e){function t(){var t=e.apply(this,(0,r.__spreadArray)([],(0,r.__read)(arguments),!1))||this;return t.name="svg-picker",t}return(0,r.__extends)(t,e),t.prototype.init=function(){this.addRenderingPlugin(new l)},t.prototype.destroy=function(){this.removeAllRenderingPlugins()},t}(i.F6),c=n(79364),h=n(12873),d=n(55072),f=n(17517),v=function(){function e(){}return e.tag="c-svg-element",e}();function p(e,t){return(t||document).createElementNS("http://www.w3.org/2000/svg",e)}var g="g-filter-";function m(e,t,n,r,i){var a=g+n.entity,o=t.querySelectorAll("[name=".concat(a,"]"));if(o.length&&o.forEach((function(e){t.removeChild(e)})),0===i.length)null==r||r.removeAttribute("filter");else{var s=i.map((function(n,r){var i=n.name,o=n.params,s=p("filter",e);return s.setAttribute("filterUnits","userSpaceOnUse"),"blur"===i?function(e,t,n){var r=p("feGaussianBlur",e);r.setAttribute("in","SourceGraphic"),r.setAttribute("stdDeviation","".concat(n[0].value)),t.appendChild(r)}(e,s,o):"brightness"===i?function(e,t,n){var r=y(n[0]);E(e,t,{type:"linear",slope:r,intercept:0})}(e,s,o):"drop-shadow"===i?function(e,t,n){var r=n[0].value,i=n[1].value,a=n[2].value,o=n[3].formatted,s=p("feGaussianBlur",e);s.setAttribute("in","SourceAlpha"),s.setAttribute("stdDeviation","".concat(a)),t.appendChild(s);var l=p("feOffset",e);l.setAttribute("dx","".concat(r)),l.setAttribute("dy","".concat(i)),l.setAttribute("result","offsetblur"),t.appendChild(l);var u=p("feFlood",e);u.setAttribute("flood-color",o),t.appendChild(u);var c=p("feComposite",e);c.setAttribute("in2","offsetblur"),c.setAttribute("operator","in"),t.appendChild(c);var h=p("feMerge",e);t.appendChild(h);var d=p("feMergeNode",e),f=p("feMergeNode",e);f.setAttribute("in","SourceGraphic"),h.appendChild(d),h.appendChild(f)}(e,s,o):"contrast"===i?function(e,t,n){var r=y(n[0]);E(e,t,{type:"linear",slope:r,intercept:-.5*r+.5})}(e,s,o):"grayscale"===i?function(e,t,n){var r=y(n[0]);_(e,t,[.2126+.7874*(1-r),.7152-.7152*(1-r),.0722-.0722*(1-r),0,0,.2126-.2126*(1-r),.7152+.2848*(1-r),.0722-.0722*(1-r),0,0,.2126-.2126*(1-r),.7152-.7152*(1-r),.0722+.9278*(1-r),0,0,0,0,0,1,0])}(e,s,o):"sepia"===i?function(e,t,n){var r=y(n[0]);_(e,t,[.393+.607*(1-r),.769-.769*(1-r),.189-.189*(1-r),0,0,.349-.349*(1-r),.686+.314*(1-r),.168-.168*(1-r),0,0,.272-.272*(1-r),.534-.534*(1-r),.131+.869*(1-r),0,0,0,0,0,1,0])}(e,s,o):"saturate"===i?function(e,t,n){var r=y(n[0]),i=p("feColorMatrix",e);i.setAttribute("type","saturate"),i.setAttribute("values","".concat(r)),t.appendChild(i)}(e,s,o):"hue-rotate"===i?function(e,t,n){var r=p("feColorMatrix",e);r.setAttribute("type","hueRotate"),r.setAttribute("values","".concat(n[0].value)),t.appendChild(r)}(e,s,o):"invert"===i&&function(e,t,n){var r=y(n[0]);E(e,t,{type:"table",tableValues:"".concat(r," ").concat(1-r)})}(e,s,o),s.id="".concat(a,"-").concat(r),s.setAttribute("name",a),t.appendChild(s),s.id}));setTimeout((function(){null==r||r.setAttribute("filter",s.map((function(e){return"url(#".concat(e,")")})).join(" "))}))}}function y(e){return e.unit===i.Cm.kPercentage?e.value/100:e.value}function E(e,t,n){var r=n.type,i=n.slope,a=n.intercept,o=n.tableValues,s=p("feComponentTransfer",e);[p("feFuncR",e),p("feFuncG",e),p("feFuncB",e)].forEach((function(e){e.setAttribute("type",r),"table"===r?e.setAttribute("tableValues","".concat(o)):(e.setAttribute("slope","".concat(i)),e.setAttribute("intercept","".concat(a))),s.appendChild(e)})),t.appendChild(s)}function _(e,t,n){var r=p("feColorMatrix",e);r.setAttribute("type","matrix"),r.setAttribute("values",n.join(" ")),t.appendChild(r)}var T={},S=0;function R(e,t,n,r,a,o,s,l){if(!a)return"";if(!(0,i.qA)(a)){if((0,i.R)(a)){var u=function(e,t,n,r,a,o){var s=A(r),l=t.querySelector("#".concat(s));if(!l){var u=r.image,h="";if((0,c.Z)(u)?h=u:i.jU&&(u instanceof HTMLImageElement?h=u.src:u instanceof HTMLCanvasElement&&(h=u.toDataURL())),h){var d,f=p("image",e);f.setAttribute("href",h),a?d=a(h):i.jU&&(d=new window.Image),h.match(/^data:/i)||(d.crossOrigin="Anonymous",f.setAttribute("crossorigin","anonymous")),d.src=h;var v=function(){var i=x(e,t,n,r,s,d.width,d.height);t.appendChild(i),i.appendChild(f),f.setAttribute("x","0"),f.setAttribute("y","0"),f.setAttribute("width","".concat(d.width)),f.setAttribute("height","".concat(d.height))};d.complete?v():d.onload=v}if("rect"===u.nodeName){var g=u.parsedStyle,m=g.width,y=g.height,E=x(e,t,u,r,s,m,y);u.forEach((function(t){o.createSVGDom(e,t,null);var n=t.elementSVG,r=t.getLocalTransform();o.applyTransform(n.$groupEl,r)}));var _=u.elementSVG;E.appendChild(_.$groupEl)}}return s}(e,t,n,a,s,l);return r.style[o]="url(#".concat(u,")"),u}if(1===a.length){var h=k(e,n,t,r,a[0]);return null==r||r.setAttribute(o,"url(#".concat(h,")")),h}var d=function(e,t,n,r,i){var a=g+t.entity+"-gradient",o=n.querySelector("#".concat(a));o||((o=p("filter",e)).setAttribute("filterUnits","userSpaceOnUse"),o.setAttribute("x","0%"),o.setAttribute("y","0%"),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.id=a,n.appendChild(o));var s=0;i.forEach((function(i,l){var u=k(e,t,n,r,i),c=u+"_rect",h=p("rect",e);h.setAttribute("x","0"),h.setAttribute("y","0"),h.setAttribute("width","100%"),h.setAttribute("height","100%"),h.setAttribute("fill","url(#".concat(u,")")),h.id=c,n.appendChild(h);var d=p("feImage",e);if(d.setAttribute("href","#".concat(c)),d.setAttribute("result","".concat(a,"-").concat(l)),o.appendChild(d),l>0){var f=p("feBlend",e);f.setAttribute("in",1===l?"".concat(a,"-").concat(l-1):"".concat(a,"-blended-").concat(s-1)),f.setAttribute("in2","".concat(a,"-").concat(l)),f.setAttribute("result","".concat(a,"-blended-").concat(s++)),f.setAttribute("mode","multiply"),o.appendChild(f)}}));var l=p("feComposite",e);return l.setAttribute("in","".concat(a,"-blended-").concat(s)),l.setAttribute("in2","SourceGraphic"),l.setAttribute("operator","in"),o.appendChild(l),a}(e,n,t,r,a);return null==r||r.setAttribute("filter","url(#".concat(d,")")),null==r||r.setAttribute("fill","black"),d}return"currentColor"===n.style[o]?null==r||r.setAttribute(o,"currentColor"):null==r||r.setAttribute(o,a.isNone?"none":a.toString()),""}function A(e,t){void 0===t&&(t={});var n="";if((0,i.Ny)(e)){var a=e.type,o=e.value;if(a===i.GL.LinearGradient||a===i.GL.RadialGradient){var s=(0,r.__assign)((0,r.__assign)({},o),t),l=s.type,u=s.width,h=s.height,d=s.steps,f=s.angle,v=s.cx,p=s.cy,g=s.size;n="gradient-".concat(l,"-").concat((null==f?void 0:f.toString())||0,"-").concat((null==v?void 0:v.toString())||0,"-").concat((null==p?void 0:p.toString())||0,"-").concat((null==g?void 0:g.toString())||0,"-").concat(u,"-").concat(h,"-").concat(d.map((function(e){var t=e.offset,n=e.color;return"".concat(t).concat(n)})).join("-"))}}else(0,i.R)(e)&&(n=(0,c.Z)(e.image)?"pattern-".concat(e.image,"-").concat(e.repetition):"rect"===e.image.nodeName?"pattern-rect-".concat(e.image.entity):"pattern-".concat(S));return n&&(T[n]||(T[n]="g-pattern-"+"".concat(S++))),T[n]}function x(e,t,n,a,o,s,l){var u=a.repetition,c=a.transform,h=p("pattern",e);c&&h.setAttribute("patternTransform",function(e){return(0,i.G$)(e).map((function(e){var t=e.t,n=e.d;if("translate"===t)return"translate(".concat(n[0].value," ").concat(n[1].value,")");if("translatex"===t)return"translate(".concat(n[0].value," 0)");if("translatey"===t)return"translate(0 ".concat(n[0].value,")");if("rotate"===t)return"rotate(".concat(n[0].value,")");if("scale"===t){var i=(null==n?void 0:n.map((function(e){return e.value})))||[1,1];return"scale(".concat(i[0],", ").concat(i[1],")")}if("scalex"===t)return i=(null==n?void 0:n.map((function(e){return e.value})))||[1],"scale(".concat(i[0],", 1)");if("scaley"===t)return i=(null==n?void 0:n.map((function(e){return e.value})))||[1],"scale(1, ".concat(i[0],")");if("skew"===t){var a=(null==n?void 0:n.map((function(e){return e.value})))||[0,0];return"skewX(".concat(a[0],") skewY(").concat(a[1],")")}if("skewx"===t)return a=(null==n?void 0:n.map((function(e){return e.value})))||[0],"skewX(".concat(a[0],")");if("skewy"===t)return a=(null==n?void 0:n.map((function(e){return e.value})))||[0],"skewY(".concat(a[0],")");if("matrix"===t){var o=(0,r.__read)(n.map((function(e){return e.value})),6),s=o[0],l=o[1],u=o[2],c=o[3],h=o[4],d=o[5];return"matrix(".concat(s," ").concat(l," ").concat(u," ").concat(c," ").concat(h," ").concat(d,")")}})).join(" ")}(c)),h.setAttribute("patternUnits","userSpaceOnUse"),h.id=o,t.appendChild(h),h.setAttribute("x","0"),h.setAttribute("y","0");var d=n.getGeometryBounds().halfExtents,f=s,v=l;return"repeat-x"===u?v=2*d[1]:"repeat-y"===u?f=2*d[0]:"no-repeat"===u&&(f=2*d[0],v=2*d[1]),h.setAttribute("width","".concat(f)),h.setAttribute("height","".concat(v)),h}function k(e,t,n,r,a){var o=t.getGeometryBounds(),s=o&&2*o.halfExtents[0]||0,l=o&&2*o.halfExtents[1]||0,u=A(a,{width:s,height:l}),c=n.querySelector("#".concat(u));if(!c){(c=p(a.type===i.GL.LinearGradient?"linearGradient":"radialGradient",e)).setAttribute("gradientUnits","userSpaceOnUse");var h="";a.value.steps.sort((function(e,t){return e.offset.value-t.offset.value})).forEach((function(e){var t=e.offset,n=e.color;h+='<stop offset="'.concat(t.value/100,'" stop-color="').concat(n,'"></stop>')})),c.innerHTML=h,c.id=u,n.appendChild(c)}if(a.type===i.GL.LinearGradient){var d=a.value.angle,f=(0,i.Rx)(s,l,d),v=f.x1,g=f.y1,m=f.x2,y=f.y2;c.setAttribute("x1","".concat(v)),c.setAttribute("y1","".concat(g)),c.setAttribute("x2","".concat(m)),c.setAttribute("y2","".concat(y))}else{var E=a.value,_=E.cx,T=E.cy,S=E.size,R=(0,i.o6)(s,l,_,T,S),x=R.x,k=R.y,N=R.r;c.setAttribute("cx","".concat(x)),c.setAttribute("cy","".concat(k)),c.setAttribute("r","".concat(N))}return u}var N=/url\("?#(.*)\)/,M=function(){function e(e){this.context=e,this.gradientCache={}}return e.prototype.getDefElement=function(){return this.$def},e.prototype.init=function(){var e=this.context.config.document,t=this.context.contextService.getContext();this.$def=p("defs",e),t.appendChild(this.$def)},e.prototype.clear=function(e){var t=this;Object.keys(this.gradientCache).forEach((function(n){t.clearUnusedDefElement(t.gradientCache,n,e)}))},e.prototype.clearUnusedDefElement=function(e,t,n){if(e[t]&&1===e[t].size&&e[t].has(n)){var r=this.$def.querySelector("#".concat(t));r&&this.$def.removeChild(r)}},e.prototype.createOrUpdateGradientAndPattern=function(e,t,n,r,a){var o=this.context.config,s=o.document,l=o.createImage;if(t){var u=((0,i.R)(n)?t.style[r]:t.getAttribute(r)||"").match(N);u&&u.length>1&&this.clearUnusedDefElement(this.gradientCache,u[1].replace('"',""),e.entity);var c=R(s||document,this.$def,e,t,n,r,l,a);c&&(this.gradientCache[c]||(this.gradientCache[c]=new Set),this.gradientCache[c].add(e.entity))}},e.prototype.createOrUpdateShadow=function(e,t,n){!function(e,t,n,r,i){var a=n.parsedStyle,o=a.shadowType,s=a.shadowBlur,l=a.shadowColor,u=a.shadowOffsetX,c=a.shadowOffsetY,h=!(0,d.Z)(l)&&s>0,f="g-filter-dropshadow-"+n.entity,v=t.querySelector("#".concat(f));if(v&&(v.getAttribute("data-type")===o&&h||(v.remove(),v=null)),h){if(null==r||r.setAttribute("filter","url(#".concat(f,")")),!v){if((v=p("filter",e)).setAttribute("data-type",o),"outer"===o)(k=p("feDropShadow",e)).setAttribute("dx","".concat((u||0)/2)),k.setAttribute("dy","".concat((c||0)/2)),k.setAttribute("stdDeviation","".concat((s||0)/4)),k.setAttribute("flood-color",l.toString()),v.appendChild(k);else if("inner"===o){var g=p("feComponentTransfer",e);g.setAttribute("in","SourceAlpha");var m=p("feFuncA",e);m.setAttribute("type","table"),m.setAttribute("tableValues","1 0"),g.appendChild(m),v.appendChild(g),(R=p("feGaussianBlur",e)).setAttribute("stdDeviation","".concat((s||0)/4)),v.appendChild(R),(A=p("feOffset",e)).setAttribute("dx","".concat((u||0)/2)),A.setAttribute("dy","".concat((c||0)/2)),A.setAttribute("result","offsetblur"),v.appendChild(A),(x=p("feFlood",e)).setAttribute("flood-color",l.toString()),x.setAttribute("result","color"),v.appendChild(x);var y=p("feComposite",e);y.setAttribute("in2","offsetblur"),y.setAttribute("operator","in"),v.appendChild(y);var E=p("feComposite",e);E.setAttribute("in2","SourceAlpha"),E.setAttribute("operator","in"),v.appendChild(E);var _=p("feMerge",e);v.appendChild(_);var T=p("feMergeNode",e);T.setAttribute("in","SourceGraphic");var S=p("feMergeNode",e);_.appendChild(T),_.appendChild(S)}return v.id=f,v.setAttribute("filterUnits","userSpaceOnUse"),void t.appendChild(v)}if("inner"===o){var R=v.children[1],A=v.children[2],x=v.children[3];"shadowColor"===i?x.setAttribute("flood-color",l.toString()):"shadowBlur"===i?R.setAttribute("stdDeviation","".concat((s||0)/4)):"shadowOffsetX"===i?A.setAttribute("dx","".concat((u||0)/2)):"shadowOffsetY"===i&&A.setAttribute("dy","".concat((c||0)/2))}else if("outer"===o){var k=v.children[0];"shadowColor"===i?k.setAttribute("flood-color",l.toString()):"shadowBlur"===i?k.setAttribute("stdDeviation","".concat((s||0)/4)):"shadowOffsetX"===i?k.setAttribute("dx","".concat((u||0)/2)):"shadowOffsetY"===i&&k.setAttribute("dy","".concat((c||0)/2))}}else null==r||r.removeAttribute("filter")}(this.context.config.document||document,this.$def,e,t,n)},e.prototype.createOrUpdateFilter=function(e,t,n){m(this.context.config.document||document,this.$def,e,t,n)},e}();function C(e){return e.toFixed(6).replace(".000000","")}function b(e){return e.replace(/[&|<|>|"|']/g,(function(e){return"&"===e?"&amp;":"<"===e?"&lt;":">"===e?"&gt;":'"'===e?"&quot;":"&apos;"}))}var P,O,I={opacity:"opacity",fillStyle:"fill",fill:"fill",fillRule:"fill-rule",fillOpacity:"fill-opacity",strokeStyle:"stroke",strokeOpacity:"stroke-opacity",stroke:"stroke",clipPath:"clip-path",textPath:"text-path",r:"r",rx:"rx",ry:"ry",width:"width",height:"height",lineCap:"stroke-linecap",lineJoin:"stroke-linejoin",lineWidth:"stroke-width",lineDash:"stroke-dasharray",lineDashOffset:"stroke-dashoffset",miterLimit:"stroke-miterlimit",font:"font",fontSize:"font-size",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",fontFamily:"font-family",letterSpacing:"letter-spacing",startArrow:"marker-start",endArrow:"marker-end",class:"class",id:"id",preserveAspectRatio:"preserveAspectRatio",visibility:"visibility",anchor:"anchor",shadowColor:"flood-color",shadowBlur:"stdDeviation",shadowOffsetX:"dx",shadowOffsetY:"dy",filter:"filter",innerHTML:"innerHTML",textAlign:"text-anchor",pointerEvents:"pointer-events"},w={textAlign:{inherit:"inherit",left:"left",start:"left",center:"middle",right:"end",end:"end"}},L={textAlign:"inherit",lineCap:"butt",lineJoin:"miter",lineWidth:"1px",opacity:"1",fillOpacity:"1",fillRule:"nonzero",strokeOpacity:"1",strokeWidth:"0",strokeMiterLimit:"4",letterSpacing:"0",fontSize:"inherit",fontFamily:"inherit",pointerEvents:"auto"},D="g-svg",B="clip-path-",F="text-path-",U=function(){function e(e,t,n){this.pluginOptions=e,this.defElementManager=t,this.context=n,this.svgElementMap=new WeakMap,this.renderQueue=[],this.dirtyAttributes=new WeakMap,this.pendingReorderQueue=new Set,this.clipPathUseMap=new WeakMap}return e.prototype.apply=function(t){var n=this,r=t.renderingService,a=t.renderingContext;this.context=t,this.context.svgElementMap=this.svgElementMap;var o=a.root.ownerDocument.defaultView,s=this.context.config.document,l=function(e){var t=e.target;if(n.clipPathUseMap.get(t)){var r=n.defElementManager.getDefElement().querySelector("#".concat(n.getId(t)));r&&r.remove()}n.createSVGDom(s,t,n.$camera)},u=function(e){var t=e.target;n.defElementManager.clear(t.entity),n.clipPathUseMap.delete(t),n.removeSVGDom(t)},c=function(e){var t,r,i=e.parentNode,a=null===(r=null===(t=e.parentNode)||void 0===t?void 0:t.elementSVG)||void 0===r?void 0:r.$groupEl,o=((null==i?void 0:i.children)||[]).slice();a&&n.reorderChildren(s,a,o)},h=function(e){var t=e.target;c(t)},d=function(e){var t=e.target;if(t.elementSVG){var r=e.attrName,i=n.dirtyAttributes.get(t);i||(n.dirtyAttributes.set(t,[]),i=n.dirtyAttributes.get(t)),i.push(r)}},v=function(e){var t,r=e.target,a=null===(t=r.elementSVG)||void 0===t?void 0:t.$el,o=r.parsedStyle,s=o.fill,l=o.stroke,u=o.clipPath;if(s&&!(0,i.qA)(s)&&n.defElementManager.createOrUpdateGradientAndPattern(r,a,s,"fill",n),l&&!(0,i.qA)(l)&&n.defElementManager.createOrUpdateGradientAndPattern(r,a,l,"stroke",n),u){var c=f.invert(f.create(),r.getWorldTransform()),h=B+u.entity+"-"+r.entity,d=n.defElementManager.getDefElement().querySelector("#".concat(h));d&&n.applyTransform(d,c)}};r.hooks.init.tap(e.tag,(function(){var e=n.context.config,t=e.background,r=e.document;n.defElementManager.init();var a=n.context.contextService.getContext();t&&(a.style.background=t),a.setAttribute("color-interpolation-filters","sRGB"),n.$camera=p("g",r),n.$camera.id="".concat(D,"-camera"),n.applyTransform(n.$camera,n.context.camera.getOrthoMatrix()),a.appendChild(n.$camera),o.addEventListener(i.Dk.MOUNTED,l),o.addEventListener(i.Dk.UNMOUNTED,u),o.addEventListener(i.Dk.REPARENT,h),o.addEventListener(i.Dk.ATTR_MODIFIED,d),o.addEventListener(i.Dk.BOUNDS_CHANGED,v)})),r.hooks.destroy.tap(e.tag,(function(){o.removeEventListener(i.Dk.MOUNTED,l),o.removeEventListener(i.Dk.UNMOUNTED,u),o.removeEventListener(i.Dk.REPARENT,h),o.removeEventListener(i.Dk.ATTR_MODIFIED,d),o.removeEventListener(i.Dk.BOUNDS_CHANGED,v),S=0,T={}})),r.hooks.render.tap(e.tag,(function(e){n.renderQueue.push(e)})),r.hooks.beginFrame.tap(e.tag,(function(){var e=n.context.config.document;n.pendingReorderQueue.size&&(n.pendingReorderQueue.forEach((function(t){var r,i=((null==t?void 0:t.children)||[]).slice(),a=null===(r=null==t?void 0:t.elementSVG)||void 0===r?void 0:r.$groupEl;a&&n.reorderChildren(e||s,a,i||[])})),n.pendingReorderQueue.clear())})),r.hooks.endFrame.tap(e.tag,(function(){a.renderReasons.has(i.Rr.CAMERA_CHANGED)&&n.applyTransform(n.$camera,n.context.camera.getOrthoMatrix()),n.renderQueue.forEach((function(e){var t,r,i=null===(t=e.elementSVG)||void 0===t?void 0:t.$el,a=null===(r=e.elementSVG)||void 0===r?void 0:r.$groupEl;if(i&&a){var o=e.getLocalTransform();n.applyTransform(a,o);var s=n.clipPathUseMap.get(e);s&&s.length&&s.forEach((function(t){n.applyTransform(t,e.getWorldTransform())})),e.renderable.dirty=!1}var l=n.dirtyAttributes.get(e);l&&(l.forEach((function(t){"zIndex"===t?c(e):"increasedLineWidthForHitTesting"===t&&n.createOrUpdateHitArea(e,i,a),n.updateAttribute(e,[t])})),n.dirtyAttributes.delete(e))})),n.renderQueue=[]}))},e.prototype.getId=function(e){return e.id||"".concat(D,"-").concat(e.entity)},e.prototype.reorderChildren=function(e,t,n){if(n.sort((function(e,t){return e.sortable.renderOrder-t.sortable.renderOrder})),n.length){var r=(e||document).createDocumentFragment();n.forEach((function(e){if(e.isConnected){var t=e.elementSVG.$groupEl;t&&r.appendChild(t)}})),t.appendChild(r)}},e.prototype.applyTransform=function(e,t){e.setAttribute("transform","matrix(".concat(C(t[0]),",").concat(C(t[1]),",").concat(C(t[4]),",").concat(C(t[5]),",").concat(C(t[12]),",").concat(C(t[13]),")"))},e.prototype.applyAttributes=function(e){var t=e.elementSVG,n=null==t?void 0:t.$el,r=null==t?void 0:t.$groupEl;if(n&&r){var a=e.nodeName,o=e.attributes;a!==i.bn.HTML&&n.setAttribute("fill","none"),a===i.bn.IMAGE&&n.setAttribute("preserveAspectRatio","none"),this.updateAttribute(e,Object.keys(o))}},e.prototype.updateAttribute=function(e,t){var n=this,r=this.context.enableCSSParsing,a=this.context.config.document,o=e.elementSVG,s=o.$el,l=o.$groupEl,u=o.$hitTestingEl,c=e.parsedStyle,h=e.computedStyle,f=e.nodeName;t.some((function(t){return n.context.SVGElementLifeCycleContribution.shouldUpdateElementAttribute(e,t)}))&&s&&[s,u].forEach((function(t){t&&(n.context.SVGElementLifeCycleContribution.updateElementAttribute(e,t,n.svgElementMap),e.nodeName!==i.bn.TEXT&&n.updateAnchorWithTransform(e))})),t.forEach((function(t){var o,v,p=I[t],g=r?h[t]:c[t],m=!(0,d.Z)(g)&&g.toString(),y=(null===(o=w[t])||void 0===o?void 0:o[m])||m,E=c[t],_=p&&!!(null===(v=i.N1[t])||void 0===v?void 0:v.inh);if(f===i.bn.HTML)"fill"===t?s.style.background=E.toString():"stroke"===t?(s.style["border-color"]=E.toString(),s.style["border-style"]="solid"):"lineWidth"===t?s.style["border-width"]="".concat(E||0,"px"):"lineDash"===t?s.style["border-style"]="dashed":"innerHTML"===t?n.createOrUpdateInnerHTML(a,s,E):"width"===t||"height"===t||"class"===t?s.setAttribute(t,E.toString()):"x"===t||"y"===t||(0,d.Z)(e.style[t])||""===e.style[t]||(s.style[t]=e.style[t]);else{if(!p||(f===i.bn.GROUP||e.isCustomElement)&&!r&&(_||"fill"===p||"stroke"===p))return;"fill"===t||"stroke"===t?n.defElementManager.createOrUpdateGradientAndPattern(e,s,E,p,n):r&&_?"unset"!==m&&m!==L[t]?null==l||l.setAttribute(p,y):null==l||l.removeAttribute(p):"clipPath"===t?n.createOrUpdateClipOrTextPath(a,E,e):"textPath"===t?n.createOrUpdateClipOrTextPath(a,E,e,!0):"shadowType"===t||"shadowColor"===t||"shadowBlur"===t||"shadowOffsetX"===t||"shadowOffsetY"===t?n.defElementManager.createOrUpdateShadow(e,s,t):"filter"===t?n.defElementManager.createOrUpdateFilter(e,s,E):"anchor"===t?f!==i.bn.TEXT&&n.updateAnchorWithTransform(e):(0,d.Z)(g)||[s,u].forEach((function(e){e&&p&&("unset"!==m&&m!==L[t]?e.setAttribute(p,y):e.removeAttribute(p))}))}}))},e.prototype.createSVGDom=function(e,t,n,r){var a;void 0===r&&(r=!1),t.elementSVG=new v;var o=t.elementSVG,s=this.context.SVGElementLifeCycleContribution.createElement(t,this.svgElementMap);if(s){var l=void 0;t.nodeName===i.bn.HTML&&(t.parsedStyle.$el=s),this.pluginOptions.outputSVGElementId&&(s.id=this.getId(t)),this.pluginOptions.outputSVGElementName&&t.name&&s.setAttribute("name",t.name),!s.hasAttribute("data-wrapgroup")&&"g"===s.nodeName||r?l=s:(l=p("g",e)).appendChild(s),o.$el=s,o.$groupEl=l,this.applyAttributes(t),this.createOrUpdateHitArea(t,s,l);var u=n||t.parentNode&&(null===(a=t.parentNode.elementSVG)||void 0===a?void 0:a.$groupEl);u&&(u.appendChild(l),this.pendingReorderQueue.add(t.parentNode))}},e.prototype.removeSVGDom=function(e){var t,n=null===(t=e.elementSVG)||void 0===t?void 0:t.$groupEl;n&&n.parentNode&&(n.parentNode.removeChild(n),this.context.SVGElementLifeCycleContribution.destroyElement(e,n))},e.prototype.createOrUpdateHitArea=function(e,t,n){var r=e.elementSVG,i=r.$hitTestingEl,a=Number(e.parsedStyle.increasedLineWidthForHitTesting);if(a){if(!i){i=t.cloneNode(),["filter"].forEach((function(e){i.removeAttribute(e)}));var o="none"!==t.getAttribute("fill");i.setAttribute("fill",o?"transparent":"none"),i.setAttribute("stroke","transparent"),n.appendChild(i),r.$hitTestingEl=i,this.svgElementMap.set(i,e)}i.setAttribute("stroke-width","".concat(a+e.parsedStyle.lineWidth))}else i&&(n.removeChild(i),r.$hitTestingEl=null)},e.prototype.createOrUpdateInnerHTML=function(e,t,n){var r=(e||document).createElement("div");"string"==typeof n?r.innerHTML=n:r.appendChild(n),t.innerHTML="",t.appendChild(r)},e.prototype.createOrUpdateClipOrTextPath=function(e,t,n,r){void 0===r&&(r=!1);var i=n.elementSVG.$groupEl,a=r?"g":"clipPath",o=r?"text-path":"clip-path";if(t){var s=(r?F:B)+t.entity+"-"+n.entity,l=this.defElementManager.getDefElement();if(!l.querySelector("#".concat(s))){var u=void 0;if(r)this.createSVGDom(e,t,null,!0),u=t.elementSVG.$el;else{if(!t.isConnected)l.querySelector("#".concat(this.getId(t)))||this.createSVGDom(e,t,l,!0);u=p(a,e);var c=p("use",e);c.setAttribute("href","#".concat(t.elementSVG.$el.id)),u.appendChild(c);var h=this.clipPathUseMap.get(t);h||(this.clipPathUseMap.set(t,[]),h=this.clipPathUseMap.get(t)),h.push(c),this.applyTransform(c,t.getWorldTransform());var d=f.invert(f.create(),n.getWorldTransform());this.applyTransform(u,d)}this.pluginOptions.outputSVGElementId&&(u.id=s),l.appendChild(u)}this.applyAttributes(t),r||i.setAttribute(o,"url(#".concat(s,")"))}else r||i.removeAttribute(o)},e.prototype.updateAnchorWithTransform=function(e){var t,n,r=e.getGeometryBounds(),a=r&&2*r.halfExtents[0]||0,o=r&&2*r.halfExtents[1]||0,s=(e.parsedStyle||{}).anchor;[null===(t=e.elementSVG)||void 0===t?void 0:t.$el,null===(n=e.elementSVG)||void 0===n?void 0:n.$hitTestingEl].forEach((function(t){if(t){var n=-s[0]*a,r=-s[1]*o;0===n&&0===r||t.setAttribute("transform","translate(".concat(n,",").concat(r,")")),e.nodeName!==i.bn.CIRCLE&&e.nodeName!==i.bn.ELLIPSE||(t.setAttribute("cx","".concat(a/2)),t.setAttribute("cy","".concat(o/2)))}}))},e.tag="SVGRenderer",e}(),Z={top:"hanging",middle:"central",bottom:"text-after-edge",alphabetic:"alphabetic",ideographic:"ideographic",hanging:"hanging"};var G=((P={})[i.bn.RECT]="path",P[i.bn.CIRCLE]="circle",P[i.bn.ELLIPSE]="ellipse",P[i.bn.IMAGE]="image",P[i.bn.GROUP]="g",P[i.bn.LINE]="line",P[i.bn.POLYLINE]="polyline",P[i.bn.POLYGON]="polygon",P[i.bn.TEXT]="text",P[i.bn.PATH]="path",P[i.bn.HTML]="foreignObject",P),V=((O={})[i.bn.CIRCLE]=["r"],O[i.bn.ELLIPSE]=["rx","ry"],O[i.bn.RECT]=["width","height","radius"],O[i.bn.IMAGE]=["img","width","height"],O[i.bn.LINE]=["x1","y1","x2","y2","markerStart","markerEnd","markerStartOffset","markerEndOffset"],O[i.bn.POLYLINE]=["points","markerStart","markerEnd","markerMid","markerStartOffset","markerEndOffset"],O[i.bn.POLYGON]=["points","markerStart","markerEnd","markerMid","markerStartOffset","markerEndOffset"],O[i.bn.PATH]=["path","markerStart","markerEnd","markerMid","markerStartOffset","markerEndOffset"],O[i.bn.TEXT]=["text","font","fontSize","fontFamily","fontStyle","fontWeight","fontVariant","lineHeight","letterSpacing","wordWrap","wordWrapWidth","maxLines","leading","textBaseline","textAlign","textTransform","textOverflow","textPath","textPathSide","textPathStartOffset","textDecorationLine","textDecorationColor","textDecorationStyle","dx","dy"],O),W=function(){function e(e,t){this.context=e,this.runtime=t}return e.prototype.createElement=function(e,t){var n=this.context.config.document,r=p(G[e.nodeName]||"g",n||document);return t.set(r,e),r},e.prototype.destroyElement=function(e,t){},e.prototype.shouldUpdateElementAttribute=function(e,t){var n=e.nodeName;return(V[n]||[]).indexOf(t)>-1},e.prototype.updateElementAttribute=function(e){var t=e.elementSVG.$el,n=e.nodeName,a=e.parsedStyle;switch(n){case i.bn.IMAGE:!function(e,t){var n=t.img,r=void 0===n?"":n,i=t.width,a=t.height;if(e.setAttribute("x","0"),e.setAttribute("y","0"),(0,c.Z)(r))e.setAttribute("href",r);else if(r instanceof Image)i||e.setAttribute("width","".concat(r.width)),a||e.setAttribute("height","".concat(r.height)),e.setAttribute("href",r.src);else if(r instanceof HTMLElement&&(0,c.Z)(r.nodeName)&&"CANVAS"===r.nodeName.toUpperCase())e.setAttribute("href",r.toDataURL());else if(r instanceof ImageData){var o=document.createElement("canvas");o.setAttribute("width","".concat(r.width)),o.setAttribute("height","".concat(r.height));var s=o.getContext("2d");s&&(s.putImageData(r,0,0),i||e.setAttribute("width","".concat(r.width)),a||e.setAttribute("height","".concat(r.height)),e.setAttribute("href",o.toDataURL()))}}(t,a);break;case i.bn.RECT:!function(e,t){var n=t.radius,i=t.width,a=t.height;if(isFinite(i)&&isFinite(a)){var o="";if(n&&n.some((function(e){return 0!==e}))){var s=(0,r.__read)(n.map((function(e){return(0,h.Z)(e,0,Math.min(Math.abs(i)/2,Math.abs(a)/2))})),4),l=s[0],u=s[1],c=s[2],d=s[3],f=i>0?1:-1,v=a>0?1:-1,p=f+v!==0?1:0;o=[["M ".concat(f*l,",0")],["l ".concat(i-f*(l+u),",0")],["a ".concat(u,",").concat(u,",0,0,").concat(p,",").concat(f*u,",").concat(v*u)],["l 0,".concat(a-v*(u+c))],["a ".concat(c,",").concat(c,",0,0,").concat(p,",").concat(-f*c,",").concat(v*c)],["l ".concat(f*(c+d)-i,",0")],["a ".concat(d,",").concat(d,",0,0,").concat(p,",").concat(-f*d,",").concat(-v*d)],["l 0,".concat(v*(d+l)-a)],["a ".concat(l,",").concat(l,",0,0,").concat(p,",").concat(f*l,",").concat(-v*l)],["z"]].join(" ")}else o="M 0,0 l ".concat(i,",0 l 0,").concat(a," l").concat(-i," 0 z");e.setAttribute("d",o)}}(t,a);break;case i.bn.LINE:!function(e,t){var n,r,a=t.x1,o=t.y1,s=t.x2,l=t.y2,u=t.defX,c=void 0===u?0:u,h=t.defY,d=void 0===h?0:h,f=t.markerStart,v=t.markerEnd,p=t.markerStartOffset,g=t.markerEndOffset,m=0,y=0,E=0,_=0,T=0;f&&(0,i.RV)(f)&&p&&(n=s-a,r=l-o,T=Math.atan2(r,n),m=Math.cos(T)*(p||0),y=Math.sin(T)*(p||0)),v&&(0,i.RV)(v)&&g&&(n=a-s,r=o-l,T=Math.atan2(r,n),E=Math.cos(T)*(g||0),_=Math.sin(T)*(g||0)),e.setAttribute("x1","".concat(a-c+m)),e.setAttribute("y1","".concat(o-d+y)),e.setAttribute("x2","".concat(s-c+E)),e.setAttribute("y2","".concat(l-d+_))}(t,a);break;case i.bn.POLYGON:case i.bn.POLYLINE:!function(e,t){var n=t.points.points,r=t.defX,a=void 0===r?0:r,o=t.defY,s=void 0===o?0:o,l=t.markerStart,u=t.markerStartOffset,c=t.markerEnd,h=t.markerEndOffset,d=n.length;if(n&&d>=2){var f=0,v=0,p=0,g=0,m=0,y=void 0,E=void 0;l&&(0,i.RV)(l)&&u&&(y=n[1][0]-n[0][0],E=n[1][1]-n[0][1],m=Math.atan2(E,y),f=Math.cos(m)*(u||0),v=Math.sin(m)*(u||0)),c&&(0,i.RV)(c)&&h&&(y=n[d-2][0]-n[d-1][0],E=n[d-2][1]-n[d-1][1],m=Math.atan2(E,y),p=Math.cos(m)*(h||0),g=Math.sin(m)*(h||0)),e.setAttribute("points",n.map((function(e,t){var n=0,r=0;return 0===t?(n=f,r=v):t===d-1&&(n=p,r=g),"".concat(e[0]-a+n,",").concat(e[1]-s+r)})).join(" "))}}(t,a);break;case i.bn.PATH:!function(e,t){var n,a,o=t.path,s=t.defX,l=void 0===s?0:s,u=t.defY,c=void 0===u?0:u,h=t.markerStart,d=t.markerEnd,f=t.markerStartOffset,v=t.markerEndOffset,p=0,g=0,m=0,y=0,E=0;if(h&&(0,i.RV)(h)&&f){var _=(0,r.__read)(h.parentNode.getStartTangent(),2),T=_[0],S=_[1];n=T[0]-S[0],a=T[1]-S[1],E=Math.atan2(a,n),p=Math.cos(E)*(f||0),g=Math.sin(E)*(f||0)}if(d&&(0,i.RV)(d)&&v){var R=(0,r.__read)(d.parentNode.getEndTangent(),2);T=R[0],S=R[1],n=T[0]-S[0],a=T[1]-S[1],E=Math.atan2(a,n),m=Math.cos(E)*(v||0),y=Math.sin(E)*(v||0)}e.setAttribute("d",(0,i.MM)(o.absolutePath,l,c,p,g,m,y))}(t,a);break;case i.bn.TEXT:!function(e,t,n,r){var i=t.lineWidth,a=t.dx,o=t.dy,s=t.textPath,l=t.textPathSide,u=void 0===l?"left":l,c=t.textPathStartOffset,h=void 0===c?0:c,d=t.textDecorationLine,f=void 0===d?"":d,v=t.textDecorationColor,g=void 0===v?"":v,m=t.textDecorationStyle,y=void 0===m?"":m,E=t.metrics,_=t.textBaseline;r.enableCSSParsing||"alphabetic"!==_||(_="bottom"),e.setAttribute("dominant-baseline",Z[_]),e.setAttribute("paint-order","stroke");var T=E.lines,S=E.lineHeight,R=E.height,A=T.length,x="";if(0===a&&0===o||(x+="transform:translate(".concat(a,"px, ").concat(o,"px);")),f&&"none"!==f&&(x+="text-decoration:".concat(f," ").concat(y," ").concat(g,";")),x&&e.setAttribute("style",x),1===A){var k=b(T[0]);if(e.setAttribute("dx","".concat(i/2)),"bottom"!==_&&"top"!==_||(e.setAttribute("dominant-baseline",Z.middle),e.setAttribute("dy","bottom"===_?"-".concat(R/2,"px"):"".concat(R/2,"px"))),s){e.innerHTML="";var N=p("textPath",e.ownerDocument);N.setAttribute("href","#".concat(F+s.entity)),"left"!==u&&N.setAttribute("side",u),0!==h&&N.setAttribute("startOffset","".concat(h)),N.innerHTML=k,e.appendChild(N)}else e.innerHTML=k}else e.innerHTML=T.map((function(e,t){var n=0;return 0===t?"middle"===_?n=S/2-R/2:"top"===_||"hanging"===_?n=0:"bottom"!==_&&"alphabetic"!==_&&"ideographic"!==_||(n=-S*(A-1)):n=S,'<tspan x="0" dx="'.concat(i/2,'" dy="').concat(n,'">').concat(b(e),"</tspan>")})).join("")}(t,a,0,this.runtime)}},e}(),H=function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return n.options=t,n.name="svg-renderer",n}return(0,r.__extends)(t,e),t.prototype.init=function(e){var t=this.options,n=t.outputSVGElementId,r=t.outputSVGElementName,i=new M(this.context),a=new W(this.context,e);this.context.defaultElementLifeCycleContribution=a,this.context.SVGElementLifeCycleContribution=a;var o={outputSVGElementId:!!(0,d.Z)(n)||!!n,outputSVGElementName:!!(0,d.Z)(r)||!!r};this.addRenderingPlugin(new U(o,i,this.context))},t.prototype.destroy=function(){this.removeAllRenderingPlugins(),delete this.context.defaultElementLifeCycleContribution,delete this.context.SVGElementLifeCycleContribution},t}(i.F6),X=n(15940),z=function(){function e(e){this.canvasConfig=e.config}return e.prototype.init=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a;return(0,r.__generator)(this,(function(r){return e=this.canvasConfig,t=e.container,n=e.document,this.$container=(0,c.Z)(t)?(n||document).getElementById(t):t,this.$container&&(this.$container.style.position||(this.$container.style.position="relative"),(i=p("svg",n)).setAttribute("width","".concat(this.canvasConfig.width)),i.setAttribute("height","".concat(this.canvasConfig.height)),this.$container.appendChild(i),this.$namespace=i),a=(a=window.devicePixelRatio||1)>=1?Math.ceil(a):1,this.dpr=a,[2]}))}))},e.prototype.getDomElement=function(){return this.$namespace},e.prototype.getContext=function(){return this.$namespace},e.prototype.getDPR=function(){return this.dpr},e.prototype.getBoundingClientRect=function(){var e;return null===(e=this.$namespace)||void 0===e?void 0:e.getBoundingClientRect()},e.prototype.destroy=function(){this.$container&&this.$namespace&&this.$namespace.parentNode&&this.$container.removeChild(this.$namespace)},e.prototype.resize=function(e,t){this.$namespace&&(this.$namespace.setAttribute("width","".concat(e)),this.$namespace.setAttribute("height","".concat(t)))},e.prototype.applyCursorStyle=function(e){this.$container&&(this.$container.style.cursor=e)},e.prototype.toDataURL=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n;return(0,r.__generator)(this,(function(r){return e=this.$namespace.cloneNode(!0),t=document.implementation.createDocumentType("svg","-//W3C//DTD SVG 1.1//EN","http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"),(n=document.implementation.createDocument("http://www.w3.org/2000/svg","svg",t)).replaceChild(e,n.documentElement),[2,"data:image/svg+xml;charset=utf8,".concat(encodeURIComponent((new XMLSerializer).serializeToString(n)))]}))}))},e}(),Y=function(e){function t(){var t=e.apply(this,(0,r.__spreadArray)([],(0,r.__read)(arguments),!1))||this;return t.name="mobile-svg-context-register",t}return(0,r.__extends)(t,e),t.prototype.init=function(){this.context.ContextService=z},t.prototype.destroy=function(){delete this.context.ContextService},t}(i.F6),j=function(e){function t(t){var n=e.call(this,t)||this;return n.registerPlugin(new Y),n.registerPlugin(new H),n.registerPlugin(new s),n.registerPlugin(new u),n.registerPlugin(new a.S({isDocumentDraggable:!!(0,d.Z)(null==t?void 0:t.isDocumentDraggable)||t.isDocumentDraggable,isDocumentDroppable:!!(0,d.Z)(null==t?void 0:t.isDocumentDroppable)||t.isDocumentDroppable,dragstartDistanceThreshold:(0,d.Z)(null==t?void 0:t.dragstartDistanceThreshold)?10:t.dragstartDistanceThreshold,dragstartTimeThreshold:(0,d.Z)(null==t?void 0:t.dragstartTimeThreshold)?50:t.dragstartTimeThreshold})),n.registerPlugin(new X.S({isDocumentGestureEnabled:!0})),n}return(0,r.__extends)(t,e),t}(i.I8)},66999:function(e,t,n){n.d(t,{Th:function(){return uf}});var r=n(34944),i=n.n(r),a=n(78643),o=n(54091),s=n(85545),l=n(62228),u=n(67538),c=n(96103),h=n(55332),d=n(38471),f=n(26186),v=n(47156),p=n(17517),g=n(88244),m=n(52810),y=n(38516),E=n(98773),_=n(43665),T=n(55072),S=n(79364),R=n(12873),A=n(24753),x=n(91508),k=n(53982),N=n(99107),M=n(57002),C=n(60241),b=n(31973),P=n(20773),O=n(50315),I=n(53894),w=n(76622),L=n(86703),D=n(70148),B=n(90176),F=n(17020),U=n(45327),Z=n(21254),G=n(57387),V=n(60286),W=n(67505),H=n(77280);function X(e,t,n,r){var i=e-n,a=t-r;return Math.sqrt(i*i+a*a)}function z(e,t){var n=Math.min.apply(Math,(0,c.Z)(e)),r=Math.min.apply(Math,(0,c.Z)(t));return{x:n,y:r,width:Math.max.apply(Math,(0,c.Z)(e))-n,height:Math.max.apply(Math,(0,c.Z)(t))-r}}function Y(e,t,n,r,i,a){return n*Math.cos(i)*Math.cos(a)-r*Math.sin(i)*Math.sin(a)+e}function j(e,t,n,r,i,a){return n*Math.sin(i)*Math.cos(a)+r*Math.cos(i)*Math.sin(a)+t}function K(e,t,n,r,i,a,o){for(var s=function(e,t,n){return Math.atan(-t/e*Math.tan(n))}(n,r,i),l=1/0,u=-1/0,c=[a,o],h=2*-Math.PI;h<=2*Math.PI;h+=Math.PI){var d=s+h;a<o?a<d&&d<o&&c.push(d):o<d&&d<a&&c.push(d)}for(var f=0;f<c.length;f++){var v=Y(e,0,n,r,i,c[f]);v<l&&(l=v),v>u&&(u=v)}for(var p=function(e,t,n){return Math.atan(t/(e*Math.tan(n)))}(n,r,i),g=1/0,m=-1/0,y=[a,o],E=2*-Math.PI;E<=2*Math.PI;E+=Math.PI){var _=p+E;a<o?a<_&&_<o&&y.push(_):o<_&&_<a&&y.push(_)}for(var T=0;T<y.length;T++){var S=j(0,t,n,r,i,y[T]);S<g&&(g=S),S>m&&(m=S)}return{x:l,y:g,width:u-l,height:m-g}}function q(e,t,n,r){return X(e,t,n,r)}function $(e,t,n,r,i){return{x:(1-i)*e+i*n,y:(1-i)*t+i*r}}function Q(e,t,n,r,i){var a=1-i;return a*a*a*e+3*t*i*a*a+3*n*i*i*a+r*i*i*i}function J(e,t,n,r){var i,a,o,s=-3*e+9*t-9*n+3*r,l=6*e-12*t+6*n,u=3*t-3*e,c=[];if((0,N.Z)(s,0))(0,N.Z)(l,0)||(i=-u/l)>=0&&i<=1&&c.push(i);else{var h=l*l-4*s*u;(0,N.Z)(h,0)?c.push(-l/(2*s)):h>0&&(a=(-l-(o=Math.sqrt(h)))/(2*s),(i=(-l+o)/(2*s))>=0&&i<=1&&c.push(i),a>=0&&a<=1&&c.push(a))}return c}function ee(e,t,n,r,i,a,o,s,l){if(0===l)return function(e,t){for(var n=0,r=e.length,i=0;i<r;i++)n+=X(e[i],t[i],e[(i+1)%r],t[(i+1)%r]);return n/2}([e,n,i,o],[t,r,a,s]);var u=function(e,t,n,r,i,a,o,s,l){var u=Q(e,n,i,o,l),c=Q(t,r,a,s,l),h=$(e,t,n,r,l),d=$(n,r,i,a,l),f=$(i,a,o,s,l),v=$(h.x,h.y,d.x,d.y,l),p=$(d.x,d.y,f.x,f.y,l);return[[e,t,h.x,h.y,v.x,v.y,u,c],[u,c,p.x,p.y,f.x,f.y,o,s]]}(e,t,n,r,i,a,o,s,.5),h=[].concat((0,c.Z)(u[0]),[l-1]),d=[].concat((0,c.Z)(u[1]),[l-1]);return ee.apply(void 0,(0,c.Z)(h))+ee.apply(void 0,(0,c.Z)(d))}function te(e,t,n,r,i,a,o,s){for(var l=[e,o],u=[t,s],c=J(e,n,i,o),h=J(t,r,a,s),d=0;d<c.length;d++)l.push(Q(e,n,i,o,c[d]));for(var f=0;f<h.length;f++)u.push(Q(t,r,a,s,h[f]));return z(l,u)}function ne(e){if(e.length<2)return 0;for(var t=0,n=0;n<e.length-1;n++){var r=e[n],i=e[n+1];t+=X(r[0],r[1],i[0],i[1])}return t}function re(e,t,n,r){var i=1-r;return i*i*e+2*r*i*t+r*r*n}function ie(e,t,n){var r=e+n-2*t;if((0,N.Z)(r,0))return[.5];var i=(e-t)/r;return i<=1&&i>=0?[i]:[]}function ae(e,t,n,r,i,a,o){if(0===o)return(X(e,t,n,r)+X(n,r,i,a)+X(e,t,i,a))/2;var s=function(e,t,n,r,i,a,o){var s=re(e,n,i,o),l=re(t,r,a,o),u=$(e,t,n,r,o),c=$(n,r,i,a,o);return[[e,t,u.x,u.y,s,l],[s,l,c.x,c.y,i,a]]}(e,t,n,r,i,a,.5),l=s[0],u=s[1];return l.push(o-1),u.push(o-1),ae.apply(void 0,(0,c.Z)(l))+ae.apply(void 0,(0,c.Z)(u))}function oe(e,t,n,r,i,a){var o=ie(e,n,i)[0],s=ie(t,r,a)[0],l=[e,i],u=[t,a];return void 0!==o&&l.push(re(e,n,i,o)),void 0!==s&&u.push(re(t,r,a,s)),z(l,u)}var se=n(77135),le=n(4933),ue=n(24395),ce=n(76895),he=function(e){return e.GROUP="g",e.FRAGMENT="fragment",e.CIRCLE="circle",e.ELLIPSE="ellipse",e.IMAGE="image",e.RECT="rect",e.LINE="line",e.POLYLINE="polyline",e.POLYGON="polygon",e.TEXT="text",e.PATH="path",e.HTML="html",e.MESH="mesh",e}({}),de=function(e){return e[e.ZERO=0]="ZERO",e[e.NEGATIVE_ONE=1]="NEGATIVE_ONE",e}({}),fe=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.plugins=[]}),[{key:"addRenderingPlugin",value:function(e){this.plugins.push(e),this.context.renderingPlugins.push(e)}},{key:"removeAllRenderingPlugins",value:function(){var e=this;this.plugins.forEach((function(t){var n=e.context.renderingPlugins.indexOf(t);n>=0&&e.context.renderingPlugins.splice(n,1)}))}}])}(),ve=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.clipSpaceNearZ=de.NEGATIVE_ONE,this.plugins=[],this.config=(0,u.Z)({enableDirtyCheck:!0,enableCulling:!1,enableAutoRendering:!0,enableDirtyRectangleRendering:!0,enableDirtyRectangleRenderingDebug:!1,enableSizeAttenuation:!0,enableRenderingOptimization:!1},t)}),[{key:"registerPlugin",value:function(e){-1===this.plugins.findIndex((function(t){return t===e}))&&this.plugins.push(e)}},{key:"unregisterPlugin",value:function(e){var t=this.plugins.findIndex((function(t){return t===e}));t>-1&&this.plugins.splice(t,1)}},{key:"getPlugins",value:function(){return this.plugins}},{key:"getPlugin",value:function(e){return this.plugins.find((function(t){return t.name===e}))}},{key:"getConfig",value:function(){return this.config}},{key:"setConfig",value:function(e){Object.assign(this.config,e)}}])}(),pe=f.add,ge=f.copy,me=f.max,ye=f.min,Ee=f.scale,_e=f.sub,Te=function(){function e(){(0,o.Z)(this,e),this.center=[0,0,0],this.halfExtents=[0,0,0],this.min=[0,0,0],this.max=[0,0,0]}return(0,a.Z)(e,[{key:"update",value:function(e,t){ge(this.center,e),ge(this.halfExtents,t),_e(this.min,this.center,this.halfExtents),pe(this.max,this.center,this.halfExtents)}},{key:"setMinMax",value:function(e,t){pe(this.center,t,e),Ee(this.center,this.center,.5),_e(this.halfExtents,t,e),Ee(this.halfExtents,this.halfExtents,.5),ge(this.min,e),ge(this.max,t)}},{key:"getMin",value:function(){return this.min}},{key:"getMax",value:function(){return this.max}},{key:"add",value:function(t){if(!e.isEmpty(t))if(e.isEmpty(this))this.setMinMax(t.getMin(),t.getMax());else{var n=this.center,r=n[0],i=n[1],a=n[2],o=this.halfExtents,s=o[0],l=o[1],u=o[2],c=r-s,h=r+s,d=i-l,f=i+l,v=a-u,p=a+u,g=t.center,m=g[0],y=g[1],E=g[2],_=t.halfExtents,T=_[0],S=_[1],R=_[2],A=m-T,x=m+T,k=y-S,N=y+S,M=E-R,C=E+R;A<c&&(c=A),x>h&&(h=x),k<d&&(d=k),N>f&&(f=N),M<v&&(v=M),C>p&&(p=C),n[0]=.5*(c+h),n[1]=.5*(d+f),n[2]=.5*(v+p),o[0]=.5*(h-c),o[1]=.5*(f-d),o[2]=.5*(p-v),this.min[0]=c,this.min[1]=d,this.min[2]=v,this.max[0]=h,this.max[1]=f,this.max[2]=p}}},{key:"setFromTransformedAABB",value:function(e,t){var n=this.center,r=this.halfExtents,i=e.center,a=e.halfExtents,o=t[0],s=t[4],l=t[8],u=t[1],c=t[5],h=t[9],d=t[2],f=t[6],v=t[10],p=Math.abs(o),g=Math.abs(s),m=Math.abs(l),y=Math.abs(u),E=Math.abs(c),_=Math.abs(h),T=Math.abs(d),S=Math.abs(f),R=Math.abs(v);n[0]=t[12]+o*i[0]+s*i[1]+l*i[2],n[1]=t[13]+u*i[0]+c*i[1]+h*i[2],n[2]=t[14]+d*i[0]+f*i[1]+v*i[2],r[0]=p*a[0]+g*a[1]+m*a[2],r[1]=y*a[0]+E*a[1]+_*a[2],r[2]=T*a[0]+S*a[1]+R*a[2],_e(this.min,n,r),pe(this.max,n,r)}},{key:"intersects",value:function(e){var t=this.getMax(),n=this.getMin(),r=e.getMax(),i=e.getMin();return n[0]<=r[0]&&t[0]>=i[0]&&n[1]<=r[1]&&t[1]>=i[1]&&n[2]<=r[2]&&t[2]>=i[2]}},{key:"intersection",value:function(t){if(!this.intersects(t))return null;var n=new e,r=me([0,0,0],this.getMin(),t.getMin()),i=ye([0,0,0],this.getMax(),t.getMax());return n.setMinMax(r,i),n}},{key:"getNegativeFarPoint",value:function(e){return 273===e.pnVertexFlag?ge([0,0,0],this.min):272===e.pnVertexFlag?[this.min[0],this.min[1],this.max[2]]:257===e.pnVertexFlag?[this.min[0],this.max[1],this.min[2]]:256===e.pnVertexFlag?[this.min[0],this.max[1],this.max[2]]:17===e.pnVertexFlag?[this.max[0],this.min[1],this.min[2]]:16===e.pnVertexFlag?[this.max[0],this.min[1],this.max[2]]:1===e.pnVertexFlag?[this.max[0],this.max[1],this.min[2]]:[this.max[0],this.max[1],this.max[2]]}},{key:"getPositiveFarPoint",value:function(e){return 273===e.pnVertexFlag?ge([0,0,0],this.max):272===e.pnVertexFlag?[this.max[0],this.max[1],this.min[2]]:257===e.pnVertexFlag?[this.max[0],this.min[1],this.max[2]]:256===e.pnVertexFlag?[this.max[0],this.min[1],this.min[2]]:17===e.pnVertexFlag?[this.min[0],this.max[1],this.max[2]]:16===e.pnVertexFlag?[this.min[0],this.max[1],this.min[2]]:1===e.pnVertexFlag?[this.min[0],this.min[1],this.max[2]]:[this.min[0],this.min[1],this.min[2]]}}],[{key:"isEmpty",value:function(e){return!e||0===e.halfExtents[0]&&0===e.halfExtents[1]&&0===e.halfExtents[2]}}])}(),Se=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e),this.distance=t||0,this.normal=n||f.fromValues(0,1,0),this.updatePNVertexFlag()}),[{key:"updatePNVertexFlag",value:function(){this.pnVertexFlag=(Number(this.normal[0]>=0)<<8)+(Number(this.normal[1]>=0)<<4)+Number(this.normal[2]>=0)}},{key:"distanceToPoint",value:function(e){return f.dot(e,this.normal)-this.distance}},{key:"normalize",value:function(){var e=1/f.len(this.normal);f.scale(this.normal,this.normal,e),this.distance*=e}},{key:"intersectsLine",value:function(e,t,n){var r=this.distanceToPoint(e),i=r/(r-this.distanceToPoint(t)),a=i>=0&&i<=1;return a&&n&&f.lerp(n,e,t,i),a}}])}(),Re=function(){return(0,a.Z)((function e(t){if((0,o.Z)(this,e),this.planes=[],t)this.planes=t;else for(var n=0;n<6;n++)this.planes.push(new Se)}),[{key:"extractFromVPMatrix",value:function(e){var t=(0,h.Z)(e,16),n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=t[9],v=t[10],p=t[11],g=t[12],m=t[13],y=t[14],E=t[15];f.set(this.planes[0].normal,a-n,u-o,p-c),this.planes[0].distance=E-g,f.set(this.planes[1].normal,a+n,u+o,p+c),this.planes[1].distance=E+g,f.set(this.planes[2].normal,a+r,u+s,p+d),this.planes[2].distance=E+m,f.set(this.planes[3].normal,a-r,u-s,p-d),this.planes[3].distance=E-m,f.set(this.planes[4].normal,a-i,u-l,p-v),this.planes[4].distance=E-y,f.set(this.planes[5].normal,a+i,u+l,p+v),this.planes[5].distance=E+y,this.planes.forEach((function(e){e.normalize(),e.updatePNVertexFlag()}))}}])}(),Ae=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,o.Z)(this,e),this.x=0,this.y=0,this.x=t,this.y=n}return(0,a.Z)(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"copyFrom",value:function(e){this.x=e.x,this.y=e.y}}])}(),xe=function(){function e(t,n,r,i){(0,o.Z)(this,e),this.x=t,this.y=n,this.width=r,this.height=i,this.left=t,this.right=t+r,this.top=n,this.bottom=n+i}return(0,a.Z)(e,[{key:"toJSON",value:function(){}}],[{key:"fromRect",value:function(t){return new e(t.x,t.y,t.width,t.height)}},{key:"applyTransform",value:function(t,n){var r=v.fromValues(t.x,t.y,0,1),i=v.fromValues(t.x+t.width,t.y,0,1),a=v.fromValues(t.x,t.y+t.height,0,1),o=v.fromValues(t.x+t.width,t.y+t.height,0,1),s=v.create(),l=v.create(),u=v.create(),c=v.create();v.transformMat4(s,r,n),v.transformMat4(l,i,n),v.transformMat4(u,a,n),v.transformMat4(c,o,n);var h=Math.min(s[0],l[0],u[0],c[0]),d=Math.min(s[1],l[1],u[1],c[1]),f=Math.max(s[0],l[0],u[0],c[0]),p=Math.max(s[1],l[1],u[1],c[1]);return e.fromRect({x:h,y:d,width:f-h,height:p-d})}}])}(),ke="Method not implemented.";function Ne(e){return void 0===e?0:e>360||e<-360?e%360:e}var Me=f.create();function Ce(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Array.isArray(e)&&3===e.length?r?f.clone(e):f.copy(Me,e):(0,E.Z)(e)?r?f.fromValues(e,t,n):f.set(Me,e,t,n):r?f.fromValues(e[0],e[1]||t,e[2]||n):f.set(Me,e[0],e[1]||t,e[2]||n)}var be=Math.PI/180;function Pe(e){return e*be}var Oe=180/Math.PI;function Ie(e){return e*Oe}var we=Math.PI/2;function Le(e,t){return 16===t.length?function(e,t){var n,r,i=p.getScaling(f.create(),t),a=(0,h.Z)(i,3),o=a[0],s=a[1],l=a[2],u=Math.asin(-t[2]/o);return u<we?u>-we?(n=Math.atan2(t[6]/s,t[10]/l),r=Math.atan2(t[1]/o,t[0]/o)):(r=0,n=-Math.atan2(t[4]/s,t[5]/s)):(r=0,n=Math.atan2(t[4]/s,t[5]/s)),e[0]=n,e[1]=u,e[2]=r,e}(e,t):function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=r*r,s=i*i,l=a*a,u=n*n+o+s+l,c=n*a-r*i;return c>.499995*u?(e[0]=we,e[1]=2*Math.atan2(r,n),e[2]=0):c<-.499995*u?(e[0]=-we,e[1]=2*Math.atan2(r,n),e[2]=0):(e[0]=Math.asin(2*(n*i-a*r)),e[1]=Math.atan2(2*(n*a+r*i),1-2*(s+l)),e[2]=Math.atan2(2*(n*r+i*a),1-2*(o+s))),e}(e,t)}function De(e){var t=e[0],n=e[1],r=e[3],i=e[4],a=Math.sqrt(t*t+n*n),o=Math.sqrt(r*r+i*i);if(t*i-n*r<0&&(t<i?a=-a:o=-o),a){var s=1/a;t*=s,n*=s}if(o){var l=1/o;r*=l,i*=l}var u=Ie(Math.atan2(n,t));return[e[6],e[7],a,o,u]}var Be=p.create(),Fe=p.create(),Ue=v.create(),Ze=[f.create(),f.create(),f.create()],Ge=f.create();function Ve(e,t,n,r,i){e[0]=t[0]*r+n[0]*i,e[1]=t[1]*r+n[1]*i,e[2]=t[2]*r+n[2]*i}var We=function(e){return e[e.ORBITING=0]="ORBITING",e[e.EXPLORING=1]="EXPLORING",e[e.TRACKING=2]="TRACKING",e}({}),He=function(e){return e[e.DEFAULT=0]="DEFAULT",e[e.ROTATIONAL=1]="ROTATIONAL",e[e.TRANSLATIONAL=2]="TRANSLATIONAL",e[e.CINEMATIC=3]="CINEMATIC",e}({}),Xe=function(e){return e[e.ORTHOGRAPHIC=0]="ORTHOGRAPHIC",e[e.PERSPECTIVE=1]="PERSPECTIVE",e}({}),ze="updated",Ye=2e-4,je=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.clipSpaceNearZ=de.NEGATIVE_ONE,this.eventEmitter=new d.Z,this.matrix=p.create(),this.right=f.fromValues(1,0,0),this.up=f.fromValues(0,1,0),this.forward=f.fromValues(0,0,1),this.position=f.fromValues(0,0,1),this.focalPoint=f.fromValues(0,0,0),this.distanceVector=f.fromValues(0,0,-1),this.distance=1,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.dollyingStep=0,this.maxDistance=1/0,this.minDistance=-1/0,this.zoom=1,this.rotateWorld=!1,this.fov=30,this.near=.1,this.far=1e3,this.aspect=1,this.projectionMatrix=p.create(),this.projectionMatrixInverse=p.create(),this.jitteredProjectionMatrix=void 0,this.enableUpdate=!0,this.type=We.EXPLORING,this.trackingMode=He.DEFAULT,this.projectionMode=Xe.PERSPECTIVE,this.frustum=new Re,this.orthoMatrix=p.create()}),[{key:"isOrtho",value:function(){return this.projectionMode===Xe.ORTHOGRAPHIC}},{key:"getProjectionMode",value:function(){return this.projectionMode}},{key:"getPerspective",value:function(){return this.jitteredProjectionMatrix||this.projectionMatrix}},{key:"getPerspectiveInverse",value:function(){return this.projectionMatrixInverse}},{key:"getFrustum",value:function(){return this.frustum}},{key:"getPosition",value:function(){return this.position}},{key:"getFocalPoint",value:function(){return this.focalPoint}},{key:"getDollyingStep",value:function(){return this.dollyingStep}},{key:"getNear",value:function(){return this.near}},{key:"getFar",value:function(){return this.far}},{key:"getZoom",value:function(){return this.zoom}},{key:"getOrthoMatrix",value:function(){return this.orthoMatrix}},{key:"getView",value:function(){return this.view}},{key:"setEnableUpdate",value:function(e){this.enableUpdate=e}},{key:"setType",value:function(e,t){return this.type=e,this.type===We.EXPLORING?this.setWorldRotation(!0):this.setWorldRotation(!1),this._getAngles(),this.type===We.TRACKING&&void 0!==t&&this.setTrackingMode(t),this}},{key:"setProjectionMode",value:function(e){return this.projectionMode=e,this}},{key:"setTrackingMode",value:function(e){if(this.type!==We.TRACKING)throw new Error("Impossible to set a tracking mode if the camera is not of tracking type");return this.trackingMode=e,this}},{key:"setWorldRotation",value:function(e){return this.rotateWorld=e,this._getAngles(),this}},{key:"getViewTransform",value:function(){return p.invert(p.create(),this.matrix)}},{key:"getWorldTransform",value:function(){return this.matrix}},{key:"jitterProjectionMatrix",value:function(e,t){var n=p.fromTranslation(p.create(),[e,t,0]);this.jitteredProjectionMatrix=p.multiply(p.create(),n,this.projectionMatrix)}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0}},{key:"setMatrix",value:function(e){return this.matrix=e,this._update(),this}},{key:"setProjectionMatrix",value:function(e){this.projectionMatrix=e}},{key:"setFov",value:function(e){return this.setPerspective(this.near,this.far,e,this.aspect),this}},{key:"setAspect",value:function(e){return this.setPerspective(this.near,this.far,this.fov,e),this}},{key:"setNear",value:function(e){return this.projectionMode===Xe.PERSPECTIVE?this.setPerspective(e,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,e,this.far),this}},{key:"setFar",value:function(e){return this.projectionMode===Xe.PERSPECTIVE?this.setPerspective(this.near,e,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,e),this}},{key:"setViewOffset",value:function(e,t,n,r,i,a){return this.aspect=e/t,void 0===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.projectionMode===Xe.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"clearViewOffset",value:function(){return void 0!==this.view&&(this.view.enabled=!1),this.projectionMode===Xe.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"setZoom",value:function(e){return this.zoom=e,this.projectionMode===Xe.ORTHOGRAPHIC?this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far):this.projectionMode===Xe.PERSPECTIVE&&this.setPerspective(this.near,this.far,this.fov,this.aspect),this}},{key:"setZoomByViewportPoint",value:function(e,t){var n=this.canvas.viewport2Canvas({x:t[0],y:t[1]}),r=n.x,i=n.y,a=this.roll;this.rotate(0,0,-a),this.setPosition(r,i),this.setFocalPoint(r,i),this.setZoom(e),this.rotate(0,0,a);var o=this.canvas.viewport2Canvas({x:t[0],y:t[1]}),s=o.x,l=o.y,u=f.fromValues(s-r,l-i,0),c=f.dot(u,this.right)/f.length(this.right),d=f.dot(u,this.up)/f.length(this.up),v=this.getPosition(),p=(0,h.Z)(v,2),g=p[0],m=p[1],y=this.getFocalPoint(),E=(0,h.Z)(y,2),_=E[0],T=E[1];return this.setPosition(g-c,m-d),this.setFocalPoint(_-c,T-d),this}},{key:"setPerspective",value:function(e,t,n,r){var i;this.projectionMode=Xe.PERSPECTIVE,this.fov=n,this.near=e,this.far=t,this.aspect=r;var a=this.near*Math.tan(Pe(.5*this.fov))/this.zoom,o=2*a,s=this.aspect*o,l=-.5*s;if(null!==(i=this.view)&&void 0!==i&&i.enabled){var u=this.view.fullWidth,c=this.view.fullHeight;l+=this.view.offsetX*s/u,a-=this.view.offsetY*o/c,s*=this.view.width/u,o*=this.view.height/c}return function(e,t,n,r,i,a,o){var s,l,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=2*a,h=n-t,d=r-i,f=c/h,v=c/d,p=(n+t)/h,g=(r+i)/d,m=o-a,y=o*a;u?(s=-o/m,l=-y/m):(s=-(o+a)/m,l=-2*y/m),e[0]=f,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=v,e[6]=0,e[7]=0,e[8]=p,e[9]=g,e[10]=s,e[11]=-1,e[12]=0,e[13]=0,e[14]=l,e[15]=0}(this.projectionMatrix,l,l+s,a-o,a,e,this.far,this.clipSpaceNearZ===de.ZERO),p.invert(this.projectionMatrixInverse,this.projectionMatrix),this.triggerUpdate(),this}},{key:"setOrthographic",value:function(e,t,n,r,i,a){var o;this.projectionMode=Xe.ORTHOGRAPHIC,this.rright=t,this.left=e,this.top=n,this.bottom=r,this.near=i,this.far=a;var s=(this.rright-this.left)/(2*this.zoom),l=(this.top-this.bottom)/(2*this.zoom),u=(this.rright+this.left)/2,c=(this.top+this.bottom)/2,h=u-s,d=u+s,f=c+l,v=c-l;if(null!==(o=this.view)&&void 0!==o&&o.enabled){var g=(this.rright-this.left)/this.view.fullWidth/this.zoom,m=(this.top-this.bottom)/this.view.fullHeight/this.zoom;d=(h+=g*this.view.offsetX)+g*this.view.width,v=(f-=m*this.view.offsetY)-m*this.view.height}return this.clipSpaceNearZ===de.NEGATIVE_ONE?p.ortho(this.projectionMatrix,h,d,f,v,i,a):p.orthoZO(this.projectionMatrix,h,d,f,v,i,a),p.invert(this.projectionMatrixInverse,this.projectionMatrix),this._getOrthoMatrix(),this.triggerUpdate(),this}},{key:"setPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.position[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.position[2],r=Ce(e,t,n);return this._setPosition(r),this.setFocalPoint(this.focalPoint),this.triggerUpdate(),this}},{key:"setFocalPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.focalPoint[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.focalPoint[2],r=f.fromValues(0,1,0);if(this.focalPoint=Ce(e,t,n),this.trackingMode===He.CINEMATIC){var i=f.subtract(f.create(),this.focalPoint,this.position);e=i[0],t=i[1],n=i[2];var a=f.length(i),o=Ie(Math.asin(t/a)),s=90+Ie(Math.atan2(n,e)),l=p.create();p.rotateY(l,l,Pe(s)),p.rotateX(l,l,Pe(o)),r=f.transformMat4(f.create(),[0,1,0],l)}return p.invert(this.matrix,p.lookAt(p.create(),this.position,this.focalPoint,r)),this._getAxes(),this._getDistance(),this._getAngles(),this.triggerUpdate(),this}},{key:"getDistance",value:function(){return this.distance}},{key:"getDistanceVector",value:function(){return this.distanceVector}},{key:"setDistance",value:function(e){if(this.distance===e||e<0)return this;this.distance=e,this.distance<Ye&&(this.distance=Ye),this.dollyingStep=this.distance/100;var t=f.create();e=this.distance;var n=this.forward,r=this.focalPoint;return t[0]=e*n[0]+r[0],t[1]=e*n[1]+r[1],t[2]=e*n[2]+r[2],this._setPosition(t),this.triggerUpdate(),this}},{key:"setMaxDistance",value:function(e){return this.maxDistance=e,this}},{key:"setMinDistance",value:function(e){return this.minDistance=e,this}},{key:"setAzimuth",value:function(e){return this.azimuth=Ne(e),this.computeMatrix(),this._getAxes(),this.type===We.ORBITING||this.type===We.EXPLORING?this._getPosition():this.type===We.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this}},{key:"getAzimuth",value:function(){return this.azimuth}},{key:"setElevation",value:function(e){return this.elevation=Ne(e),this.computeMatrix(),this._getAxes(),this.type===We.ORBITING||this.type===We.EXPLORING?this._getPosition():this.type===We.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this}},{key:"getElevation",value:function(){return this.elevation}},{key:"setRoll",value:function(e){return this.roll=Ne(e),this.computeMatrix(),this._getAxes(),this.type===We.ORBITING||this.type===We.EXPLORING?this._getPosition():this.type===We.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this}},{key:"getRoll",value:function(){return this.roll}},{key:"_update",value:function(){this._getAxes(),this._getPosition(),this._getDistance(),this._getAngles(),this._getOrthoMatrix(),this.triggerUpdate()}},{key:"computeMatrix",value:function(){var e=m.setAxisAngle(m.create(),[0,0,1],Pe(this.roll));p.identity(this.matrix);var t=m.setAxisAngle(m.create(),[1,0,0],Pe((this.rotateWorld&&this.type!==We.TRACKING||this.type===We.TRACKING?1:-1)*this.elevation)),n=m.setAxisAngle(m.create(),[0,1,0],Pe((this.rotateWorld&&this.type!==We.TRACKING||this.type===We.TRACKING?1:-1)*this.azimuth)),r=m.multiply(m.create(),n,t);r=m.multiply(m.create(),r,e);var i=p.fromQuat(p.create(),r);this.type===We.ORBITING||this.type===We.EXPLORING?(p.translate(this.matrix,this.matrix,this.focalPoint),p.multiply(this.matrix,this.matrix,i),p.translate(this.matrix,this.matrix,[0,0,this.distance])):this.type===We.TRACKING&&(p.translate(this.matrix,this.matrix,this.position),p.multiply(this.matrix,this.matrix,i))}},{key:"_setPosition",value:function(e,t,n){this.position=Ce(e,t,n);var r=this.matrix;r[12]=this.position[0],r[13]=this.position[1],r[14]=this.position[2],r[15]=1,this._getOrthoMatrix()}},{key:"_getAxes",value:function(){f.copy(this.right,Ce(v.transformMat4(v.create(),[1,0,0,0],this.matrix))),f.copy(this.up,Ce(v.transformMat4(v.create(),[0,1,0,0],this.matrix))),f.copy(this.forward,Ce(v.transformMat4(v.create(),[0,0,1,0],this.matrix))),f.normalize(this.right,this.right),f.normalize(this.up,this.up),f.normalize(this.forward,this.forward)}},{key:"_getAngles",value:function(){var e=this.distanceVector[0],t=this.distanceVector[1],n=this.distanceVector[2],r=f.length(this.distanceVector);if(0===r)return this.elevation=0,void(this.azimuth=0);this.type===We.TRACKING||this.rotateWorld?(this.elevation=Ie(Math.asin(t/r)),this.azimuth=Ie(Math.atan2(-e,-n))):(this.elevation=-Ie(Math.asin(t/r)),this.azimuth=-Ie(Math.atan2(-e,-n)))}},{key:"_getPosition",value:function(){f.copy(this.position,Ce(v.transformMat4(v.create(),[0,0,0,1],this.matrix))),this._getDistance()}},{key:"_getFocalPoint",value:function(){f.transformMat3(this.distanceVector,[0,0,-this.distance],g.fromMat4(g.create(),this.matrix)),f.add(this.focalPoint,this.position,this.distanceVector),this._getDistance()}},{key:"_getDistance",value:function(){this.distanceVector=f.subtract(f.create(),this.focalPoint,this.position),this.distance=f.length(this.distanceVector),this.dollyingStep=this.distance/100}},{key:"_getOrthoMatrix",value:function(){if(this.projectionMode===Xe.ORTHOGRAPHIC){var e=this.position,t=m.setAxisAngle(m.create(),[0,0,1],-this.roll*Math.PI/180);p.fromRotationTranslationScaleOrigin(this.orthoMatrix,t,f.fromValues((this.rright-this.left)/2-e[0],(this.top-this.bottom)/2-e[1],0),f.fromValues(this.zoom,this.zoom,1),e)}}},{key:"triggerUpdate",value:function(){if(this.enableUpdate){var e=this.getViewTransform(),t=p.multiply(p.create(),this.getPerspective(),e);this.getFrustum().extractFromVPMatrix(t),this.eventEmitter.emit(ze)}}},{key:"rotate",value:function(e,t,n){throw new Error(ke)}},{key:"pan",value:function(e,t){throw new Error(ke)}},{key:"dolly",value:function(e){throw new Error(ke)}},{key:"createLandmark",value:function(e,t){throw new Error(ke)}},{key:"gotoLandmark",value:function(e,t){throw new Error(ke)}},{key:"cancelLandmarkAnimation",value:function(){throw new Error(ke)}}])}(),Ke=function(e){return e[e.Standard=0]="Standard",e}({}),qe=function(e){return e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED",e[e.Z_INDEX_CHANGED=2]="Z_INDEX_CHANGED",e}({}),$e=f.create(),Qe=p.create(),Je=m.create();function et(e){if(e.localDirtyFlag){if(0!==e.localSkew[0]||0!==e.localSkew[1]){p.fromRotationTranslationScaleOrigin(e.localTransform,e.localRotation,e.localPosition,f.fromValues(1,1,1),e.origin),0===e.localSkew[0]&&0===e.localSkew[1]||(p.identity(Qe),Qe[4]=Math.tan(e.localSkew[0]),Qe[1]=Math.tan(e.localSkew[1]),p.multiply(e.localTransform,e.localTransform,Qe));var t=p.fromRotationTranslationScaleOrigin(Qe,m.set(Je,0,0,0,1),f.set($e,1,1,1),e.localScale,e.origin);p.multiply(e.localTransform,e.localTransform,t)}else{var n=e.localTransform,r=e.localPosition,i=e.localRotation,a=e.localScale,o=e.origin,s=0!==r[0]||0!==r[1]||0!==r[2],l=1!==i[3]||0!==i[0]||0!==i[1]||0!==i[2],u=1!==a[0]||1!==a[1]||1!==a[2],c=0!==o[0]||0!==o[1]||0!==o[2];l||u||c?p.fromRotationTranslationScaleOrigin(n,i,r,a,o):s?p.fromTranslation(n,r):p.identity(n)}e.localDirtyFlag=!1}}var tt={absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:new xe(0,0,0,0)},nt=function(e){return e.COORDINATE="<coordinate>",e.COLOR="<color>",e.PAINT="<paint>",e.NUMBER="<number>",e.ANGLE="<angle>",e.OPACITY_VALUE="<opacity-value>",e.SHADOW_BLUR="<shadow-blur>",e.LENGTH="<length>",e.PERCENTAGE="<percentage>",e.LENGTH_PERCENTAGE="<length> | <percentage>",e.LENGTH_PERCENTAGE_12="[<length> | <percentage>]{1,2}",e.LENGTH_PERCENTAGE_14="[<length> | <percentage>]{1,4}",e.LIST_OF_POINTS="<list-of-points>",e.PATH="<path>",e.FILTER="<filter>",e.Z_INDEX="<z-index>",e.OFFSET_DISTANCE="<offset-distance>",e.DEFINED_PATH="<defined-path>",e.MARKER="<marker>",e.TRANSFORM="<transform>",e.TRANSFORM_ORIGIN="<transform-origin>",e.TEXT="<text>",e.TEXT_TRANSFORM="<text-transform>",e}({});function rt(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function it(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function at(){}var ot=.7,st=1/ot,lt="\\s*([+-]?\\d+)\\s*",ut="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ct="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ht=/^#([0-9a-f]{3,8})$/,dt=new RegExp("^rgb\\(".concat(lt,",").concat(lt,",").concat(lt,"\\)$")),ft=new RegExp("^rgb\\(".concat(ct,",").concat(ct,",").concat(ct,"\\)$")),vt=new RegExp("^rgba\\(".concat(lt,",").concat(lt,",").concat(lt,",").concat(ut,"\\)$")),pt=new RegExp("^rgba\\(".concat(ct,",").concat(ct,",").concat(ct,",").concat(ut,"\\)$")),gt=new RegExp("^hsl\\(".concat(ut,",").concat(ct,",").concat(ct,"\\)$")),mt=new RegExp("^hsla\\(".concat(ut,",").concat(ct,",").concat(ct,",").concat(ut,"\\)$")),yt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Et(){return this.rgb().formatHex()}function _t(){return this.rgb().formatRgb()}function Tt(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=ht.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?St(t):3===n?new xt(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Rt(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Rt(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=dt.exec(e))?new xt(t[1],t[2],t[3],1):(t=ft.exec(e))?new xt(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=vt.exec(e))?Rt(t[1],t[2],t[3],t[4]):(t=pt.exec(e))?Rt(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=gt.exec(e))?Pt(t[1],t[2]/100,t[3]/100,1):(t=mt.exec(e))?Pt(t[1],t[2]/100,t[3]/100,t[4]):yt.hasOwnProperty(e)?St(yt[e]):"transparent"===e?new xt(NaN,NaN,NaN,0):null}function St(e){return new xt(e>>16&255,e>>8&255,255&e,1)}function Rt(e,t,n,r){return r<=0&&(e=t=n=NaN),new xt(e,t,n,r)}function At(e){return e instanceof at||(e=Tt(e)),e?new xt((e=e.rgb()).r,e.g,e.b,e.opacity):new xt}function xt(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function kt(){return"#".concat(bt(this.r)).concat(bt(this.g)).concat(bt(this.b))}function Nt(){var e=Mt(this.opacity);return"".concat(1===e?"rgb(":"rgba(").concat(Ct(this.r),", ").concat(Ct(this.g),", ").concat(Ct(this.b)).concat(1===e?")":", ".concat(e,")"))}function Mt(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ct(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function bt(e){return((e=Ct(e))<16?"0":"")+e.toString(16)}function Pt(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new It(e,t,n,r)}function Ot(e){if(e instanceof It)return new It(e.h,e.s,e.l,e.opacity);if(e instanceof at||(e=Tt(e)),!e)return new It;if(e instanceof It)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new It(o,s,l,e.opacity)}function It(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function wt(e){return(e=(e||0)%360)<0?e+360:e}function Lt(e){return Math.max(0,Math.min(1,e||0))}function Dt(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Bt(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];var o=t?t.apply(this,i):i[0],s=n.cache;if(s.has(o))return s.get(o);var l=e.apply(this,i);return n.cache=s.set(o,l)||s,l};return n.cache=new(Bt.Cache||Map),Bt.cacheList.push(n.cache),n}rt(at,Tt,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Et,formatHex:Et,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Ot(this).formatHsl()},formatRgb:_t,toString:_t}),rt(xt,(function(e,t,n,r){return 1===arguments.length?At(e):new xt(e,t,n,null==r?1:r)}),it(at,{brighter:function(e){return e=null==e?st:Math.pow(st,e),new xt(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?ot:Math.pow(ot,e),new xt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},clamp:function(){return new xt(Ct(this.r),Ct(this.g),Ct(this.b),Mt(this.opacity))},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:kt,formatHex:kt,formatHex8:function(){return"#".concat(bt(this.r)).concat(bt(this.g)).concat(bt(this.b)).concat(bt(255*(isNaN(this.opacity)?1:this.opacity)))},formatRgb:Nt,toString:Nt})),rt(It,(function(e,t,n,r){return 1===arguments.length?Ot(e):new It(e,t,n,null==r?1:r)}),it(at,{brighter:function(e){return e=null==e?st:Math.pow(st,e),new It(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?ot:Math.pow(ot,e),new It(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new xt(Dt(e>=240?e-240:e+120,i,r),Dt(e,i,r),Dt(e<120?e+240:e-120,i,r),this.opacity)},clamp:function(){return new It(wt(this.h),Lt(this.s),Lt(this.l),Mt(this.opacity))},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=Mt(this.opacity);return"".concat(1===e?"hsl(":"hsla(").concat(wt(this.h),", ").concat(100*Lt(this.s),"%, ").concat(100*Lt(this.l),"%").concat(1===e?")":", ".concat(e,")"))}})),Bt.Cache=Map,Bt.cacheList=[],Bt.clearCache=function(){Bt.cacheList.forEach((function(e){return e.clear()}))};var Ft=function(e){return e[e.kUnknown=0]="kUnknown",e[e.kNumber=1]="kNumber",e[e.kPercentage=2]="kPercentage",e[e.kEms=3]="kEms",e[e.kPixels=4]="kPixels",e[e.kRems=5]="kRems",e[e.kDegrees=6]="kDegrees",e[e.kRadians=7]="kRadians",e[e.kGradians=8]="kGradians",e[e.kTurns=9]="kTurns",e[e.kMilliseconds=10]="kMilliseconds",e[e.kSeconds=11]="kSeconds",e[e.kInteger=12]="kInteger",e}({}),Ut=function(e){return e[e.kUNumber=0]="kUNumber",e[e.kUPercent=1]="kUPercent",e[e.kULength=2]="kULength",e[e.kUAngle=3]="kUAngle",e[e.kUTime=4]="kUTime",e[e.kUOther=5]="kUOther",e}({}),Zt=function(e){return e[e.kYes=0]="kYes",e[e.kNo=1]="kNo",e}({}),Gt=function(e){return e[e.kYes=0]="kYes",e[e.kNo=1]="kNo",e}({}),Vt=[{name:"em",unit_type:Ft.kEms},{name:"px",unit_type:Ft.kPixels},{name:"deg",unit_type:Ft.kDegrees},{name:"rad",unit_type:Ft.kRadians},{name:"grad",unit_type:Ft.kGradians},{name:"ms",unit_type:Ft.kMilliseconds},{name:"s",unit_type:Ft.kSeconds},{name:"rem",unit_type:Ft.kRems},{name:"turn",unit_type:Ft.kTurns}],Wt=function(e){return e[e.kUnknownType=0]="kUnknownType",e[e.kUnparsedType=1]="kUnparsedType",e[e.kKeywordType=2]="kKeywordType",e[e.kUnitType=3]="kUnitType",e[e.kSumType=4]="kSumType",e[e.kProductType=5]="kProductType",e[e.kNegateType=6]="kNegateType",e[e.kInvertType=7]="kInvertType",e[e.kMinType=8]="kMinType",e[e.kMaxType=9]="kMaxType",e[e.kClampType=10]="kClampType",e[e.kTransformType=11]="kTransformType",e[e.kPositionType=12]="kPositionType",e[e.kURLImageType=13]="kURLImageType",e[e.kColorType=14]="kColorType",e[e.kUnsupportedColorType=15]="kUnsupportedColorType",e}({}),Ht=function(e){return e?"number"===e?Ft.kNumber:"percent"===e||"%"===e?Ft.kPercentage:function(e){return Vt.find((function(t){return t.name===e})).unit_type}(e):Ft.kUnknown},Xt=function(e){var t=1;switch(e){case Ft.kPixels:case Ft.kDegrees:case Ft.kSeconds:break;case Ft.kMilliseconds:t=.001;break;case Ft.kRadians:t=180/Math.PI;break;case Ft.kGradians:t=.9;break;case Ft.kTurns:t=360}return t},zt=function(e){switch(e){case Ft.kNumber:case Ft.kInteger:return"";case Ft.kPercentage:return"%";case Ft.kEms:return"em";case Ft.kRems:return"rem";case Ft.kPixels:return"px";case Ft.kDegrees:return"deg";case Ft.kRadians:return"rad";case Ft.kGradians:return"grad";case Ft.kMilliseconds:return"ms";case Ft.kSeconds:return"s";case Ft.kTurns:return"turn"}return""},Yt=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"toString",value:function(){return this.buildCSSText(Zt.kNo,Gt.kNo,"")}},{key:"isNumericValue",value:function(){return this.getType()>=Wt.kUnitType&&this.getType()<=Wt.kClampType}}],[{key:"isAngle",value:function(e){return e===Ft.kDegrees||e===Ft.kRadians||e===Ft.kGradians||e===Ft.kTurns}},{key:"isLength",value:function(e){return e>=Ft.kEms&&e<Ft.kDegrees}},{key:"isRelativeUnit",value:function(e){return e===Ft.kPercentage||e===Ft.kEms||e===Ft.kRems}},{key:"isTime",value:function(e){return e===Ft.kSeconds||e===Ft.kMilliseconds}}])}(),jt=function(e){function t(e){var n;return(0,o.Z)(this,t),(n=(0,s.Z)(this,t)).colorSpace=e,n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getType",value:function(){return Wt.kColorType}},{key:"to",value:function(e){return this}}])}(Yt),Kt=function(e){return e[e.Constant=0]="Constant",e[e.LinearGradient=1]="LinearGradient",e[e.RadialGradient=2]="RadialGradient",e}({}),qt=function(e){function t(e,n){var r;return(0,o.Z)(this,t),(r=(0,s.Z)(this,t)).type=e,r.value=n,r}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.type,this.value)}},{key:"buildCSSText",value:function(e,t,n){return n}},{key:"getType",value:function(){return Wt.kColorType}}])}(Yt),$t=function(e){function t(e){var n;return(0,o.Z)(this,t),(n=(0,s.Z)(this,t)).value=e,n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.value)}},{key:"getType",value:function(){return Wt.kKeywordType}},{key:"buildCSSText",value:function(e,t,n){return n+this.value}}])}(Yt),Qt=function(e){return function(e){switch(e){case Ut.kUNumber:return Ft.kNumber;case Ut.kULength:return Ft.kPixels;case Ut.kUPercent:return Ft.kPercentage;case Ut.kUTime:return Ft.kSeconds;case Ut.kUAngle:return Ft.kDegrees;default:return Ft.kUnknown}}(function(e){switch(e){case Ft.kNumber:case Ft.kInteger:return Ut.kUNumber;case Ft.kPercentage:return Ut.kUPercent;case Ft.kPixels:return Ut.kULength;case Ft.kMilliseconds:case Ft.kSeconds:return Ut.kUTime;case Ft.kDegrees:case Ft.kRadians:case Ft.kGradians:case Ft.kTurns:return Ut.kUAngle;default:return Ut.kUOther}}(e))},Jt=function(e){function t(e){var n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ft.kNumber;return(0,o.Z)(this,t),n=(0,s.Z)(this,t),r="string"==typeof i?Ht(i):i,n.unit=r,n.value=e,n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.value,this.unit)}},{key:"equals",value:function(e){var t=e;return this.value===t.value&&this.unit===t.unit}},{key:"getType",value:function(){return Wt.kUnitType}},{key:"convertTo",value:function(e){if(this.unit===e)return new t(this.value,this.unit);var n=Qt(this.unit);if(n!==Qt(e)||n===Ft.kUnknown)return null;var r=Xt(this.unit)/Xt(e);return new t(this.value*r,e)}},{key:"buildCSSText",value:function(e,t,n){var r;switch(this.unit){case Ft.kUnknown:break;case Ft.kInteger:r=Number(this.value).toFixed(0);break;case Ft.kNumber:case Ft.kPercentage:case Ft.kEms:case Ft.kRems:case Ft.kPixels:case Ft.kDegrees:case Ft.kRadians:case Ft.kGradians:case Ft.kMilliseconds:case Ft.kSeconds:case Ft.kTurns:var i=this.value,a=zt(this.unit);if(i<-999999||i>999999){var o=zt(this.unit);r=!Number.isFinite(i)||Number.isNaN(i)?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(Number.isFinite(e)?"NaN":e>0?"infinity":"-infinity")+t}(i,o):i+(o||"")}else r="".concat(i).concat(a)}return n+=r}}])}(Yt),en=new Jt(0,"px");new Jt(1,"px");var tn=new Jt(0,"deg"),nn=function(e){function t(e,n,r){var i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(0,o.Z)(this,t),(i=(0,s.Z)(this,t,["rgb"])).r=e,i.g=n,i.b=r,i.alpha=a,i.isNone=l,i}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.r,this.g,this.b,this.alpha)}},{key:"buildCSSText",value:function(e,t,n){return"".concat(n,"rgba(").concat(this.r,",").concat(this.g,",").concat(this.b,",").concat(this.alpha,")")}}])}(jt),rn=new $t("unset"),an={"":rn,unset:rn,initial:new $t("initial"),inherit:new $t("inherit")},on=new nn(0,0,0,0,!0),sn=new nn(0,0,0,0),ln=Bt((function(e,t,n,r){return new nn(e,t,n,r)}),(function(e,t,n,r){return"rgba(".concat(e,",").concat(t,",").concat(n,",").concat(r,")")})),un=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ft.kNumber;return new Jt(e,t)};function cn(e){var t=e.type,n=e.value;return"hex"===t?"#".concat(n):"literal"===t?n:"rgb"===t?"rgb(".concat(n.join(","),")"):"rgba(".concat(n.join(","),")")}new Jt(50,"%");var hn=function(){var e=/^(linear\-gradient)/i,t=/^(repeating\-linear\-gradient)/i,n=/^(radial\-gradient)/i,r=/^(repeating\-radial\-gradient)/i,i=/^(conic\-gradient)/i,a=/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,o=/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,s=/^(left|center|right|top|bottom)/i,l=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,u=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,c=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,h=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,d=/^\(/,f=/^\)/,v=/^,/,p=/^\#([0-9a-fA-F]+)/,g=/^([a-zA-Z]+)/,m=/^rgb/i,y=/^rgba/i,E=/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/,_="";function T(e){throw new Error("".concat(_,": ").concat(e))}function S(){var e=O(R);return _.length>0&&T("Invalid input not EOF"),e}function R(){return A("linear-gradient",e,k)||A("repeating-linear-gradient",t,k)||A("radial-gradient",n,N)||A("repeating-radial-gradient",r,N)||A("conic-gradient",i,N)}function A(e,t,n){return x(t,(function(t){var r=n();return r&&(F(v)||T("Missing comma before color stops")),{type:e,orientation:r,colorStops:O(I)}}))}function x(e,t){var n=F(e);if(n){F(d)||T("Missing (");var r=t(n);return F(f)||T("Missing )"),r}}function k(){return B("directional",a,1)||B("angular",h,1)}function N(){var e,t,n=M();return n&&((e=[]).push(n),t=_,F(v)&&((n=M())?e.push(n):_=t)),e}function M(){var e=function(){var e=B("shape",/^(circle)/i,0);e&&(e.style=D()||C());return e}()||function(){var e=B("shape",/^(ellipse)/i,0);e&&(e.style=L()||C());return e}();if(e)e.at=b();else{var t=C();if(t){e=t;var n=b();n&&(e.at=n)}else{var r=P();r&&(e={type:"default-radial",at:r})}}return e}function C(){return B("extent-keyword",o,1)}function b(){if(B("position",/^at/,0)){var e=P();return e||T("Missing positioning value"),e}}function P(){var e={x:L(),y:L()};if(e.x||e.y)return{type:"position",value:e}}function O(e){var t=e(),n=[];if(t)for(n.push(t);F(v);)(t=e())?n.push(t):T("One extra comma");return n}function I(){var e=B("hex",p,1)||x(y,(function(){return{type:"rgba",value:O(w)}}))||x(m,(function(){return{type:"rgb",value:O(w)}}))||B("literal",g,0);return e||T("Expected color definition"),e.length=L(),e}function w(){return F(E)[1]}function L(){return B("%",u,1)||B("position-keyword",s,1)||D()}function D(){return B("px",l,1)||B("em",c,1)}function B(e,t,n){var r=F(t);if(r)return{type:e,value:r[n]}}function F(e){var t=/^[\n\r\t\s]+/.exec(_);t&&U(t[0].length);var n=e.exec(_);return n&&U(n[0].length),n}function U(e){_=_.substring(e)}return function(e){return _=e,S()}}();var dn=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,fn=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,vn=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,pn=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;var gn={left:180,top:-90,bottom:90,right:0,"left top":225,"top left":225,"left bottom":135,"bottom left":135,"right top":-45,"top right":-45,"right bottom":45,"bottom right":45},mn=Bt((function(e){var t;return t="angular"===e.type?Number(e.value):gn[e.value]||0,un(t,"deg")})),yn=Bt((function(e){var t=50,n=50,r="%",i="%";if("position"===(null==e?void 0:e.type)){var a=e.value,o=a.x,s=a.y;"position-keyword"===(null==o?void 0:o.type)&&("left"===o.value?t=0:"center"===o.value?t=50:"right"===o.value?t=100:"top"===o.value?n=0:"bottom"===o.value&&(n=100)),"position-keyword"===(null==s?void 0:s.type)&&("left"===s.value?t=0:"center"===s.value?n=50:"right"===s.value?t=100:"top"===s.value?n=0:"bottom"===s.value&&(n=100)),"px"!==(null==o?void 0:o.type)&&"%"!==(null==o?void 0:o.type)&&"em"!==(null==o?void 0:o.type)||(r=null==o?void 0:o.type,t=Number(o.value)),"px"!==(null==s?void 0:s.type)&&"%"!==(null==s?void 0:s.type)&&"em"!==(null==s?void 0:s.type)||(i=null==s?void 0:s.type,n=Number(s.value))}return{cx:un(t,r),cy:un(n,i)}})),En=Bt((function(e){if(e.indexOf("linear")>-1||e.indexOf("radial")>-1)return hn(e).map((function(e){var t=e.type,n=e.orientation,r=e.colorStops;!function(e){var t,n,r=e.length;e[r-1].length=null!==(t=e[r-1].length)&&void 0!==t?t:{type:"%",value:"100"},r>1&&(e[0].length=null!==(n=e[0].length)&&void 0!==n?n:{type:"%",value:"0"});for(var i=0,a=Number(e[0].length.value),o=1;o<r;o++){var s,l=null===(s=e[o].length)||void 0===s?void 0:s.value;if(!(0,T.Z)(l)&&!(0,T.Z)(a)){for(var u=1;u<o-i;u++)e[i+u].length={type:"%",value:"".concat(a+(Number(l)-a)*u/(o-i))};i=o,a=Number(l)}}}(r);var i,a=r.map((function(e){return{offset:un(Number(e.length.value),"%"),color:cn(e)}}));if("linear-gradient"===t)return new qt(Kt.LinearGradient,{angle:n?mn(n):tn,steps:a});if("radial-gradient"===t&&(n||(n=[{type:"shape",value:"circle"}]),"shape"===n[0].type&&"circle"===n[0].value)){var o,s=yn(n[0].at),l=s.cx,u=s.cy;if(n[0].style){var c=n[0].style,h=c.type,d=c.value;"extent-keyword"===h?(an[i=d]||(an[i]=new $t(i)),o=an[i]):o=un(d,h)}return new qt(Kt.RadialGradient,{cx:l,cy:u,size:o,steps:a})}}));var t=e[0];if("("===e[1]||"("===e[2])if("l"===t){var n=dn.exec(e);if(n){var r,i=(null===(r=n[2].match(pn))||void 0===r?void 0:r.map((function(e){return e.split(":")})))||[];return[new qt(Kt.LinearGradient,{angle:un(parseFloat(n[1]),"deg"),steps:i.map((function(e){var t=(0,h.Z)(e,2),n=t[0],r=t[1];return{offset:un(100*Number(n),"%"),color:r}}))})]}}else if("r"===t){var a=function(e){var t=fn.exec(e);if(t){var n,r=(null===(n=t[4].match(pn))||void 0===n?void 0:n.map((function(e){return e.split(":")})))||[];return{cx:un(50,"%"),cy:un(50,"%"),steps:r.map((function(e){var t=(0,h.Z)(e,2),n=t[0],r=t[1];return{offset:un(100*Number(n),"%"),color:r}}))}}return null}(e);if(a){if(!(0,S.Z)(a))return[new qt(Kt.RadialGradient,a)];e=a}}else if("p"===t)return function(e){var t=vn.exec(e);if(t){var n=t[1],r=t[2];switch(n){case"a":n="repeat";break;case"x":n="repeat-x";break;case"y":n="repeat-y";break;default:n="no-repeat"}return{image:r,repetition:n}}return null}(e)}));function _n(e){return e&&!!e.image}function Tn(e){return e&&!(0,T.Z)(e.r)&&!(0,T.Z)(e.g)&&!(0,T.Z)(e.b)}var Sn=Bt((function(e){if(_n(e))return(0,u.Z)({repetition:"repeat"},e);if((0,T.Z)(e)&&(e=""),"transparent"===e)return sn;if("currentColor"===e)e="black";else if("none"===e)return on;var t=En(e);if(t)return t;var n=Tt(e),r=[0,0,0,0];return null!==n&&(r[0]=n.r||0,r[1]=n.g||0,r[2]=n.b||0,r[3]=n.opacity),ln.apply(void 0,r)}));function Rn(e,t){if(Tn(e)&&Tn(t))return[[Number(e.r),Number(e.g),Number(e.b),Number(e.alpha)],[Number(t.r),Number(t.g),Number(t.b),Number(t.alpha)],function(e){var t=e.slice();if(t[3])for(var n=0;n<3;n++)t[n]=Math.round((0,R.Z)(t[n],0,255));return t[3]=(0,R.Z)(t[3],0,1),"rgba(".concat(t.join(","),")")}]}function An(e,t){if((0,T.Z)(t))return un(0,"px");if(t="".concat(t).trim().toLowerCase(),isFinite(Number(t))){if("px".search(e)>=0)return un(Number(t),"px");if("deg".search(e)>=0)return un(Number(t),"deg")}var n=[];t=t.replace(e,(function(e){return n.push(e),"U".concat(e)}));var r="U(".concat(e.source,")");return n.map((function(e){return un(Number(t.replace(new RegExp("U".concat(e),"g"),"").replace(new RegExp(r,"g"),"*0")),e)}))[0]}var xn=function(e){return An(new RegExp("px","g"),e)},kn=Bt(xn);Bt((function(e){return An(new RegExp("%","g"),e)}));var Nn=function(e){return(0,E.Z)(e)||isFinite(Number(e))?un(Number(e)||0,"px"):An(new RegExp("px|%|em|rem","g"),e)},Mn=Bt(Nn),Cn=function(e){return An(new RegExp("deg|rad|grad|turn","g"),e)},bn=Bt(Cn);function Pn(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a="",o=e.value||0,s=t.value||0,l=Qt(e.unit),u=e.convertTo(l),c=t.convertTo(l);return u&&c?(o=u.value,s=c.value,a=zt(e.unit)):(Jt.isLength(e.unit)||Jt.isLength(t.unit))&&(o=wn(e,i,n),s=wn(t,i,n),a="px"),[o,s,function(e){return r&&(e=Math.max(e,0)),e+a}]}function On(e){var t=0;return e.unit===Ft.kDegrees?t=e.value:e.unit===Ft.kRadians?t=Ie(Number(e.value)):e.unit===Ft.kTurns?t=360*Number(e.value):e.value&&(t=e.value),t}function In(e,t){var n;return Array.isArray(e)?n=e.map((function(e){return Number(e)})):(0,S.Z)(e)?n=e.split(" ").map((function(e){return Number(e)})):(0,E.Z)(e)&&(n=[e]),2===t?1===n.length?[n[0],n[0]]:[n[0],n[1]]:4===t?1===n.length?[n[0],n[0],n[0],n[0]]:2===n.length?[n[0],n[1],n[0],n[1]]:3===n.length?[n[0],n[1],n[2],n[1]]:[n[0],n[1],n[2],n[3]]:"even"===t&&n.length%2==1?[].concat((0,c.Z)(n),(0,c.Z)(n)):n}function wn(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.unit===Ft.kPixels)return Number(e.value);if(e.unit===Ft.kPercentage&&n){var i=n.nodeName===he.GROUP?n.getLocalBounds():n.getGeometryBounds();return(r?i.min[t]:0)+e.value/100*i.halfExtents[t]*2}return 0}var Ln=function(e){return An(/deg|rad|grad|turn|px|%/g,e)},Dn=["blur","brightness","drop-shadow","contrast","grayscale","sepia","saturate","hue-rotate","invert"];function Bn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if("none"===(e=e.toLowerCase().trim()))return[];for(var t,n=/\s*([\w-]+)\(([^)]*)\)/g,r=[],i=0;t=n.exec(e);){if(t.index!==i)return[];if(i=t.index+t[0].length,Dn.indexOf(t[1])>-1&&r.push({name:t[1],params:t[2].split(" ").map((function(e){return Ln(e)||Sn(e)}))}),n.lastIndex===e.length)return r}return[]}function Fn(e){return e.toString()}var Un=function(e){return"number"==typeof e?un(e):/^\s*[-+]?(\d*\.)?\d+\s*$/.test(e)?un(Number(e)):un(0)},Zn=Bt(Un);function Gn(e,t){return[e,t,Fn]}function Vn(e,t){return function(n,r){return[n,r,function(n){return Fn((0,R.Z)(n,e,t))}]}}function Wn(e,t){if(e.length===t.length)return[e,t,function(e){return e}]}function Hn(e){return 0===e.parsedStyle.d.totalLength&&(e.parsedStyle.d.totalLength=(0,A.D)(e.parsedStyle.d.absolutePath)),e.parsedStyle.d.totalLength}function Xn(e){return 0===e.parsedStyle.points.totalLength&&(e.parsedStyle.points.totalLength=ne(e.parsedStyle.points.points)),e.parsedStyle.points.totalLength}function zn(e,t){return e[0]===t[0]&&e[1]===t[1]}function Yn(e,t){var n=e.prePoint,r=e.currentPoint,i=e.nextPoint,a=Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2),o=Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2),s=Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2),l=Math.acos((a+o-s)/(2*Math.sqrt(a)*Math.sqrt(o)));if(!l||0===Math.sin(l)||(0,N.Z)(l,0))return{xExtra:0,yExtra:0};var u=Math.abs(Math.atan2(i[1]-r[1],i[0]-r[0])),c=Math.abs(Math.atan2(i[0]-r[0],i[1]-r[1]));return u=u>Math.PI/2?Math.PI-u:u,c=c>Math.PI/2?Math.PI-c:c,{xExtra:Math.cos(l/2-u)*(t/2*(1/Math.sin(l/2)))-t/2||0,yExtra:Math.cos(c-l/2)*(t/2*(1/Math.sin(l/2)))-t/2||0}}function jn(e,t){return[t[0]+(t[0]-e[0]),t[1]+(t[1]-e[1])]}Bt((function(e){return(0,S.Z)(e)?e.split(" ").map(Zn):e.map(Zn)}));var Kn=function(e,t){var n=e.x*t.x+e.y*t.y,r=Math.sqrt((Math.pow(e.x,2)+Math.pow(e.y,2))*(Math.pow(t.x,2)+Math.pow(t.y,2)));return(e.x*t.y-e.y*t.x<0?-1:1)*Math.acos(n/r)},qn=function(e,t,n,r,i,a,o,s){t=Math.abs(t),n=Math.abs(n);var l=Pe(r=(0,M.Z)(r,360));if(e.x===o.x&&e.y===o.y)return{x:e.x,y:e.y,ellipticalArcAngle:0};if(0===t||0===n)return{x:0,y:0,ellipticalArcAngle:0};var u=(e.x-o.x)/2,c=(e.y-o.y)/2,h={x:Math.cos(l)*u+Math.sin(l)*c,y:-Math.sin(l)*u+Math.cos(l)*c},d=Math.pow(h.x,2)/Math.pow(t,2)+Math.pow(h.y,2)/Math.pow(n,2);d>1&&(t*=Math.sqrt(d),n*=Math.sqrt(d));var f=(Math.pow(t,2)*Math.pow(n,2)-Math.pow(t,2)*Math.pow(h.y,2)-Math.pow(n,2)*Math.pow(h.x,2))/(Math.pow(t,2)*Math.pow(h.y,2)+Math.pow(n,2)*Math.pow(h.x,2));f=f<0?0:f;var v=(i!==a?1:-1)*Math.sqrt(f),p=v*(t*h.y/n),g=v*(-n*h.x/t),m={x:Math.cos(l)*p-Math.sin(l)*g+(e.x+o.x)/2,y:Math.sin(l)*p+Math.cos(l)*g+(e.y+o.y)/2},y={x:(h.x-p)/t,y:(h.y-g)/n},E=Kn({x:1,y:0},y),_=Kn(y,{x:(-h.x-p)/t,y:(-h.y-g)/n});!a&&_>0?_-=2*Math.PI:a&&_<0&&(_+=2*Math.PI);var T=E+(_%=2*Math.PI)*s,S=t*Math.cos(T),R=n*Math.sin(T);return{x:Math.cos(l)*S-Math.sin(l)*R+m.x,y:Math.sin(l)*S+Math.cos(l)*R+m.y,ellipticalArcStartAngle:E,ellipticalArcEndAngle:E+_,ellipticalArcAngle:T,ellipticalArcCenter:m,resultantRx:t,resultantRy:n}};function $n(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.arcParams,i=r.rx,a=void 0===i?0:i,o=r.ry,s=void 0===o?0:o,l=r.xRotation,u=r.arcFlag,c=r.sweepFlag,h=qn({x:e.prePoint[0],y:e.prePoint[1]},a,s,l,!!u,!!c,{x:e.currentPoint[0],y:e.currentPoint[1]},t),d=qn({x:e.prePoint[0],y:e.prePoint[1]},a,s,l,!!u,!!c,{x:e.currentPoint[0],y:e.currentPoint[1]},n?t+.005:t-.005),f=d.x-h.x,v=d.y-h.y,p=Math.sqrt(f*f+v*v);return{x:-f/p,y:-v/p}}function Qn(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Jn(e,t){return Qn(e)*Qn(t)?(e[0]*t[0]+e[1]*t[1])/(Qn(e)*Qn(t)):1}function er(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(Jn(e,t))}function tr(e,t){var n=t[1],r=t[2],i=(0,M.Z)(Pe(t[3]),2*Math.PI),a=t[4],o=t[5],s=e[0],l=e[1],u=t[6],c=t[7],h=Math.cos(i)*(s-u)/2+Math.sin(i)*(l-c)/2,d=-1*Math.sin(i)*(s-u)/2+Math.cos(i)*(l-c)/2,f=h*h/(n*n)+d*d/(r*r);f>1&&(n*=Math.sqrt(f),r*=Math.sqrt(f));var v=n*n*(d*d)+r*r*(h*h),p=v?Math.sqrt((n*n*(r*r)-v)/v):1;a===o&&(p*=-1),isNaN(p)&&(p=0);var g=r?p*n*d/r:0,m=n?p*-r*h/n:0,y=(s+u)/2+Math.cos(i)*g-Math.sin(i)*m,E=(l+c)/2+Math.sin(i)*g+Math.cos(i)*m,_=[(h-g)/n,(d-m)/r],T=[(-1*h-g)/n,(-1*d-m)/r],S=er([1,0],_),R=er(_,T);return Jn(_,T)<=-1&&(R=Math.PI),Jn(_,T)>=1&&(R=0),0===o&&R>0&&(R-=2*Math.PI),1===o&&R<0&&(R+=2*Math.PI),{cx:y,cy:E,rx:zn(e,[u,c])?0:n,ry:zn(e,[u,c])?0:r,startAngle:S,endAngle:S+R,xRotation:i,arcFlag:a,sweepFlag:o}}function nr(e,t,n){return e.reduce((function(e,t){var r="";if("M"===t[0]||"L"===t[0]){var i=f.fromValues(t[1],t[2],0);n&&f.transformMat4(i,i,n),r="".concat(t[0]).concat(i[0],",").concat(i[1])}else if("Z"===t[0])r=t[0];else if("C"===t[0]){var a=f.fromValues(t[1],t[2],0),o=f.fromValues(t[3],t[4],0),s=f.fromValues(t[5],t[6],0);n&&(f.transformMat4(a,a,n),f.transformMat4(o,o,n),f.transformMat4(s,s,n)),r="".concat(t[0]).concat(a[0],",").concat(a[1],",").concat(o[0],",").concat(o[1],",").concat(s[0],",").concat(s[1])}else if("A"===t[0]){var l=f.fromValues(t[6],t[7],0);n&&f.transformMat4(l,l,n),r="".concat(t[0]).concat(t[1],",").concat(t[2],",").concat(t[3],",").concat(t[4],",").concat(t[5],",").concat(l[0],",").concat(l[1])}else if("Q"===t[0]){var u=f.fromValues(t[1],t[2],0),c=f.fromValues(t[3],t[4],0);n&&(f.transformMat4(u,u,n),f.transformMat4(c,c,n)),r="".concat(t[0]).concat(t[1],",").concat(t[2],",").concat(t[3],",").concat(t[4],"}")}return e+r}),"")}function rr(e,t,n,r){return[["M",e,t],["L",n,r]]}function ir(e,t,n,r){var i=(-1+Math.sqrt(2))/3*4,a=e*i,o=t*i,s=n-e,l=n+e,u=r-t,c=r+t;return[["M",s,r],["C",s,r-o,n-a,u,n,u],["C",n+a,u,l,r-o,l,r],["C",l,r+o,n+a,c,n,c],["C",n-a,c,s,r+o,s,r],["Z"]]}function ar(e,t){var n=e.map((function(e,t){return[0===t?"M":"L",e[0],e[1]]}));return t&&n.push(["Z"]),n}function or(e,t,n,r,i){if(i){var a=(0,h.Z)(i,4),o=a[0],s=a[1],l=a[2],u=a[3],c=e>0?1:-1,d=t>0?1:-1,f=c+d!==0?1:0;return[["M",c*o+n,r],["L",e-c*s+n,r],s?["A",s,s,0,0,f,e+n,d*s+r]:null,["L",e+n,t-d*l+r],l?["A",l,l,0,0,f,e+n-c*l,t+r]:null,["L",n+c*u,t+r],u?["A",u,u,0,0,f,n,t+r-d*u]:null,["L",n,d*o+r],o?["A",o,o,0,0,f,c*o+n,r]:null,["Z"]].filter((function(e){return e}))}return[["M",n,r],["L",n+e,r],["L",n+e,r+t],["L",n,r+t],["Z"]]}function sr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.getLocalTransform(),n=[];switch(e.nodeName){case he.LINE:var r=e.parsedStyle,i=r.x1,a=void 0===i?0:i,o=r.y1,s=void 0===o?0:o,l=r.x2,u=void 0===l?0:l,h=r.y2,d=void 0===h?0:h;n=rr(a,s,u,d);break;case he.CIRCLE:var f=e.parsedStyle,v=f.r,p=void 0===v?0:v,g=f.cx,m=void 0===g?0:g,y=f.cy,E=void 0===y?0:y;n=ir(p,p,m,E);break;case he.ELLIPSE:var _=e.parsedStyle,T=_.rx,S=void 0===T?0:T,A=_.ry,x=void 0===A?0:A,k=_.cx,N=void 0===k?0:k,M=_.cy,C=void 0===M?0:M;n=ir(S,x,N,C);break;case he.POLYLINE:case he.POLYGON:var b=e.parsedStyle.points;n=ar(b.points,e.nodeName===he.POLYGON);break;case he.RECT:var P=e.parsedStyle,O=P.width,I=void 0===O?0:O,w=P.height,L=void 0===w?0:w,D=P.x,B=void 0===D?0:D,F=P.y,U=void 0===F?0:F,Z=P.radius,G=Z&&Z.some((function(e){return 0!==e}));n=or(I,L,B,U,G&&Z.map((function(e){return(0,R.Z)(e,0,Math.min(Math.abs(I)/2,Math.abs(L)/2))})));break;case he.PATH:var V=e.parsedStyle.d.absolutePath;n=(0,c.Z)(V)}if(n.length)return nr(n,0,t)}var lr=function(e){if(""===e||Array.isArray(e)&&0===e.length)return{absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:{x:0,y:0,width:0,height:0}};var t;try{t=(0,C.A)(e)}catch(n){t=(0,C.A)(""),console.error("[g]: Invalid SVG Path definition: ".concat(e))}!function(e){for(var t=0;t<e.length;t++){var n=e[t-1],r=e[t];if("M"===r[0]&&n){var i=n[0],a=[r[1],r[2]],o=void 0;"L"===i||"M"===i?o=[n[1],n[2]]:"C"!==i&&"A"!==i&&"Q"!==i||(o=[n[n.length-2],n[n.length-1]]),o&&zn(a,o)&&(e.splice(t,1),t--)}}}(t);var n=function(e){for(var t=!1,n=e.length,r=0;r<n;r++){var i=e[r][0];if("C"===i||"A"===i||"Q"===i){t=!0;break}}return t}(t),r=function(e){for(var t=[],n=[],r=[],i=0;i<e.length;i++){var a=e[i],o=a[0];"M"===o?(r.length&&(n.push(r),r=[]),r.push([a[1],a[2]])):"Z"===o?r.length&&(t.push(r),r=[]):r.push([a[1],a[2]])}return r.length>0&&n.push(r),{polygons:t,polylines:n}}(t),i=r.polygons,a=r.polylines,o=function(e){for(var t=[],n=null,r=null,i=null,a=0,o=e.length,s=0;s<o;s++){var l=e[s];r=e[s+1];var u=l[0],c={command:u,prePoint:n,params:l,startTangent:null,endTangent:null,currentPoint:null,nextPoint:null,arcParams:null,box:null,cubicParams:null};switch(u){case"M":i=[l[1],l[2]],a=s;break;case"A":var h=tr(n,l);c.arcParams=h}if("Z"===u)n=i,r=e[a+1];else{var d=l.length;n=[l[d-2],l[d-1]]}r&&"Z"===r[0]&&(r=e[a],t[a]&&(t[a].prePoint=n)),c.currentPoint=n,t[a]&&zn(n,t[a].currentPoint)&&(t[a].prePoint=c.prePoint);var f=r?[r[r.length-2],r[r.length-1]]:null;c.nextPoint=f;var v=c.prePoint;if(["L","H","V"].includes(u))c.startTangent=[v[0]-n[0],v[1]-n[1]],c.endTangent=[n[0]-v[0],n[1]-v[1]];else if("Q"===u){var p=[l[1],l[2]];c.startTangent=[v[0]-p[0],v[1]-p[1]],c.endTangent=[n[0]-p[0],n[1]-p[1]]}else if("T"===u){var g=t[s-1],m=jn(g.currentPoint,v);"Q"===g.command?(c.command="Q",c.startTangent=[v[0]-m[0],v[1]-m[1]],c.endTangent=[n[0]-m[0],n[1]-m[1]]):(c.command="TL",c.startTangent=[v[0]-n[0],v[1]-n[1]],c.endTangent=[n[0]-v[0],n[1]-v[1]])}else if("C"===u){var y=[l[1],l[2]],E=[l[3],l[4]];c.startTangent=[v[0]-y[0],v[1]-y[1]],c.endTangent=[n[0]-E[0],n[1]-E[1]],0===c.startTangent[0]&&0===c.startTangent[1]&&(c.startTangent=[y[0]-E[0],y[1]-E[1]]),0===c.endTangent[0]&&0===c.endTangent[1]&&(c.endTangent=[E[0]-y[0],E[1]-y[1]])}else if("S"===u){var _=t[s-1],T=jn(_.currentPoint,v),S=[l[1],l[2]];"C"===_.command?(c.command="C",c.startTangent=[v[0]-T[0],v[1]-T[1]],c.endTangent=[n[0]-S[0],n[1]-S[1]]):(c.command="SQ",c.startTangent=[v[0]-S[0],v[1]-S[1]],c.endTangent=[n[0]-S[0],n[1]-S[1]])}else if("A"===u){var R=$n(c,0),A=R.x,x=R.y,k=$n(c,1,!1),N=k.x,M=k.y;c.startTangent=[A,x],c.endTangent=[N,M]}t.push(c)}return t}(t),s=function(e,t){for(var n=[],r=[],i=[],a=0;a<e.length;a++){var o=e[a],s=o.currentPoint,l=o.params,u=o.prePoint,c=void 0;switch(o.command){case"Q":c=oe(u[0],u[1],l[1],l[2],l[3],l[4]);break;case"C":c=te(u[0],u[1],l[1],l[2],l[3],l[4],l[5],l[6]);break;case"A":var h=o.arcParams;c=K(h.cx,h.cy,h.rx,h.ry,h.xRotation,h.startAngle,h.endAngle);break;default:n.push(s[0]),r.push(s[1])}c&&(o.box=c,n.push(c.x,c.x+c.width),r.push(c.y,c.y+c.height)),t&&("L"===o.command||"M"===o.command)&&o.prePoint&&o.nextPoint&&i.push(o)}n=n.filter((function(e){return!Number.isNaN(e)&&e!==1/0&&e!==-1/0})),r=r.filter((function(e){return!Number.isNaN(e)&&e!==1/0&&e!==-1/0}));var d=(0,x.Z)(n),f=(0,x.Z)(r),v=(0,k.Z)(n),p=(0,k.Z)(r);if(0===i.length)return{x:d,y:f,width:v-d,height:p-f};for(var g=0;g<i.length;g++){var m=i[g],y=m.currentPoint;y[0]===d?d-=Yn(m,t).xExtra:y[0]===v&&(v+=Yn(m,t).xExtra),y[1]===f?f-=Yn(m,t).yExtra:y[1]===p&&(p+=Yn(m,t).yExtra)}return{x:d,y:f,width:v-d,height:p-f}}(o,0),l=s.x,u=s.y,c=s.width,h=s.height;return{absolutePath:t,hasArc:n,segments:o,polygons:i,polylines:a,totalLength:0,rect:{x:Number.isFinite(l)?l:0,y:Number.isFinite(u)?u:0,width:Number.isFinite(c)?c:0,height:Number.isFinite(h)?h:0}}},ur=Bt(lr);function cr(e){return(0,S.Z)(e)?ur(e):lr(e)}function hr(e,t,n){var r=e.curve,i=t.curve;r&&0!==r.length||(r=(0,b.Y)(e.absolutePath,!1),e.curve=r),i&&0!==i.length||(i=(0,b.Y)(t.absolutePath,!1),t.curve=i);var a=[r,i];r.length!==i.length&&(a=(0,P.x)(r,i));var o=(0,O.b)(a[0])!==(0,O.b)(a[1])?(0,I.G)(a[0]):(0,w.U)(a[0]);return[o,(0,L.g)(a[1],o),function(e){return e}]}function dr(e,t){return{points:(0,S.Z)(e)?e.split(" ").map((function(e){var t=e.split(","),n=(0,h.Z)(t,2),r=n[0],i=n[1];return[Number(r),Number(i)]})):e,totalLength:0,segments:[]}}function fr(e,t){return[e.points,t.points,function(e){return e}]}var vr=null,pr=/\s*(\w+)\(([^)]*)\)/g;function gr(e){return function(t){var n=0;return e.map((function(e){return e===vr?t[n++]:e}))}}function mr(e){return e}var yr={matrix:["NNNNNN",[vr,vr,0,0,vr,vr,0,0,0,0,1,0,vr,vr,0,1],mr],matrix3d:["NNNNNNNNNNNNNNNN",mr],rotate:["A"],rotateX:["A"],rotateY:["A"],rotateZ:["A"],rotate3d:["NNNA"],perspective:["L"],scale:["Nn",gr([vr,vr,new Jt(1)]),mr],scaleX:["N",gr([vr,new Jt(1),new Jt(1)]),gr([vr,new Jt(1)])],scaleY:["N",gr([new Jt(1),vr,new Jt(1)]),gr([new Jt(1),vr])],scaleZ:["N",gr([new Jt(1),new Jt(1),vr])],scale3d:["NNN",mr],skew:["Aa",null,mr],skewX:["A",null,gr([vr,tn])],skewY:["A",null,gr([tn,vr])],translate:["Tt",gr([vr,vr,en]),mr],translateX:["T",gr([vr,en,en]),gr([vr,en])],translateY:["T",gr([en,vr,en]),gr([en,vr])],translateZ:["L",gr([en,en,vr])],translate3d:["TTL",mr]};function Er(e){for(var t=[],n=e.length,r=0;r<n;r++){var i=e[r],a=i[0],o=i.slice(1);if("translate"===a||"skew"===a?1===o.length&&o.push(0):"scale"===a&&1===o.length&&o.push(o[0]),!yr[a])return[];var s=o.map((function(e){return un(e)}));t.push({t:a,d:s})}return t}function _r(e){if(Array.isArray(e))return Er(e);if("none"===(e=(e||"none").trim()))return[];var t,n=[],r=0;for(pr.lastIndex=0;t=pr.exec(e);){if(t.index!==r)return[];r=t.index+t[0].length;var i=t[1],a=yr[i];if(!a)return[];var o=t[2].split(","),s=a[0];if(s.length<o.length)return[];for(var l=[],u=0;u<s.length;u++){var c=o[u],h=s[u],d=void 0;if(void 0===(d=c?{A:function(e){return"0"===e.trim()?tn:bn(e)},N:Zn,T:Mn,L:kn}[h.toUpperCase()](c):{a:tn,n:l[0],t:en}[h]))return[];l.push(d)}if(n.push({t:i,d:l}),pr.lastIndex===e.length)return n}return[]}function Tr(e){if(Array.isArray(e))return Er(e);if("none"===(e=(e||"none").trim()))return[];var t,n=[],r=0;for(pr.lastIndex=0;t=pr.exec(e);){if(t.index!==r)return[];r=t.index+t[0].length;var i=t[1],a=yr[i];if(!a)return[];var o=t[2].split(","),s=a[0];if(s.length<o.length)return[];for(var l=[],u=0;u<s.length;u++){var c=o[u],h=s[u],d=void 0;if(void 0===(d=c?{A:function(e){return"0"===e.trim()?tn:Cn(e)},N:Un,T:Nn,L:xn}[h.toUpperCase()](c):{a:tn,n:l[0],t:en}[h]))return[];l.push(d)}if(n.push({t:i,d:l}),pr.lastIndex===e.length)return n}return[]}function Sr(e){var t,n,r,i;switch(e.t){case"rotateX":return i=Pe(On(e.d[0])),[1,0,0,0,0,Math.cos(i),Math.sin(i),0,0,-Math.sin(i),Math.cos(i),0,0,0,0,1];case"rotateY":return i=Pe(On(e.d[0])),[Math.cos(i),0,-Math.sin(i),0,0,1,0,0,Math.sin(i),0,Math.cos(i),0,0,0,0,1];case"rotate":case"rotateZ":return i=Pe(On(e.d[0])),[Math.cos(i),Math.sin(i),0,0,-Math.sin(i),Math.cos(i),0,0,0,0,1,0,0,0,0,1];case"rotate3d":t=e.d[0].value,n=e.d[1].value,r=e.d[2].value,i=Pe(On(e.d[3]));var a=t*t+n*n+r*r;if(0===a)t=1,n=0,r=0;else if(1!==a){var o=Math.sqrt(a);t/=o,n/=o,r/=o}var s=Math.sin(i/2),l=s*Math.cos(i/2),u=s*s;return[1-2*(n*n+r*r)*u,2*(t*n*u+r*l),2*(t*r*u-n*l),0,2*(t*n*u-r*l),1-2*(t*t+r*r)*u,2*(n*r*u+t*l),0,2*(t*r*u+n*l),2*(n*r*u-t*l),1-2*(t*t+n*n)*u,0,0,0,0,1];case"scale":return[e.d[0].value,0,0,0,0,e.d[1].value,0,0,0,0,1,0,0,0,0,1];case"scaleX":return[e.d[0].value,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"scaleY":return[1,0,0,0,0,e.d[0].value,0,0,0,0,1,0,0,0,0,1];case"scaleZ":return[1,0,0,0,0,1,0,0,0,0,e.d[0].value,0,0,0,0,1];case"scale3d":return[e.d[0].value,0,0,0,0,e.d[1].value,0,0,0,0,e.d[2].value,0,0,0,0,1];case"skew":var c=Pe(On(e.d[0])),h=Pe(On(e.d[1]));return[1,Math.tan(h),0,0,Math.tan(c),1,0,0,0,0,1,0,0,0,0,1];case"skewX":return i=Pe(On(e.d[0])),[1,0,0,0,Math.tan(i),1,0,0,0,0,1,0,0,0,0,1];case"skewY":return i=Pe(On(e.d[0])),[1,Math.tan(i),0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"translate":return[1,0,0,0,0,1,0,0,0,0,1,0,t=wn(e.d[0],0,null)||0,n=wn(e.d[1],0,null)||0,0,1];case"translateX":return[1,0,0,0,0,1,0,0,0,0,1,0,t=wn(e.d[0],0,null)||0,0,0,1];case"translateY":return[1,0,0,0,0,1,0,0,0,0,1,0,0,n=wn(e.d[0],0,null)||0,0,1];case"translateZ":return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,r=wn(e.d[0],0,null)||0,1];case"translate3d":return[1,0,0,0,0,1,0,0,0,0,1,0,t=wn(e.d[0],0,null)||0,n=wn(e.d[1],0,null)||0,r=wn(e.d[2],0,null)||0,1];case"perspective":var d=wn(e.d[0],0,null)||0;return[1,0,0,0,0,1,0,0,0,0,1,d?-1/d:0,0,0,0,1];case"matrix":return[e.d[0].value,e.d[1].value,0,0,e.d[2].value,e.d[3].value,0,0,0,0,1,0,e.d[4].value,e.d[5].value,0,1];case"matrix3d":return e.d.map((function(e){return e.value}))}}function Rr(e,t){return[e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],e[0]*t[4]+e[4]*t[5]+e[8]*t[6]+e[12]*t[7],e[1]*t[4]+e[5]*t[5]+e[9]*t[6]+e[13]*t[7],e[2]*t[4]+e[6]*t[5]+e[10]*t[6]+e[14]*t[7],e[3]*t[4]+e[7]*t[5]+e[11]*t[6]+e[15]*t[7],e[0]*t[8]+e[4]*t[9]+e[8]*t[10]+e[12]*t[11],e[1]*t[8]+e[5]*t[9]+e[9]*t[10]+e[13]*t[11],e[2]*t[8]+e[6]*t[9]+e[10]*t[10]+e[14]*t[11],e[3]*t[8]+e[7]*t[9]+e[11]*t[10]+e[15]*t[11],e[0]*t[12]+e[4]*t[13]+e[8]*t[14]+e[12]*t[15],e[1]*t[12]+e[5]*t[13]+e[9]*t[14]+e[13]*t[15],e[2]*t[12]+e[6]*t[13]+e[10]*t[14]+e[14]*t[15],e[3]*t[12]+e[7]*t[13]+e[11]*t[14]+e[15]*t[15]]}function Ar(e){var t=[0,0,0],n=[1,1,1],r=[0,0,0],i=[0,0,0,1],a=[0,0,0,1];return function(e,t,n,r,i,a){if(!function(e,t){var n=t[15];if(0===n)return!1;for(var r=1/n,i=0;i<16;i++)e[i]=t[i]*r;return!0}(Be,e))return!1;if(p.copy(Fe,Be),Fe[3]=0,Fe[7]=0,Fe[11]=0,Fe[15]=1,Math.abs(p.determinant(Fe))<1e-8)return!1;var o,s,l=Be[3],u=Be[7],c=Be[11],h=Be[12],d=Be[13],g=Be[14],m=Be[15];if(0!==l||0!==u||0!==c){if(Ue[0]=l,Ue[1]=u,Ue[2]=c,Ue[3]=m,!p.invert(Fe,Fe))return!1;p.transpose(Fe,Fe),v.transformMat4(i,Ue,Fe)}else i[0]=i[1]=i[2]=0,i[3]=1;if(t[0]=h,t[1]=d,t[2]=g,s=Be,(o=Ze)[0][0]=s[0],o[0][1]=s[1],o[0][2]=s[2],o[1][0]=s[4],o[1][1]=s[5],o[1][2]=s[6],o[2][0]=s[8],o[2][1]=s[9],o[2][2]=s[10],n[0]=f.length(Ze[0]),f.normalize(Ze[0],Ze[0]),r[0]=f.dot(Ze[0],Ze[1]),Ve(Ze[1],Ze[1],Ze[0],1,-r[0]),n[1]=f.length(Ze[1]),f.normalize(Ze[1],Ze[1]),r[0]/=n[1],r[1]=f.dot(Ze[0],Ze[2]),Ve(Ze[2],Ze[2],Ze[0],1,-r[1]),r[2]=f.dot(Ze[1],Ze[2]),Ve(Ze[2],Ze[2],Ze[1],1,-r[2]),n[2]=f.length(Ze[2]),f.normalize(Ze[2],Ze[2]),r[1]/=n[2],r[2]/=n[2],f.cross(Ge,Ze[1],Ze[2]),f.dot(Ze[0],Ge)<0)for(var y=0;y<3;y++)n[y]*=-1,Ze[y][0]*=-1,Ze[y][1]*=-1,Ze[y][2]*=-1;a[0]=.5*Math.sqrt(Math.max(1+Ze[0][0]-Ze[1][1]-Ze[2][2],0)),a[1]=.5*Math.sqrt(Math.max(1-Ze[0][0]+Ze[1][1]-Ze[2][2],0)),a[2]=.5*Math.sqrt(Math.max(1-Ze[0][0]-Ze[1][1]+Ze[2][2],0)),a[3]=.5*Math.sqrt(Math.max(1+Ze[0][0]+Ze[1][1]+Ze[2][2],0)),Ze[2][1]>Ze[1][2]&&(a[0]=-a[0]),Ze[0][2]>Ze[2][0]&&(a[1]=-a[1]),Ze[1][0]>Ze[0][1]&&(a[2]=-a[2])}(function(e){return 0===e.length?[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]:e.map(Sr).reduce(Rr)}(e),t,n,r,i,a),[[t,n,r,a,i]]}var xr=function(){function e(e,t){for(var n=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],r=0;r<4;r++)for(var i=0;i<4;i++)for(var a=0;a<4;a++)n[r][i]+=t[r][a]*e[a][i];return n}return function(t,n,r,i,a){for(var o=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],s=0;s<4;s++)o[s][3]=a[s];for(var l=0;l<3;l++)for(var u=0;u<3;u++)o[3][l]+=t[u]*o[u][l];var c=i[0],h=i[1],d=i[2],f=i[3],v=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];v[0][0]=1-2*(h*h+d*d),v[0][1]=2*(c*h-d*f),v[0][2]=2*(c*d+h*f),v[1][0]=2*(c*h+d*f),v[1][1]=1-2*(c*c+d*d),v[1][2]=2*(h*d-c*f),v[2][0]=2*(c*d-h*f),v[2][1]=2*(h*d+c*f),v[2][2]=1-2*(c*c+h*h),o=e(o,v);var p,g=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];r[2]&&(g[2][1]=r[2],o=e(o,g)),r[1]&&(g[2][1]=0,g[2][0]=r[0],o=e(o,g)),r[0]&&(g[2][0]=0,g[1][0]=r[0],o=e(o,g));for(var m=0;m<3;m++)for(var y=0;y<3;y++)o[m][y]*=n[m];return 0===(p=o)[0][2]&&0===p[0][3]&&0===p[1][2]&&0===p[1][3]&&0===p[2][0]&&0===p[2][1]&&1===p[2][2]&&0===p[2][3]&&0===p[3][2]&&1===p[3][3]?[o[0][0],o[0][1],o[1][0],o[1][1],o[3][0],o[3][1]]:o[0].concat(o[1],o[2],o[3])}}();function kr(e){return e.toFixed(6).replace(".000000","")}function Nr(e,t){var n,r;return e.decompositionPair!==t&&(e.decompositionPair=t,n=Ar(e)),t.decompositionPair!==e&&(t.decompositionPair=e,r=Ar(t)),null===n[0]||null===r[0]?[[!1],[!0],function(n){return n?t[0].d:e[0].d}]:(n[0].push(0),r[0].push(1),[n,r,function(e){var t=function(e,t,n){var r=function(e,t){for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[r];return n}(e,t);r=(0,R.Z)(r,-1,1);var i=[];if(1===r)i=e;else for(var a=Math.acos(r),o=1*Math.sin(n*a)/Math.sqrt(1-r*r),s=0;s<4;s++)i.push(e[s]*(Math.cos(n*a)-r*o)+t[s]*o);return i}(n[0][3],r[0][3],e[5]);return xr(e[0],e[1],e[2],t,e[4]).map(kr).join(",")}])}function Mr(e){return e.replace(/[XY]/,"")}function Cr(e){return e.replace(/(X|Y|Z|3d)?$/,"3d")}function br(e,t,n){var r=!1;if(!e.length||!t.length){e.length||(r=!0,e=t,t=[]);for(var i=function(){var n=e[a],r=n.t,i=n.d,o="scale"===r.substring(0,5)?1:0;t.push({t:r,d:i.map((function(e){return"number"==typeof e?un(o):un(o,e.unit)}))})},a=0;a<e.length;a++)i()}var o,s,l=[],u=[],c=[];if(e.length!==t.length){var h=Nr(e,t);l=[h[0]],u=[h[1]],c=[["matrix",[h[2]]]]}else for(var d=0;d<e.length;d++){var f=e[d].t,v=t[d].t,p=e[d].d,g=t[d].d,m=yr[f],y=yr[v],E=void 0;if(s=v,"perspective"===(o=f)&&"perspective"===s||!("matrix"!==o&&"matrix3d"!==o||"matrix"!==s&&"matrix3d"!==s)){var _=Nr([e[d]],[t[d]]);l.push(_[0]),u.push(_[1]),c.push(["matrix",[_[2]]])}else{if(f===v)E=f;else if(m[2]&&y[2]&&Mr(f)===Mr(v))E=Mr(f),p=m[2](p),g=y[2](g);else{if(!m[1]||!y[1]||Cr(f)!==Cr(v)){var T=Nr(e,t);l=[T[0]],u=[T[1]],c=[["matrix",[T[2]]]];break}E=Cr(f),p=m[1](p),g=y[1](g)}for(var S=[],R=[],A=[],x=0;x<p.length;x++){var k=Pn(p[x],g[x],n,!1,x);S[x]=k[0],R[x]=k[1],A.push(k[2])}l.push(S),u.push(R),c.push([E,A])}}if(r){var N=l;l=u,u=N}return[l,u,function(e){return e.map((function(e,t){var n=e.map((function(e,n){return c[t][1][n](e)})).join(",");return"matrix"===c[t][0]&&16===n.split(",").length&&(c[t][0]="matrix3d"),"matrix3d"===c[t][0]&&6===n.split(",").length&&(c[t][0]="matrix"),"".concat(c[t][0],"(").concat(n,")")})).join(" ")}]}var Pr=Bt((function(e){if((0,S.Z)(e)){if("text-anchor"===e)return[un(0,"px"),un(0,"px")];var t=e.split(" ");return 1===t.length&&("top"===t[0]||"bottom"===t[0]?(t[1]=t[0],t[0]="center"):t[1]="center"),2!==t.length?null:[Mn(Or(t[0])),Mn(Or(t[1]))]}return[un(e[0]||0,"px"),un(e[1]||0,"px")]}));function Or(e){return"center"===e?"50%":"left"===e||"top"===e?"0%":"right"===e||"bottom"===e?"100%":e}var Ir=[{n:"display",k:["none"]},{n:"opacity",int:!0,inh:!0,d:"1",syntax:nt.OPACITY_VALUE},{n:"fillOpacity",int:!0,inh:!0,d:"1",syntax:nt.OPACITY_VALUE},{n:"strokeOpacity",int:!0,inh:!0,d:"1",syntax:nt.OPACITY_VALUE},{n:"fill",int:!0,k:["none"],d:"none",syntax:nt.PAINT},{n:"fillRule",k:["nonzero","evenodd"],d:"nonzero"},{n:"stroke",int:!0,k:["none"],d:"none",syntax:nt.PAINT,l:!0},{n:"shadowType",k:["inner","outer","both"],d:"outer",l:!0},{n:"shadowColor",int:!0,syntax:nt.COLOR},{n:"shadowOffsetX",int:!0,l:!0,d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"shadowOffsetY",int:!0,l:!0,d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"shadowBlur",int:!0,l:!0,d:"0",syntax:nt.SHADOW_BLUR},{n:"lineWidth",int:!0,inh:!0,d:"1",l:!0,a:["strokeWidth"],syntax:nt.LENGTH_PERCENTAGE},{n:"increasedLineWidthForHitTesting",inh:!0,d:"0",l:!0,syntax:nt.LENGTH_PERCENTAGE},{n:"lineJoin",inh:!0,l:!0,a:["strokeLinejoin"],k:["miter","bevel","round"],d:"miter"},{n:"lineCap",inh:!0,l:!0,a:["strokeLinecap"],k:["butt","round","square"],d:"butt"},{n:"lineDash",int:!0,inh:!0,k:["none"],a:["strokeDasharray"],syntax:nt.LENGTH_PERCENTAGE_12},{n:"lineDashOffset",int:!0,inh:!0,d:"0",a:["strokeDashoffset"],syntax:nt.LENGTH_PERCENTAGE},{n:"offsetPath",syntax:nt.DEFINED_PATH},{n:"offsetDistance",int:!0,syntax:nt.OFFSET_DISTANCE},{n:"dx",int:!0,l:!0,d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"dy",int:!0,l:!0,d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"zIndex",ind:!0,int:!0,d:"0",k:["auto"],syntax:nt.Z_INDEX},{n:"visibility",k:["visible","hidden"],ind:!0,inh:!0,int:!0,d:"visible"},{n:"pointerEvents",inh:!0,k:["none","auto","stroke","fill","painted","visible","visiblestroke","visiblefill","visiblepainted","all"],d:"auto"},{n:"filter",ind:!0,l:!0,k:["none"],d:"none",syntax:nt.FILTER},{n:"clipPath",syntax:nt.DEFINED_PATH},{n:"textPath",syntax:nt.DEFINED_PATH},{n:"textPathSide",k:["left","right"],d:"left"},{n:"textPathStartOffset",l:!0,d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"transform",p:100,int:!0,k:["none"],d:"none",syntax:nt.TRANSFORM},{n:"transformOrigin",p:100,d:"0 0",l:!0,syntax:nt.TRANSFORM_ORIGIN},{n:"cx",int:!0,l:!0,d:"0",syntax:nt.COORDINATE},{n:"cy",int:!0,l:!0,d:"0",syntax:nt.COORDINATE},{n:"cz",int:!0,l:!0,d:"0",syntax:nt.COORDINATE},{n:"r",int:!0,l:!0,d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"rx",int:!0,l:!0,d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"ry",int:!0,l:!0,d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"x",int:!0,l:!0,d:"0",syntax:nt.COORDINATE},{n:"y",int:!0,l:!0,d:"0",syntax:nt.COORDINATE},{n:"z",int:!0,l:!0,d:"0",syntax:nt.COORDINATE},{n:"width",int:!0,l:!0,k:["auto","fit-content","min-content","max-content"],d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"height",int:!0,l:!0,k:["auto","fit-content","min-content","max-content"],d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"radius",int:!0,l:!0,d:"0",syntax:nt.LENGTH_PERCENTAGE_14},{n:"x1",int:!0,l:!0,syntax:nt.COORDINATE},{n:"y1",int:!0,l:!0,syntax:nt.COORDINATE},{n:"z1",int:!0,l:!0,syntax:nt.COORDINATE},{n:"x2",int:!0,l:!0,syntax:nt.COORDINATE},{n:"y2",int:!0,l:!0,syntax:nt.COORDINATE},{n:"z2",int:!0,l:!0,syntax:nt.COORDINATE},{n:"d",int:!0,l:!0,d:"",syntax:nt.PATH,p:50},{n:"points",int:!0,l:!0,syntax:nt.LIST_OF_POINTS,p:50},{n:"text",l:!0,d:"",syntax:nt.TEXT,p:50},{n:"textTransform",l:!0,inh:!0,k:["capitalize","uppercase","lowercase","none"],d:"none",syntax:nt.TEXT_TRANSFORM,p:51},{n:"font",l:!0},{n:"fontSize",int:!0,inh:!0,d:"16px",l:!0,syntax:nt.LENGTH_PERCENTAGE},{n:"fontFamily",l:!0,inh:!0,d:"sans-serif"},{n:"fontStyle",l:!0,inh:!0,k:["normal","italic","oblique"],d:"normal"},{n:"fontWeight",l:!0,inh:!0,k:["normal","bold","bolder","lighter"],d:"normal"},{n:"fontVariant",l:!0,inh:!0,k:["normal","small-caps"],d:"normal"},{n:"lineHeight",l:!0,syntax:nt.LENGTH,int:!0,d:"0"},{n:"letterSpacing",l:!0,syntax:nt.LENGTH,int:!0,d:"0"},{n:"miterLimit",l:!0,syntax:nt.NUMBER,d:function(e){return e===he.PATH||e===he.POLYGON||e===he.POLYLINE?"4":"10"}},{n:"wordWrap",l:!0},{n:"wordWrapWidth",l:!0},{n:"maxLines",l:!0},{n:"textOverflow",l:!0,d:"clip"},{n:"leading",l:!0},{n:"textBaseline",l:!0,inh:!0,k:["top","hanging","middle","alphabetic","ideographic","bottom"],d:"alphabetic"},{n:"textAlign",l:!0,inh:!0,k:["start","center","middle","end","left","right"],d:"start"},{n:"markerStart",syntax:nt.MARKER},{n:"markerEnd",syntax:nt.MARKER},{n:"markerMid",syntax:nt.MARKER},{n:"markerStartOffset",syntax:nt.LENGTH,l:!0,int:!0,d:"0"},{n:"markerEndOffset",syntax:nt.LENGTH,l:!0,int:!0,d:"0"}],wr=new Set(Ir.filter((function(e){return!!e.l})).map((function(e){return e.n}))),Lr={},Dr=function(){return(0,a.Z)((function e(t){var n=this;(0,o.Z)(this,e),this.runtime=t,Ir.forEach((function(e){n.registerMetadata(e)}))}),[{key:"registerMetadata",value:function(e){[e.n].concat((0,c.Z)(e.a||[])).forEach((function(t){Lr[t]=e}))}},{key:"getPropertySyntax",value:function(e){return this.runtime.CSSPropertySyntaxFactory[e]}},{key:"processProperties",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{skipUpdateAttribute:!1,skipParse:!1,forceUpdateGeometry:!1,usedAttributes:[],memoize:!0};Object.assign(e.attributes,t);var r=e.parsedStyle.clipPath,i=e.parsedStyle.offsetPath;Br(e,t);var a=!!n.forceUpdateGeometry;if(!a)for(var o in t)if(wr.has(o)){a=!0;break}var s=Fr(e);s.has("fill")&&t.fill&&(e.parsedStyle.fill=Sn(t.fill)),s.has("stroke")&&t.stroke&&(e.parsedStyle.stroke=Sn(t.stroke)),s.has("shadowColor")&&t.shadowColor&&(e.parsedStyle.shadowColor=Sn(t.shadowColor)),s.has("filter")&&t.filter&&(e.parsedStyle.filter=Bn(t.filter)),s.has("radius")&&!(0,T.Z)(t.radius)&&(e.parsedStyle.radius=In(t.radius,4)),s.has("lineDash")&&!(0,T.Z)(t.lineDash)&&(e.parsedStyle.lineDash=In(t.lineDash,"even")),s.has("points")&&t.points&&(e.parsedStyle.points=dr(t.points)),s.has("d")&&""===t.d&&(e.parsedStyle.d=(0,u.Z)({},tt)),s.has("d")&&t.d&&(e.parsedStyle.d=cr(t.d)),s.has("textTransform")&&t.textTransform&&this.runtime.CSSPropertySyntaxFactory[nt.TEXT_TRANSFORM].calculator(null,null,{value:t.textTransform},e,null),s.has("clipPath")&&!(0,D.Z)(t.clipPath)&&this.runtime.CSSPropertySyntaxFactory[nt.DEFINED_PATH].calculator("clipPath",r,t.clipPath,e,this.runtime),s.has("offsetPath")&&t.offsetPath&&this.runtime.CSSPropertySyntaxFactory[nt.DEFINED_PATH].calculator("offsetPath",i,t.offsetPath,e,this.runtime),s.has("transform")&&t.transform&&(e.parsedStyle.transform=_r(t.transform)),s.has("transformOrigin")&&t.transformOrigin&&(e.parsedStyle.transformOrigin=Pr(t.transformOrigin)),s.has("markerStart")&&t.markerStart&&(e.parsedStyle.markerStart=this.runtime.CSSPropertySyntaxFactory[nt.MARKER].calculator(null,t.markerStart,t.markerStart,null,null)),s.has("markerEnd")&&t.markerEnd&&(e.parsedStyle.markerEnd=this.runtime.CSSPropertySyntaxFactory[nt.MARKER].calculator(null,t.markerEnd,t.markerEnd,null,null)),s.has("markerMid")&&t.markerMid&&(e.parsedStyle.markerMid=this.runtime.CSSPropertySyntaxFactory[nt.MARKER].calculator("",t.markerMid,t.markerMid,null,null)),s.has("zIndex")&&!(0,T.Z)(t.zIndex)&&this.runtime.CSSPropertySyntaxFactory[nt.Z_INDEX].postProcessor(e),s.has("offsetDistance")&&!(0,T.Z)(t.offsetDistance)&&this.runtime.CSSPropertySyntaxFactory[nt.OFFSET_DISTANCE].postProcessor(e),s.has("transform")&&t.transform&&this.runtime.CSSPropertySyntaxFactory[nt.TRANSFORM].postProcessor(e),s.has("transformOrigin")&&t.transformOrigin&&this.runtime.CSSPropertySyntaxFactory[nt.TRANSFORM_ORIGIN].postProcessor(e),a&&(e.dirty(!0,!0),n.forceUpdateGeometry||this.runtime.sceneGraphService.dirtyToRoot(e))}},{key:"updateGeometry",value:function(e){var t=e.nodeName,n=this.runtime.geometryUpdaterFactory[t];if(n){var r=e.geometry;r.contentBounds||(r.contentBounds=new Te),r.renderBounds||(r.renderBounds=new Te);var i=e.parsedStyle,a=n.update(i,e),o=a.cx,s=void 0===o?0:o,l=a.cy,u=void 0===l?0:l,c=a.cz,h=void 0===c?0:c,d=a.hwidth,v=void 0===d?0:d,p=a.hheight,g=void 0===p?0:p,m=a.hdepth,y=void 0===m?0:m,E=[Math.abs(v),Math.abs(g),y],_=i.stroke,T=i.lineWidth,S=void 0===T?1:T,R=i.increasedLineWidthForHitTesting,A=void 0===R?0:R,x=i.shadowType,k=void 0===x?"outer":x,N=i.shadowColor,M=i.filter,C=void 0===M?[]:M,b=i.transformOrigin,P=[s,u,h];r.contentBounds.update(P,E);var O=t===he.POLYLINE||t===he.POLYGON||t===he.PATH?Math.SQRT2:.5;if(_&&!_.isNone){var I=((S||0)+(A||0))*O;E[0]+=I,E[1]+=I}if(r.renderBounds.update(P,E),N&&k&&"inner"!==k){var w=r.renderBounds,L=w.min,D=w.max,B=i.shadowBlur||0,F=i.shadowOffsetX||0,U=i.shadowOffsetY||0,Z=L[0]-B+F,G=D[0]+B+F,V=L[1]-B+U,W=D[1]+B+U;L[0]=Math.min(L[0],Z),D[0]=Math.max(D[0],G),L[1]=Math.min(L[1],V),D[1]=Math.max(D[1],W),r.renderBounds.setMinMax(L,D)}C.forEach((function(e){var t=e.name,n=e.params;if("blur"===t){var i=n[0].value;r.renderBounds.update(r.renderBounds.center,f.add(r.renderBounds.halfExtents,r.renderBounds.halfExtents,[i,i,0]))}else if("drop-shadow"===t){var a=n[0].value,o=n[1].value,s=n[2].value,l=r.renderBounds,u=l.min,c=l.max,h=u[0]-s+a,d=c[0]+s+a,v=u[1]-s+o,p=c[1]+s+o;u[0]=Math.min(u[0],h),c[0]=Math.max(c[0],d),u[1]=Math.min(u[1],v),c[1]=Math.max(c[1],p),r.renderBounds.setMinMax(u,c)}})),e.geometry.dirty=!1;var H=g<0,X=(v<0?-1:1)*(b?wn(b[0],0,e,!0):0),z=(H?-1:1)*(b?wn(b[1],1,e,!0):0);(X||z)&&e.setOrigin(X,z)}}},{key:"updateSizeAttenuation",value:function(e,t){e.style.isSizeAttenuation?(e.style.rawLineWidth||(e.style.rawLineWidth=e.style.lineWidth),e.style.lineWidth=(e.style.rawLineWidth||1)/t,e.nodeName===he.CIRCLE&&(e.style.rawR||(e.style.rawR=e.style.r),e.style.r=(e.style.rawR||1)/t)):(e.style.rawLineWidth&&(e.style.lineWidth=e.style.rawLineWidth,delete e.style.rawLineWidth),e.nodeName===he.CIRCLE&&e.style.rawR&&(e.style.r=e.style.rawR,delete e.style.rawR))}}])}();function Br(e,t){var n=Fr(e);for(var r in t)n.has(r)&&(e.parsedStyle[r]=t[r])}function Fr(e){return e.constructor.PARSED_STYLE_LIST}var Ur=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Gn}),[{key:"calculator",value:function(e,t,n,r){return On(n)}}])}(),Zr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r,i){return n instanceof $t&&(n=null),i.sceneGraphService.updateDisplayObjectDependency(e,t,n,r),"clipPath"===e&&r.forEach((function(e){0===e.childNodes.length&&i.sceneGraphService.dirtyToRoot(e)})),n}}])}(),Gr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.parser=Sn,this.mixer=Rn}),[{key:"calculator",value:function(e,t,n,r){return n instanceof $t?"none"===n.value?on:sn:n}}])}(),Vr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n){return n instanceof $t?[]:n}}])}();function Wr(e){var t=e.parsedStyle.fontSize;return(0,T.Z)(t)?null:t}var Hr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Gn}),[{key:"calculator",value:function(e,t,n,r,i){if((0,E.Z)(n))return n;if(!Jt.isRelativeUnit(n.unit))return n.value;if(n.unit===Ft.kPercentage)return 0;if(n.unit===Ft.kEms){if(r.parentNode){var a=Wr(r.parentNode);if(a)return a*=n.value}return 0}if(n.unit===Ft.kRems){var o;if(null!=r&&null!==(o=r.ownerDocument)&&void 0!==o&&o.documentElement){var s=Wr(r.ownerDocument.documentElement);if(s)return s*=n.value}return 0}}}])}(),Xr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Wn}),[{key:"calculator",value:function(e,t,n){return n.map((function(e){return e.value}))}}])}(),zr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Wn}),[{key:"calculator",value:function(e,t,n){return n.map((function(e){return e.value}))}}])}(),Yr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){var i;n instanceof $t&&(n=null);var a=null===(i=n)||void 0===i?void 0:i.cloneNode(!0);return a&&(a.style.isMarker=!0),a}}])}(),jr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Gn}),[{key:"calculator",value:function(e,t,n){return n.value}}])}(),Kr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Vn(0,1)}),[{key:"calculator",value:function(e,t,n){return n.value}},{key:"postProcessor",value:function(e){var t=e.parsedStyle,n=t.offsetPath,r=t.offsetDistance;if(n){var i=n.nodeName;if(i===he.LINE||i===he.PATH||i===he.POLYLINE){var a=n.getPoint(r);a&&e.setLocalPosition(a.x,a.y)}}}}])}(),qr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Vn(0,1)}),[{key:"calculator",value:function(e,t,n){return n.value}}])}(),$r=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.parser=cr,this.mixer=hr}),[{key:"calculator",value:function(e,t,n){return n instanceof $t&&"unset"===n.value?{absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:new xe(0,0,0,0)}:n}}])}(),Qr=(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=fr})),Jr=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).mixer=Vn(0,1/0),e}return(0,l.Z)(t,e),(0,a.Z)(t)}(Hr),ei=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){return n instanceof $t?"unset"===n.value?"":n.value:"".concat(n)}},{key:"postProcessor",value:function(e){e.nodeValue="".concat(e.parsedStyle.text)||""}}])}(),ti=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){var i=r.getAttribute("text");if(i){var a=i;"capitalize"===n.value?a=i.charAt(0).toUpperCase()+i.slice(1):"lowercase"===n.value?a=i.toLowerCase():"uppercase"===n.value&&(a=i.toUpperCase()),r.parsedStyle.text=a}return n.value}}])}();new WeakMap;"undefined"!=typeof window&&window.document;function ni(e){var t=e;do{var n;if(null===(n=t.parsedStyle)||void 0===n?void 0:n.clipPath)return t;t=t.parentElement}while(null!==t);return null}var ri={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},ii="object"===("undefined"==typeof performance?"undefined":i()(performance))&&performance.now?performance:Date;function ai(e){return e.nodeName===he.FRAGMENT||e.getRootNode().nodeName===he.FRAGMENT}var oi=1,si="object"===("undefined"==typeof self?"undefined":i()(self))&&self.self===self?self:"object"===(void 0===n.g?"undefined":i()(n.g))&&n.g.global===n.g?n.g:{},li=Date.now(),ui={},ci=Date.now(),hi=function(e){if("function"!=typeof e)throw new TypeError("".concat(e," is not a function"));var t=Date.now(),n=t-ci,r=n>16?0:16-n,i=oi++;return ui[i]=e,Object.keys(ui).length>1||setTimeout((function(){ci=t;var e=ui;ui={},Object.keys(e).forEach((function(t){return e[t](si.performance&&"function"==typeof si.performance.now?si.performance.now():Date.now()-li)}))}),r),i},di=function(e){delete ui[e]},fi=function(e){return"string"!=typeof e?hi:""===e?si.requestAnimationFrame:si["".concat(e,"RequestAnimationFrame")]},vi=function(e,t){for(var n=0;void 0!==e[n];){if(t(e[n]))return e[n];n+=1}}(["","webkit","moz","ms","o"],(function(e){return!!fi(e)})),pi=fi(vi),gi=function(e){return"string"!=typeof e?di:""===e?si.cancelAnimationFrame:si["".concat(e,"CancelAnimationFrame")]||si["".concat(e,"CancelRequestAnimationFrame")]}(vi);si.requestAnimationFrame=pi,si.cancelAnimationFrame=gi;var mi=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],yi=/([\"\'])[^\'\"]+\1/;function Ei(e){var t=e.fontSize,n=void 0===t?16:t,r=e.fontFamily,i=void 0===r?"sans-serif":r,a=e.fontStyle,o=void 0===a?"normal":a,s=e.fontVariant,l=void 0===s?"normal":s,u=e.fontWeight;return{fontSize:n,fontFamily:i,fontStyle:o,fontVariant:l,fontWeight:void 0===u?"normal":u}}var _i=Bt((function(e){for(var t=Ei(e),n=t.fontSize,r=t.fontFamily,i=t.fontStyle,a=t.fontVariant,o=t.fontWeight,s=(0,E.Z)(n)&&"".concat(n,"px")||"16px",l=r.split(","),u=l.length-1;u>=0;u--){var c=l[u].trim();!yi.test(c)&&mi.indexOf(c)<0&&(c='"'.concat(c,'"')),l[u]=c}return"".concat(i," ").concat(a," ").concat(o," ").concat(s," ").concat(l.join(","))}),(function(e){var t=Ei(e),n=t.fontSize,r=t.fontFamily,i=t.fontStyle,a=t.fontVariant,o=t.fontWeight;return"".concat(i,"_").concat(a,"_").concat(o,"_").concat(n,"_").concat(r)})),Ti=function(e){return Math.max(e,1e-6)};function Si(e,t,n){return p.identity(e),e[4]=Math.tan(t),e[1]=Math.tan(n),e}var Ri=p.create(),Ai=p.create(),xi={scale:function(e){p.fromScaling(Ri,[e[0].value,e[1].value,1].map((function(e){return Ti(e)})))},scaleX:function(e){p.fromScaling(Ri,[e[0].value,1,1].map((function(e){return Ti(e)})))},scaleY:function(e){p.fromScaling(Ri,[1,e[0].value,1].map((function(e){return Ti(e)})))},scaleZ:function(e){p.fromScaling(Ri,[1,1,e[0].value].map((function(e){return Ti(e)})))},scale3d:function(e){p.fromScaling(Ri,[e[0].value,e[1].value,e[2].value].map((function(e){return Ti(e)})))},translate:function(e){p.fromTranslation(Ri,[e[0].value,e[1].value,0])},translateX:function(e){p.fromTranslation(Ri,[e[0].value,0,0])},translateY:function(e){p.fromTranslation(Ri,[0,e[0].value,0])},translateZ:function(e){p.fromTranslation(Ri,[0,0,e[0].value])},translate3d:function(e){p.fromTranslation(Ri,[e[0].value,e[1].value,e[2].value])},rotate:function(e){p.fromZRotation(Ri,Pe(On(e[0])))},rotateX:function(e){p.fromXRotation(Ri,Pe(On(e[0])))},rotateY:function(e){p.fromYRotation(Ri,Pe(On(e[0])))},rotateZ:function(e){p.fromZRotation(Ri,Pe(On(e[0])))},rotate3d:function(e){p.fromRotation(Ri,Pe(On(e[3])),[e[0].value,e[1].value,e[2].value])},skew:function(e){Si(Ri,Pe(e[0].value),Pe(e[1].value))},skewX:function(e){Si(Ri,Pe(e[0].value),0)},skewY:function(e){Si(Ri,0,Pe(e[0].value))},matrix:function(e){p.set(Ri,e[0].value,e[1].value,0,0,e[2].value,e[3].value,0,0,0,0,1,0,e[4].value,e[5].value,0,1)},matrix3d:function(e){p.set.apply(p,[Ri].concat((0,c.Z)(e.map((function(e){return e.value})))))}},ki=f.fromValues(1,1,1),Ni=f.create(),Mi={translate:function(e,t){Ca.sceneGraphService.setLocalScale(e,ki,!1),Ca.sceneGraphService.setLocalEulerAngles(e,Ni,void 0,void 0,!1),Ca.sceneGraphService.setLocalPosition(e,[t[0].value,t[1].value,0],!1),Ca.sceneGraphService.dirtyLocalTransform(e,e.transformable)}};function Ci(e,t){if(e.length){if(1===e.length&&Mi[e[0].t])return void Mi[e[0].t](t,e[0].d);for(var n=p.identity(Ai),r=0;r<e.length;r++){var i=e[r],a=i.t,o=i.d,s=xi[a];s&&(s(o),p.mul(n,n,Ri))}t.setLocalTransform(n)}else t.resetLocalTransform();return t.getLocalTransform()}var bi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.parser=Tr,this.mixer=br}),[{key:"calculator",value:function(e,t,n,r){return n instanceof $t?[]:n}},{key:"postProcessor",value:function(e){Ci(e.parsedStyle.transform,e)}}])}(),Pi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"postProcessor",value:function(e){var t=e.parsedStyle.transformOrigin;t[0].unit===Ft.kPixels&&t[1].unit===Ft.kPixels?e.setOrigin(t[0].value,t[1].value):e.getGeometryBounds()}}])}(),Oi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){return n.value}},{key:"postProcessor",value:function(e){if(e.parentNode){var t=e.parentNode,n=t.renderable,r=t.sortable;n&&t.dirty(),r&&(r.dirty=!0,r.dirtyReason=qe.Z_INDEX_CHANGED)}}}])}(),Ii=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.cx,r=void 0===n?0:n,i=e.cy,a=void 0===i?0:i,o=e.r,s=void 0===o?0:o;return{cx:r,cy:a,hwidth:s,hheight:s}}}])}(),wi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.cx,r=void 0===n?0:n,i=e.cy,a=void 0===i?0:i,o=e.rx,s=void 0===o?0:o,l=e.ry;return{cx:r,cy:a,hwidth:s,hheight:void 0===l?0:l}}}])}(),Li=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e){var t=e.x1,n=e.y1,r=e.x2,i=e.y2,a=Math.min(t,r),o=Math.max(t,r),s=Math.min(n,i),l=(o-a)/2,u=(Math.max(n,i)-s)/2;return{cx:a+l,cy:s+u,hwidth:l,hheight:u}}}])}(),Di=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e){var t=e.d.rect,n=t.x,r=t.y,i=t.width/2,a=t.height/2;return{cx:n+i,cy:r+a,hwidth:i,hheight:a}}}])}(),Bi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e){if(e.points&&(0,B.Z)(e.points.points)){var t=e.points.points,n=Math.min.apply(Math,(0,c.Z)(t.map((function(e){return e[0]})))),r=Math.max.apply(Math,(0,c.Z)(t.map((function(e){return e[0]})))),i=Math.min.apply(Math,(0,c.Z)(t.map((function(e){return e[1]})))),a=(r-n)/2,o=(Math.max.apply(Math,(0,c.Z)(t.map((function(e){return e[1]}))))-i)/2;return{cx:n+a,cy:i+o,hwidth:a,hheight:o}}return{cx:0,cy:0,hwidth:0,hheight:0}}}])}(),Fi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.x,r=void 0===n?0:n,i=e.y,a=void 0===i?0:i,o=e.src,s=e.width,l=void 0===s?0:s,u=e.height,c=l,h=void 0===u?0:u;return o&&!(0,S.Z)(o)&&(c||(c=o.width,e.width=c),h||(h=o.height,e.height=h)),{cx:r+c/2,cy:a+h/2,hwidth:c/2,hheight:h/2}}}])}(),Ui=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.globalRuntime=t}),[{key:"isReadyToMeasure",value:function(e,t){return e.text}},{key:"update",value:function(e,t){var n,r=e.text,i=e.textAlign,a=void 0===i?"start":i,o=e.lineWidth,s=void 0===o?1:o,l=e.textBaseline,u=void 0===l?"alphabetic":l,c=e.dx,h=void 0===c?0:c,d=e.dy,f=void 0===d?0:d,v=e.x,p=void 0===v?0:v,g=e.y,m=void 0===g?0:g;if(!this.isReadyToMeasure(e,t))return e.metrics={font:"",width:0,height:0,lines:[],lineWidths:[],lineHeight:0,maxLineWidth:0,fontProperties:{ascent:0,descent:0,fontSize:0},lineMetrics:[]},{hwidth:0,hheight:0,cx:0,cy:0};var y=((null==t||null===(n=t.ownerDocument)||void 0===n||null===(n=n.defaultView)||void 0===n?void 0:n.getConfig())||{}).offscreenCanvas,E=this.globalRuntime.textService.measureText(r,e,y);e.metrics=E;var _=E.width/2,T=E.height/2,S=p+_;"center"===a||"middle"===a?S+=s/2-_:"right"!==a&&"end"!==a||(S+=s-2*_);var R=m-T;return"middle"===u?R+=T:"top"===u||"hanging"===u?R+=2*T:"alphabetic"===u||"bottom"!==u&&"ideographic"!==u||(R+=0),h&&(S+=h),f&&(R+=f),{cx:S,cy:R,hwidth:_,hheight:T}}}])}(),Zi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){return{cx:0,cy:0,hwidth:0,hheight:0}}}])}(),Gi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.x,r=void 0===n?0:n,i=e.y,a=void 0===i?0:i,o=e.width,s=void 0===o?0:o,l=e.height,u=void 0===l?0:l;return{cx:r+s/2,cy:a+u/2,hwidth:s/2,hheight:u/2}}}])}();var Vi=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.eventPhase=e.prototype.NONE,this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.defaultPrevented=!1,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Ae,this.page=new Ae,this.canvas=new Ae,this.viewport=new Ae,this.composed=!1,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}),[{key:"name",get:function(){return this.type}},{key:"layerX",get:function(){return this.layer.x}},{key:"layerY",get:function(){return this.layer.y}},{key:"pageX",get:function(){return this.page.x}},{key:"pageY",get:function(){return this.page.y}},{key:"x",get:function(){return this.canvas.x}},{key:"y",get:function(){return this.canvas.y}},{key:"canvasX",get:function(){return this.canvas.x}},{key:"canvasY",get:function(){return this.canvas.y}},{key:"viewportX",get:function(){return this.viewport.x}},{key:"viewportY",get:function(){return this.viewport.y}},{key:"composedPath",value:function(){return!this.manager||this.path&&this.path[0]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}},{key:"propagationPath",get:function(){return this.composedPath()}},{key:"preventDefault",value:function(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}},{key:"stopImmediatePropagation",value:function(){this.propagationImmediatelyStopped=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"initEvent",value:function(){}},{key:"initUIEvent",value:function(){}},{key:"clone",value:function(){throw new Error(ke)}}])}(),Wi=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).client=new Ae,e.movement=new Ae,e.offset=new Ae,e.global=new Ae,e.screen=new Ae,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clientX",get:function(){return this.client.x}},{key:"clientY",get:function(){return this.client.y}},{key:"movementX",get:function(){return this.movement.x}},{key:"movementY",get:function(){return this.movement.y}},{key:"offsetX",get:function(){return this.offset.x}},{key:"offsetY",get:function(){return this.offset.y}},{key:"globalX",get:function(){return this.global.x}},{key:"globalY",get:function(){return this.global.y}},{key:"screenX",get:function(){return this.screen.x}},{key:"screenY",get:function(){return this.screen.y}},{key:"getModifierState",value:function(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}},{key:"initMouseEvent",value:function(){throw new Error(ke)}}])}(Vi),Hi=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).width=0,e.height=0,e.isPrimary=!1,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getCoalescedEvents",value:function(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}},{key:"getPredictedEvents",value:function(){throw new Error("getPredictedEvents is not supported!")}},{key:"clone",value:function(){return this.manager.clonePointerEvent(this)}}])}(Wi),Xi=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return this.manager.cloneWheelEvent(this)}}])}(Wi),zi=function(e){function t(e,n){var r;return(0,o.Z)(this,t),(r=(0,s.Z)(this,t,[null])).type=e,r.detail=null==n?void 0:n.detail,n&&!("detail"in n)&&(r.detail=n),Object.assign(r,n),r}return(0,l.Z)(t,e),(0,a.Z)(t)}(Vi),Yi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.emitter=new d.Z}),[{key:"on",value:function(e,t,n){return this.addEventListener(e,t,n),this}},{key:"addEventListener",value:function(e,t,n){var r=!1,i=!1;if((0,F.Z)(n))r=n;else if(n){var a=n.capture;r=void 0!==a&&a;var o=n.once;i=void 0!==o&&o}r&&(e+="capture"),t=(0,U.Z)(t)?t:t.handleEvent;var s=(0,U.Z)(t)?void 0:t;return i?this.emitter.once(e,t,s):this.emitter.on(e,t,s),this}},{key:"off",value:function(e,t,n){return e?this.removeEventListener(e,t,n):this.removeAllEventListeners(),this}},{key:"removeAllEventListeners",value:function(){var e;null===(e=this.emitter)||void 0===e||e.removeAllListeners()}},{key:"removeEventListener",value:function(e,t,n){var r;if(!this.emitter)return this;((0,F.Z)(n)?n:null==n?void 0:n.capture)&&(e+="capture"),t=(0,U.Z)(t)?t:null===(r=t)||void 0===r?void 0:r.handleEvent;var i=(0,U.Z)(t)?void 0:t;return this.emitter.off(e,t,i),this}},{key:"emit",value:function(e,t){this.dispatchEvent(new zi(e,t))}},{key:"dispatchEventToSelf",value:function(e){e.target||(e.target=this),e.currentTarget=this,this.emitter.emit(e.type,e)}},{key:"dispatchEvent",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;if(r)return this.dispatchEventToSelf(e),!0;if(this.document)t=this;else if(this.defaultView)t=this.defaultView;else{var i;t=null===(i=this.ownerDocument)||void 0===i?void 0:i.defaultView}if(t){if(e.manager=t.getEventService(),!e.manager)return!1;e.defaultPrevented=!1,e.path?e.path.length=0:e.page=[],n||(e.target=this),e.manager.dispatchEvent(e,e.type,n)}else this.dispatchEventToSelf(e);return!e.defaultPrevented}}])}(),ji=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).shadow=!1,e.ownerDocument=null,e.isConnected=!1,e.baseURI="",e.childNodes=[],e.nodeType=0,e.nodeName="",e.nodeValue=null,e.mutations=void 0,e.parentNode=null,e.destroyed=!1,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"textContent",get:function(){var e="";this.nodeName===he.TEXT&&(e+=this.style.text);var t,n=(0,ue.Z)(this.childNodes);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.nodeName===he.TEXT?e+=r.nodeValue:e+=r.textContent}}catch(e){n.e(e)}finally{n.f()}return e},set:function(e){var t=this;this.childNodes.slice().forEach((function(e){t.removeChild(e)})),this.nodeName===he.TEXT&&(this.style.text="".concat(e))}},{key:"getRootNode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.parentNode?this.parentNode.getRootNode(e):e.composed&&this.host?this.host.getRootNode(e):this}},{key:"hasChildNodes",value:function(){return this.childNodes.length>0}},{key:"isDefaultNamespace",value:function(e){throw new Error(ke)}},{key:"lookupNamespaceURI",value:function(e){throw new Error(ke)}},{key:"lookupPrefix",value:function(e){throw new Error(ke)}},{key:"normalize",value:function(){throw new Error(ke)}},{key:"isEqualNode",value:function(e){return this===e}},{key:"isSameNode",value:function(e){return this.isEqualNode(e)}},{key:"parent",get:function(){return this.parentNode}},{key:"parentElement",get:function(){return null}},{key:"nextSibling",get:function(){return null}},{key:"previousSibling",get:function(){return null}},{key:"firstChild",get:function(){return this.childNodes.length>0?this.childNodes[0]:null}},{key:"lastChild",get:function(){return this.childNodes.length>0?this.childNodes[this.childNodes.length-1]:null}},{key:"compareDocumentPosition",value:function(e){if(e===this)return 0;for(var n=e,r=this,i=[n],a=[r];null!==(o=n.parentNode)&&void 0!==o?o:r.parentNode;){var o;n=n.parentNode?(i.push(n.parentNode),n.parentNode):n,r=r.parentNode?(a.push(r.parentNode),r.parentNode):r}if(n!==r)return t.DOCUMENT_POSITION_DISCONNECTED|t.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC|t.DOCUMENT_POSITION_PRECEDING;var s=i.length>a.length?i:a,l=s===i?a:i;if(s[s.length-l.length]===l[0])return s===i?t.DOCUMENT_POSITION_CONTAINED_BY|t.DOCUMENT_POSITION_FOLLOWING:t.DOCUMENT_POSITION_CONTAINS|t.DOCUMENT_POSITION_PRECEDING;for(var u=s.length-l.length,c=l.length-1;c>=0;c--){var h=l[c],d=s[u+c];if(d!==h){var f=h.parentNode.childNodes;return f.indexOf(h)<f.indexOf(d)?l===i?t.DOCUMENT_POSITION_PRECEDING:t.DOCUMENT_POSITION_FOLLOWING:s===i?t.DOCUMENT_POSITION_PRECEDING:t.DOCUMENT_POSITION_FOLLOWING}}return t.DOCUMENT_POSITION_FOLLOWING}},{key:"contain",value:function(e){return this.contains(e)}},{key:"contains",value:function(e){for(var t=e;t&&this!==t;)t=t.parentNode;return!!t}},{key:"getAncestor",value:function(e){for(var t=this;e>0&&t;)t=t.parentNode,e--;return t}},{key:"forEach",value:function(e){for(var t=[this];t.length>0;){var n=t.pop();if(!1===e(n))break;for(var r=n.childNodes.length-1;r>=0;r--)t.push(n.childNodes[r])}}}],[{key:"isNode",value:function(e){return!!e.childNodes}}])}(Yi);ji.DOCUMENT_POSITION_DISCONNECTED=1,ji.DOCUMENT_POSITION_PRECEDING=2,ji.DOCUMENT_POSITION_FOLLOWING=4,ji.DOCUMENT_POSITION_CONTAINS=8,ji.DOCUMENT_POSITION_CONTAINED_BY=16,ji.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC=32;var Ki=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"getOrCreateCanvas",value:function(e,t){if(this.canvas)return this.canvas;if(e||Ca.offscreenCanvas)this.canvas=e||Ca.offscreenCanvas,this.context=this.canvas.getContext("2d",(0,u.Z)({willReadFrequently:!0},t));else try{this.canvas=new window.OffscreenCanvas(0,0),this.context=this.canvas.getContext("2d",(0,u.Z)({willReadFrequently:!0},t)),this.context&&this.context.measureText||(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"))}catch(e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d",(0,u.Z)({willReadFrequently:!0},t))}return this.canvas.width=10,this.canvas.height=10,this.canvas}},{key:"getOrCreateContext",value:function(e,t){return this.context||this.getOrCreateCanvas(e,t),this.context}}],[{key:"createCanvas",value:function(){try{return new window.OffscreenCanvas(0,0)}catch(e){}try{return document.createElement("canvas")}catch(e){}return null}}])}(),qi=function(e){return e[e.CAMERA_CHANGED=0]="CAMERA_CHANGED",e[e.DISPLAY_OBJECT_CHANGED=1]="DISPLAY_OBJECT_CHANGED",e[e.NONE=2]="NONE",e}({}),$i=/\[\s*(.*)=(.*)\s*\]/,Qi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"selectOne",value:function(e,t){var n=this;if(e.startsWith("."))return t.find((function(t){return((null==t?void 0:t.classList)||[]).indexOf(n.getIdOrClassname(e))>-1}));if(e.startsWith("#"))return t.find((function(t){return t.id===n.getIdOrClassname(e)}));if(e.startsWith("[")){var r=this.getAttribute(e),i=r.name,a=r.value;return i?t.find((function(e){return t!==e&&("name"===i?e.name===a:n.attributeToString(e,i)===a)})):null}return t.find((function(n){return t!==n&&n.nodeName===e}))}},{key:"selectAll",value:function(e,t){var n=this;if(e.startsWith("."))return t.findAll((function(r){return t!==r&&((null==r?void 0:r.classList)||[]).indexOf(n.getIdOrClassname(e))>-1}));if(e.startsWith("#"))return t.findAll((function(r){return t!==r&&r.id===n.getIdOrClassname(e)}));if(e.startsWith("[")){var r=this.getAttribute(e),i=r.name,a=r.value;return i?t.findAll((function(e){return t!==e&&("name"===i?e.name===a:n.attributeToString(e,i)===a)})):[]}return t.findAll((function(n){return t!==n&&n.nodeName===e}))}},{key:"is",value:function(e,t){if(e.startsWith("."))return t.className===this.getIdOrClassname(e);if(e.startsWith("#"))return t.id===this.getIdOrClassname(e);if(e.startsWith("[")){var n=this.getAttribute(e),r=n.name,i=n.value;return"name"===r?t.name===i:this.attributeToString(t,r)===i}return t.nodeName===e}},{key:"getIdOrClassname",value:function(e){return e.substring(1)}},{key:"getAttribute",value:function(e){var t=e.match($i),n="",r="";return t&&t.length>2&&(n=t[1].replace(/"/g,""),r=t[2].replace(/"/g,"")),{name:n,value:r}}},{key:"attributeToString",value:function(e,t){if(!e.getAttribute)return"";var n=e.getAttribute(t);return(0,T.Z)(n)?"":n.toString?n.toString():""}}])}(),Ji=function(e){return e.ATTR_MODIFIED="DOMAttrModified",e.INSERTED="DOMNodeInserted",e.MOUNTED="DOMNodeInsertedIntoDocument",e.REMOVED="removed",e.UNMOUNTED="DOMNodeRemovedFromDocument",e.REPARENT="reparent",e.DESTROY="destroy",e.BOUNDS_CHANGED="bounds-changed",e.CULLED="culled",e}({}),ea=function(e){function t(e,n,r,i,a,l,u,c){var h;return(0,o.Z)(this,t),(h=(0,s.Z)(this,t,[null])).relatedNode=n,h.prevValue=r,h.newValue=i,h.attrName=a,h.attrChange=l,h.prevParsedValue=u,h.newParsedValue=c,h.type=e,h}return(0,l.Z)(t,e),(0,a.Z)(t)}(Vi);ea.ADDITION=2,ea.MODIFICATION=1,ea.REMOVAL=3;var ta,na,ra,ia=new ea(Ji.REPARENT,null,"","","",0,"",""),aa=y.create(),oa=f.create(),sa=f.fromValues(1,1,1),la=p.create(),ua=y.create(),ca=f.create(),ha=p.create(),da=m.create(),fa=f.create(),va=m.create(),pa=f.create(),ga=f.create(),ma=f.create(),ya=p.create(),Ea=m.create(),_a=m.create(),Ta=m.create(),Sa=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.displayObjectDependencyMap=new WeakMap,this.runtime=t}),[{key:"matches",value:function(e,t){return this.runtime.sceneGraphSelector.is(e,t)}},{key:"querySelector",value:function(e,t){return this.runtime.sceneGraphSelector.selectOne(e,t)}},{key:"querySelectorAll",value:function(e,t){return this.runtime.sceneGraphSelector.selectAll(e,t)}},{key:"attach",value:function(e,t,n){var r,i=!1;e.parentNode&&(i=e.parentNode!==t,this.detach(e));var a=e.nodeName===he.FRAGMENT,o=ai(t);e.parentNode=t;var s=a?e.childNodes:[e];(0,E.Z)(n)?s.forEach((function(e){t.childNodes.splice(n,0,e),e.parentNode=t})):s.forEach((function(e){t.childNodes.push(e),e.parentNode=t}));var l=t.sortable;if((null!=l&&null!==(r=l.sorted)&&void 0!==r&&r.length||l.dirty||e.parsedStyle.zIndex)&&(-1===l.dirtyChildren.indexOf(e)&&l.dirtyChildren.push(e),l.dirty=!0,l.dirtyReason=qe.ADDED),!o){if(a)this.dirtyFragment(e);else{var u=e.transformable;u&&this.dirtyWorldTransform(e,u)}if(i){var c,h=!0===(null===(c=t.ownerDocument)||void 0===c||null===(c=c.defaultView)||void 0===c||null===(c=c.getConfig())||void 0===c||null===(c=c.future)||void 0===c?void 0:c.experimentalCancelEventPropagation);e.dispatchEvent(ia,h,h)}}}},{key:"detach",value:function(e){var t,n;if(e.parentNode){var r=e.transformable,i=e.parentNode.sortable;(null!=i&&null!==(t=i.sorted)&&void 0!==t&&t.length||null!==(n=e.style)&&void 0!==n&&n.zIndex)&&(-1===i.dirtyChildren.indexOf(e)&&i.dirtyChildren.push(e),i.dirty=!0,i.dirtyReason=qe.REMOVED);var a=e.parentNode.childNodes.indexOf(e);a>-1&&e.parentNode.childNodes.splice(a,1),r&&this.dirtyWorldTransform(e,r),e.parentNode=null}}},{key:"getLocalPosition",value:function(e){return e.transformable.localPosition}},{key:"getLocalRotation",value:function(e){return e.transformable.localRotation}},{key:"getLocalScale",value:function(e){return e.transformable.localScale}},{key:"getLocalSkew",value:function(e){return e.transformable.localSkew}},{key:"getLocalTransform",value:function(e){var t=e.transformable;return et(t),t.localTransform}},{key:"setLocalPosition",value:function(e,t){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.transformable;ga[0]=t[0],ga[1]=t[1],ga[2]=null!==(n=t[2])&&void 0!==n?n:0,f.equals(i.localPosition,ga)||(f.copy(i.localPosition,ga),r&&this.dirtyLocalTransform(e,i))}},{key:"translateLocal",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;f.equals(t,oa)||(f.transformQuat(t,t,i.localRotation),f.add(i.localPosition,i.localPosition,t),this.dirtyLocalTransform(e,i))}},{key:"setLocalRotation",value:function(e,t,n,r,i){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];"number"==typeof t&&(t=m.set(da,t,n,r,i));var o=e.transformable;m.copy(o.localRotation,t),a&&this.dirtyLocalTransform(e,o)}},{key:"rotateLocal",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;m.fromEuler(_a,t[0],t[1],t[2]),m.mul(i.localRotation,i.localRotation,_a),this.dirtyLocalTransform(e,i)}},{key:"setLocalScale",value:function(e,t){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.transformable;f.set(ca,t[0],t[1],null!==(n=t[2])&&void 0!==n?n:i.localScale[2]),f.equals(ca,i.localScale)||(f.copy(i.localScale,ca),r&&this.dirtyLocalTransform(e,i))}},{key:"scaleLocal",value:function(e,t){var n,r=e.transformable;f.multiply(r.localScale,r.localScale,f.set(ca,t[0],t[1],null!==(n=t[2])&&void 0!==n?n:1)),this.dirtyLocalTransform(e,r)}},{key:"setLocalSkew",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];"number"==typeof t&&(t=y.set(ua,t,n));var i=e.transformable;y.copy(i.localSkew,t),r&&this.dirtyLocalTransform(e,i)}},{key:"setLocalEulerAngles",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];"number"==typeof t&&(t=f.fromValues(t,n,r));var a=e.transformable;m.fromEuler(a.localRotation,t[0],t[1],t[2]),i&&this.dirtyLocalTransform(e,a)}},{key:"setLocalTransform",value:function(e,t){var n=p.getTranslation(fa,t),r=p.getRotation(va,t),i=p.getScaling(pa,t);this.setLocalScale(e,i,!1),this.setLocalPosition(e,n,!1),this.setLocalRotation(e,r,void 0,void 0,void 0,!1),this.dirtyLocalTransform(e,e.transformable)}},{key:"resetLocalTransform",value:function(e){this.setLocalScale(e,sa,!1),this.setLocalPosition(e,oa,!1),this.setLocalEulerAngles(e,oa,void 0,void 0,!1),this.setLocalSkew(e,aa,void 0,!1),this.dirtyLocalTransform(e,e.transformable)}},{key:"getPosition",value:function(e){var t=e.transformable;return p.getTranslation(t.position,this.getWorldTransform(e,t))}},{key:"getRotation",value:function(e){var t=e.transformable;return p.getRotation(t.rotation,this.getWorldTransform(e,t))}},{key:"getScale",value:function(e){var t=e.transformable;return p.getScaling(t.scaling,this.getWorldTransform(e,t))}},{key:"getOrigin",value:function(e){return e.getGeometryBounds(),e.transformable.origin}},{key:"getWorldTransform",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transformable;return t.localDirtyFlag||t.dirtyFlag?(e.parentNode&&e.parentNode.transformable&&this.getWorldTransform(e.parentNode),this.internalUpdateTransform(e),t.worldTransform):t.worldTransform}},{key:"setPosition",value:function(e,t){var n,r=e.transformable;if(ma[0]=t[0],ma[1]=t[1],ma[2]=null!==(n=t[2])&&void 0!==n?n:0,!f.equals(this.getPosition(e),ma)){if(f.copy(r.position,ma),null!==e.parentNode&&e.parentNode.transformable){var i=e.parentNode.transformable;p.copy(ya,i.worldTransform),p.invert(ya,ya),f.transformMat4(r.localPosition,ma,ya)}else f.copy(r.localPosition,ma);this.dirtyLocalTransform(e,r)}}},{key:"translate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.set(ca,t,n,r)),f.equals(t,oa)||(f.add(ca,this.getPosition(e),t),this.setPosition(e,ca))}},{key:"setRotation",value:function(e,t,n,r,i){var a=e.transformable;if("number"==typeof t&&(t=m.fromValues(t,n,r,i)),null!==e.parentNode&&e.parentNode.transformable){var o=this.getRotation(e.parentNode);m.copy(da,o),m.invert(da,da),m.multiply(a.localRotation,da,t),m.normalize(a.localRotation,a.localRotation),this.dirtyLocalTransform(e,a)}else this.setLocalRotation(e,t)}},{key:"rotate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;if(null!==e.parentNode&&e.parentNode.transformable){var a=da;m.fromEuler(a,t[0],t[1],t[2]);var o=this.getRotation(e),s=this.getRotation(e.parentNode);m.copy(Ta,s),m.invert(Ta,Ta),m.multiply(a,Ta,a),m.multiply(i.localRotation,a,o),m.normalize(i.localRotation,i.localRotation),this.dirtyLocalTransform(e,i)}else this.rotateLocal(e,t)}},{key:"setOrigin",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=[t,n,r]);var i=e.transformable;if(t[0]!==i.origin[0]||t[1]!==i.origin[1]||t[2]!==i.origin[2]){var a=i.origin;a[0]=t[0],a[1]=t[1],a[2]=t[2]||0,this.dirtyLocalTransform(e,i)}}},{key:"setEulerAngles",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;if(null!==e.parentNode&&e.parentNode.transformable){m.fromEuler(i.localRotation,t[0],t[1],t[2]);var a=this.getRotation(e.parentNode);m.copy(Ea,m.invert(da,a)),m.mul(i.localRotation,i.localRotation,Ea),this.dirtyLocalTransform(e,i)}else this.setLocalEulerAngles(e,t)}},{key:"getGeometryBounds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e,r=n.geometry;r.dirty&&Ca.styleValueRegistry.updateGeometry(e);var i=t?r.renderBounds:r.contentBounds||null;return i||new Te}},{key:"getTransformedGeometryBounds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.getGeometryBounds(e,t);if(!Te.isEmpty(r)){var i=n||new Te;return i.setFromTransformedAABB(r,this.getWorldTransform(e)),i}return null}},{key:"getBounds",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e,i=r.renderable;if(!i.boundsDirty&&!n&&i.bounds)return i.bounds;if(!i.renderBoundsDirty&&n&&i.renderBounds)return i.renderBounds;var a=n?i.renderBounds:i.bounds,o=this.getTransformedGeometryBounds(e,n,a),s=e.childNodes;if(s.forEach((function(e){var r=t.getBounds(e,n);r&&(o?o.add(r):(o=a||new Te).update(r.center,r.halfExtents))})),o||(o=new Te),n){var l=ni(e);if(l){var u=l.parsedStyle.clipPath.getBounds(n);o?u&&(o=u.intersection(o)):o.update(u.center,u.halfExtents)}}return n?(i.renderBounds=o,i.renderBoundsDirty=!1):(i.bounds=o,i.boundsDirty=!1),o}},{key:"getLocalBounds",value:function(e){if(e.parentNode){var t=la;e.parentNode.transformable&&(t=p.invert(ha,this.getWorldTransform(e.parentNode)));var n=this.getBounds(e);if(!Te.isEmpty(n)){var r=new Te;return r.setFromTransformedAABB(n,t),r}}return this.getBounds(e)}},{key:"getBoundingClientRect",value:function(e){var t,n,r=this.getGeometryBounds(e);Te.isEmpty(r)||(n=new Te).setFromTransformedAABB(r,this.getWorldTransform(e));var i=null===(t=e.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t?void 0:t.getContextService().getBoundingClientRect();if(n){var a=n.getMin(),o=(0,h.Z)(a,2),s=o[0],l=o[1],u=n.getMax(),c=(0,h.Z)(u,2),d=c[0],f=c[1];return new xe(s+((null==i?void 0:i.left)||0),l+((null==i?void 0:i.top)||0),d-s,f-l)}return new xe((null==i?void 0:i.left)||0,(null==i?void 0:i.top)||0,0,0)}},{key:"internalUpdateTransform",value:function(e){var t,n=null===(t=e.parentNode)||void 0===t?void 0:t.transformable;et(e.transformable),function(e,t){e.dirtyFlag&&(t?p.multiply(e.worldTransform,t.worldTransform,e.localTransform):p.copy(e.worldTransform,e.localTransform),e.dirtyFlag=!1)}(e.transformable,n)}},{key:"internalUpdateElement",value:function(e,t){var n,r,i,a,o,s,l=!0===(null===(n=e.ownerDocument)||void 0===n||null===(n=n.defaultView)||void 0===n||null===(n=n.getConfig())||void 0===n||null===(n=n.future)||void 0===n?void 0:n.experimentalAttributeUpdateOptimization),u=t[t.length-1],c=(null==u?void 0:u.transformDirty)||(null===(r=e.transformable)||void 0===r?void 0:r.localDirtyFlag);e.transformable&&((o=e.transformable).dirtyFlag||(o.dirtyFlag=c));(this.internalUpdateTransform(e),c)&&(null===(s=e.dirty)||void 0===s||s.call(e,!0,!0));var h=(null===(i=e.renderable)||void 0===i?void 0:i.boundsDirty)||(null===(a=e.renderable)||void 0===a?void 0:a.renderBoundsDirty);if((c||h)&&!1===(null==u?void 0:u.shapeUpdated)&&l)for(var d=t.length-1;d>=0;){var f,v,p=t[d];if(p.shapeUpdated)break;null===(f=(v=p.node).dirty)||void 0===f||f.call(v,!0,!0),p.shapeUpdated=!0,d-=1}return c}},{key:"syncHierarchy",value:function(e){for(var t,n,r=[e],i=e.parentNode?[{node:e.parentNode,transformDirty:(null===(t=e.parentNode.transformable)||void 0===t?void 0:t.localDirtyFlag)||(null===(n=e.parentNode.transformable)||void 0===n?void 0:n.dirtyFlag),shapeUpdated:!1}]:[];r.length>0;){for(var a=r.pop(),o=i[i.length-1];i.length>0&&a.parentNode!==o.node;)o=i.pop();var s=this.internalUpdateElement(a,i);if(a.childNodes.length>0){for(var l=a.childNodes.length-1;l>=0;l--)r.push(a.childNodes[l]);i.push({node:a,transformDirty:s,shapeUpdated:!1})}}}},{key:"dirtyLocalTransform",value:function(e,t){ai(e)||t.localDirtyFlag||(t.localDirtyFlag=!0,t.dirtyFlag||this.dirtyWorldTransform(e,t))}},{key:"dirtyWorldTransform",value:function(e,t){this.dirtyWorldInternal(e,t),this.dirtyToRoot(e,!0)}},{key:"dirtyWorldInternal",value:function(e,t){var n,r=this,i=!0===(null===(n=e.ownerDocument)||void 0===n||null===(n=n.defaultView)||void 0===n||null===(n=n.getConfig())||void 0===n||null===(n=n.future)||void 0===n?void 0:n.experimentalAttributeUpdateOptimization);t.dirtyFlag||(t.dirtyFlag=!0,e.dirty(!0,!0),i||e.childNodes.forEach((function(e){var t=e.transformable;r.dirtyWorldInternal(e,t)})))}},{key:"dirtyToRoot",value:function(e){for(var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e,i=!0===(null===(t=e.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t||null===(t=t.getConfig())||void 0===t||null===(t=t.future)||void 0===t?void 0:t.experimentalAttributeUpdateOptimization);r;){var a,o;if(null===(a=(o=r).dirty)||void 0===a||a.call(o,!0,!0),i)break;r=r.parentNode}n&&e.forEach((function(e){var t;null===(t=e.dirty)||void 0===t||t.call(e,!0,!0)})),this.informDependentDisplayObjects(e);var s=e.mutations||[],l=s.find((function(e){return"attributes"===e.type&&e._boundsChangeData}));l?l._boundsChangeData={affectChildren:l._boundsChangeData.affectChildren||n}:(l={type:"attributes",target:e,_boundsChangeData:{affectChildren:n}},s.push(l)),e.mutations=s}},{key:"dirtyFragment",value:function(e){var t,n,r=e.transformable;r&&(r.dirtyFlag=!0,r.localDirtyFlag=!0),null===(t=(n=e).dirty)||void 0===t||t.call(n,!0,!0);for(var i=e.childNodes.length,a=0;a<i;a++)this.dirtyFragment(e.childNodes[a])}},{key:"notifyMutationObservers",value:function(e){var t=new Set;if(e.getRoot().forEach((function(e){(e.mutations||[]).forEach((function(n){"attributes"===n.type&&n._boundsChangeData&&(n._boundsChangeData.affectChildren?e.forEach((function(e){var r=(0,u.Z)({},n);r.target=e,t.add(r)})):t.add(n))})),e.mutations=void 0})),t.size>0){var n=new zi(Ji.BOUNDS_CHANGED,{detail:Array.from(t)});e.dispatchEvent(n,!0,!0)}}},{key:"updateDisplayObjectDependency",value:function(e,t,n,r){if(t&&t!==n){var i=this.displayObjectDependencyMap.get(t);if(i&&i[e]){var a=i[e].indexOf(r);i[e].splice(a,1)}}if(n){var o=this.displayObjectDependencyMap.get(n);o||(this.displayObjectDependencyMap.set(n,{}),o=this.displayObjectDependencyMap.get(n)),o[e]||(o[e]=[]),o[e].push(r)}}},{key:"informDependentDisplayObjects",value:function(e){var t,n=this,r=this.displayObjectDependencyMap.get(e);if(r){var i=null===(t=e.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t||null===(t=t.getConfig())||void 0===t||null===(t=t.future)||void 0===t?void 0:t.experimentalCancelEventPropagation;Object.keys(r).forEach((function(e){r[e].forEach((function(t){n.dirtyToRoot(t,!0),t.dispatchEvent(new ea(Ji.ATTR_MODIFIED,t,n,n,e,ea.MODIFICATION,n,n),i,i),t.isCustomElement&&t.isConnected&&t.attributeChangedCallback&&t.attributeChangedCallback(e,n,n)}))}))}}}])}(),Ra=function(){return(0,a.Z)((function e(t){if((0,o.Z)(this,e),t<=0)throw new Error("LRU capacity must be a positive number.");this.capacity=t,this.cache=new Map}),[{key:"get",value:function(e){if(this.cache.has(e)){var t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),t}}},{key:"put",value:function(e,t){if(this.cache.has(e)&&this.cache.delete(e),this.cache.set(e,t),this.cache.size>this.capacity){var n=this.cache.keys().next().value;this.cache.delete(n)}}},{key:"len",value:function(){return this.cache.size}},{key:"clear",value:function(){this.cache.clear()}}])}(),Aa={MetricsString:"|q",BaselineSymbol:"M",BaselineMultiplier:1.4,HeightMultiplier:2,Newlines:[10,13],BreakingSpaces:[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288]},xa=/[a-zA-Z0-9\u00C0-\u00D6\u00D8-\u00f6\u00f8-\u00ff!"#$%&'()*+,-./:;]/,ka=new RegExp("".concat(/[!%),.:;?\]}'""]/.source,"|").concat(/[!),.:;?\]}'""]/.source,"|").concat(/[)\]'"?!:;,.]/.source,"|").concat(/[!%),.:;?\]}'"]/.source)),Na=new RegExp("".concat(/[$('"]/.source,"|").concat(/[([{'"]/.source,"|").concat(/[(['"...]/.source,"|").concat(/[$([{'"#]/.source)),Ma=function(){return(0,a.Z)((function e(t){var n=this;(0,o.Z)(this,e),this.fontMetricsCache={},this.shouldBreakByKinsokuShorui=function(e,t){return!n.isBreakingSpace(t)&&!(!e||!Na.exec(t)&&!ka.exec(e))},this.trimByKinsokuShorui=function(e){var t=(0,c.Z)(e),n=t[t.length-2];if(!n)return e;var r=n[n.length-1];return t[t.length-2]=n.slice(0,-1),t[t.length-1]=r+t[t.length-1],t},this.runtime=t,this.charWidthCache=new Ra(100)}),[{key:"measureFont",value:function(e,t){if(this.fontMetricsCache[e])return this.fontMetricsCache[e];var n={ascent:0,descent:0,fontSize:0},r=this.runtime.offscreenCanvasCreator.getOrCreateCanvas(t),i=this.runtime.offscreenCanvasCreator.getOrCreateContext(t,{willReadFrequently:!0});i.font=e;var a=Aa.MetricsString+Aa.BaselineSymbol,o=Math.ceil(i.measureText(a).width),s=Math.ceil(i.measureText(Aa.BaselineSymbol).width),l=Aa.HeightMultiplier*s;s=s*Aa.BaselineMultiplier|0,r.width=o,r.height=l,i.fillStyle="#f00",i.fillRect(0,0,o,l),i.font=e,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(a,0,s);var u=i.getImageData(0,0,o||1,l||1).data,c=u.length,h=4*o,d=0,f=0,v=!1;for(d=0;d<s;++d){for(var p=0;p<h;p+=4)if(255!==u[f+p]){v=!0;break}if(v)break;f+=h}for(n.ascent=s-d,f=c-h,v=!1,d=l;d>s;--d){for(var g=0;g<h;g+=4)if(255!==u[f+g]){v=!0;break}if(v)break;f-=h}return n.descent=d-s,n.fontSize=n.ascent+n.descent,this.fontMetricsCache[e]=n,n}},{key:"measureText",value:function(e,t,n){var r=t.fontSize,i=void 0===r?16:r,a=t.wordWrap,o=void 0!==a&&a,s=t.lineHeight,l=t.lineWidth,u=void 0===l?1:l,c=t.textBaseline,h=void 0===c?"alphabetic":c,d=t.textAlign,f=void 0===d?"start":d,v=t.letterSpacing,p=void 0===v?0:v,g=t.textPath;t.textPathSide,t.textPathStartOffset;var m=t.leading,y=void 0===m?0:m,E=_i(t),_=this.measureFont(E,n);0===_.fontSize&&(_.fontSize=i,_.ascent=i);var T=this.runtime.offscreenCanvasCreator.getOrCreateContext(n);T.font=E,t.isOverflowing=!1;var S=(o?this.wordWrap(e,t,n):e).split(/(?:\r\n|\r|\n)/),R=new Array(S.length),A=0;if(!g){for(var x=0;x<S.length;x++){var k=T.measureText(S[x]).width+(S[x].length-1)*p;R[x]=k,A=Math.max(A,k)}var N=A+u,M=s||_.fontSize+u,C=Math.max(M,_.fontSize+u)+(S.length-1)*(M+y),b=0;return"middle"===h?b=-C/2:"bottom"===h||"alphabetic"===h||"ideographic"===h?b=-C:"top"!==h&&"hanging"!==h||(b=0),{font:E,width:N,height:C,lines:S,lineWidths:R,lineHeight:M+=y,maxLineWidth:A,fontProperties:_,lineMetrics:R.map((function(e,t){var n=0;return"center"===f||"middle"===f?n-=e/2:"right"!==f&&"end"!==f||(n-=e),new xe(n-u/2,b+t*M,e+u,M)}))}}g.getTotalLength();for(var P=0;P<S.length;P++)T.measureText(S[P]).width,S[P].length}},{key:"wordWrap",value:function(e,t,n){var r=this,i=Array.from(e);if(0===i.length)return"";var a=this,o=t.wordWrapWidth,s=void 0===o?0:o,l=t.letterSpacing,u=void 0===l?0:l,c=t.maxLines,h=void 0===c?1/0:c,d=t.textOverflow,f=this.runtime.offscreenCanvasCreator.getOrCreateContext(n),v=s+u,p="";"ellipsis"===d?p="...":d&&"clip"!==d&&(p=d);var g=[""],m=0,y=0,E=-1,_=_i(t),T=this.charWidthCache.get(_);T||(T=new Ra(500),this.charWidthCache.put(_,T));var S=function(e){return r.getFromCache(e,u,T,f)},R=S(p);function A(e,t,n,r){for(;S(e)<r&&t<i.length-1&&!a.isNewline(i[t+1]);)e+=i[t+=1];for(;S(e)>r&&t>=n;)t-=1,e=e.slice(0,-1);return{lineTxt:e,txtLastCharIndex:t}}function x(e,t){if(!(R<=0||R>v))if(g[e]){var n=A(g[e],t,E+1,v-R);g[e]=n.lineTxt+p}else g[e]=p}for(var k=0;k<i.length;k++){var N=i[k],M=i[k-1],C=i[k+1],b=S(N);if(this.isNewline(N)){if(m+1>=h){k<i.length-1&&x(m,k-1),t.isOverflowing=!0;break}E=k-1,y=0,g[m+=1]=""}else{if(b>v){x(m,k-1),t.isOverflowing=!0;break}if(y>0&&y+b>v){var P=A(g[m],k-1,E+1,v);if(P.txtLastCharIndex!==k-1){if(g[m]=P.lineTxt,P.txtLastCharIndex===i.length-1)break;k=P.txtLastCharIndex+1,N=i[k],M=i[k-1],C=i[k+1],b=S(N)}if(m+1>=h){x(m,k-1),t.isOverflowing=!0;break}if(E=k-1,y=0,g[m+=1]="",this.isBreakingSpace(N))continue;this.canBreakInLastChar(N)||(g=this.trimToBreakable(g),y=this.sumTextWidthByCache(g[m]||"",S)),this.shouldBreakByKinsokuShorui(N,C)&&(g=this.trimByKinsokuShorui(g),y+=S(M||""))}y+=b,g[m]+=N}}return g.join("\n")}},{key:"isBreakingSpace",value:function(e){return"string"==typeof e&&Aa.BreakingSpaces.indexOf(e.charCodeAt(0))>=0}},{key:"isNewline",value:function(e){return"string"==typeof e&&Aa.Newlines.indexOf(e.charCodeAt(0))>=0}},{key:"trimToBreakable",value:function(e){var t=(0,c.Z)(e),n=t[t.length-2],r=this.findBreakableIndex(n);if(-1===r||!n)return t;var i=n.slice(r,r+1),a=r+1,o=r+(this.isBreakingSpace(i)?0:1);return t[t.length-1]+=n.slice(a,n.length),t[t.length-2]=n.slice(0,o),t}},{key:"canBreakInLastChar",value:function(e){return!e||!xa.test(e)}},{key:"sumTextWidthByCache",value:function(e,t){return e.split("").reduce((function(e,n){return e+t(n)}),0)}},{key:"findBreakableIndex",value:function(e){for(var t=e.length-1;t>=0;t--)if(!xa.test(e[t]))return t;return-1}},{key:"getFromCache",value:function(e,t,n,r){var i=n.get(e);if("number"!=typeof i){var a=e.length*t;i=r.measureText(e).width+a,n.put(e,i)}return i}},{key:"clearCache",value:function(){this.fontMetricsCache={},this.charWidthCache.clear()}}])}(),Ca={},ba=(na=new Fi,ra=new Bi,ta={},(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(ta,he.FRAGMENT,null),he.CIRCLE,new Ii),he.ELLIPSE,new wi),he.RECT,na),he.IMAGE,na),he.GROUP,new Zi),he.LINE,new Li),he.TEXT,new Ui(Ca)),he.POLYLINE,ra),he.POLYGON,ra),(0,V.Z)((0,V.Z)((0,V.Z)(ta,he.PATH,new Di),he.HTML,new Gi),he.MESH,null)),Pa=function(e){var t=new Gr,n=new Hr;return e={},(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(e,nt.PERCENTAGE,null),nt.NUMBER,new jr),nt.ANGLE,new Ur),nt.DEFINED_PATH,new Zr),nt.PAINT,t),nt.COLOR,t),nt.FILTER,new Vr),nt.LENGTH,n),nt.LENGTH_PERCENTAGE,n),nt.LENGTH_PERCENTAGE_12,new Xr),(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(e,nt.LENGTH_PERCENTAGE_14,new zr),nt.COORDINATE,new Hr),nt.OFFSET_DISTANCE,new Kr),nt.OPACITY_VALUE,new qr),nt.PATH,new $r),nt.LIST_OF_POINTS,new Qr),nt.SHADOW_BLUR,new Jr),nt.TEXT,new ei),nt.TEXT_TRANSFORM,new ti),nt.TRANSFORM,new bi),(0,V.Z)((0,V.Z)((0,V.Z)(e,nt.TRANSFORM_ORIGIN,new Pi),nt.Z_INDEX,new Oi),nt.MARKER,new Yr)}();Ca.CameraContribution=je,Ca.AnimationTimeline=null,Ca.EasingFunction=null,Ca.offscreenCanvasCreator=new Ki,Ca.sceneGraphSelector=new Qi,Ca.sceneGraphService=new Sa(Ca),Ca.textService=new Ma(Ca),Ca.geometryUpdaterFactory=ba,Ca.CSSPropertySyntaxFactory=Pa,Ca.styleValueRegistry=new Dr(Ca),Ca.layoutRegistry=null,Ca.globalThis="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},Ca.enableStyleSyntax=!0,Ca.enableSizeAttenuation=!1;var Oa=0;var Ia=new ea(Ji.INSERTED,null,"","","",0,"",""),wa=new ea(Ji.REMOVED,null,"","","",0,"",""),La=new zi(Ji.DESTROY),Da=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).entity=Oa++,e.transformable={dirtyFlag:!1,localDirtyFlag:!1,localPosition:[0,0,0],localRotation:[0,0,0,1],localScale:[1,1,1],localTransform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],localSkew:[0,0],position:[0,0,0],rotation:[0,0,0,1],scaling:[1,1,1],worldTransform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],origin:[0,0,0]},e.renderable={bounds:void 0,boundsDirty:!0,renderBounds:void 0,renderBoundsDirty:!0,dirtyRenderBounds:void 0,dirty:!1},e.geometry={contentBounds:void 0,renderBounds:void 0,dirty:!0},e.cullable={strategy:Ke.Standard,visibilityPlaneMask:-1,visible:!0,enable:!0},e.sortable={dirty:!1,sorted:void 0,renderOrder:0,dirtyChildren:[],dirtyReason:void 0},e.namespaceURI="g",e.scrollLeft=0,e.scrollTop=0,e.clientTop=0,e.clientLeft=0,e.style={},e.computedStyle={},e.parsedStyle={},e.attributes={},e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"dirty",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;this.renderable.dirty=e,void 0!==t&&(this.renderable.boundsDirty=t,this.renderable.renderBoundsDirty=t,this.geometry.dirty=t)}},{key:"className",get:function(){return this.getAttribute("class")||""},set:function(e){this.setAttribute("class",e)}},{key:"classList",get:function(){return this.className.split(" ").filter((function(e){return""!==e}))}},{key:"tagName",get:function(){return this.nodeName}},{key:"children",get:function(){return this.childNodes}},{key:"childElementCount",get:function(){return this.childNodes.length}},{key:"firstElementChild",get:function(){return this.firstChild}},{key:"lastElementChild",get:function(){return this.lastChild}},{key:"parentElement",get:function(){return this.parentNode}},{key:"nextSibling",get:function(){if(this.parentNode){var e=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[e+1]||null}return null}},{key:"previousSibling",get:function(){if(this.parentNode){var e=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[e-1]||null}return null}},{key:"cloneNode",value:function(e){throw new Error(ke)}},{key:"appendChild",value:function(e,t){var n;if(e.destroyed)throw new Error("Cannot append a destroyed element.");return Ca.sceneGraphService.attach(e,this,t),null!==(n=this.ownerDocument)&&void 0!==n&&n.defaultView&&(ai(this)||e.nodeName!==he.FRAGMENT?this.ownerDocument.defaultView.mountChildren(e):this.ownerDocument.defaultView.mountFragment(e)),this.isMutationObserved&&(Ia.relatedNode=this,e.dispatchEvent(Ia)),e}},{key:"insertBefore",value:function(e,t){if(t){e.parentElement&&e.parentElement.removeChild(e);var n=this.childNodes.indexOf(t);-1===n?this.appendChild(e):this.appendChild(e,n)}else this.appendChild(e);return e}},{key:"replaceChild",value:function(e,t){var n=this.childNodes.indexOf(t);return this.removeChild(t),this.appendChild(e,n),t}},{key:"removeChild",value:function(e){var t,n,r=!0===(null===(t=this.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t||null===(t=t.getConfig().future)||void 0===t?void 0:t.experimentalCancelEventPropagation);return wa.relatedNode=this,e.dispatchEvent(wa,r,r),null!==(n=e.ownerDocument)&&void 0!==n&&n.defaultView&&e.ownerDocument.defaultView.unmountChildren(e),Ca.sceneGraphService.detach(e),e}},{key:"removeChildren",value:function(){for(var e=this.childNodes.length-1;e>=0;e--){var t=this.childNodes[e];this.removeChild(t)}}},{key:"destroyChildren",value:function(){for(var e=this.childNodes.length-1;e>=0;e--){var t=this.childNodes[e];t.childNodes.length>0&&t.destroyChildren(),t.destroy()}}},{key:"matches",value:function(e){return Ca.sceneGraphService.matches(e,this)}},{key:"getElementById",value:function(e){return Ca.sceneGraphService.querySelector("#".concat(e),this)}},{key:"getElementsByName",value:function(e){return Ca.sceneGraphService.querySelectorAll('[name="'.concat(e,'"]'),this)}},{key:"getElementsByClassName",value:function(e){return Ca.sceneGraphService.querySelectorAll(".".concat(e),this)}},{key:"getElementsByTagName",value:function(e){return Ca.sceneGraphService.querySelectorAll(e,this)}},{key:"querySelector",value:function(e){return Ca.sceneGraphService.querySelector(e,this)}},{key:"querySelectorAll",value:function(e){return Ca.sceneGraphService.querySelectorAll(e,this)}},{key:"closest",value:function(e){var t=this;do{if(Ca.sceneGraphService.matches(e,t))return t;t=t.parentElement}while(null!==t);return null}},{key:"find",value:function(e){var t=this,n=null;return this.forEach((function(r){return r===t||!e(r)||(n=r,!1)})),n}},{key:"findAll",value:function(e){var t=this,n=[];return this.forEach((function(r){r!==t&&e(r)&&n.push(r)})),n}},{key:"after",value:function(){var e=this;if(this.parentNode){for(var t=this.parentNode.childNodes.indexOf(this),n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];r.forEach((function(n,r){var i;return null===(i=e.parentNode)||void 0===i?void 0:i.appendChild(n,t+r+1)}))}}},{key:"before",value:function(){if(this.parentNode){for(var e,t=this.parentNode.childNodes.indexOf(this),n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var a=r[0],o=(0,H.Z)(r).slice(1);this.parentNode.appendChild(a,t),(e=a).after.apply(e,(0,c.Z)(o))}}},{key:"replaceWith",value:function(){this.after.apply(this,arguments),this.remove()}},{key:"append",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t){return e.appendChild(t)}))}},{key:"prepend",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t,n){return e.appendChild(t,n)}))}},{key:"replaceChildren",value:function(){for(;this.childNodes.length&&this.firstChild;)this.removeChild(this.firstChild);this.append.apply(this,arguments)}},{key:"remove",value:function(){return this.parentNode?this.parentNode.removeChild(this):this}},{key:"destroy",value:function(){var e,t=!0===(null===(e=this.ownerDocument)||void 0===e||null===(e=e.defaultView)||void 0===e||null===(e=e.getConfig().future)||void 0===e?void 0:e.experimentalCancelEventPropagation);this.destroyChildren(),this.dispatchEvent(La,t,t),this.remove(),this.emitter.removeAllListeners(),this.destroyed=!0}},{key:"getGeometryBounds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Ca.sceneGraphService.getGeometryBounds(this,e)}},{key:"getTransformedGeometryBounds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Ca.sceneGraphService.getTransformedGeometryBounds(this,e)}},{key:"getBounds",value:function(){return Ca.sceneGraphService.getBounds(this)}},{key:"getRenderBounds",value:function(){return Ca.sceneGraphService.getBounds(this,!0)}},{key:"getLocalBounds",value:function(){return Ca.sceneGraphService.getLocalBounds(this)}},{key:"getBoundingClientRect",value:function(){return Ca.sceneGraphService.getBoundingClientRect(this)}},{key:"getClientRects",value:function(){return[this.getBoundingClientRect()]}},{key:"computedStyleMap",value:function(){return new Map(Object.entries(this.computedStyle))}},{key:"getAttributeNames",value:function(){return Object.keys(this.attributes)}},{key:"getAttribute",value:function(e){if("symbol"!==i()(e)){var t=this.attributes[e];return t}}},{key:"hasAttribute",value:function(e){return this.getAttributeNames().includes(e)}},{key:"hasAttributes",value:function(){return!!this.getAttributeNames().length}},{key:"removeAttribute",value:function(e){this.setAttribute(e,null),delete this.attributes[e]}},{key:"setAttribute",value:function(e,t){this.attributes[e]=t}},{key:"getAttributeNS",value:function(e,t){throw new Error(ke)}},{key:"getAttributeNode",value:function(e){throw new Error(ke)}},{key:"getAttributeNodeNS",value:function(e,t){throw new Error(ke)}},{key:"hasAttributeNS",value:function(e,t){throw new Error(ke)}},{key:"removeAttributeNS",value:function(e,t){throw new Error(ke)}},{key:"removeAttributeNode",value:function(e){throw new Error(ke)}},{key:"setAttributeNS",value:function(e,t,n){throw new Error(ke)}},{key:"setAttributeNode",value:function(e){throw new Error(ke)}},{key:"setAttributeNodeNS",value:function(e){throw new Error(ke)}},{key:"toggleAttribute",value:function(e,t){throw new Error(ke)}}])}(ji);function Ba(e){return!(null==e||!e.nodeName)}var Fa=Ca.globalThis.Proxy?Ca.globalThis.Proxy:function(){},Ua=new ea(Ji.ATTR_MODIFIED,null,null,null,null,ea.MODIFICATION,null,null),Za=f.create(),Ga=m.create(),Va=function(e){function t(e){var n;return(0,o.Z)(this,t),(n=(0,s.Z)(this,t)).isCustomElement=!1,n.isMutationObserved=!1,n.activeAnimations=[],n.config=e,n.id=e.id||"",n.name=e.name||"",(e.className||e.class)&&(n.className=e.className||e.class),n.nodeName=e.type||he.GROUP,e.initialParsedStyle&&Object.assign(n.parsedStyle,e.initialParsedStyle),n.initAttributes(e.style),Ca.enableStyleSyntax&&(n.style=new Fa({setProperty:function(e,t){n.setAttribute(e,t)},getPropertyValue:function(e){return n.getAttribute(e)},removeProperty:function(e){n.removeAttribute(e)},item:function(){return""}},{get:function(e,t){return void 0!==e[t]?e[t]:n.getAttribute(t)},set:function(e,t,r){return n.setAttribute(t,r),!0}})),n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"destroy",value:function(){(0,W.Z)(t,"destroy",this,3)([]),this.getAnimations().forEach((function(e){e.cancel()}))}},{key:"cloneNode",value:function(e,t){var n=(0,u.Z)({},this.attributes);for(var r in n){var i=n[r];Ba(i)&&"clipPath"!==r&&"offsetPath"!==r&&"textPath"!==r&&(n[r]=i.cloneNode(e)),t&&(n[r]=t(r,i))}var a=new this.constructor((0,u.Z)((0,u.Z)({},this.config),{},{style:n}));return a.setLocalTransform(this.getLocalTransform()),e&&this.children.forEach((function(t){if(!t.style.isMarker){var n=t.cloneNode(e);a.appendChild(n)}})),a}},{key:"initAttributes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={forceUpdateGeometry:!0};Ca.styleValueRegistry.processProperties(this,e,t),this.dirty()}},{key:"setAttribute",value:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];(0,D.Z)(n)||(r||n!==this.attributes[e])&&(this.internalSetAttribute(e,n,{memoize:i}),(0,W.Z)(t,"setAttribute",this,3)([e,n]))}},{key:"setAttributes",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.skipDispatchAttrModifiedEvent,a=void 0!==i&&i;if(a||(t=(0,u.Z)({},this.attributes),n=(0,u.Z)({},this.parsedStyle)),Ca.styleValueRegistry.processProperties(this,e,r),this.dirty(),!a)for(var o in e)this.dispatchAttrModifiedEvent(o,t[o],e[o],n[o])}},{key:"internalSetAttribute",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.attributes[e],i=this.parsedStyle[e];Ca.styleValueRegistry.processProperties(this,(0,V.Z)({},e,t),n),this.dirty(),this.dispatchAttrModifiedEvent(e,r,t,i)}},{key:"dispatchAttrModifiedEvent",value:function(e,t,n,r){var i,a=this.parsedStyle[e];if(this.isConnected)if(Ua.relatedNode=this,Ua.prevValue=t,Ua.newValue=n,Ua.attrName=e,Ua.prevParsedValue=r,Ua.newParsedValue=a,this.isMutationObserved)this.dispatchEvent(Ua);else{var o,s=!0===(null===(o=this.ownerDocument.defaultView.getConfig().future)||void 0===o?void 0:o.experimentalCancelEventPropagation);Ua.target=this,this.ownerDocument.defaultView.dispatchEvent(Ua,!0,s)}(this.isCustomElement&&this.isConnected||!this.isCustomElement)&&(null===(i=this.attributeChangedCallback)||void 0===i||i.call(this,e,t,n,r,a))}},{key:"getBBox",value:function(){var e=this.getBounds(),t=e.getMin(),n=(0,h.Z)(t,2),r=n[0],i=n[1],a=e.getMax(),o=(0,h.Z)(a,2),s=o[0],l=o[1];return new xe(r,i,s-r,l-i)}},{key:"setOrigin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Ca.sceneGraphService.setOrigin(this,Ce(e,t,n,!1)),this}},{key:"getOrigin",value:function(){return Ca.sceneGraphService.getOrigin(this)}},{key:"setPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Ca.sceneGraphService.setPosition(this,Ce(e,t,n,!1)),this}},{key:"setLocalPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Ca.sceneGraphService.setLocalPosition(this,Ce(e,t,n,!1)),this}},{key:"translate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Ca.sceneGraphService.translate(this,Ce(e,t,n,!1)),this}},{key:"translateLocal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Ca.sceneGraphService.translateLocal(this,Ce(e,t,n,!1)),this}},{key:"getPosition",value:function(){return Ca.sceneGraphService.getPosition(this)}},{key:"getLocalPosition",value:function(){return Ca.sceneGraphService.getLocalPosition(this)}},{key:"scale",value:function(e,t,n){return this.scaleLocal(e,t,n)}},{key:"scaleLocal",value:function(e,t,n){return"number"==typeof e&&(e=Ce(e,t=t||e,n=n||e,!1)),Ca.sceneGraphService.scaleLocal(this,e),this}},{key:"setLocalScale",value:function(e,t,n){return"number"==typeof e&&(e=Ce(e,t=t||e,n=n||e,!1)),Ca.sceneGraphService.setLocalScale(this,e),this}},{key:"getLocalScale",value:function(){return Ca.sceneGraphService.getLocalScale(this)}},{key:"getScale",value:function(){return Ca.sceneGraphService.getScale(this)}},{key:"getEulerAngles",value:function(){var e=Le(Za,Ca.sceneGraphService.getWorldTransform(this));return Ie((0,h.Z)(e,3)[2])}},{key:"getLocalEulerAngles",value:function(){var e=Le(Za,Ca.sceneGraphService.getLocalRotation(this));return Ie((0,h.Z)(e,3)[2])}},{key:"setEulerAngles",value:function(e){return Ca.sceneGraphService.setEulerAngles(this,0,0,e),this}},{key:"setLocalEulerAngles",value:function(e){return Ca.sceneGraphService.setLocalEulerAngles(this,0,0,e),this}},{key:"rotateLocal",value:function(e,t,n){return(0,T.Z)(t)&&(0,T.Z)(n)?Ca.sceneGraphService.rotateLocal(this,0,0,e):Ca.sceneGraphService.rotateLocal(this,e,t,n),this}},{key:"rotate",value:function(e,t,n){return(0,T.Z)(t)&&(0,T.Z)(n)?Ca.sceneGraphService.rotate(this,0,0,e):Ca.sceneGraphService.rotate(this,e,t,n),this}},{key:"setRotation",value:function(e,t,n,r){return Ca.sceneGraphService.setRotation(this,e,t,n,r),this}},{key:"setLocalRotation",value:function(e,t,n,r){return Ca.sceneGraphService.setLocalRotation(this,e,t,n,r),this}},{key:"setLocalSkew",value:function(e,t){return Ca.sceneGraphService.setLocalSkew(this,e,t),this}},{key:"getRotation",value:function(){return Ca.sceneGraphService.getRotation(this)}},{key:"getLocalRotation",value:function(){return Ca.sceneGraphService.getLocalRotation(this)}},{key:"getLocalSkew",value:function(){return Ca.sceneGraphService.getLocalSkew(this)}},{key:"getLocalTransform",value:function(){return Ca.sceneGraphService.getLocalTransform(this)}},{key:"getWorldTransform",value:function(){return Ca.sceneGraphService.getWorldTransform(this)}},{key:"setLocalTransform",value:function(e){return Ca.sceneGraphService.setLocalTransform(this,e),this}},{key:"resetLocalTransform",value:function(){Ca.sceneGraphService.resetLocalTransform(this)}},{key:"getAnimations",value:function(){return this.activeAnimations}},{key:"animate",value:function(e,t){var n,r=null===(n=this.ownerDocument)||void 0===n?void 0:n.timeline;return r?r.play(this,e,t):null}},{key:"isVisible",value:function(){var e;return"hidden"!==(null===(e=this.parsedStyle)||void 0===e?void 0:e.visibility)}},{key:"interactive",get:function(){return this.isInteractive()},set:function(e){this.style.pointerEvents=e?"auto":"none"}},{key:"isInteractive",value:function(){var e;return"none"!==(null===(e=this.parsedStyle)||void 0===e?void 0:e.pointerEvents)}},{key:"isCulled",value:function(){return!(!this.cullable||!this.cullable.enable||this.cullable.visible)}},{key:"toFront",value:function(){return this.parentNode&&(this.style.zIndex=Math.max.apply(Math,(0,c.Z)(this.parentNode.children.map((function(e){return Number(e.style.zIndex)}))))+1),this}},{key:"toBack",value:function(){return this.parentNode&&(this.style.zIndex=Math.min.apply(Math,(0,c.Z)(this.parentNode.children.map((function(e){return Number(e.style.zIndex)}))))-1),this}},{key:"getConfig",value:function(){return this.config}},{key:"attr",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n[0],a=n[1];return i?(0,Z.Z)(i)?(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),this):2===n.length?(this.setAttribute(i,a),this):this.attributes[i]:this.attributes}},{key:"getMatrix",value:function(e){var t=e||this.getWorldTransform(),n=p.getTranslation(Za,t),r=(0,h.Z)(n,2),i=r[0],a=r[1],o=p.getScaling(Za,t),s=(0,h.Z)(o,2),l=s[0],u=s[1],c=p.getRotation(Ga,t),d=Le(Za,c),f=(0,h.Z)(d,3),v=f[0],m=f[2];return function(e,t,n,r,i){var a=Math.cos(e),o=Math.sin(e);return g.fromValues(r*a,i*o,0,-r*o,i*a,0,t,n,1)}(v||m,i,a,l,u)}},{key:"getLocalMatrix",value:function(){return this.getMatrix(this.getLocalTransform())}},{key:"setMatrix",value:function(e){var t=De(e),n=(0,h.Z)(t,5),r=n[0],i=n[1],a=n[2],o=n[3],s=n[4];this.setEulerAngles(s).setPosition(r,i).setLocalScale(a,o)}},{key:"setLocalMatrix",value:function(e){var t=De(e),n=(0,h.Z)(t,5),r=n[0],i=n[1],a=n[2],o=n[3],s=n[4];this.setLocalEulerAngles(s).setLocalPosition(r,i).setLocalScale(a,o)}},{key:"show",value:function(){this.forEach((function(e){e.style.visibility="visible"}))}},{key:"hide",value:function(){this.forEach((function(e){e.style.visibility="hidden"}))}},{key:"getCount",value:function(){return this.childElementCount}},{key:"getParent",value:function(){return this.parentElement}},{key:"getChildren",value:function(){return this.children}},{key:"getFirst",value:function(){return this.firstElementChild}},{key:"getLast",value:function(){return this.lastElementChild}},{key:"getChildByIndex",value:function(e){return this.children[e]||null}},{key:"add",value:function(e,t){return this.appendChild(e,t)}},{key:"set",value:function(e,t){this.config[e]=t}},{key:"get",value:function(e){return this.config[e]}},{key:"moveTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.setPosition(e,t,n),this}},{key:"move",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.setPosition(e,t,n),this}},{key:"setZIndex",value:function(e){return this.style.zIndex=e,this}}])}(Da);Va.PARSED_STYLE_LIST=new Set(["class","className","clipPath","cursor","display","draggable","droppable","fill","fillOpacity","fillRule","filter","increasedLineWidthForHitTesting","lineCap","lineDash","lineDashOffset","lineJoin","lineWidth","miterLimit","hitArea","offsetDistance","offsetPath","offsetX","offsetY","opacity","pointerEvents","shadowColor","shadowType","shadowBlur","shadowOffsetX","shadowOffsetY","stroke","strokeOpacity","strokeWidth","strokeLinecap","strokeLineJoin","strokeDasharray","strokeDashoffset","transform","transformOrigin","textTransform","visibility","zIndex"]);var Wa=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:he.CIRCLE},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(Va);Wa.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Va.PARSED_STYLE_LIST),["cx","cy","cz","r","isBillboard","isSizeAttenuation"]));var Ha=["style"],Xa=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,ce.Z)(n,Ha);return(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({style:r},i)])).isCustomElement=!0,e}return(0,l.Z)(t,e),(0,a.Z)(t)}(Va);Xa.PARSED_STYLE_LIST=new Set(["class","className","clipPath","cursor","draggable","droppable","opacity","pointerEvents","transform","transformOrigin","zIndex","visibility"]);var za=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:he.ELLIPSE},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(Va);za.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Va.PARSED_STYLE_LIST),["cx","cy","cz","rx","ry","isBillboard","isSizeAttenuation"])),(function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,[{type:he.FRAGMENT}])}return(0,l.Z)(t,e),(0,a.Z)(t)}(Va)).PARSED_STYLE_LIST=new Set(["class","className"]);var Ya=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:he.GROUP},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(Va);Ya.PARSED_STYLE_LIST=new Set(["class","className","clipPath","cursor","draggable","droppable","opacity","pointerEvents","transform","transformOrigin","zIndex","visibility"]);var ja=["style"],Ka=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,ce.Z)(n,ja);return(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:he.HTML,style:r},i)])).cullable.enable=!1,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getDomElement",value:function(){return this.parsedStyle.$el}},{key:"getClientRects",value:function(){return[this.getBoundingClientRect()]}},{key:"getLocalBounds",value:function(){if(this.parentNode){var e=p.invert(p.create(),this.parentNode.getWorldTransform()),t=this.getBounds();if(!Te.isEmpty(t)){var n=new Te;return n.setFromTransformedAABB(t,e),n}}return this.getBounds()}}])}(Va);Ka.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Va.PARSED_STYLE_LIST),["x","y","$el","innerHTML","width","height"]));var qa=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:he.IMAGE},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(Va);qa.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Va.PARSED_STYLE_LIST),["x","y","z","src","width","height","isBillboard","billboardRotation","isSizeAttenuation","keepAspectRatio"]));var $a=["style"],Qa=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,ce.Z)(n,$a);(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:he.LINE,style:(0,u.Z)({x1:0,y1:0,x2:0,y2:0,z1:0,z2:0},r)},i)])).markerStartAngle=0,e.markerEndAngle=0;var a=e.parsedStyle,l=a.markerStart,c=a.markerEnd;return l&&Ba(l)&&(e.markerStartAngle=l.getLocalEulerAngles(),e.appendChild(l)),c&&Ba(c)&&(e.markerEndAngle=c.getLocalEulerAngles(),e.appendChild(c)),e.transformMarker(!0),e.transformMarker(!1),e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"attributeChangedCallback",value:function(e,t,n,r,i){"x1"===e||"y1"===e||"x2"===e||"y2"===e||"markerStartOffset"===e||"markerEndOffset"===e?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===e?(r&&Ba(r)&&(this.markerStartAngle=0,r.remove()),i&&Ba(i)&&(this.markerStartAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!0))):"markerEnd"===e&&(r&&Ba(r)&&(this.markerEndAngle=0,r.remove()),i&&Ba(i)&&(this.markerEndAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!1)))}},{key:"transformMarker",value:function(e){var t=this.parsedStyle,n=t.markerStart,r=t.markerEnd,i=t.markerStartOffset,a=t.markerEndOffset,o=t.x1,s=t.x2,l=t.y1,u=t.y2,c=e?n:r;if(c&&Ba(c)){var h,d,f,v,p,g,m;e?(v=o,p=l,d=s-o,f=u-l,g=i||0,m=this.markerStartAngle):(v=s,p=u,d=o-s,f=l-u,g=a||0,m=this.markerEndAngle),h=Math.atan2(f,d),c.setLocalEulerAngles(180*h/Math.PI+m),c.setLocalPosition(v+Math.cos(h)*g,p+Math.sin(h)*g)}}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.parsedStyle,r=n.x1,i=n.y1,a=n.x2,o=n.y2,s=$(r,i,a,o,e),l=s.x,u=s.y,c=f.transformMat4(f.create(),f.fromValues(l,u,0),t?this.getWorldTransform():this.getLocalTransform());return new Ae(c[0],c[1])}},{key:"getPointAtLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getPoint(e/this.getTotalLength(),t)}},{key:"getTotalLength",value:function(){var e=this.parsedStyle;return q(e.x1,e.y1,e.x2,e.y2)}}])}(Va);Qa.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Va.PARSED_STYLE_LIST),["x1","y1","x2","y2","z1","z2","isBillboard","isSizeAttenuation","markerStart","markerEnd","markerStartOffset","markerEndOffset"]));var Ja=["style"],eo=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,ce.Z)(n,Ja);(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:he.PATH,style:r,initialParsedStyle:{miterLimit:4,d:(0,u.Z)({},tt)}},i)])).markerStartAngle=0,e.markerEndAngle=0,e.markerMidList=[];var a=e.parsedStyle,l=a.markerStart,c=a.markerEnd,h=a.markerMid;return l&&Ba(l)&&(e.markerStartAngle=l.getLocalEulerAngles(),e.appendChild(l)),h&&Ba(h)&&e.placeMarkerMid(h),c&&Ba(c)&&(e.markerEndAngle=c.getLocalEulerAngles(),e.appendChild(c)),e.transformMarker(!0),e.transformMarker(!1),e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"attributeChangedCallback",value:function(e,t,n,r,i){"d"===e?(this.transformMarker(!0),this.transformMarker(!1),this.placeMarkerMid(this.parsedStyle.markerMid)):"markerStartOffset"===e||"markerEndOffset"===e?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===e?(r&&Ba(r)&&(this.markerStartAngle=0,r.remove()),i&&Ba(i)&&(this.markerStartAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!0))):"markerEnd"===e?(r&&Ba(r)&&(this.markerEndAngle=0,r.remove()),i&&Ba(i)&&(this.markerEndAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!1))):"markerMid"===e&&this.placeMarkerMid(i)}},{key:"transformMarker",value:function(e){var t=this.parsedStyle,n=t.markerStart,r=t.markerEnd,i=t.markerStartOffset,a=t.markerEndOffset,o=e?n:r;if(o&&Ba(o)){var s,l,u,c,d,f,v;if(e){var p=this.getStartTangent(),g=(0,h.Z)(p,2),m=g[0],y=g[1];c=y[0],d=y[1],l=m[0]-y[0],u=m[1]-y[1],f=i||0,v=this.markerStartAngle}else{var E=this.getEndTangent(),_=(0,h.Z)(E,2),T=_[0],S=_[1];c=S[0],d=S[1],l=T[0]-S[0],u=T[1]-S[1],f=a||0,v=this.markerEndAngle}s=Math.atan2(u,l),o.setLocalEulerAngles(180*s/Math.PI+v),o.setLocalPosition(c+Math.cos(s)*f,d+Math.sin(s)*f)}}},{key:"placeMarkerMid",value:function(e){var t=this.parsedStyle.d.segments;if(this.markerMidList.forEach((function(e){e.remove()})),e&&Ba(e))for(var n=1;n<t.length-1;n++){var r=(0,h.Z)(t[n].currentPoint,2),i=r[0],a=r[1],o=1===n?e:e.cloneNode(!0);this.markerMidList.push(o),this.appendChild(o),o.setLocalPosition(i,a)}}},{key:"getTotalLength",value:function(){return Hn(this)}},{key:"getPointAtLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.parsedStyle.d.absolutePath,r=(0,G.r)(n,e),i=r.x,a=r.y,o=f.transformMat4(f.create(),f.fromValues(i,a,0),t?this.getWorldTransform():this.getLocalTransform());return new Ae(o[0],o[1])}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getPointAtLength(e*Hn(this),t)}},{key:"getStartTangent",value:function(){var e=this.parsedStyle.d.segments,t=[];if(e.length>1){var n=e[0].currentPoint,r=e[1].currentPoint,i=e[1].startTangent;t=[],i?(t.push([n[0]-i[0],n[1]-i[1]]),t.push([n[0],n[1]])):(t.push([r[0],r[1]]),t.push([n[0],n[1]]))}return t}},{key:"getEndTangent",value:function(){var e=this.parsedStyle.d.segments,t=e.length,n=[];if(t>1){var r=e[t-2].currentPoint,i=e[t-1].currentPoint,a=e[t-1].endTangent;n=[],a?(n.push([i[0]-a[0],i[1]-a[1]]),n.push([i[0],i[1]])):(n.push([r[0],r[1]]),n.push([i[0],i[1]]))}return n}}])}(Va);eo.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Va.PARSED_STYLE_LIST),["d","markerStart","markerMid","markerEnd","markerStartOffset","markerEndOffset","isBillboard","isSizeAttenuation"]));var to=["style"],no=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,ce.Z)(n,to);(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:he.POLYGON,style:r,initialParsedStyle:{points:{points:[],totalLength:0,segments:[]},miterLimit:4,isClosed:!0}},i)])).markerStartAngle=0,e.markerEndAngle=0,e.markerMidList=[];var a=e.parsedStyle,l=a.markerStart,c=a.markerEnd,h=a.markerMid;return l&&Ba(l)&&(e.markerStartAngle=l.getLocalEulerAngles(),e.appendChild(l)),h&&Ba(h)&&e.placeMarkerMid(h),c&&Ba(c)&&(e.markerEndAngle=c.getLocalEulerAngles(),e.appendChild(c)),e.transformMarker(!0),e.transformMarker(!1),e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"attributeChangedCallback",value:function(e,t,n,r,i){"points"===e?(this.transformMarker(!0),this.transformMarker(!1),this.placeMarkerMid(this.parsedStyle.markerMid)):"markerStartOffset"===e||"markerEndOffset"===e?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===e?(r&&Ba(r)&&(this.markerStartAngle=0,r.remove()),i&&Ba(i)&&(this.markerStartAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!0))):"markerEnd"===e?(r&&Ba(r)&&(this.markerEndAngle=0,r.remove()),i&&Ba(i)&&(this.markerEndAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!1))):"markerMid"===e&&this.placeMarkerMid(i)}},{key:"transformMarker",value:function(e){var t=this.parsedStyle,n=t.markerStart,r=t.markerEnd,i=t.markerStartOffset,a=t.markerEndOffset,o=(t.points||{}).points,s=e?n:r;if(s&&Ba(s)&&o){var l,u,c,h,d,f,v;if(h=o[0][0],d=o[0][1],e)u=o[1][0]-o[0][0],c=o[1][1]-o[0][1],f=i||0,v=this.markerStartAngle;else{var p=o.length;this.parsedStyle.isClosed?(u=o[p-1][0]-o[0][0],c=o[p-1][1]-o[0][1]):(h=o[p-1][0],d=o[p-1][1],u=o[p-2][0]-o[p-1][0],c=o[p-2][1]-o[p-1][1]),f=a||0,v=this.markerEndAngle}l=Math.atan2(c,u),s.setLocalEulerAngles(180*l/Math.PI+v),s.setLocalPosition(h+Math.cos(l)*f,d+Math.sin(l)*f)}}},{key:"placeMarkerMid",value:function(e){var t=(this.parsedStyle.points||{}).points;if(this.markerMidList.forEach((function(e){e.remove()})),this.markerMidList=[],e&&Ba(e)&&t)for(var n=1;n<(this.parsedStyle.isClosed?t.length:t.length-1);n++){var r=t[n][0],i=t[n][1],a=1===n?e:e.cloneNode(!0);this.markerMidList.push(a),this.appendChild(a),a.setLocalPosition(r,i)}}}])}(Va);no.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Va.PARSED_STYLE_LIST),["points","markerStart","markerMid","markerEnd","markerStartOffset","markerEndOffset","isClosed","isBillboard","isSizeAttenuation"]));var ro=["style"],io=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.style,r=(0,ce.Z)(e,ro);return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:he.POLYLINE,style:n,initialParsedStyle:{points:{points:[],totalLength:0,segments:[]},miterLimit:4,isClosed:!1}},r)])}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getTotalLength",value:function(){return Xn(this)}},{key:"getPointAtLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getPoint(e/this.getTotalLength(),t)}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.parsedStyle.points.points;if(0===this.parsedStyle.points.segments.length){var r,i,a=[],o=0,s=this.getTotalLength();n.forEach((function(e,t){n[t+1]&&((r=[0,0])[0]=o/s,i=q(e[0],e[1],n[t+1][0],n[t+1][1]),o+=i,r[1]=o/s,a.push(r))})),this.parsedStyle.points.segments=a}var l=0,u=0;this.parsedStyle.points.segments.forEach((function(t,n){e>=t[0]&&e<=t[1]&&(l=(e-t[0])/(t[1]-t[0]),u=n)}));var c=$(n[u][0],n[u][1],n[u+1][0],n[u+1][1],l),h=c.x,d=c.y,v=f.transformMat4(f.create(),f.fromValues(h,d,0),t?this.getWorldTransform():this.getLocalTransform());return new Ae(v[0],v[1])}},{key:"getStartTangent",value:function(){var e=this.parsedStyle.points.points,t=[];return t.push([e[1][0],e[1][1]]),t.push([e[0][0],e[0][1]]),t}},{key:"getEndTangent",value:function(){var e=this.parsedStyle.points.points,t=e.length-1,n=[];return n.push([e[t-1][0],e[t-1][1]]),n.push([e[t][0],e[t][1]]),n}}])}(no);io.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(no.PARSED_STYLE_LIST),["points","markerStart","markerMid","markerEnd","markerStartOffset","markerEndOffset","isBillboard"]));var ao=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:he.RECT},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(Va);ao.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Va.PARSED_STYLE_LIST),["x","y","z","width","height","isBillboard","isSizeAttenuation","radius"]));var oo=["style"],so=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.style,r=(0,ce.Z)(e,oo);return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:he.TEXT,style:(0,u.Z)({fill:"black"},n)},r)])}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getComputedTextLength",value:function(){var e;return this.getGeometryBounds(),(null===(e=this.parsedStyle.metrics)||void 0===e?void 0:e.maxLineWidth)||0}},{key:"getLineBoundingRects",value:function(){var e;return this.getGeometryBounds(),(null===(e=this.parsedStyle.metrics)||void 0===e?void 0:e.lineMetrics)||[]}},{key:"isOverflowing",value:function(){return this.getGeometryBounds(),!!this.parsedStyle.isOverflowing}}])}(Va);so.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Va.PARSED_STYLE_LIST),["x","y","z","isBillboard","billboardRotation","isSizeAttenuation","text","textAlign","textBaseline","fontStyle","fontSize","fontFamily","fontWeight","fontVariant","lineHeight","letterSpacing","leading","wordWrap","wordWrapWidth","maxLines","textOverflow","isOverflowing","textPath","textDecorationLine","textDecorationColor","textDecorationStyle","textDecorationThickness","textPathSide","textPathStartOffset","metrics","dx","dy"]));var lo=function(){function e(t){(0,o.Z)(this,e),this.strategies=t}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=t.config,r=t.camera,i=t.renderingService,a=t.renderingContext,o=this.strategies;i.hooks.cull.tap(e.tag,(function(e){if(e){var t,i=e.cullable;if(0===o.length?i.visible=a.unculledEntities.indexOf(e.entity)>-1:i.visible=o.every((function(t){return t.isVisible(r,e)})),!e.isCulled()&&e.isVisible())return e;var s=!0===(null===(t=n.future)||void 0===t?void 0:t.experimentalCancelEventPropagation);return e.dispatchEvent(new zi(Ji.CULLED),s,s),null}return e})),i.hooks.afterRender.tap(e.tag,(function(e){e.cullable.visibilityPlaneMask=-1}))}}])}();lo.tag="Culling";var uo=function(){function e(){var t=this;(0,o.Z)(this,e),this.autoPreventDefault=!1,this.rootPointerEvent=new Hi(null),this.rootWheelEvent=new Xi(null),this.onPointerMove=function(e){var n,r=null===(n=t.context.renderingContext.root)||void 0===n||null===(n=n.ownerDocument)||void 0===n?void 0:n.defaultView;if(!r.supportsTouchEvents||"touch"!==e.pointerType){var i,a=t.normalizeToPointerEvent(e,r),o=(0,ue.Z)(a);try{for(o.s();!(i=o.n()).done;){var s=i.value,l=t.bootstrapEvent(t.rootPointerEvent,s,r,e);t.context.eventService.mapEvent(l)}}catch(e){o.e(e)}finally{o.f()}t.setCursor(t.context.eventService.cursor)}},this.onClick=function(e){var n,r,i=null===(n=t.context.renderingContext.root)||void 0===n||null===(n=n.ownerDocument)||void 0===n?void 0:n.defaultView,a=t.normalizeToPointerEvent(e,i),o=(0,ue.Z)(a);try{for(o.s();!(r=o.n()).done;){var s=r.value,l=t.bootstrapEvent(t.rootPointerEvent,s,i,e);t.context.eventService.mapEvent(l)}}catch(e){o.e(e)}finally{o.f()}t.setCursor(t.context.eventService.cursor)}}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=this;this.context=t;var r=t.renderingService,i=this.context.renderingContext.root.ownerDocument.defaultView;this.context.eventService.setPickHandler((function(e){return n.context.renderingService.hooks.pickSync.call({position:e,picked:[],topmost:!0}).picked[0]||null})),r.hooks.pointerWheel.tap(e.tag,(function(e){var t=n.normalizeWheelEvent(e);n.context.eventService.mapEvent(t)})),r.hooks.pointerDown.tap(e.tag,(function(e){if(!i.supportsTouchEvents||"touch"!==e.pointerType){var t=n.normalizeToPointerEvent(e,i);if(n.autoPreventDefault&&t[0].isNormalized)(e.cancelable||!("cancelable"in e))&&e.preventDefault();var r,a=(0,ue.Z)(t);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=n.bootstrapEvent(n.rootPointerEvent,o,i,e);n.context.eventService.mapEvent(s)}}catch(e){a.e(e)}finally{a.f()}n.setCursor(n.context.eventService.cursor)}})),r.hooks.pointerUp.tap(e.tag,(function(e){if(!i.supportsTouchEvents||"touch"!==e.pointerType){var t,r=n.context.contextService.getDomElement(),a=n.context.eventService.isNativeEventFromCanvas(r,e)?"":"outside",o=n.normalizeToPointerEvent(e,i),s=(0,ue.Z)(o);try{for(s.s();!(t=s.n()).done;){var l=t.value,u=n.bootstrapEvent(n.rootPointerEvent,l,i,e);u.type+=a,n.context.eventService.mapEvent(u)}}catch(e){s.e(e)}finally{s.f()}n.setCursor(n.context.eventService.cursor)}})),r.hooks.pointerMove.tap(e.tag,this.onPointerMove),r.hooks.pointerOver.tap(e.tag,this.onPointerMove),r.hooks.pointerOut.tap(e.tag,this.onPointerMove),r.hooks.click.tap(e.tag,this.onClick),r.hooks.pointerCancel.tap(e.tag,(function(e){var t,r=n.normalizeToPointerEvent(e,i),a=(0,ue.Z)(r);try{for(a.s();!(t=a.n()).done;){var o=t.value,s=n.bootstrapEvent(n.rootPointerEvent,o,i,e);n.context.eventService.mapEvent(s)}}catch(e){a.e(e)}finally{a.f()}n.setCursor(n.context.eventService.cursor)}))}},{key:"bootstrapEvent",value:function(e,t,n,r){e.view=n,e.originalEvent=null,e.nativeEvent=r,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t);var i=this.context.eventService.client2Viewport({x:t.clientX,y:t.clientY}),a=i.x,o=i.y;e.viewport.x=a,e.viewport.y=o;var s=this.context.eventService.viewport2Canvas(e.viewport),l=s.x,u=s.y;return e.canvas.x=l,e.canvas.y=u,e.global.copyFrom(e.canvas),e.offset.copyFrom(e.canvas),e.isTrusted=r.isTrusted,"pointerleave"===e.type&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=ri[e.type]||e.type),e}},{key:"normalizeWheelEvent",value:function(e){var t=this.rootWheelEvent;this.transferMouseData(t,e),t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ;var n=this.context.eventService.client2Viewport({x:e.clientX,y:e.clientY}),r=n.x,i=n.y;t.viewport.x=r,t.viewport.y=i;var a=this.context.eventService.viewport2Canvas(t.viewport),o=a.x,s=a.y;return t.canvas.x=o,t.canvas.y=s,t.global.copyFrom(t.canvas),t.offset.copyFrom(t.canvas),t.nativeEvent=e,t.type=e.type,t}},{key:"transferMouseData",value:function(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=ii.now(),e.type=t.type,e.altKey=t.altKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey,e.ctrlKey=t.ctrlKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.screen.x=t.screenX,e.screen.y=t.screenY,e.relatedTarget=null}},{key:"setCursor",value:function(e){this.context.contextService.applyCursorStyle(e||this.context.config.cursor||"default")}},{key:"normalizeToPointerEvent",value:function(e,t){var n=[];if(t.isTouchEvent(e))for(var r=0;r<e.changedTouches.length;r++){var i=e.changedTouches[r];(0,D.Z)(i.button)&&(i.button=0),(0,D.Z)(i.buttons)&&(i.buttons=1),(0,D.Z)(i.isPrimary)&&(i.isPrimary=1===e.touches.length&&"touchstart"===e.type),(0,D.Z)(i.width)&&(i.width=i.radiusX||1),(0,D.Z)(i.height)&&(i.height=i.radiusY||1),(0,D.Z)(i.tiltX)&&(i.tiltX=0),(0,D.Z)(i.tiltY)&&(i.tiltY=0),(0,D.Z)(i.pointerType)&&(i.pointerType="touch"),(0,D.Z)(i.pointerId)&&(i.pointerId=i.identifier||0),(0,D.Z)(i.pressure)&&(i.pressure=i.force||.5),(0,D.Z)(i.twist)&&(i.twist=0),(0,D.Z)(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,i.type=e.type,n.push(i)}else if(t.isMouseEvent(e)){var a=e;(0,D.Z)(a.isPrimary)&&(a.isPrimary=!0),(0,D.Z)(a.width)&&(a.width=1),(0,D.Z)(a.height)&&(a.height=1),(0,D.Z)(a.tiltX)&&(a.tiltX=0),(0,D.Z)(a.tiltY)&&(a.tiltY=0),(0,D.Z)(a.pointerType)&&(a.pointerType="mouse"),(0,D.Z)(a.pointerId)&&(a.pointerId=1),(0,D.Z)(a.pressure)&&(a.pressure=.5),(0,D.Z)(a.twist)&&(a.twist=0),(0,D.Z)(a.tangentialPressure)&&(a.tangentialPressure=0),a.isNormalized=!0,n.push(a)}else n.push(e);return n}}])}();uo.tag="Event";he.CIRCLE,he.ELLIPSE,he.IMAGE,he.RECT,he.LINE,he.POLYLINE,he.POLYGON,he.TEXT,he.PATH,he.HTML;var co=function(){function e(){(0,o.Z)(this,e),this.mutationRecords=[],this.isFirstTimeRendering=!0,this.isFirstTimeRenderingFinished=!1}return(0,a.Z)(e,[{key:"apply",value:function(t){var n,r=this,i=t.renderingService,a=t.renderingContext.root.ownerDocument.defaultView,o=function(e){i.dirty()},s=function(e){var t,n=e.detail;(t=r.mutationRecords).push.apply(t,(0,c.Z)(n)),i.dirty()},l=function(e){var t=e.target;Ca.enableSizeAttenuation&&Ca.styleValueRegistry.updateSizeAttenuation(t,a.getCamera().getZoom())},u=function(e){var t=e.target;Ca.sceneGraphService.dirtyToRoot(t),i.dirty()};i.hooks.init.tap(e.tag,(function(){a.addEventListener(Ji.MOUNTED,l),a.addEventListener(Ji.UNMOUNTED,u),a.addEventListener(Ji.ATTR_MODIFIED,o),a.addEventListener(Ji.BOUNDS_CHANGED,s)})),i.hooks.destroy.tap(e.tag,(function(){a.removeEventListener(Ji.MOUNTED,l),a.removeEventListener(Ji.UNMOUNTED,u),a.removeEventListener(Ji.ATTR_MODIFIED,o),a.removeEventListener(Ji.BOUNDS_CHANGED,s),r.mutationRecords=[]}));var h=null!==(n=Ca.globalThis.requestIdleCallback)&&void 0!==n?n:pi.bind(Ca.globalThis);i.hooks.endFrame.tap(e.tag,(function(){r.isFirstTimeRendering&&(r.isFirstTimeRendering=!1,h((function(){r.isFirstTimeRenderingFinished=!0}))),r.mutationRecords=[]}))}}])}();co.tag="Prepare";var ho=function(e){return e.READY="ready",e.BEFORE_RENDER="beforerender",e.RERENDER="rerender",e.AFTER_RENDER="afterrender",e.BEFORE_DESTROY="beforedestroy",e.AFTER_DESTROY="afterdestroy",e.RESIZE="resize",e.DIRTY_RECTANGLE="dirtyrectangle",e.RENDERER_CHANGED="rendererchanged",e}({});new zi(Ji.MOUNTED),new zi(Ji.UNMOUNTED),new zi(ho.BEFORE_RENDER),new zi(ho.RERENDER),new zi(ho.AFTER_RENDER),new WeakMap;var fo=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.cacheStore=new Map}),[{key:"onRefAdded",value:function(e){}},{key:"has",value:function(e){return this.cacheStore.has(e)}},{key:"put",value:function(e,t,n){return!this.cacheStore.has(e)&&(this.cacheStore.set(e,{value:t,counter:new Set([n.entity])}),this.onRefAdded(n),!0)}},{key:"get",value:function(e,t){var n=this.cacheStore.get(e);return n?(n.counter.has(t.entity)||(n.counter.add(t.entity),this.onRefAdded(t)),n.value):null}},{key:"update",value:function(e,t,n){var r=this.cacheStore.get(e);return!!r&&(r.value=(0,u.Z)((0,u.Z)({},r.value),t),r.counter.has(n.entity)||(r.counter.add(n.entity),this.onRefAdded(n)),!0)}},{key:"release",value:function(e,t){var n=this.cacheStore.get(e);return!!n&&(n.counter.delete(t.entity),n.counter.size<=0&&this.cacheStore.delete(e),!0)}},{key:"releaseRef",value:function(e){var t=this;Array.from(this.cacheStore.keys()).forEach((function(n){t.release(n,e)}))}},{key:"getSize",value:function(){return this.cacheStore.size}},{key:"clear",value:function(){this.cacheStore.clear()}}])}(),vo=[],po=[],go=function(){function e(){(0,o.Z)(this,e)}return(0,a.Z)(e,null,[{key:"stop",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.api;e.rafId&&(t.cancelAnimationFrame(e.rafId),e.rafId=null)}},{key:"executeTask",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.api;vo.length<=0&&po.length<=0||(po.forEach((function(e){return e()})),po=vo.splice(0,e.TASK_NUM_PER_FRAME),e.rafId=t.requestAnimationFrame((function(){e.executeTask(t)})))}},{key:"sliceImage",value:function(t,n,r,i){for(var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.api,s=t.naturalWidth||t.width,l=t.naturalHeight||t.height,u=n-a,c=r-a,h=Math.ceil(s/u),d=Math.ceil(l/c),f={tileSize:[n,r],gridSize:[d,h],tiles:Array(d).fill(null).map((function(){return Array(h).fill(null)}))},v=function(e){for(var a=function(a){vo.push((function(){var h=a*u,d=e*c,v=[Math.min(n,s-h),Math.min(r,l-d)],p=v[0],g=v[1],m=o.createCanvas();m.width=n,m.height=r,m.getContext("2d").drawImage(t,h,d,p,g,0,0,p,g),f.tiles[e][a]={x:h,y:d,tileX:a,tileY:e,data:m},i()}))},d=0;d<h;d++)a(d)},p=0;p<d;p++)v(p);return e.stop(),e.executeTask(),f}}])}();go.TASK_NUM_PER_FRAME=10;var mo=new fo;mo.onRefAdded=function(e){var t=this;e.addEventListener(Ji.DESTROY,(function(){t.releaseRef(e)}),{once:!0})};var yo=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e),this.gradientCache={},this.patternCache={},this.context=t,this.runtime=n}),[{key:"getImageSync",value:function(e,t,n){var r=(0,S.Z)(e)?e:e.src;if(mo.has(r)){var i=mo.get(r,t);if(i.img.complete)return null==n||n(i),i}return this.getOrCreateImage(e,t).then((function(e){null==n||n(e)})).catch((function(e){console.error(e)})),null}},{key:"getOrCreateImage",value:function(e,t){var n=this,r=(0,S.Z)(e)?e:e.src;if(!(0,S.Z)(e)&&!mo.has(r)){var i={img:e,size:[e.naturalWidth||e.width,e.naturalHeight||e.height],tileSize:Eo(e)};mo.put(r,i,t)}if(mo.has(r)){var a=mo.get(r,t);return a.img.complete?Promise.resolve(a):new Promise((function(e,t){a.img.addEventListener("load",(function(){a.size=[a.img.naturalWidth||a.img.width,a.img.naturalHeight||a.img.height],a.tileSize=Eo(a.img),e(a)})),a.img.addEventListener("error",(function(e){t(e)}))}))}return new Promise((function(e,i){var a=n.context.config.createImage();if(a){var o={img:a,size:[0,0],tileSize:Eo(a)};mo.put(r,o,t),a.onload=function(){o.size=[a.naturalWidth||a.width,a.naturalHeight||a.height],o.tileSize=Eo(o.img),e(o)},a.onerror=function(e){i(e)},a.crossOrigin="Anonymous",a.src=r}}))}},{key:"createDownSampledImage",value:(t=(0,le.Z)((0,se.Z)().mark((function e(t,n){var r,i,a,o,s,l,c,d,f,v,p,g,m,y;return(0,se.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.getOrCreateImage(t,n);case 1:if(void 0===(r=e.sent).downSamplingRate){e.next=2;break}return e.abrupt("return",r);case 2:if(i=this.context.config.enableLargeImageOptimization,o=(a="boolean"==typeof i?{}:i).maxDownSampledImageSize,s=void 0===o?2048:o,l=a.downSamplingRateThreshold,c=void 0===l?.5:l,d=this.runtime.globalThis.createImageBitmap,f=(0,h.Z)(r.size,2),v=f[0],p=f[1],g=r.img,m=Math.min((s+s)/(v+p),Math.max(.01,Math.min(c,.5))),y=(0,u.Z)((0,u.Z)({},r),{},{downSamplingRate:m}),mo.update(r.img.src,y,n),!d){e.next=7;break}return e.prev=3,e.next=4,d(r.img,{resizeWidth:v*m,resizeHeight:p*m});case 4:g=e.sent,e.next=6;break;case 5:e.prev=5,e.catch(3),m=1;case 6:e.next=8;break;case 7:m=1;case 8:return y=(0,u.Z)((0,u.Z)({},this.getImageSync(t,n)),{},{downSampled:g,downSamplingRate:m}),mo.update(r.img.src,y,n),e.abrupt("return",y);case 9:case"end":return e.stop()}}),e,this,[[3,5]])}))),function(e,n){return t.apply(this,arguments)})},{key:"createImageTiles",value:(e=(0,le.Z)((0,se.Z)().mark((function e(t,n,r,i){var a,o,s,l,c;return(0,se.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.getOrCreateImage(t,i);case 1:return a=e.sent,o=i.ownerDocument.defaultView,s=o.requestAnimationFrame,l=o.cancelAnimationFrame,go.api={requestAnimationFrame:s,cancelAnimationFrame:l,createCanvas:function(){return Ki.createCanvas()}},c=(0,u.Z)((0,u.Z)({},a),go.sliceImage(a.img,a.tileSize[0],a.tileSize[0],r)),mo.update(a.img.src,c,i),e.abrupt("return",c);case 2:case"end":return e.stop()}}),e,this)}))),function(t,n,r,i){return e.apply(this,arguments)})},{key:"releaseImage",value:function(e,t){mo.release((0,S.Z)(e)?e:e.src,t)}},{key:"releaseImageRef",value:function(e){mo.releaseRef(e)}},{key:"getOrCreatePatternSync",value:function(e,t,n,r,i,a,o){var s=this.generatePatternKey(t);if(s&&this.patternCache[s])return this.patternCache[s];var l,u=t.image,c=t.repetition,h=t.transform,d=!1;if((0,S.Z)(u)){var f=this.getImageSync(u,e,o);l=null==f?void 0:f.img}else r?(l=r,d=!0):l=u;var v,g=l&&n.createPattern(l,c);g&&(v=h?Ci(_r(h),new Va({})):p.identity(p.create()),d&&p.scale(v,v,[1/i,1/i,1]),g.setTransform({a:v[0],b:v[1],c:v[4],d:v[5],e:v[12]+a[0],f:v[13]+a[1]}));return s&&g&&(this.patternCache[s]=g),g}},{key:"getOrCreateGradient",value:function(e,t){var n=this.generateGradientKey(e),r=e.type,i=e.steps,a=e.min,o=e.width,s=e.height,l=e.angle,u=e.cx,c=e.cy,h=e.size;if(this.gradientCache[n])return this.gradientCache[n];var d=null;if(r===Kt.LinearGradient){var f=function(e,t,n,r){var i=Pe(r.value),a=0+t/2,o=0+n/2,s=Math.abs(t*Math.cos(i))+Math.abs(n*Math.sin(i));return{x1:e[0]+a-Math.cos(i)*s/2,y1:e[1]+o-Math.sin(i)*s/2,x2:e[0]+a+Math.cos(i)*s/2,y2:e[1]+o+Math.sin(i)*s/2}}(a,o,s,l),v=f.x1,p=f.y1,g=f.x2,m=f.y2;d=t.createLinearGradient(v,p,g,m)}else if(r===Kt.RadialGradient){var y=function(e,t,n,r,i,a){var o=r.value,s=i.value;r.unit===Ft.kPercentage&&(o=r.value/100*t),i.unit===Ft.kPercentage&&(s=i.value/100*n);var l=Math.max((0,_.y)([0,0],[o,s]),(0,_.y)([0,n],[o,s]),(0,_.y)([t,n],[o,s]),(0,_.y)([t,0],[o,s]));return a&&(a instanceof Jt?l=a.value:a instanceof $t&&("closest-side"===a.value?l=Math.min(o,t-o,s,n-s):"farthest-side"===a.value?l=Math.max(o,t-o,s,n-s):"closest-corner"===a.value&&(l=Math.min((0,_.y)([0,0],[o,s]),(0,_.y)([0,n],[o,s]),(0,_.y)([t,n],[o,s]),(0,_.y)([t,0],[o,s]))))),{x:o+e[0],y:s+e[1],r:l}}(a,o,s,u,c,h),E=y.x,T=y.y,S=y.r;d=t.createRadialGradient(E,T,0,E,T,S)}return d&&(i.forEach((function(e){var t,n=e.offset,r=e.color;n.unit===Ft.kPercentage&&(null===(t=d)||void 0===t||t.addColorStop(n.value/100,r.toString()))})),this.gradientCache[n]=d),this.gradientCache[n]}},{key:"generateGradientKey",value:function(e){var t=e.type,n=e.min,r=e.width,i=e.height,a=e.steps,o=e.angle,s=e.cx,l=e.cy,u=e.size;return"gradient-".concat(t,"-").concat((null==o?void 0:o.toString())||0,"-").concat((null==s?void 0:s.toString())||0,"-").concat((null==l?void 0:l.toString())||0,"-").concat((null==u?void 0:u.toString())||0,"-").concat(n[0],"-").concat(n[1],"-").concat(r,"-").concat(i,"-").concat(a.map((function(e){var t=e.offset,n=e.color;return"".concat(t).concat(n)})).join("-"))}},{key:"generatePatternKey",value:function(e){var t=e.image,n=e.repetition;return(0,S.Z)(t)?"pattern-".concat(t,"-").concat(n):"rect"===t.nodeName?"pattern-".concat(t.entity,"-").concat(n):void 0}}]);var e,t}();function Eo(e){if(!e.complete)return[0,0];var t=e.naturalWidth||e.width,n=e.naturalHeight||e.height,r=256;return[256,512].forEach((function(e){Math.ceil(n/e)*Math.ceil(t/e)<1e3&&(r=e)})),[r,r]}yo.isSupportTile=!!Ki.createCanvas();var _o=function(){function e(){(0,o.Z)(this,e)}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=t.renderingService,r=t.renderingContext,i=t.imagePool,a=r.root.ownerDocument.defaultView,o=function(e,t,n){var r=e.parsedStyle,i=r.width,a=r.height;i&&!a?e.setAttribute("height",n/t*i):!i&&a&&e.setAttribute("width",t/n*a)},s=function(e){var t=e.target,r=t.nodeName,a=t.attributes;if(r===he.IMAGE){var s=a.src,l=a.keepAspectRatio;i.getImageSync(s,t,(function(e){var r=e.img,i=r.width,a=r.height;l&&o(t,i,a),t.dirty(),n.dirty()}))}},l=function(e){var t=e.target,r=e.attrName,a=e.prevValue,s=e.newValue;t.nodeName===he.IMAGE&&"src"===r&&(a!==s&&i.releaseImage(a,t),(0,S.Z)(s)&&i.getOrCreateImage(s,t).then((function(e){var r=e.img,i=r.width,a=r.height;t.attributes.keepAspectRatio&&o(t,i,a),t.dirty(),n.dirty()})).catch((function(){})))};n.hooks.init.tap(e.tag,(function(){a.addEventListener(Ji.MOUNTED,s),a.addEventListener(Ji.ATTR_MODIFIED,l)})),n.hooks.destroy.tap(e.tag,(function(){a.removeEventListener(Ji.MOUNTED,s),a.removeEventListener(Ji.ATTR_MODIFIED,l)}))}}])}();_o.tag="LoadImage";var To=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).name="image-loader",e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(e){this.context.imagePool=new yo(this.context,e),this.addRenderingPlugin(new _o)}},{key:"destroy",value:function(){this.removeAllRenderingPlugins()}}])}(fe),So=Object.freeze({__proto__:null,ImagePool:yo,Plugin:To}),Ro=function(){function e(){(0,o.Z)(this,e),this.displayObjectHTMLElementMap=new WeakMap}return(0,a.Z)(e,[{key:"joinTransformMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return"matrix(".concat([e[0],e[1],e[4],e[5],e[12]+t[0],e[13]+t[1]].join(","),")")}},{key:"apply",value:function(t,n){var r=this,i=t.camera,a=t.renderingContext,o=t.renderingService;this.context=t;var s=a.root.ownerDocument.defaultView,l=s.context.eventService.nativeHTMLMap,u=function(e,t){t.style.transform=r.joinTransformMatrix(e.getWorldTransform(),e.getOrigin())},c=function(e){var t=e.target;if(t.nodeName===he.HTML){r.$camera||(r.$camera=r.createCamera(i));var n=r.getOrCreateEl(t);r.$camera.appendChild(n),Object.keys(t.attributes).forEach((function(e){r.updateAttribute(e,t)})),u(t,n),l.set(n,t)}},h=function(e){var t=e.target;if(t.nodeName===he.HTML&&r.$camera){var n=r.getOrCreateEl(t);n&&(n.remove(),l.delete(n))}},d=function(e){var t=e.target;if(t.nodeName===he.HTML){var n=e.attrName;r.updateAttribute(n,t)}},f=function(e){for(var t=e.detail,n=0;n<t.length;n++){var i=t[n].target;(i.nodeName===he.FRAGMENT?i.childNodes:[i]).forEach((function(e){if(e.nodeName===he.HTML){var t=r.getOrCreateEl(e);u(e,t)}}))}},v=function(){if(r.$camera){var e=r.context.config,t=e.width,n=e.height;r.$camera.parentElement.style.width="".concat(t||0,"px"),r.$camera.parentElement.style.height="".concat(n||0,"px")}};o.hooks.init.tap(e.tag,(function(){s.addEventListener(ho.RESIZE,v),s.addEventListener(Ji.MOUNTED,c),s.addEventListener(Ji.UNMOUNTED,h),s.addEventListener(Ji.ATTR_MODIFIED,d),s.addEventListener(Ji.BOUNDS_CHANGED,f)})),o.hooks.endFrame.tap(e.tag,(function(){r.$camera&&a.renderReasons.has(qi.CAMERA_CHANGED)&&(r.$camera.style.transform=r.joinTransformMatrix(i.getOrthoMatrix()))})),o.hooks.destroy.tap(e.tag,(function(){r.$camera&&r.$camera.remove(),s.removeEventListener(ho.RESIZE,v),s.removeEventListener(Ji.MOUNTED,c),s.removeEventListener(Ji.UNMOUNTED,h),s.removeEventListener(Ji.ATTR_MODIFIED,d),s.removeEventListener(Ji.BOUNDS_CHANGED,f)}))}},{key:"createCamera",value:function(e){var t=this.context.config,n=t.document,r=t.width,i=t.height,a=this.context.contextService.getDomElement(),o=a.parentNode;if(o){var s="g-canvas-camera",l=o.querySelector("#".concat(s));if(!l){var u=(n||document).createElement("div");u.style.overflow="hidden",u.style.pointerEvents="none",u.style.position="absolute",u.style.left="0px",u.style.top="0px",u.style.width="".concat(r||0,"px"),u.style.height="".concat(i||0,"px");var c=(n||document).createElement("div");l=c,c.id=s,c.style.position="absolute",c.style.left="".concat(a.offsetLeft||0,"px"),c.style.top="".concat(a.offsetTop||0,"px"),c.style.transformOrigin="left top",c.style.transform=this.joinTransformMatrix(e.getOrthoMatrix()),c.style.pointerEvents="none",c.style.width="100%",c.style.height="100%",u.appendChild(c),o.appendChild(u)}return l}return null}},{key:"getOrCreateEl",value:function(e){var t=this.context.config.document,n=this.displayObjectHTMLElementMap.get(e);return n||(n=(t||document).createElement("div"),e.parsedStyle.$el=n,this.displayObjectHTMLElementMap.set(e,n),e.id&&(n.id=e.id),e.name&&n.setAttribute("name",e.name),e.className&&(n.className=e.className),n.style.position="absolute",n.style["will-change"]="transform",n.style.transform=this.joinTransformMatrix(e.getWorldTransform(),e.getOrigin())),n}},{key:"updateAttribute",value:function(e,t){var n=this.getOrCreateEl(t);switch(e){case"innerHTML":var r=t.parsedStyle.innerHTML;(0,S.Z)(r)?n.innerHTML=r:(n.innerHTML="",n.appendChild(r));break;case"x":n.style.left="".concat(t.parsedStyle.x,"px");break;case"y":n.style.top="".concat(t.parsedStyle.y,"px");break;case"transformOrigin":var i=t.parsedStyle.transformOrigin;n.style["transform-origin"]="".concat(i[0].buildCSSText(null,null,"")," ").concat(i[1].buildCSSText(null,null,""));break;case"width":var a=t.parsedStyle.width;n.style.width=(0,E.Z)(a)?"".concat(a,"px"):a.toString();break;case"height":var o=t.parsedStyle.height;n.style.height=(0,E.Z)(o)?"".concat(o,"px"):o.toString();break;case"zIndex":var s=t.parsedStyle.zIndex;n.style["z-index"]="".concat(s);break;case"visibility":var l=t.parsedStyle.visibility;n.style.visibility=l;break;case"pointerEvents":var u=t.parsedStyle.pointerEvents,c=void 0===u?"auto":u;n.style.pointerEvents=c;break;case"opacity":var h=t.parsedStyle.opacity;n.style.opacity="".concat(h);break;case"fill":var d=t.parsedStyle.fill,f="";Tn(d)?f=d.isNone?"transparent":t.getAttribute("fill"):Array.isArray(d)?f=t.getAttribute("fill"):_n(d),n.style.background=f;break;case"stroke":var v=t.parsedStyle.stroke,p="";Tn(v)?p=v.isNone?"transparent":t.getAttribute("stroke"):Array.isArray(v)?p=t.getAttribute("stroke"):_n(v),n.style["border-color"]=p,n.style["border-style"]="solid";break;case"lineWidth":var g=t.parsedStyle.lineWidth;n.style["border-width"]="".concat(g||0,"px");break;case"lineDash":n.style["border-style"]="dashed";break;case"filter":var m=t.style.filter;n.style.filter=m;break;default:(0,T.Z)(t.style[e])||""===t.style[e]||(n.style[e]=t.style[e])}}}])}();Ro.tag="HTMLRendering";var Ao=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).name="html-renderer",e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){this.addRenderingPlugin(new Ro)}},{key:"destroy",value:function(){this.removeAllRenderingPlugins()}}])}(fe),xo=Object.freeze({__proto__:null,Plugin:Ao}),ko=function(){function e(){(0,o.Z)(this,e)}return(0,a.Z)(e,[{key:"apply",value:function(t,n){var r=this,i=t.renderingService,a=t.renderingContext,o=t.config;this.context=t;var s=a.root.ownerDocument.defaultView,l=function(e){i.hooks.pointerMove.call(e)},u=function(e){i.hooks.pointerUp.call(e)},c=function(e){i.hooks.pointerDown.call(e)},h=function(e){i.hooks.pointerOver.call(e)},d=function(e){i.hooks.pointerOut.call(e)},f=function(e){i.hooks.pointerCancel.call(e)},v=function(e){i.hooks.pointerWheel.call(e)},p=function(e){i.hooks.click.call(e)};i.hooks.init.tap(e.tag,(function(){var e=r.context.contextService.getDomElement();n.globalThis.navigator.msPointerEnabled?(e.style.msContentZooming="none",e.style.msTouchAction="none"):s.supportsPointerEvents&&(e.style.touchAction="none"),s.supportsPointerEvents?function(e){n.globalThis.document.addEventListener("pointermove",l,!0),e.addEventListener("pointerdown",c,!0),e.addEventListener("pointerleave",d,!0),e.addEventListener("pointerover",h,!0),n.globalThis.addEventListener("pointerup",u,!0),n.globalThis.addEventListener("pointercancel",f,!0)}(e):function(e){n.globalThis.document.addEventListener("mousemove",l,!0),e.addEventListener("mousedown",c,!0),e.addEventListener("mouseout",d,!0),e.addEventListener("mouseover",h,!0),n.globalThis.addEventListener("mouseup",u,!0)}(e),s.supportsTouchEvents&&function(e){e.addEventListener("touchstart",c,!0),e.addEventListener("touchend",u,!0),e.addEventListener("touchmove",l,!0),e.addEventListener("touchcancel",f,!0)}(e),o.useNativeClickEvent&&e.addEventListener("click",p,!0),e.addEventListener("wheel",v,{passive:!0,capture:!0})})),i.hooks.destroy.tap(e.tag,(function(){var e=r.context.contextService.getDomElement();n.globalThis.navigator.msPointerEnabled?(e.style.msContentZooming="",e.style.msTouchAction=""):s.supportsPointerEvents&&(e.style.touchAction=""),s.supportsPointerEvents?function(e){n.globalThis.document.removeEventListener("pointermove",l,!0),e.removeEventListener("pointerdown",c,!0),e.removeEventListener("pointerleave",d,!0),e.removeEventListener("pointerover",h,!0),n.globalThis.removeEventListener("pointerup",u,!0),n.globalThis.removeEventListener("pointercancel",f,!0)}(e):function(e){n.globalThis.document.removeEventListener("mousemove",l,!0),e.removeEventListener("mousedown",c,!0),e.removeEventListener("mouseout",d,!0),e.removeEventListener("mouseover",h,!0),n.globalThis.removeEventListener("mouseup",u,!0)}(e),s.supportsTouchEvents&&function(e){e.removeEventListener("touchstart",c,!0),e.removeEventListener("touchend",u,!0),e.removeEventListener("touchmove",l,!0),e.removeEventListener("touchcancel",f,!0)}(e),o.useNativeClickEvent&&e.removeEventListener("click",p,!0),e.removeEventListener("wheel",v,!0)}))}}])}();ko.tag="DOMInteraction";var No=function(){function e(){(0,o.Z)(this,e)}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=t.renderingService,r=t.contextService,i=t.config,a=r.getDomElement(),o=function(e){n.hooks.pointerDown.call(e)},s=function(e){n.hooks.pointerUp.call(e)},l=function(e){n.hooks.pointerMove.call(e)},u=function(e){n.hooks.pointerOver.call(e)},c=function(e){n.hooks.pointerOut.call(e)},h=function(e){n.hooks.click.call(e)},d=function(e){n.hooks.pointerCancel.call(e)};n.hooks.init.tap(e.tag,(function(){a.addEventListener("touchstart",o,!0),a.addEventListener("touchend",s,!0),a.addEventListener("touchmove",l,!0),a.addEventListener("touchcancel",d,!0),a.addEventListener("mouseout",c,!0),a.addEventListener("mouseover",u,!0),i.useNativeClickEvent&&a.addEventListener("click",h,!0)})),n.hooks.destroy.tap(e.tag,(function(){a.removeEventListener("touchstart",o,!0),a.removeEventListener("touchend",s,!0),a.removeEventListener("touchmove",l,!0),a.removeEventListener("touchcancel",d,!0),a.removeEventListener("mouseout",c,!0),a.removeEventListener("mouseover",u,!0),i.useNativeClickEvent&&a.removeEventListener("click",h,!0)}))}}])}();No.tag="MobileInteraction";var Mo,Co,bo,Po,Oo,Io,wo,Lo,Do,Bo,Fo,Uo,Zo,Go,Vo,Wo,Ho,Xo,zo,Yo,jo,Ko,qo,$o,Qo,Jo,es,ts=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).name="mobile-interaction",e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){this.addRenderingPlugin(new No)}},{key:"destroy",value:function(){this.removeAllRenderingPlugins()}}])}(fe),ns=Object.freeze({__proto__:null,Plugin:ts}),rs=n(88164),is=n(17662),as=n.n(is),os=n(31404),ss=n.n(os),ls=n(5486),us=n.n(ls),cs=n(30702),hs=n.n(cs),ds=n(51148);function fs(e,t,n,r){return{dimension:Wo.TEXTURE_2D,format:e,width:t,height:n,depthOrArrayLayers:1,mipLevelCount:r,usage:Ho.SAMPLED}}function vs(e,t,n){return e<<16|t<<8|n}function ps(e){return e>>>8&255}function gs(e){return e>>>16&255}function ms(e){return 255&e}function ys(e){switch(e){case $o.F32:case $o.U32:case $o.S32:return 4;case $o.U16:case $o.S16:case $o.F16:return 2;case $o.U8:case $o.S8:return 1;default:throw new Error("whoops")}}function Es(e){return ys(gs(e))}function _s(e){var t=ms(e);if(t&Jo.Depth)return Yo.Depth;if(t&Jo.Normalized)return Yo.Float;var n=gs(e);if(n===$o.F16||n===$o.F32)return Yo.Float;if(n===$o.U8||n===$o.U16||n===$o.U32)return Yo.Uint;if(n===$o.S8||n===$o.S16||n===$o.S32)return Yo.Sint;throw new Error("whoops")}function Ts(e,t){if(void 0===t&&(t=""),!e)throw new Error("Assert fail: ".concat(t))}function Ss(e){if(null!=e)return e;throw new Error("Missing object")}function Rs(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}function As(e,t){e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a}function xs(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}function ks(e,t,n,r){return void 0===r&&(r=1),{r:e,g:t,b:n,a:r}}!function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"}(Mo||(Mo={})),function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.RenderPipeline=7]="RenderPipeline",e[e.ComputePipeline=8]="ComputePipeline",e[e.Readback=9]="Readback",e[e.QueryPool=10]="QueryPool",e[e.RenderBundle=11]="RenderBundle"}(Co||(Co={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(bo||(bo={})),function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"}(Po||(Po={})),function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.FRONT_AND_BACK=3]="FRONT_AND_BACK"}(Oo||(Oo={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC=768]="SRC",e[e.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",e[e.DST=774]="DST",e[e.ONE_MINUS_DST=775]="ONE_MINUS_DST",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONST=32769]="CONST",e[e.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}(Io||(Io={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBSTRACT=32778]="SUBSTRACT",e[e.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"}(wo||(wo={})),function(e){e[e.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",e[e.REPEAT=1]="REPEAT",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"}(Lo||(Lo={})),function(e){e[e.POINT=0]="POINT",e[e.BILINEAR=1]="BILINEAR"}(Do||(Do={})),function(e){e[e.NO_MIP=0]="NO_MIP",e[e.NEAREST=1]="NEAREST",e[e.LINEAR=2]="LINEAR"}(Bo||(Bo={})),function(e){e[e.POINTS=0]="POINTS",e[e.TRIANGLES=1]="TRIANGLES",e[e.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",e[e.LINES=3]="LINES",e[e.LINE_STRIP=4]="LINE_STRIP"}(Fo||(Fo={})),function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"}(Uo||(Uo={})),function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"}(Zo||(Zo={})),function(e){e[e.VERTEX=1]="VERTEX",e[e.INSTANCE=2]="INSTANCE"}(Go||(Go={})),function(e){e.LOADED="loaded"}(Vo||(Vo={})),function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"}(Wo||(Wo={})),function(e){e[e.SAMPLED=1]="SAMPLED",e[e.RENDER_TARGET=2]="RENDER_TARGET",e[e.STORAGE=4]="STORAGE"}(Ho||(Ho={})),function(e){e[e.NONE=0]="NONE",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e[e.RGB=7]="RGB",e[e.ALL=15]="ALL"}(Xo||(Xo={})),function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INVERT=5386]="INVERT",e[e.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",e[e.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",e[e.INCREMENT_WRAP=34055]="INCREMENT_WRAP",e[e.DECREMENT_WRAP=34056]="DECREMENT_WRAP"}(zo||(zo={})),function(e){e[e.Float=0]="Float",e[e.UnfilterableFloat=1]="UnfilterableFloat",e[e.Uint=2]="Uint",e[e.Sint=3]="Sint",e[e.Depth=4]="Depth"}(Yo||(Yo={})),function(e){e[e.LOWER_LEFT=0]="LOWER_LEFT",e[e.UPPER_LEFT=1]="UPPER_LEFT"}(jo||(jo={})),function(e){e[e.NEGATIVE_ONE=0]="NEGATIVE_ONE",e[e.ZERO=1]="ZERO"}(Ko||(Ko={})),function(e){e[e.OcclusionConservative=0]="OcclusionConservative"}(qo||(qo={})),function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.U16_PACKED_565=98]="U16_PACKED_565",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"}($o||($o={})),function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"}(Qo||(Qo={})),function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget",e[e.Luminance=32]="Luminance"}(Jo||(Jo={})),function(e){e[e.ALPHA=vs($o.U8,Qo.A,Jo.None)]="ALPHA",e[e.U8_LUMINANCE=vs($o.U8,Qo.A,Jo.Luminance)]="U8_LUMINANCE",e[e.F16_LUMINANCE=vs($o.F16,Qo.A,Jo.Luminance)]="F16_LUMINANCE",e[e.F32_LUMINANCE=vs($o.F32,Qo.A,Jo.Luminance)]="F32_LUMINANCE",e[e.F16_R=vs($o.F16,Qo.R,Jo.None)]="F16_R",e[e.F16_RG=vs($o.F16,Qo.RG,Jo.None)]="F16_RG",e[e.F16_RGB=vs($o.F16,Qo.RGB,Jo.None)]="F16_RGB",e[e.F16_RGBA=vs($o.F16,Qo.RGBA,Jo.None)]="F16_RGBA",e[e.F32_R=vs($o.F32,Qo.R,Jo.None)]="F32_R",e[e.F32_RG=vs($o.F32,Qo.RG,Jo.None)]="F32_RG",e[e.F32_RGB=vs($o.F32,Qo.RGB,Jo.None)]="F32_RGB",e[e.F32_RGBA=vs($o.F32,Qo.RGBA,Jo.None)]="F32_RGBA",e[e.U8_R=vs($o.U8,Qo.R,Jo.None)]="U8_R",e[e.U8_R_NORM=vs($o.U8,Qo.R,Jo.Normalized)]="U8_R_NORM",e[e.U8_RG=vs($o.U8,Qo.RG,Jo.None)]="U8_RG",e[e.U8_RG_NORM=vs($o.U8,Qo.RG,Jo.Normalized)]="U8_RG_NORM",e[e.U8_RGB=vs($o.U8,Qo.RGB,Jo.None)]="U8_RGB",e[e.U8_RGB_NORM=vs($o.U8,Qo.RGB,Jo.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=vs($o.U8,Qo.RGB,Jo.sRGB|Jo.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=vs($o.U8,Qo.RGBA,Jo.None)]="U8_RGBA",e[e.U8_RGBA_NORM=vs($o.U8,Qo.RGBA,Jo.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=vs($o.U8,Qo.RGBA,Jo.sRGB|Jo.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=vs($o.U16,Qo.R,Jo.None)]="U16_R",e[e.U16_R_NORM=vs($o.U16,Qo.R,Jo.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=vs($o.U16,Qo.RG,Jo.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=vs($o.U16,Qo.RGBA,Jo.Normalized)]="U16_RGBA_NORM",e[e.U16_RGBA=vs($o.U16,Qo.RGBA,Jo.None)]="U16_RGBA",e[e.U16_RGB=vs($o.U16,Qo.RGB,Jo.None)]="U16_RGB",e[e.U16_RG=vs($o.U16,Qo.RG,Jo.None)]="U16_RG",e[e.U32_R=vs($o.U32,Qo.R,Jo.None)]="U32_R",e[e.U32_RG=vs($o.U32,Qo.RG,Jo.None)]="U32_RG",e[e.U32_RGB=vs($o.U32,Qo.RGB,Jo.None)]="U32_RGB",e[e.U32_RGBA=vs($o.U32,Qo.RGBA,Jo.None)]="U32_RGBA",e[e.S8_R=vs($o.S8,Qo.R,Jo.None)]="S8_R",e[e.S8_R_NORM=vs($o.S8,Qo.R,Jo.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=vs($o.S8,Qo.RG,Jo.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=vs($o.S8,Qo.RGB,Jo.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=vs($o.S8,Qo.RGBA,Jo.Normalized)]="S8_RGBA_NORM",e[e.S16_R=vs($o.S16,Qo.R,Jo.None)]="S16_R",e[e.S16_RG=vs($o.S16,Qo.RG,Jo.None)]="S16_RG",e[e.S16_RG_NORM=vs($o.S16,Qo.RG,Jo.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=vs($o.S16,Qo.RGB,Jo.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=vs($o.S16,Qo.RGBA,Jo.None)]="S16_RGBA",e[e.S16_RGBA_NORM=vs($o.S16,Qo.RGBA,Jo.Normalized)]="S16_RGBA_NORM",e[e.S32_R=vs($o.S32,Qo.R,Jo.None)]="S32_R",e[e.S32_RG=vs($o.S32,Qo.RG,Jo.None)]="S32_RG",e[e.S32_RGB=vs($o.S32,Qo.RGB,Jo.None)]="S32_RGB",e[e.S32_RGBA=vs($o.S32,Qo.RGBA,Jo.None)]="S32_RGBA",e[e.U16_RGBA_5551=vs($o.U16_PACKED_5551,Qo.RGBA,Jo.Normalized)]="U16_RGBA_5551",e[e.U16_RGB_565=vs($o.U16_PACKED_565,Qo.RGB,Jo.Normalized)]="U16_RGB_565",e[e.BC1=vs($o.BC1,Qo.RGBA,Jo.Normalized)]="BC1",e[e.BC1_SRGB=vs($o.BC1,Qo.RGBA,Jo.Normalized|Jo.sRGB)]="BC1_SRGB",e[e.BC2=vs($o.BC2,Qo.RGBA,Jo.Normalized)]="BC2",e[e.BC2_SRGB=vs($o.BC2,Qo.RGBA,Jo.Normalized|Jo.sRGB)]="BC2_SRGB",e[e.BC3=vs($o.BC3,Qo.RGBA,Jo.Normalized)]="BC3",e[e.BC3_SRGB=vs($o.BC3,Qo.RGBA,Jo.Normalized|Jo.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=vs($o.BC4_UNORM,Qo.R,Jo.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=vs($o.BC4_SNORM,Qo.R,Jo.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=vs($o.BC5_UNORM,Qo.RG,Jo.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=vs($o.BC5_SNORM,Qo.RG,Jo.Normalized)]="BC5_SNORM",e[e.D24=vs($o.D24,Qo.R,Jo.Depth)]="D24",e[e.D24_S8=vs($o.D24S8,Qo.RG,Jo.Depth|Jo.Stencil)]="D24_S8",e[e.D32F=vs($o.D32F,Qo.R,Jo.Depth)]="D32F",e[e.D32F_S8=vs($o.D32FS8,Qo.RG,Jo.Depth|Jo.Stencil)]="D32F_S8",e[e.U8_RGB_RT=vs($o.U8,Qo.RGB,Jo.RenderTarget|Jo.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=vs($o.U8,Qo.RGBA,Jo.RenderTarget|Jo.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=vs($o.U8,Qo.RGBA,Jo.RenderTarget|Jo.Normalized|Jo.sRGB)]="U8_RGBA_RT_SRGB"}(es||(es={}));var Ns=ks(0,0,0,0),Ms=ks(0,0,0,1),Cs=ks(1,1,1,0),bs=ks(1,1,1,1);function Ps(e){return!(!e||0!=(e&e-1))}function Os(e,t){return null!=e?e:t}function Is(e){return void 0===e?null:e}function ws(e,t,n){e.length=t,e.fill(n)}function Ls(e,t){var n=t-1;return e+n&~n}function Ds(e,t){return((e+t-1)/t|0)*t}function Bs(e,t,n){return n?e|=t:e&=~t,e}function Fs(e,t){for(var n=new Array(e),r=0;r<e;r++)n[r]=t();return n}function Us(e,t){e.blendDstFactor=t.blendDstFactor,e.blendSrcFactor=t.blendSrcFactor,e.blendMode=t.blendMode}function Zs(e,t){return void 0===e&&(e={}),e.compare=t.compare,e.depthFailOp=t.depthFailOp,e.passOp=t.passOp,e.failOp=t.failOp,e.mask=t.mask,e}function Gs(e,t){return void 0===e&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),Us(e.rgbBlendState,t.rgbBlendState),Us(e.alphaBlendState,t.alphaBlendState),e.channelWriteMask=t.channelWriteMask,e}function Vs(e,t){e.length!==t.length&&(e.length=t.length);for(var n=0;n<t.length;n++)e[n]=Gs(e[n],t[n])}function Ws(e,t){void 0!==t.attachmentsState&&Vs(e.attachmentsState,t.attachmentsState),e.blendConstant&&t.blendConstant&&As(e.blendConstant,t.blendConstant),e.depthCompare=Os(t.depthCompare,e.depthCompare),e.depthWrite=Os(t.depthWrite,e.depthWrite),e.stencilWrite=Os(t.stencilWrite,e.stencilWrite),e.stencilFront&&t.stencilFront&&Zs(e.stencilFront,t.stencilFront),e.stencilBack&&t.stencilBack&&Zs(e.stencilBack,t.stencilBack),e.cullMode=Os(t.cullMode,e.cullMode),e.frontFace=Os(t.frontFace,e.frontFace),e.polygonOffset=Os(t.polygonOffset,e.polygonOffset),e.polygonOffsetFactor=Os(t.polygonOffsetFactor,e.polygonOffsetFactor),e.polygonOffsetUnits=Os(t.polygonOffsetUnits,e.polygonOffsetUnits)}function Hs(e){var t=Object.assign({},e);return t.attachmentsState=[],Vs(t.attachmentsState,e.attachmentsState),t.blendConstant=t.blendConstant&&xs(t.blendConstant),t.stencilFront=Zs(void 0,e.stencilFront),t.stencilBack=Zs(void 0,e.stencilBack),t}var Xs={blendMode:wo.ADD,blendSrcFactor:Io.ONE,blendDstFactor:Io.ZERO},zs={attachmentsState:[{channelWriteMask:Xo.ALL,rgbBlendState:Xs,alphaBlendState:Xs}],blendConstant:xs(Ns),depthWrite:!0,depthCompare:bo.LEQUAL,stencilWrite:!1,stencilFront:{compare:bo.ALWAYS,passOp:zo.KEEP,depthFailOp:zo.KEEP,failOp:zo.KEEP},stencilBack:{compare:bo.ALWAYS,passOp:zo.KEEP,depthFailOp:zo.KEEP,failOp:zo.KEEP},cullMode:Oo.NONE,frontFace:Po.CCW,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0};var Ys=function(e,t){void 0===e&&(e=null),void 0===t&&(t=zs);var n=Hs(t);return null!==e&&Ws(n,e),n}({depthCompare:bo.ALWAYS,depthWrite:!1},zs);function js(e,t){return void 0===e.attachmentsState&&(e.attachmentsState=[],Vs(e.attachmentsState,zs.attachmentsState)),function(e,t){void 0!==t.channelWriteMask&&(e.channelWriteMask=t.channelWriteMask),void 0!==t.rgbBlendMode&&(e.rgbBlendState.blendMode=t.rgbBlendMode),void 0!==t.alphaBlendMode&&(e.alphaBlendState.blendMode=t.alphaBlendMode),void 0!==t.rgbBlendSrcFactor&&(e.rgbBlendState.blendSrcFactor=t.rgbBlendSrcFactor),void 0!==t.alphaBlendSrcFactor&&(e.alphaBlendState.blendSrcFactor=t.alphaBlendSrcFactor),void 0!==t.rgbBlendDstFactor&&(e.rgbBlendState.blendDstFactor=t.rgbBlendDstFactor),void 0!==t.alphaBlendDstFactor&&(e.alphaBlendState.blendDstFactor=t.alphaBlendDstFactor)}(e.attachmentsState[0],t),e}var Ks,qs={texture:null,sampler:null,formatKind:Yo.Float,dimension:Wo.TEXTURE_2D};function $s(e,t,n){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!n(e[r],t[r]))return!1;return!0}function Qs(e,t){for(var n=Array(e.length),r=0;r<e.length;r++)n[r]=t(e[r]);return n}function Js(e,t){return e.texture===t.texture&&e.binding===t.binding}function el(e,t){return e.buffer===t.buffer&&e.size===t.size&&e.binding===t.binding&&e.offset===t.offset}function tl(e,t){return null===e?null===t:null!==t&&(e.sampler===t.sampler&&e.texture===t.texture&&e.dimension===t.dimension&&e.formatKind===t.formatKind&&e.comparison===t.comparison)}function nl(e,t){return e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],e.storageBufferBindings=e.storageBufferBindings||[],e.storageTextureBindings=e.storageTextureBindings||[],t.samplerBindings=t.samplerBindings||[],t.uniformBufferBindings=t.uniformBufferBindings||[],t.storageBufferBindings=t.storageBufferBindings||[],t.storageTextureBindings=t.storageTextureBindings||[],e.samplerBindings.length===t.samplerBindings.length&&(!!$s(e.samplerBindings,t.samplerBindings,tl)&&(!!$s(e.uniformBufferBindings,t.uniformBufferBindings,el)&&(!!$s(e.storageBufferBindings,t.storageBufferBindings,el)&&!!$s(e.storageTextureBindings,t.storageTextureBindings,Js))))}function rl(e,t){return e.blendMode==t.blendMode&&e.blendSrcFactor===t.blendSrcFactor&&e.blendDstFactor===t.blendDstFactor}function il(e,t){return!!rl(e.rgbBlendState,t.rgbBlendState)&&(!!rl(e.alphaBlendState,t.alphaBlendState)&&e.channelWriteMask===t.channelWriteMask)}function al(e,t){return e.compare==t.compare&&e.depthFailOp===t.depthFailOp&&e.failOp===t.failOp&&e.passOp===t.passOp&&e.mask===t.mask}function ol(e,t){return e.id===t.id}function sl(e,t){return e===t}function ll(e,t){return e.topology===t.topology&&(e.inputLayout===t.inputLayout&&(e.sampleCount===t.sampleCount&&(!(e.megaStateDescriptor&&t.megaStateDescriptor&&!function(e,t){return!(!$s(e.attachmentsState,t.attachmentsState,il)||e.blendConstant&&t.blendConstant&&!Rs(e.blendConstant,t.blendConstant)||e.stencilFront&&t.stencilFront&&!al(e.stencilFront,t.stencilFront)||e.stencilBack&&t.stencilBack&&!al(e.stencilBack,t.stencilBack)||e.depthCompare!==t.depthCompare||e.depthWrite!==t.depthWrite||e.stencilWrite!==t.stencilWrite||e.cullMode!==t.cullMode||e.frontFace!==t.frontFace||e.polygonOffset!==t.polygonOffset||e.polygonOffsetFactor!==t.polygonOffsetFactor||e.polygonOffsetUnits!==t.polygonOffsetUnits)}(e.megaStateDescriptor,t.megaStateDescriptor))&&(!!ol(e.program,t.program)&&(!!$s(e.colorAttachmentFormats,t.colorAttachmentFormats,sl)&&e.depthStencilAttachmentFormat===t.depthStencilAttachmentFormat)))))}function ul(e,t){return e.offset===t.offset&&e.shaderLocation===t.shaderLocation&&e.format===t.format&&e.divisor===t.divisor}function cl(e,t){return(0,T.Z)(e)?(0,T.Z)(t):!(0,T.Z)(t)&&(e.arrayStride===t.arrayStride&&e.stepMode===t.stepMode&&$s(e.attributes,t.attributes,ul))}function hl(e,t){return e.indexBufferFormat===t.indexBufferFormat&&(!!$s(e.vertexBufferDescriptors,t.vertexBufferDescriptors,cl)&&!!ol(e.program,t.program))}function dl(e,t){return e.addressModeU===t.addressModeU&&e.addressModeV===t.addressModeV&&e.minFilter===t.minFilter&&e.magFilter===t.magFilter&&e.mipmapFilter===t.mipmapFilter&&e.lodMinClamp===t.lodMinClamp&&e.lodMaxClamp===t.lodMaxClamp&&e.maxAnisotropy===t.maxAnisotropy&&e.compareFunction===t.compareFunction}function fl(e){return{sampler:e.sampler,texture:e.texture,dimension:e.dimension,formatKind:e.formatKind,comparison:e.comparison}}function vl(e){var t=e.buffer,n=e.size;return{binding:e.binding,buffer:t,offset:e.offset,size:n}}function pl(e){return{binding:e.binding,texture:e.texture}}function gl(e){return{shaderLocation:e.shaderLocation,format:e.format,offset:e.offset,divisor:e.divisor}}function ml(e){return(0,T.Z)(e)?e:{arrayStride:e.arrayStride,stepMode:e.stepMode,attributes:Qs(e.attributes,gl)}}var yl=/([^[]*)(\[[0-9]+\])?/;function El(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};var t=e.match(yl);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:t[1],length:Number(t[2])||1,isArray:Boolean(t[2])}}function _l(){var e=null;return function(t,n,r){var i=e!==r;return i&&(t.uniform1i(n,r),e=r),i}}function Tl(e,t,n,r){var i=null,a=null;return function(o,s,l){var u=t(l,n),c=u.length,h=!1;if(null===i)i=new Float32Array(c),a=c,h=!0;else{Ts(a===c,"Uniform length cannot change.");for(var d=0;d<c;++d)if(u[d]!==i[d]){h=!0;break}}return h&&(r(o,e,s,u),i.set(u)),h}}function Sl(e,t,n,r){e[t](n,r)}function Rl(e,t,n,r){e[t](n,!1,r)}var Al={},xl={},kl={},Nl=[0];function Ml(e,t,n,r){1===t&&"boolean"==typeof e&&(e=e?1:0),Number.isFinite(e)&&(Nl[0]=e,e=Nl);var i=e.length;if(e instanceof n)return e;var a=r[i];a||(a=new n(i),r[i]=a);for(var o=0;o<i;o++)a[o]=e[o];return a}function Cl(e,t){return Ml(e,t,Float32Array,Al)}function bl(e,t){return Ml(e,t,Int32Array,xl)}function Pl(e,t){return Ml(e,t,Uint32Array,kl)}var Ol=((Ks={})[Mo.FLOAT]=Tl.bind(null,"uniform1fv",Cl,1,Sl),Ks[Mo.FLOAT_VEC2]=Tl.bind(null,"uniform2fv",Cl,2,Sl),Ks[Mo.FLOAT_VEC3]=Tl.bind(null,"uniform3fv",Cl,3,Sl),Ks[Mo.FLOAT_VEC4]=Tl.bind(null,"uniform4fv",Cl,4,Sl),Ks[Mo.INT]=Tl.bind(null,"uniform1iv",bl,1,Sl),Ks[Mo.INT_VEC2]=Tl.bind(null,"uniform2iv",bl,2,Sl),Ks[Mo.INT_VEC3]=Tl.bind(null,"uniform3iv",bl,3,Sl),Ks[Mo.INT_VEC4]=Tl.bind(null,"uniform4iv",bl,4,Sl),Ks[Mo.BOOL]=Tl.bind(null,"uniform1iv",bl,1,Sl),Ks[Mo.BOOL_VEC2]=Tl.bind(null,"uniform2iv",bl,2,Sl),Ks[Mo.BOOL_VEC3]=Tl.bind(null,"uniform3iv",bl,3,Sl),Ks[Mo.BOOL_VEC4]=Tl.bind(null,"uniform4iv",bl,4,Sl),Ks[Mo.FLOAT_MAT2]=Tl.bind(null,"uniformMatrix2fv",Cl,4,Rl),Ks[Mo.FLOAT_MAT3]=Tl.bind(null,"uniformMatrix3fv",Cl,9,Rl),Ks[Mo.FLOAT_MAT4]=Tl.bind(null,"uniformMatrix4fv",Cl,16,Rl),Ks[Mo.UNSIGNED_INT]=Tl.bind(null,"uniform1uiv",Pl,1,Sl),Ks[Mo.UNSIGNED_INT_VEC2]=Tl.bind(null,"uniform2uiv",Pl,2,Sl),Ks[Mo.UNSIGNED_INT_VEC3]=Tl.bind(null,"uniform3uiv",Pl,3,Sl),Ks[Mo.UNSIGNED_INT_VEC4]=Tl.bind(null,"uniform4uiv",Pl,4,Sl),Ks[Mo.FLOAT_MAT2x3]=Tl.bind(null,"uniformMatrix2x3fv",Cl,6,Rl),Ks[Mo.FLOAT_MAT2x4]=Tl.bind(null,"uniformMatrix2x4fv",Cl,8,Rl),Ks[Mo.FLOAT_MAT3x2]=Tl.bind(null,"uniformMatrix3x2fv",Cl,6,Rl),Ks[Mo.FLOAT_MAT3x4]=Tl.bind(null,"uniformMatrix3x4fv",Cl,12,Rl),Ks[Mo.FLOAT_MAT4x2]=Tl.bind(null,"uniformMatrix4x2fv",Cl,8,Rl),Ks[Mo.FLOAT_MAT4x3]=Tl.bind(null,"uniformMatrix4x3fv",Cl,12,Rl),Ks[Mo.SAMPLER_2D]=_l,Ks[Mo.SAMPLER_CUBE]=_l,Ks[Mo.SAMPLER_3D]=_l,Ks[Mo.SAMPLER_2D_SHADOW]=_l,Ks[Mo.SAMPLER_2D_ARRAY]=_l,Ks[Mo.SAMPLER_2D_ARRAY_SHADOW]=_l,Ks[Mo.SAMPLER_CUBE_SHADOW]=_l,Ks[Mo.INT_SAMPLER_2D]=_l,Ks[Mo.INT_SAMPLER_3D]=_l,Ks[Mo.INT_SAMPLER_CUBE]=_l,Ks[Mo.INT_SAMPLER_2D_ARRAY]=_l,Ks[Mo.UNSIGNED_INT_SAMPLER_2D]=_l,Ks[Mo.UNSIGNED_INT_SAMPLER_3D]=_l,Ks[Mo.UNSIGNED_INT_SAMPLER_CUBE]=_l,Ks[Mo.UNSIGNED_INT_SAMPLER_2D_ARRAY]=_l,Ks);function Il(e,t,n){var r=Ol[n.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(n.type));return r().bind(null,e,t)}var wl={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function Ll(e,t){return"#define ".concat(e," ").concat(t)}function Dl(e){if(void 0===e)return null;var t=/binding\s*=\s*(\d+)/.exec(e);if(null!==t){var n=parseInt(t[1],10);if(!Number.isNaN(n))return n}return null}function Bl(e){return[e,""]}function Fl(e,t,n,r,i){var a;void 0===r&&(r=null),void 0===i&&(i=!0);var o="#version 100"===e.glslVersion,s="frag"===t&&(null===(a=n.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))||void 0===a?void 0:a.length)>1,l=n.replace("\r\n","\n").split("\n").map((function(e){return e.replace(/[/][/].*$/,"")})).filter((function(e){return!(!e||/^\s+$/.test(e))})),u="";null!==r&&(u=Object.keys(r).map((function(e){return Ll(e,r[e])})).join("\n"));var c=l.find((function(e){return e.startsWith("precision")}))||"precision mediump float;",h=i?l.filter((function(e){return!e.startsWith("precision")})).join("\n"):l.join("\n"),d="";if(e.viewportOrigin===jo.UPPER_LEFT&&(d+="".concat(Ll("VIEWPORT_ORIGIN_TL","1"),"\n")),e.clipSpaceNearZ===Ko.ZERO&&(d+="".concat(Ll("CLIPSPACE_NEAR_ZERO","1"),"\n")),e.explicitBindingLocations){var f=0,v=0,p=0;h=h.replace(/^\s*(layout\((.*)\))?\s*uniform(.+{)$/gm,(function(e,t,n,r){var i=n?"".concat(n,", "):"";return"layout(".concat(i,"set = ").concat(f,", binding = ").concat(v++,") uniform ").concat(r)})),f++,v=0,Ts(e.separateSamplerTextures),h=h.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,(function(e,n,r,i,a){var o=Dl(r);null===o&&(o=v++);var s=(0,ds.__read)(Bl(i),2),l=s[0],u=s[1];return"frag"===t?"\nlayout(set = ".concat(f,", binding = ").concat(2*o+0,") uniform texture").concat(l," T_").concat(a,";\nlayout(set = ").concat(f,", binding = ").concat(2*o+1,") uniform sampler").concat(u," S_").concat(a,";").trim():""})),h=h.replace("frag"===t?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,(function(e,t){return"layout(location = ".concat(p++,") ").concat(t)})),d+="".concat(Ll("gl_VertexID","gl_VertexIndex"),"\n"),d+="".concat(Ll("gl_InstanceID","gl_InstanceIndex"),"\n"),c=c.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var g=0;h=h.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,(function(e,t,n,r,i){var a=Dl(n);return null===a&&(a=g++),"uniform sampler".concat(r," ").concat(i,"; // BINDING=").concat(a)}))}if(h=(h=(h=h.replace(/\bPU_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"SAMPLER_".concat(t,"(P_").concat(n,")")}))).replace(/\bPF_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"PP_SAMPLER_".concat(t,"(P_").concat(n,")")}))).replace(/\bPU_TEXTURE\((.*?)\)/g,(function(e,t){return"TEXTURE(P_".concat(t,")")})),e.separateSamplerTextures)h=h.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){var r=(0,ds.__read)(Bl(t),2),i=r[0],a=r[1];return"texture".concat(i," T_P_").concat(n,", sampler").concat(a," S_P_").concat(n)})),h=(h=(h=h.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"T_".concat(n,", S_").concat(n)}))).replace(/\bSAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"sampler".concat(t,"(T_").concat(n,", S_").concat(n,")")}))).replace(/\bTEXTURE\((.*?)\)/g,(function(e,t){return"T_".concat(t)}));else{var m=[];h=(h=(h=h.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"sampler".concat(t," P_").concat(n)}))).replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return n}))).replace(/\bSAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return m.push([n,t]),n})),o&&m.forEach((function(e){var t=(0,ds.__read)(e,2),n=t[0],r=t[1];h=h.replace(new RegExp("texture\\(".concat(n),"g"),(function(){return"texture".concat(r,"(").concat(n)}))})),h=h.replace(/\bTEXTURE\((.*?)\)/g,(function(e,t){return t}))}var y="".concat(o?"":e.glslVersion,"\n").concat(o&&s?"#extension GL_EXT_draw_buffers : require\n":"","\n").concat(o&&"frag"===t?"#extension GL_OES_standard_derivatives : enable\n":"").concat(i?c:"","\n").concat(d||"").concat(u?u+"\n":"","\n").concat(h,"\n").trim();if(e.explicitBindingLocations&&"frag"===t&&(y=y.replace(/^\b(out)\b/g,(function(e,t){return"layout(location = 0) ".concat(t)}))),o){if("frag"===t&&(y=y.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return"varying ".concat(t," ").concat(n,";\n")}))),"vert"===t&&(y=(y=y.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return"varying ".concat(t," ").concat(n,";\n")}))).replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return"attribute ".concat(t," ").concat(n,";\n")}))),y=y.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,(function(e,t){return t.trim().replace(/^.*$/gm,(function(e){var t=e.trim();return t.startsWith("#")?t:e?"uniform ".concat(t):""}))})),"frag"===t)if(s){var E=[];y=y.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,(function(e,t){return E.push(t),"vec4 ".concat(t,";\n")}));var _=y.lastIndexOf("}");y=y.substring(0,_)+"\n    ".concat(E.map((function(e,t){return"gl_FragData[".concat(t,"] = ").concat(e,";\n    ")})).join("\n"))+y.substring(_)}else{var T;if(y=y.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return T=n,"".concat(t," ").concat(n,";\n")})),T){_=y.lastIndexOf("}");y=y.substring(0,_)+"\n  gl_FragColor = vec4(".concat(T,");\n")+y.substring(_)}}y=y.replace(/^\s*layout\((.*)\)/gm,"")}return y}var Ul,Zl=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this)||this;return i.id=n,i.device=r,null!==i.device.resourceCreationTracker&&i.device.resourceCreationTracker.trackResourceCreated(i),i}return(0,ds.__extends)(t,e),t.prototype.destroy=function(){null!==this.device.resourceCreationTracker&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},t}(d.Z),Gl=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=Co.Bindings;var o=i.uniformBufferBindings,s=i.samplerBindings;return a.uniformBufferBindings=o||[],a.samplerBindings=s||[],a.bindingLayouts=a.createBindingLayouts(),a}return(0,ds.__extends)(t,e),t.prototype.createBindingLayouts=function(){var e=0,t=0,n=[],r=this.uniformBufferBindings.length,i=this.samplerBindings.length;return n.push({firstUniformBuffer:e,numUniformBuffers:r,firstSampler:t,numSamplers:i}),{numUniformBuffers:e+=r,numSamplers:t+=i,bindingLayoutTables:n}},t}(Zl);function Vl(e){return void 0!==Ul?Ul:"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext?(Ul=!0,!0):Ul=Boolean(e&&2===e._version)}function Wl(e){switch(gs(e)){case $o.BC1:case $o.BC2:case $o.BC3:case $o.BC4_UNORM:case $o.BC4_SNORM:case $o.BC5_UNORM:case $o.BC5_SNORM:return!0;default:return!1}}function Hl(e){if(ms(e)&Jo.Normalized)return!1;var t=gs(e);return t===$o.S8||t===$o.S16||t===$o.S32||(t===$o.U8||t===$o.U16||t===$o.U32)}function Xl(e){return e&Uo.INDEX?Mo.ELEMENT_ARRAY_BUFFER:e&Uo.VERTEX?Mo.ARRAY_BUFFER:e&Uo.UNIFORM?Mo.UNIFORM_BUFFER:void 0}function zl(e){var t=gs(e),n=ps(e),r=ms(e),i=function(e){switch(e){case $o.U8:return Mo.UNSIGNED_BYTE;case $o.U16:return Mo.UNSIGNED_SHORT;case $o.U32:return Mo.UNSIGNED_INT;case $o.S8:return Mo.BYTE;case $o.S16:return Mo.SHORT;case $o.S32:return Mo.INT;case $o.F16:return Mo.HALF_FLOAT;case $o.F32:return Mo.FLOAT;default:throw new Error("whoops")}}(t),a=function(e){switch(e){case Qo.R:return 1;case Qo.RG:return 2;case Qo.RGB:return 3;case Qo.RGBA:return 4;default:return 1}}(n);return{size:a,type:i,normalized:!!(r&Jo.Normalized)}}function Yl(e){switch(e){case Lo.CLAMP_TO_EDGE:return Mo.CLAMP_TO_EDGE;case Lo.REPEAT:return Mo.REPEAT;case Lo.MIRRORED_REPEAT:return Mo.MIRRORED_REPEAT;default:throw new Error("whoops")}}function jl(e,t){if(t===Bo.LINEAR&&e===Do.BILINEAR)return Mo.LINEAR_MIPMAP_LINEAR;if(t===Bo.LINEAR&&e===Do.POINT)return Mo.NEAREST_MIPMAP_LINEAR;if(t===Bo.NEAREST&&e===Do.BILINEAR)return Mo.LINEAR_MIPMAP_NEAREST;if(t===Bo.NEAREST&&e===Do.POINT)return Mo.NEAREST_MIPMAP_NEAREST;if(t===Bo.NO_MIP&&e===Do.BILINEAR)return Mo.LINEAR;if(t===Bo.NO_MIP&&e===Do.POINT)return Mo.NEAREST;throw new Error("Unknown texture filter mode")}function Kl(e,t){void 0===t&&(t=0);var n=e;return n.gl_buffer_pages[t/n.pageByteSize|0]}function ql(e){return e.gl_texture}function $l(e){return e.gl_sampler}function Ql(e,t){e.name=t,e.__SPECTOR_Metadata={name:t}}function Jl(e,t){for(var n=[];;){var r=t.exec(e);if(!r)break;n.push(r)}return n}function eu(e){return e.blendMode==wo.ADD&&e.blendSrcFactor==Io.ONE&&e.blendDstFactor===Io.ZERO}function tu(e){if(e===Wo.TEXTURE_2D)return Mo.TEXTURE_2D;if(e===Wo.TEXTURE_2D_ARRAY)return Mo.TEXTURE_2D_ARRAY;if(e===Wo.TEXTURE_CUBE_MAP)return Mo.TEXTURE_CUBE_MAP;if(e===Wo.TEXTURE_3D)return Mo.TEXTURE_3D;throw new Error("whoops")}function nu(e,t,n,r){return e%n==0&&t%r==0}var ru,iu=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=Co.Buffer;var o=i.viewOrSize,s=i.usage,l=i.hint,u=void 0===l?Zo.STATIC:l,c=r.uniformBufferMaxPageByteSize,h=r.gl,d=s&Uo.UNIFORM;d||(Vl(h)?h.bindVertexArray(null):r.OES_vertex_array_object.bindVertexArrayOES(null));var f,v=(0,E.Z)(o)?Ls(o,4):Ls(o.byteLength,4);if(a.gl_buffer_pages=[],d){for(var p=v;p>0;)a.gl_buffer_pages.push(a.createBufferPage(Math.min(p,c),s,u)),p-=c;f=c}else a.gl_buffer_pages.push(a.createBufferPage(v,s,u)),f=v;return a.pageByteSize=f,a.byteSize=v,a.usage=s,a.gl_target=Xl(s),(0,E.Z)(o)||a.setSubData(0,new Uint8Array(o.buffer)),d||(Vl(h)?h.bindVertexArray(a.device.currentBoundVAO):r.OES_vertex_array_object.bindVertexArrayOES(a.device.currentBoundVAO)),a}return(0,ds.__extends)(t,e),t.prototype.setSubData=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=t.byteLength-n);for(var i=this.device.gl,a=this.pageByteSize,o=e+r,s=e,l=e%a;s<o;){var u=Vl(i)?i.COPY_WRITE_BUFFER:this.gl_target,c=Kl(this,s);if(c.ubo)return;i.bindBuffer(u,c),Vl(i)?i.bufferSubData(u,l,t,n,Math.min(o-s,a)):i.bufferSubData(u,l,t),s+=a,l=0,n+=a,this.device.debugGroupStatisticsBufferUpload()}},t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.gl_buffer_pages.length;t++)this.gl_buffer_pages[t].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[t]);this.gl_buffer_pages=[]},t.prototype.createBufferPage=function(e,t,n){var r=this.device.gl,i=t&Uo.UNIFORM;if(!Vl(r)&&i)return{ubo:!0};var a=this.device.ensureResourceExists(r.createBuffer()),o=Xl(t),s=function(e){switch(e){case Zo.STATIC:return Mo.STATIC_DRAW;case Zo.DYNAMIC:return Mo.DYNAMIC_DRAW}}(n);return r.bindBuffer(o,a),r.bufferData(o,e,s),a},t}(Zl),au=function(e){function t(t){var n,r,i,a,o,s=t.id,l=t.device,u=t.descriptor,c=e.call(this,{id:s,device:l})||this;c.type=Co.InputLayout;var h=u.vertexBufferDescriptors,d=u.indexBufferFormat,f=u.program;Ts(d===es.U16_R||d===es.U32_R||null===d);var v=null!==d?function(e){switch(e){case es.U8_R:return Mo.UNSIGNED_BYTE;case es.U16_R:return Mo.UNSIGNED_SHORT;case es.U32_R:return Mo.UNSIGNED_INT;default:throw new Error("whoops")}}(d):null,p=null!==d?Es(d):null,g=c.device.gl,m=c.device.ensureResourceExists(Vl(g)?g.createVertexArray():l.OES_vertex_array_object.createVertexArrayOES());Vl(g)?g.bindVertexArray(m):l.OES_vertex_array_object.bindVertexArrayOES(m),g.bindBuffer(g.ARRAY_BUFFER,Kl(c.device.fallbackVertexBuffer));try{for(var y=(0,ds.__values)(u.vertexBufferDescriptors),E=y.next();!E.done;E=y.next()){var _=E.value,S=_.stepMode,R=_.attributes;try{for(var A=(i=void 0,(0,ds.__values)(R)),x=A.next();!x.done;x=A.next()){var k=x.value,N=k.shaderLocation,M=k.format,C=k.divisor,b=void 0===C?1:C,P=Vl(g)?N:null===(o=f.attributes[N])||void 0===o?void 0:o.location,O=zl(M);if(k.vertexFormat=O,!(0,T.Z)(P)){Hl(M);var I=O.size,w=O.type,L=O.normalized;g.vertexAttribPointer(P,I,w,L,0,0),S===Go.INSTANCE&&(Vl(g)?g.vertexAttribDivisor(P,b):l.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(P,b)),g.enableVertexAttribArray(P)}}}catch(e){i={error:e}}finally{try{x&&!x.done&&(a=A.return)&&a.call(A)}finally{if(i)throw i.error}}}}catch(e){n={error:e}}finally{try{E&&!E.done&&(r=y.return)&&r.call(y)}finally{if(n)throw n.error}}return Vl(g)?g.bindVertexArray(null):l.OES_vertex_array_object.bindVertexArrayOES(null),c.vertexBufferDescriptors=h,c.vao=m,c.indexBufferFormat=d,c.indexBufferType=v,c.indexBufferCompByteSize=p,c.program=f,c}return(0,ds.__extends)(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(Vl(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},t}(Zl),ou=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=t.fake,o=e.call(this,{id:n,device:r})||this;o.type=Co.Texture,i=(0,ds.__assign)({dimension:Wo.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},i);var s,l,u=o.device.gl,c=o.clampmipLevelCount(i);if(o.immutable=i.usage===Ho.RENDER_TARGET,o.pixelStore=i.pixelStore,o.format=i.format,o.dimension=i.dimension,o.formatKind=_s(i.format),o.width=i.width,o.height=i.height,o.depthOrArrayLayers=i.depthOrArrayLayers,o.mipmaps=c>=1,!a){l=o.device.ensureResourceExists(u.createTexture());var h=o.device.translateTextureType(i.format),d=o.device.translateTextureInternalFormat(i.format);if(o.device.setActiveTexture(u.TEXTURE0),o.device.currentTextures[0]=null,o.preprocessImage(),i.dimension===Wo.TEXTURE_2D){if(s=Mo.TEXTURE_2D,u.bindTexture(s,l),o.immutable)if(Vl(u))u.texStorage2D(s,c,d,i.width,i.height);else{var f=(d===Mo.DEPTH_COMPONENT||o.isNPOT(),0);(o.format!==es.D32F&&o.format!==es.D24_S8||Vl(u)||r.WEBGL_depth_texture)&&(u.texImage2D(s,f,d,i.width,i.height,0,d,h,null),o.mipmaps&&(o.mipmaps=!1,u.texParameteri(Mo.TEXTURE_2D,Mo.TEXTURE_MIN_FILTER,Mo.LINEAR),u.texParameteri(Mo.TEXTURE_2D,Mo.TEXTURE_WRAP_S,Mo.CLAMP_TO_EDGE),u.texParameteri(Mo.TEXTURE_2D,Mo.TEXTURE_WRAP_T,Mo.CLAMP_TO_EDGE)))}Ts(1===i.depthOrArrayLayers)}else if(i.dimension===Wo.TEXTURE_2D_ARRAY)s=Mo.TEXTURE_2D_ARRAY,u.bindTexture(s,l),o.immutable&&Vl(u)&&u.texStorage3D(s,c,d,i.width,i.height,i.depthOrArrayLayers);else if(i.dimension===Wo.TEXTURE_3D)s=Mo.TEXTURE_3D,u.bindTexture(s,l),o.immutable&&Vl(u)&&u.texStorage3D(s,c,d,i.width,i.height,i.depthOrArrayLayers);else{if(i.dimension!==Wo.TEXTURE_CUBE_MAP)throw new Error("whoops");s=Mo.TEXTURE_CUBE_MAP,u.bindTexture(s,l),o.immutable&&Vl(u)&&u.texStorage2D(s,c,d,i.width,i.height),Ts(6===i.depthOrArrayLayers)}}return o.gl_texture=l,o.gl_target=s,o.mipLevelCount=c,o}return(0,ds.__extends)(t,e),t.prototype.setImageData=function(e,t){void 0===t&&(t=0);var n=this.device.gl;Wl(this.format);var r,i=this.gl_target===Mo.TEXTURE_3D||this.gl_target===Mo.TEXTURE_2D_ARRAY,a=this.gl_target===Mo.TEXTURE_CUBE_MAP,o=(r=e[0],Object.prototype.toString.call(r)in wl);this.device.setActiveTexture(n.TEXTURE0),this.device.currentTextures[0]=null;var s,l,u=e[0];o?(s=this.width,l=this.height):(s=u.width,l=u.height,this.width=s,this.height=l),n.bindTexture(this.gl_target,this.gl_texture);var c=this.device.translateTextureFormat(this.format),h=Vl(n)?this.device.translateInternalTextureFormat(this.format):c,d=this.device.translateTextureType(this.format);this.preprocessImage();for(var f=0;f<this.depthOrArrayLayers;f++){var v=e[f],p=this.gl_target;a&&(p=Mo.TEXTURE_CUBE_MAP_POSITIVE_X+f%6),this.immutable?n.texSubImage2D(p,t,0,0,s,l,c,d,v):Vl(n)?i?n.texImage3D(p,t,h,s,l,this.depthOrArrayLayers,0,c,d,v):n.texImage2D(p,t,h,s,l,0,c,d,v):o?n.texImage2D(p,t,c,s,l,0,c,d,v):n.texImage2D(p,t,c,c,d,v)}this.mipmaps&&this.generateMipmap(i)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(ql(this))},t.prototype.clampmipLevelCount=function(e){if(e.dimension===Wo.TEXTURE_2D_ARRAY&&e.depthOrArrayLayers>1&&gs(e.format)===$o.BC1)for(var t=e.width,n=e.height,r=0;r<e.mipLevelCount;r++){if(t<=2||n<=2)return r-1;t=Math.max(t/2|0,1),n=Math.max(n/2|0,1)}return e.mipLevelCount},t.prototype.preprocessImage=function(){var e=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&e.pixelStorei(Mo.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&e.pixelStorei(Mo.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&e.pixelStorei(Mo.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},t.prototype.generateMipmap=function(e){void 0===e&&(e=!1);var t=this.device.gl;return!Vl(t)&&this.isNPOT()||this.gl_texture&&this.gl_target&&(t.bindTexture(this.gl_target,this.gl_texture),e?(t.texParameteri(this.gl_target,Mo.TEXTURE_BASE_LEVEL,0),t.texParameteri(this.gl_target,Mo.TEXTURE_MAX_LEVEL,Math.log2(this.width)),t.texParameteri(this.gl_target,Mo.TEXTURE_MIN_FILTER,Mo.LINEAR_MIPMAP_LINEAR),t.texParameteri(this.gl_target,Mo.TEXTURE_MAG_FILTER,Mo.LINEAR)):t.texParameteri(Mo.TEXTURE_2D,Mo.TEXTURE_MIN_FILTER,Mo.NEAREST_MIPMAP_LINEAR),t.generateMipmap(this.gl_target),t.bindTexture(this.gl_target,null)),this},t.prototype.isNPOT=function(){return!Vl(this.device.gl)&&(!Ps(this.width)||!Ps(this.height))},t}(Zl),su=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=Co.RenderTarget,a.gl_renderbuffer=null,a.texture=null;var o=a.device.gl,s=i.format,l=i.width,u=i.height,c=i.sampleCount,h=void 0===c?1:c,d=i.texture,f=!1;if(s!==es.D32F&&s!==es.D24_S8||!d||Vl(o)||r.WEBGL_depth_texture||(d.destroy(),a.texture=null,f=!0),!f&&d)a.texture=d;else{a.gl_renderbuffer=a.device.ensureResourceExists(o.createRenderbuffer()),o.bindRenderbuffer(o.RENDERBUFFER,a.gl_renderbuffer);var v=a.device.translateTextureInternalFormat(s,!0);Vl(o)&&h>1?o.renderbufferStorageMultisample(Mo.RENDERBUFFER,h,v,l,u):o.renderbufferStorage(Mo.RENDERBUFFER,v,l,u)}return a.format=s,a.width=l,a.height=u,a.sampleCount=h,a}return(0,ds.__extends)(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),null!==this.gl_renderbuffer&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},t}(Zl);!function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"}(ru||(ru={}));var lu,uu=function(e){function t(t,n){var r=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:r,device:i})||this;o.rawVertexGLSL=n,o.type=Co.Program,o.uniformSetters={},o.attributes=[];var s=o.device.gl;return o.descriptor=a,o.gl_program=o.device.ensureResourceExists(s.createProgram()),o.gl_shader_vert=null,o.gl_shader_frag=null,o.compileState=ru.NeedsCompile,o.tryCompileProgram(),o}return(0,ds.__extends)(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},t.prototype.tryCompileProgram=function(){Ts(this.compileState===ru.NeedsCompile);var e=this.descriptor,t=e.vertex,n=e.fragment,r=this.device.gl;(null==t?void 0:t.glsl)&&(null==n?void 0:n.glsl)&&(this.gl_shader_vert=this.compileShader(t.postprocess?t.postprocess(t.glsl):t.glsl,r.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(n.postprocess?n.postprocess(n.glsl):n.glsl,r.FRAGMENT_SHADER),r.attachShader(this.gl_program,this.gl_shader_vert),r.attachShader(this.gl_program,this.gl_shader_frag),r.linkProgram(this.gl_program),this.compileState=ru.Compiling,Vl(r)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},t.prototype.readAttributesFromLinkedProgram=function(){for(var e,t=this.device.gl,n=t.getProgramParameter(this.gl_program,t.ACTIVE_ATTRIBUTES),r=function(e){var t={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,(function(e,n,r){var i=Number(r);return t[n]=isNaN(i)?r:i,""})),t}(this.descriptor.vertex.glsl),i=function(e,t){var n=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,(function(e,r,i){var a=Number(r);return n.push({location:isNaN(a)?t[r]:a,name:i}),""})),n}(this.rawVertexGLSL,r),a=function(n){var r=t.getActiveAttrib(o.gl_program,n),a=r.name,s=r.type,l=r.size,u=t.getAttribLocation(o.gl_program,a),c=null===(e=i.find((function(e){return e.name===a})))||void 0===e?void 0:e.location;u>=0&&!(0,T.Z)(c)&&(o.attributes[c]={name:a,location:u,type:s,size:l})},o=this,s=0;s<n;s++)a(s)},t.prototype.readUniformLocationsFromLinkedProgram=function(){for(var e=this.device.gl,t=e.getProgramParameter(this.gl_program,e.ACTIVE_UNIFORMS),n=0;n<t;n++){var r=e.getActiveUniform(this.gl_program,n),i=El(r.name).name,a=e.getUniformLocation(this.gl_program,i);if(this.uniformSetters[i]=Il(e,a,r),r&&r.size>1)for(var o=0;o<r.size;o++)a=e.getUniformLocation(this.gl_program,"".concat(i,"[").concat(o,"]")),this.uniformSetters["".concat(i,"[").concat(o,"]")]=Il(e,a,r)}},t.prototype.compileShader=function(e,t){var n=this.device.gl,r=this.device.ensureResourceExists(n.createShader(t));return n.shaderSource(r,e),n.compileShader(r),r},t.prototype.setUniformsLegacy=function(e){void 0===e&&(e={});var t=this.device.gl;if(!Vl(t)){var n=!1;for(var r in e){n||(t.useProgram(this.gl_program),n=!0);var i=e[r],a=this.uniformSetters[r];if(a){var o=i;o instanceof ou&&(o=o.textureIndex),a(o)}}}return this},t}(Zl),cu=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=Co.QueryPool;var o=a.device.gl;if(Vl(o)){var s=i.elemCount,l=i.type;a.gl_query=Fs(s,(function(){return a.device.ensureResourceExists(o.createQuery())})),a.gl_query_type=function(e){if(e===qo.OcclusionConservative)return Mo.ANY_SAMPLES_PASSED_CONSERVATIVE;throw new Error("whoops")}(l)}return a}return(0,ds.__extends)(t,e),t.prototype.queryResultOcclusion=function(e){var t=this.device.gl;if(Vl(t)){var n=this.gl_query[e];return t.getQueryParameter(n,t.QUERY_RESULT_AVAILABLE)?!!t.getQueryParameter(n,t.QUERY_RESULT):null}return null},t.prototype.destroy=function(){e.prototype.destroy.call(this);var t=this.device.gl;if(Vl(t))for(var n=0;n<this.gl_query.length;n++)t.deleteQuery(this.gl_query[n])},t}(Zl),hu=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this,{id:n,device:r})||this;return i.type=Co.Readback,i.gl_pbo=null,i.gl_sync=null,i}return(0,ds.__extends)(t,e),t.prototype.clientWaitAsync=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=10);var r=this.device.gl;return new Promise((function(i,a){!function o(){var s=r.clientWaitSync(e,t,0);s!=r.WAIT_FAILED?s!=r.TIMEOUT_EXPIRED?i():setTimeout(o,(0,R.Z)(n,0,r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL)):a()}()}))},t.prototype.getBufferSubDataAsync=function(e,t,n,r,i,a){return(0,ds.__awaiter)(this,void 0,void 0,(function(){var o;return(0,ds.__generator)(this,(function(s){switch(s.label){case 0:return Vl(o=this.device.gl)?(this.gl_sync=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0),o.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return s.sent(),o.bindBuffer(e,t),o.getBufferSubData(e,n,r,i,a),o.bindBuffer(e,null),[2,r];case 2:return[2]}}))}))},t.prototype.readTexture=function(e,t,n,r,i,a,o,s){return void 0===o&&(o=0),void 0===s&&(s=a.byteLength||0),(0,ds.__awaiter)(this,void 0,void 0,(function(){var l,u,c,h,d;return(0,ds.__generator)(this,(function(f){var v;return l=this.device.gl,u=e,c=this.device.translateTextureFormat(u.format),h=this.device.translateTextureType(u.format),v=u.format,d=ys(gs(v))*ps(v),Vl(l)?(this.gl_pbo=this.device.ensureResourceExists(l.createBuffer()),l.bindBuffer(l.PIXEL_PACK_BUFFER,this.gl_pbo),l.bufferData(l.PIXEL_PACK_BUFFER,s,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),l.bindFramebuffer(Mo.READ_FRAMEBUFFER,this.device.readbackFramebuffer),l.framebufferTexture2D(Mo.READ_FRAMEBUFFER,Mo.COLOR_ATTACHMENT0,Mo.TEXTURE_2D,u.gl_texture,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,this.gl_pbo),l.readPixels(t,n,r,i,c,h,o*d),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(l.PIXEL_PACK_BUFFER,this.gl_pbo,0,a,o,0)]):[2,this.readTextureSync(e,t,n,r,i,a,o,s)]}))}))},t.prototype.readTextureSync=function(e,t,n,r,i,a,o,s){void 0===s&&(s=a.byteLength||0);var l=this.device.gl,u=e,c=this.device.translateTextureType(u.format);return l.bindFramebuffer(Mo.FRAMEBUFFER,this.device.readbackFramebuffer),l.framebufferTexture2D(Mo.FRAMEBUFFER,Mo.COLOR_ATTACHMENT0,Mo.TEXTURE_2D,u.gl_texture,0),l.pixelStorei(l.PACK_ALIGNMENT,4),l.readPixels(t,n,r,i,l.RGBA,c,a),a},t.prototype.readBuffer=function(e,t,n,r,i){return(0,ds.__awaiter)(this,void 0,void 0,(function(){var a;return(0,ds.__generator)(this,(function(o){return Vl(a=this.device.gl)?[2,this.getBufferSubDataAsync(a.ARRAY_BUFFER,Kl(e,t),t,n,r,i)]:[2,Promise.reject()]}))}))},t.prototype.destroy=function(){e.prototype.destroy.call(this),Vl(this.device.gl)&&(null!==this.gl_sync&&this.device.gl.deleteSync(this.gl_sync),null!==this.gl_pbo&&this.device.gl.deleteBuffer(this.gl_pbo))},t}(Zl),du=function(e){function t(t){var n,r,i=t.id,a=t.device,o=t.descriptor,s=e.call(this,{id:i,device:a})||this;return s.type=Co.RenderPipeline,s.drawMode=function(e){switch(e){case Fo.TRIANGLES:return Mo.TRIANGLES;case Fo.POINTS:return Mo.POINTS;case Fo.TRIANGLE_STRIP:return Mo.TRIANGLE_STRIP;case Fo.LINES:return Mo.LINES;case Fo.LINE_STRIP:return Mo.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}(null!==(n=o.topology)&&void 0!==n?n:Fo.TRIANGLES),s.program=o.program,s.inputLayout=o.inputLayout,s.megaState=(0,ds.__assign)((0,ds.__assign)({},Hs(zs)),o.megaStateDescriptor),s.colorAttachmentFormats=o.colorAttachmentFormats.slice(),s.depthStencilAttachmentFormat=o.depthStencilAttachmentFormat,s.sampleCount=null!==(r=o.sampleCount)&&void 0!==r?r:1,s}return(0,ds.__extends)(t,e),t}(Zl),fu=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;return a.type=Co.ComputePipeline,a.descriptor=i,a}return(0,ds.__extends)(t,e),t}(Zl),vu=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(e){this.creationStacks.set(e,(new Error).stack),this.liveObjects.add(e)},e.prototype.trackResourceDestroyed=function(e){this.deletionStacks.has(e)&&console.warn("Object double freed:",e,"\n\nCreation stack: ",this.creationStacks.get(e),"\n\nDeletion stack: ",this.deletionStacks.get(e),"\n\nThis stack: ",(new Error).stack),this.deletionStacks.set(e,(new Error).stack),this.liveObjects.delete(e)},e.prototype.checkForLeaks=function(){var e,t;try{for(var n=(0,ds.__values)(this.liveObjects.values()),r=n.next();!r.done;r=n.next()){var i=r.value;console.warn("Object leaked:",i,"Creation stack:",this.creationStacks.get(i))}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.setResourceLeakCheck=function(e,t){t?this.liveObjects.add(e):this.liveObjects.delete(e)},e}(),pu=function(e){function t(t){var n,r,i=t.id,a=t.device,o=t.descriptor,s=e.call(this,{id:i,device:a})||this;s.type=Co.Sampler;var l=s.device.gl;if(Vl(l)){var u=s.device.ensureResourceExists(l.createSampler());l.samplerParameteri(u,Mo.TEXTURE_WRAP_S,Yl(o.addressModeU)),l.samplerParameteri(u,Mo.TEXTURE_WRAP_T,Yl(o.addressModeV)),l.samplerParameteri(u,Mo.TEXTURE_WRAP_R,Yl(null!==(n=o.addressModeW)&&void 0!==n?n:o.addressModeU)),l.samplerParameteri(u,Mo.TEXTURE_MIN_FILTER,jl(o.minFilter,o.mipmapFilter)),l.samplerParameteri(u,Mo.TEXTURE_MAG_FILTER,jl(o.magFilter,Bo.NO_MIP)),void 0!==o.lodMinClamp&&l.samplerParameterf(u,Mo.TEXTURE_MIN_LOD,o.lodMinClamp),void 0!==o.lodMaxClamp&&l.samplerParameterf(u,Mo.TEXTURE_MAX_LOD,o.lodMaxClamp),void 0!==o.compareFunction&&(l.samplerParameteri(u,l.TEXTURE_COMPARE_MODE,l.COMPARE_REF_TO_TEXTURE),l.samplerParameteri(u,l.TEXTURE_COMPARE_FUNC,o.compareFunction));var c=null!==(r=o.maxAnisotropy)&&void 0!==r?r:1;c>1&&null!==s.device.EXT_texture_filter_anisotropic&&(Ts(o.minFilter===Do.BILINEAR&&o.magFilter===Do.BILINEAR&&o.mipmapFilter===Bo.LINEAR),l.samplerParameterf(u,s.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c)),s.gl_sampler=u}else s.descriptor=o;return s}return(0,ds.__extends)(t,e),t.prototype.setTextureParameters=function(e,t,n){var r,i=this.device.gl,a=this.descriptor;this.isNPOT(t,n)?i.texParameteri(Mo.TEXTURE_2D,Mo.TEXTURE_MIN_FILTER,Mo.LINEAR):i.texParameteri(e,Mo.TEXTURE_MIN_FILTER,jl(a.minFilter,a.mipmapFilter)),i.texParameteri(Mo.TEXTURE_2D,Mo.TEXTURE_WRAP_S,Yl(a.addressModeU)),i.texParameteri(Mo.TEXTURE_2D,Mo.TEXTURE_WRAP_T,Yl(a.addressModeV)),i.texParameteri(e,Mo.TEXTURE_MAG_FILTER,jl(a.magFilter,Bo.NO_MIP));var o=null!==(r=a.maxAnisotropy)&&void 0!==r?r:1;o>1&&null!==this.device.EXT_texture_filter_anisotropic&&(Ts(a.minFilter===Do.BILINEAR&&a.magFilter===Do.BILINEAR&&a.mipmapFilter===Bo.LINEAR),i.texParameteri(e,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o))},t.prototype.destroy=function(){e.prototype.destroy.call(this),Vl(this.device.gl)&&this.device.gl.deleteSampler($l(this))},t.prototype.isNPOT=function(e,t){return!Ps(e)||!Ps(t)},t}(Zl),gu=function(){function e(){}return e.prototype.dispatchWorkgroups=function(e,t,n){},e.prototype.dispatchWorkgroupsIndirect=function(e,t){},e.prototype.setPipeline=function(e){},e.prototype.setBindings=function(e){},e.prototype.pushDebugGroup=function(e){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(e){},e}(),mu=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Co.RenderBundle,t.commands=[],t}return(0,ds.__extends)(t,e),t.prototype.push=function(e){this.commands.push(e)},t.prototype.replay=function(){this.commands.forEach((function(e){return e()}))},t}(Zl),yu=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,Eu=function(){function e(e,t){void 0===t&&(t={}),this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=Hs(zs),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=jo.LOWER_LEFT,this.clipSpaceNearZ=Ko.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=e,this.contextAttributes=Ss(e.getContextAttributes()),Vl(e)?(this.EXT_texture_norm16=e.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=e.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=e.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=e.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=e.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=e.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),e.getExtension("EXT_frag_depth"),e.getExtension("OES_element_index_uint"),e.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=e.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=e.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=e.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=e.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=e.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=e.getExtension("KHR_parallel_shader_compile"),Vl(e)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new ou({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:Wo.TEXTURE_2D,mipLevelCount:1,usage:Ho.RENDER_TARGET,format:!1===this.contextAttributes.alpha?es.U8_RGB_RT:es.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=Yo.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(Wo.TEXTURE_2D,Yo.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(Wo.TEXTURE_2D,Yo.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:Uo.VERTEX,hint:Zo.STATIC}),Vl(e)&&(this.fallbackTexture2DArray=this.createFallbackTexture(Wo.TEXTURE_2D_ARRAY,Yo.Float),this.fallbackTexture3D=this.createFallbackTexture(Wo.TEXTURE_3D,Yo.Float),this.fallbackTextureCube=this.createFallbackTexture(Wo.TEXTURE_CUBE_MAP,Yo.Float)),this.currentMegaState.depthCompare=bo.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=Xo.ALL,e.enable(e.DEPTH_TEST),e.enable(e.STENCIL_TEST),this.checkLimits(),t.shaderDebug&&(this.shaderDebug=!0),t.trackResources&&(this.resourceCreationTracker=new vu)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(e,t){var n=e===Wo.TEXTURE_CUBE_MAP?6:1,r=t===Yo.Depth?es.D32F:es.U8_RGBA_NORM,i=this.createTexture({dimension:e,format:r,usage:Ho.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1});return t===Yo.Float&&i.setImageData([new Uint8Array(4*n)]),ql(i)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var e=this.gl;if(this.maxVertexAttribs=e.getParameter(Mo.MAX_VERTEX_ATTRIBS),Vl(e)){this.uniformBufferMaxPageByteSize=Math.min(e.getParameter(Mo.MAX_UNIFORM_BLOCK_SIZE),65536),this.uniformBufferWordAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var t=e.getInternalformatParameter(e.RENDERBUFFER,e.DEPTH32F_STENCIL8,e.SAMPLES);this.supportedSampleCounts=t?(0,ds.__spreadArray)([],(0,ds.__read)(t),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=65536;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort((function(e,t){return e-t}))},e.prototype.configureSwapChain=function(e,t,n){var r=this.scTexture;r.width=e,r.height=t,this.scPlatformFramebuffer=Is(n)},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(e,t){switch(void 0===t&&(t=!1),e){case es.ALPHA:return Mo.ALPHA;case es.U8_LUMINANCE:case es.F16_LUMINANCE:case es.F32_LUMINANCE:return Mo.LUMINANCE;case es.F16_R:return Mo.R16F;case es.F16_RG:return Mo.RG16F;case es.F16_RGB:return Mo.RGB16F;case es.F16_RGBA:return Mo.RGBA16F;case es.F32_R:return Mo.R32F;case es.F32_RG:return Mo.RG32F;case es.F32_RGB:return Mo.RGB32F;case es.F32_RGBA:return Vl(this.gl)?Mo.RGBA32F:t?this.WEBGL_color_buffer_float.RGBA32F_EXT:Mo.RGBA;case es.U8_R_NORM:return Mo.R8;case es.U8_RG_NORM:return Mo.RG8;case es.U8_RGB_NORM:case es.U8_RGB_RT:return Mo.RGB8;case es.U8_RGB_SRGB:return Mo.SRGB8;case es.U8_RGBA_NORM:case es.U8_RGBA_RT:return Vl(this.gl)?Mo.RGBA8:t?Mo.RGBA4:Mo.RGBA;case es.U8_RGBA:return Mo.RGBA;case es.U8_RGBA_SRGB:case es.U8_RGBA_RT_SRGB:return Mo.SRGB8_ALPHA8;case es.U16_R:return Mo.R16UI;case es.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case es.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case es.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case es.U16_RGBA_5551:return Mo.RGB5_A1;case es.U16_RGB_565:return Mo.RGB565;case es.U32_R:return Mo.R32UI;case es.S8_RGBA_NORM:return Mo.RGBA8_SNORM;case es.S8_RG_NORM:return Mo.RG8_SNORM;case es.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case es.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case es.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case es.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case es.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case es.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case es.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case es.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case es.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case es.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case es.D32F_S8:return Vl(this.gl)?Mo.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?Mo.DEPTH_STENCIL:Mo.DEPTH_COMPONENT16;case es.D24_S8:return Vl(this.gl)?Mo.DEPTH24_STENCIL8:this.WEBGL_depth_texture?Mo.DEPTH_STENCIL:Mo.DEPTH_COMPONENT16;case es.D32F:return Vl(this.gl)?Mo.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?Mo.DEPTH_COMPONENT:Mo.DEPTH_COMPONENT16;case es.D24:return Vl(this.gl)?Mo.DEPTH_COMPONENT24:this.WEBGL_depth_texture?Mo.DEPTH_COMPONENT:Mo.DEPTH_COMPONENT16;default:throw new Error("whoops")}},e.prototype.translateTextureType=function(e){switch(gs(e)){case $o.U8:return Mo.UNSIGNED_BYTE;case $o.U16:return Mo.UNSIGNED_SHORT;case $o.U32:return Mo.UNSIGNED_INT;case $o.S8:return Mo.BYTE;case $o.F16:return Mo.HALF_FLOAT;case $o.F32:return Mo.FLOAT;case $o.U16_PACKED_5551:return Mo.UNSIGNED_SHORT_5_5_5_1;case $o.D32F:return Vl(this.gl)?Mo.FLOAT:this.WEBGL_depth_texture?Mo.UNSIGNED_INT:Mo.UNSIGNED_BYTE;case $o.D24:return Vl(this.gl)?Mo.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?Mo.UNSIGNED_SHORT:Mo.UNSIGNED_BYTE;case $o.D24S8:return Vl(this.gl)?Mo.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?Mo.UNSIGNED_INT_24_8_WEBGL:Mo.UNSIGNED_BYTE;case $o.D32FS8:return Mo.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},e.prototype.translateInternalTextureFormat=function(e){switch(e){case es.F32_R:return Mo.R32F;case es.F32_RG:return Mo.RG32F;case es.F32_RGB:return Mo.RGB32F;case es.F32_RGBA:return Mo.RGBA32F;case es.F16_R:return Mo.R16F;case es.F16_RG:return Mo.RG16F;case es.F16_RGB:return Mo.RGB16F;case es.F16_RGBA:return Mo.RGBA16F}return this.translateTextureFormat(e)},e.prototype.translateTextureFormat=function(e){if(Wl(e)||e===es.F32_LUMINANCE||e===es.U8_LUMINANCE)return this.translateTextureInternalFormat(e);var t=Vl(this.gl)||!Vl(this.gl)&&!!this.WEBGL_depth_texture;switch(e){case es.D24_S8:case es.D32F_S8:return t?Mo.DEPTH_STENCIL:Mo.RGBA;case es.D24:case es.D32F:return t?Mo.DEPTH_COMPONENT:Mo.RGBA}var n=Hl(e);switch(ps(e)){case Qo.A:return Mo.ALPHA;case Qo.R:return n?Mo.RED_INTEGER:Mo.RED;case Qo.RG:return n?Mo.RG_INTEGER:Mo.RG;case Qo.RGB:return n?Mo.RGB_INTEGER:Mo.RGB;case Qo.RGBA:return Mo.RGBA}},e.prototype.setActiveTexture=function(e){this.currentActiveTexture!==e&&(this.gl.activeTexture(e),this.currentActiveTexture=e)},e.prototype.bindVAO=function(e){this.currentBoundVAO!==e&&(Vl(this.gl)?this.gl.bindVertexArray(e):this.OES_vertex_array_object.bindVertexArrayOES(e),this.currentBoundVAO=e)},e.prototype.programCompiled=function(e){Ts(e.compileState!==ru.NeedsCompile),e.compileState===ru.Compiling&&(e.compileState=ru.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(e))},e.prototype.useProgram=function(e){this.currentProgram!==e&&(this.programCompiled(e),this.gl.useProgram(e.gl_program),this.currentProgram=e)},e.prototype.ensureResourceExists=function(e){if(null===e){var t=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(t))}return e},e.prototype.createBuffer=function(e){return new iu({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createTexture=function(e){return new ou({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createSampler=function(e){return new pu({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTarget=function(e){return new su({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTargetFromTexture=function(e){var t=e,n=t.format,r=t.width,i=t.height;return Ts(1===t.mipLevelCount),this.createRenderTarget({format:n,width:r,height:i,sampleCount:1,texture:e})},e.prototype.createProgram=function(e){var t,n,r,i=null===(t=e.vertex)||void 0===t?void 0:t.glsl;return(null===(n=e.vertex)||void 0===n?void 0:n.glsl)&&(e.vertex.glsl=Fl(this.queryVendorInfo(),"vert",e.vertex.glsl)),(null===(r=e.fragment)||void 0===r?void 0:r.glsl)&&(e.fragment.glsl=Fl(this.queryVendorInfo(),"frag",e.fragment.glsl)),this.createProgramSimple(e,i)},e.prototype.createProgramSimple=function(e,t){return new uu({id:this.getNextUniqueId(),device:this,descriptor:e},t)},e.prototype.createBindings=function(e){return new Gl({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createInputLayout=function(e){return new au({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderPipeline=function(e){return new du({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createComputePass=function(){return new gu},e.prototype.createComputePipeline=function(e){return new fu({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createReadback=function(){return new hu({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(e,t){return new cu({id:this.getNextUniqueId(),device:this,descriptor:{type:e,elemCount:t}})},e.prototype.formatRenderPassDescriptor=function(e){var t,n,r,i,a,o,s=e.colorAttachment;e.depthClearValue=null!==(t=e.depthClearValue)&&void 0!==t?t:"load",e.stencilClearValue=null!==(n=e.stencilClearValue)&&void 0!==n?n:"load";for(var l=0;l<s.length;l++)e.colorAttachmentLevel||(e.colorAttachmentLevel=[]),e.colorAttachmentLevel[l]=null!==(r=e.colorAttachmentLevel[l])&&void 0!==r?r:0,e.colorResolveToLevel||(e.colorResolveToLevel=[]),e.colorResolveToLevel[l]=null!==(i=e.colorResolveToLevel[l])&&void 0!==i?i:0,e.colorClearColor||(e.colorClearColor=[]),e.colorClearColor[l]=null!==(a=e.colorClearColor[l])&&void 0!==a?a:"load",e.colorStore||(e.colorStore=[]),e.colorStore[l]=null!==(o=e.colorStore[l])&&void 0!==o&&o},e.prototype.createRenderBundle=function(){return new mu({id:this.getNextUniqueId(),device:this})},e.prototype.beginBundle=function(e){this.renderBundle=e},e.prototype.endBundle=function(){this.renderBundle=void 0},e.prototype.executeBundles=function(e){e.forEach((function(e){e.replay()}))},e.prototype.createRenderPass=function(e){null!==this.currentRenderPassDescriptor&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=e,this.formatRenderPassDescriptor(e);var t=e.colorAttachment,n=e.colorAttachmentLevel,r=e.colorClearColor,i=e.colorResolveTo,a=e.colorResolveToLevel,o=e.depthStencilAttachment,s=e.depthClearValue,l=e.stencilClearValue,u=e.depthStencilResolveTo,c=i&&1===i.length&&i[0]===this.scTexture;this.setRenderPassParametersBegin(t.length,c);for(var h=0;h<t.length;h++)this.setRenderPassParametersColor(h,t[h],n[h],i[h],a[h],c);this.setRenderPassParametersDepthStencil(o,u,c),this.validateCurrentAttachments();for(h=0;h<t.length;h++){var d=r[h];"load"!==d&&this.setRenderPassParametersClearColor(h,d.r,d.g,d.b,d.a)}return this.setRenderPassParametersClearDepthStencil(s,l),this},e.prototype.submitPass=function(e){Ts(null!==this.currentRenderPassDescriptor),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},e.prototype.copySubTexture2D=function(e,t,n,r,i,a){var o=this.gl,s=e,l=r;if(Ts(1===l.mipLevelCount),Ts(1===s.mipLevelCount),Vl(o))s===this.scTexture?o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,s,0)),o.bindFramebuffer(o.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,l,0),o.blitFramebuffer(i,a,i+l.width,a+l.height,t,n,t+l.width,n+l.height,o.COLOR_BUFFER_BIT,o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,null);else if(s===this.scTexture){var u=this.createRenderTargetFromTexture(r);this.submitBlitRenderPass(u,s)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(e,t,n){switch(e){case es.BC1_SRGB:case es.BC2_SRGB:case es.BC3_SRGB:return null!==this.WEBGL_compressed_texture_s3tc_srgb&&nu(t,n,4,4);case es.BC1:case es.BC2:case es.BC3:return null!==this.WEBGL_compressed_texture_s3tc&&nu(t,n,4,4);case es.BC4_UNORM:case es.BC4_SNORM:case es.BC5_UNORM:case es.BC5_SNORM:return null!==this.EXT_texture_compression_rgtc&&nu(t,n,4,4);case es.U16_R_NORM:case es.U16_RG_NORM:case es.U16_RGBA_NORM:return null!==this.EXT_texture_norm16;case es.F32_R:case es.F32_RG:case es.F32_RGB:case es.F32_RGBA:return null!==this.OES_texture_float_linear;case es.F16_R:case es.F16_RG:case es.F16_RGB:case es.F16_RGBA:return null!==this.OES_texture_half_float_linear;default:return!0}},e.prototype.queryProgramReady=function(e){var t=this.gl;if(e.compileState===ru.NeedsCompile)throw new Error("whoops");if(e.compileState===ru.Compiling){var n=void 0;return(n=null===this.KHR_parallel_shader_compile||t.getProgramParameter(e.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR))&&this.programCompiled(e),n}return e.compileState===ru.NeedsBind||e.compileState===ru.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(e){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(e){return e},e.prototype.setResourceName=function(e,t){if(e.name=t,e.type===Co.Buffer)for(var n=e.gl_buffer_pages,r=0;r<n.length;r++)Ql(n[r],"".concat(t," Page ").concat(r));else if(e.type===Co.Texture)Ql(ql(e),t);else if(e.type===Co.Sampler)Ql($l(e),t);else if(e.type===Co.RenderTarget){var i=e.gl_renderbuffer;null!==i&&Ql(i,t)}else e.type===Co.InputLayout&&Ql(e.vao,t)},e.prototype.setResourceLeakCheck=function(e,t){null!==this.resourceCreationTracker&&this.resourceCreationTracker.setResourceLeakCheck(e,t)},e.prototype.checkForLeaks=function(){null!==this.resourceCreationTracker&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(e){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(e){},e.prototype.programPatched=function(e,t){Ts(this.shaderDebug)},e.prototype.getBufferData=function(e,t,n){void 0===n&&(n=0);var r=this.gl;Vl(r)&&(r.bindBuffer(r.COPY_READ_BUFFER,Kl(e,4*n)),r.getBufferSubData(r.COPY_READ_BUFFER,4*n,t))},e.prototype.debugGroupStatisticsDrawCall=function(e){void 0===e&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].drawCallCount+=e},e.prototype.debugGroupStatisticsBufferUpload=function(e){void 0===e&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].bufferUploadCount+=e},e.prototype.debugGroupStatisticsTextureBind=function(e){void 0===e&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].textureBindCount+=e},e.prototype.debugGroupStatisticsTriangles=function(e){for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].triangleCount+=e},e.prototype.reportShaderError=function(e,t){var n=this.gl,r=n.getShaderParameter(e,n.COMPILE_STATUS);if(!r){console.error(function(e,t){return void 0===t&&(t=1),e.split("\n").map((function(e,n){return"".concat(function(e,t,n){for(void 0===n&&(n="0");e.length<t;)e="".concat(n).concat(e);return e}(""+(t+n),4," "),"  ").concat(e)})).join("\n")}(t));var i=n.getExtension("WEBGL_debug_shaders");i&&console.error(i.getTranslatedShaderSource(e)),console.error(n.getShaderInfoLog(e))}return r},e.prototype.checkProgramCompilationForErrors=function(e){var t=this.gl,n=e.gl_program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var r=e.descriptor;if(!this.reportShaderError(e.gl_shader_vert,r.vertex.glsl))return;if(!this.reportShaderError(e.gl_shader_frag,r.fragment.glsl))return;console.error(t.getProgramInfoLog(e.gl_program))}},e.prototype.bindFramebufferAttachment=function(e,t,n,r){var i=this.gl;if((0,T.Z)(n))i.framebufferRenderbuffer(e,t,i.RENDERBUFFER,null);else if(n.type===Co.RenderTarget)null!==n.gl_renderbuffer?i.framebufferRenderbuffer(e,t,i.RENDERBUFFER,n.gl_renderbuffer):null!==n.texture&&i.framebufferTexture2D(e,t,Mo.TEXTURE_2D,ql(n.texture),r);else if(n.type===Co.Texture){var a=ql(n);n.dimension===Wo.TEXTURE_2D?i.framebufferTexture2D(e,t,Mo.TEXTURE_2D,a,r):Vl(i)&&(n.dimension,Wo.TEXTURE_2D_ARRAY)}},e.prototype.bindFramebufferDepthStencilAttachment=function(e,t){var n=this.gl,r=(0,T.Z)(t)?Jo.Depth|Jo.Stencil:ms(t.format),i=!!(r&Jo.Depth),a=!!(r&Jo.Stencil);i&&a?Vl(this.gl)||!Vl(this.gl)&&!!this.WEBGL_depth_texture?this.bindFramebufferAttachment(e,n.DEPTH_STENCIL_ATTACHMENT,t,0):this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,t,0):i?(this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,t,0),this.bindFramebufferAttachment(e,n.STENCIL_ATTACHMENT,null,0)):a&&(this.bindFramebufferAttachment(e,n.STENCIL_ATTACHMENT,t,0),this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var e=-1,t=-1,n=-1,r=0;r<this.currentColorAttachments.length;r++){var i=this.currentColorAttachments[r];null!==i&&(-1===e?(e=i.sampleCount,t=i.width,n=i.height):(Ts(e===i.sampleCount),Ts(t===i.width),Ts(n===i.height)))}this.currentDepthStencilAttachment&&(-1===e?e=this.currentDepthStencilAttachment.sampleCount:(Ts(e===this.currentDepthStencilAttachment.sampleCount),Ts(t===this.currentDepthStencilAttachment.width),Ts(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=e},e.prototype.setRenderPassParametersBegin=function(e,t){void 0===t&&(t=!1);var n=this.gl;if(t)n.bindFramebuffer(Mo.FRAMEBUFFER,null);else if(Vl(n)?n.bindFramebuffer(Mo.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||n.bindFramebuffer(Mo.FRAMEBUFFER,this.renderPassDrawFramebuffer),Vl(n)?n.drawBuffers([Mo.COLOR_ATTACHMENT0,Mo.COLOR_ATTACHMENT1,Mo.COLOR_ATTACHMENT2,Mo.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([Mo.COLOR_ATTACHMENT0_WEBGL,Mo.COLOR_ATTACHMENT1_WEBGL,Mo.COLOR_ATTACHMENT2_WEBGL,Mo.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var r=e;r<this.currentColorAttachments.length;r++){var i=Vl(n)?Mo.DRAW_FRAMEBUFFER:Mo.FRAMEBUFFER,a=Vl(n)?Mo.COLOR_ATTACHMENT0:Mo.COLOR_ATTACHMENT0_WEBGL;n.framebufferRenderbuffer(i,a+r,Mo.RENDERBUFFER,null),n.framebufferTexture2D(i,a+r,Mo.TEXTURE_2D,null,0)}this.currentColorAttachments.length=e},e.prototype.setRenderPassParametersColor=function(e,t,n,r,i,a){void 0===a&&(a=!1);var o=Vl(this.gl);this.currentColorAttachments[e]===t&&this.currentColorAttachmentLevels[e]===n||(this.currentColorAttachments[e]=t,this.currentColorAttachmentLevels[e]=n,!a&&(o||!o&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(o?Mo.DRAW_FRAMEBUFFER:Mo.FRAMEBUFFER,(o?Mo.COLOR_ATTACHMENT0:Mo.COLOR_ATTACHMENT0_WEBGL)+e,t,n),this.resolveColorAttachmentsChanged=!0),this.currentColorResolveTos[e]===r&&this.currentColorResolveToLevels[e]===i||(this.currentColorResolveTos[e]=r,this.currentColorResolveToLevels[e]=i,null!==r&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(e,t,n){void 0===n&&(n=!1);var r=this.gl;this.currentDepthStencilAttachment!==e&&(this.currentDepthStencilAttachment=e,n||this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(Vl(r)?Mo.DRAW_FRAMEBUFFER:Mo.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==t&&(this.currentDepthStencilResolveTo=t,t&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(e,t,n,r,i){var a,o=this.gl;null!==this.OES_draw_buffers_indexed?(a=this.currentMegaState.attachmentsState[e])&&a.channelWriteMask!==Xo.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(e,!0,!0,!0,!0),a.channelWriteMask=Xo.ALL):(a=this.currentMegaState.attachmentsState[0])&&a.channelWriteMask!==Xo.ALL&&(o.colorMask(!0,!0,!0,!0),a.channelWriteMask=Xo.ALL);this.setScissorRectEnabled(!1),Vl(o)?o.clearBufferfv(o.COLOR,e,[t,n,r,i]):(o.clearColor(t,n,r,i),o.clear(o.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(e,t){void 0===e&&(e="load"),void 0===t&&(t="load");var n=this.gl;"load"!==e&&(Ts(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),Vl(n)?n.clearBufferfv(n.DEPTH,0,[e]):(n.clearDepth(e),n.clear(n.DEPTH_BUFFER_BIT))),"load"!==t&&(Ts(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.enable(n.STENCIL_TEST),n.stencilMask(255),this.currentMegaState.stencilWrite=!0),Vl(n)?n.clearBufferiv(n.STENCIL,0,[t]):(n.clearStencil(t),n.clear(n.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(e){var t,n=this;if(this.renderBundle)this.renderBundle.push((function(){return n.setBindings(e)}));else{var r=this.gl,i=e,a=i.uniformBufferBindings,o=i.samplerBindings,s=i.bindingLayouts;Ts(0<s.bindingLayoutTables.length);var l=s.bindingLayoutTables[0];Ts(a.length>=l.numUniformBuffers),Ts(o.length>=l.numSamplers);for(var u=0;u<a.length;u++){if(0!==(g=a[u]).size){var c=l.firstUniformBuffer+u,h=g.buffer,d=g.offset||0,f=g.size||h.byteSize;if(h!==this.currentUniformBuffers[c]||d!==this.currentUniformBufferByteOffsets[c]||f!==this.currentUniformBufferByteSizes[c]){var v=d%h.pageByteSize,p=h.gl_buffer_pages[d/h.pageByteSize|0];Ts(v+f<=h.pageByteSize),Vl(r)&&r.bindBufferRange(r.UNIFORM_BUFFER,c,p,v,f),this.currentUniformBuffers[c]=h,this.currentUniformBufferByteOffsets[c]=d,this.currentUniformBufferByteSizes[c]=f}}}for(u=0;u<l.numSamplers;u++){var g=o[u],m=l.firstSampler+u,y=null!==g&&null!==g.sampler?$l(g.sampler):null,E=null!==g&&null!==g.texture?ql(g.texture):null;if(this.currentSamplers[m]!==y&&(Vl(r)&&r.bindSampler(m,y),this.currentSamplers[m]=y),this.currentTextures[m]!==E){if(this.setActiveTexture(r.TEXTURE0+m),null!==E){var _=Ss(g).texture,T=_.gl_target,S=_.width,R=_.height;g.texture.textureIndex=m,r.bindTexture(T,E),Vl(r)||null===(t=g.sampler)||void 0===t||t.setTextureParameters(T,S,R),this.debugGroupStatisticsTextureBind()}else{var A=(0,ds.__assign)((0,ds.__assign)({},g),qs),x=A.dimension,k=A.formatKind;T=tu(x);r.bindTexture(T,this.getFallbackTexture((0,ds.__assign)({gl_target:T,formatKind:k},A)))}this.currentTextures[m]=E}}}},e.prototype.setViewport=function(e,t,n,r){this.gl.viewport(e,t,n,r)},e.prototype.setScissorRect=function(e,t,n,r){var i=this.gl;this.setScissorRectEnabled(!0),i.scissor(e,t,n,r)},e.prototype.applyAttachmentStateIndexed=function(e,t,n){var r=this.gl,i=this.OES_draw_buffers_indexed;t.channelWriteMask!==n.channelWriteMask&&(i.colorMaskiOES(e,!!(n.channelWriteMask&Xo.RED),!!(n.channelWriteMask&Xo.GREEN),!!(n.channelWriteMask&Xo.BLUE),!!(n.channelWriteMask&Xo.ALPHA)),t.channelWriteMask=n.channelWriteMask);var a=t.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,o=t.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(o||a)&&(eu(t.rgbBlendState)&&eu(t.alphaBlendState)?i.enableiOES(e,r.BLEND):eu(n.rgbBlendState)&&eu(n.alphaBlendState)&&i.disableiOES(e,r.BLEND)),a&&(i.blendEquationSeparateiOES(e,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),t.rgbBlendState.blendMode=n.rgbBlendState.blendMode,t.alphaBlendState.blendMode=n.alphaBlendState.blendMode),o&&(i.blendFuncSeparateiOES(e,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(e,t){var n=this.gl;e.channelWriteMask!==t.channelWriteMask&&(n.colorMask(!!(t.channelWriteMask&Xo.RED),!!(t.channelWriteMask&Xo.GREEN),!!(t.channelWriteMask&Xo.BLUE),!!(t.channelWriteMask&Xo.ALPHA)),e.channelWriteMask=t.channelWriteMask);var r=e.rgbBlendState.blendMode!==t.rgbBlendState.blendMode||e.alphaBlendState.blendMode!==t.alphaBlendState.blendMode,i=e.rgbBlendState.blendSrcFactor!==t.rgbBlendState.blendSrcFactor||e.alphaBlendState.blendSrcFactor!==t.alphaBlendState.blendSrcFactor||e.rgbBlendState.blendDstFactor!==t.rgbBlendState.blendDstFactor||e.alphaBlendState.blendDstFactor!==t.alphaBlendState.blendDstFactor;(i||r)&&(eu(e.rgbBlendState)&&eu(e.alphaBlendState)?n.enable(n.BLEND):eu(t.rgbBlendState)&&eu(t.alphaBlendState)&&n.disable(n.BLEND)),r&&(n.blendEquationSeparate(t.rgbBlendState.blendMode,t.alphaBlendState.blendMode),e.rgbBlendState.blendMode=t.rgbBlendState.blendMode,e.alphaBlendState.blendMode=t.alphaBlendState.blendMode),i&&(n.blendFuncSeparate(t.rgbBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor,t.alphaBlendState.blendSrcFactor,t.alphaBlendState.blendDstFactor),e.rgbBlendState.blendSrcFactor=t.rgbBlendState.blendSrcFactor,e.alphaBlendState.blendSrcFactor=t.alphaBlendState.blendSrcFactor,e.rgbBlendState.blendDstFactor=t.rgbBlendState.blendDstFactor,e.alphaBlendState.blendDstFactor=t.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(e){var t=this.gl,n=this.currentMegaState;if(null!==this.OES_draw_buffers_indexed)for(var r=0;r<e.attachmentsState.length;r++)this.applyAttachmentStateIndexed(r,n.attachmentsState[0],e.attachmentsState[0]);else Ts(1===e.attachmentsState.length),this.applyAttachmentState(n.attachmentsState[0],e.attachmentsState[0]);Rs(n.blendConstant,e.blendConstant)||(t.blendColor(e.blendConstant.r,e.blendConstant.g,e.blendConstant.b,e.blendConstant.a),As(n.blendConstant,e.blendConstant)),n.depthCompare!==e.depthCompare&&(t.depthFunc(e.depthCompare),n.depthCompare=e.depthCompare),!!n.depthWrite!=!!e.depthWrite&&(t.depthMask(e.depthWrite),n.depthWrite=e.depthWrite),!!n.stencilWrite!=!!e.stencilWrite&&(t.stencilMask(e.stencilWrite?255:0),n.stencilWrite=e.stencilWrite);var i=!1;if(!al(n.stencilFront,e.stencilFront)){i=!0;var a=e.stencilFront,o=a.passOp,s=a.failOp,l=a.depthFailOp,u=a.compare;n.stencilFront.passOp===o&&n.stencilFront.failOp===s&&n.stencilFront.depthFailOp===l||(t.stencilOpSeparate(t.FRONT,s,l,o),n.stencilFront.passOp=o,n.stencilFront.failOp=s,n.stencilFront.depthFailOp=l),n.stencilFront.compare!==u&&(this.setStencilReference(0),n.stencilFront.compare=u)}if(!al(n.stencilBack,e.stencilBack)){i=!0;var c=e.stencilBack;o=c.passOp,s=c.failOp,l=c.depthFailOp,u=c.compare;n.stencilBack.passOp===o&&n.stencilBack.failOp===s&&n.stencilBack.depthFailOp===l||(t.stencilOpSeparate(t.BACK,s,l,o),n.stencilBack.passOp=o,n.stencilBack.failOp=s,n.stencilBack.depthFailOp=l),n.stencilBack.compare!==u&&(this.setStencilReference(0),n.stencilBack.compare=u)}n.stencilFront.mask===e.stencilFront.mask&&n.stencilBack.mask===e.stencilBack.mask||(i=!0,n.stencilFront.mask=e.stencilFront.mask,n.stencilBack.mask=e.stencilBack.mask),i&&this.applyStencil(),n.cullMode!==e.cullMode&&(n.cullMode===Oo.NONE?t.enable(t.CULL_FACE):e.cullMode===Oo.NONE&&t.disable(t.CULL_FACE),e.cullMode===Oo.BACK?t.cullFace(t.BACK):e.cullMode===Oo.FRONT?t.cullFace(t.FRONT):e.cullMode===Oo.FRONT_AND_BACK&&t.cullFace(t.FRONT_AND_BACK),n.cullMode=e.cullMode),n.frontFace!==e.frontFace&&(t.frontFace(e.frontFace),n.frontFace=e.frontFace),n.polygonOffset!==e.polygonOffset&&(e.polygonOffset?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),n.polygonOffset=e.polygonOffset),n.polygonOffsetFactor===e.polygonOffsetFactor&&n.polygonOffsetUnits===e.polygonOffsetUnits||(t.polygonOffset(e.polygonOffsetFactor,e.polygonOffsetUnits),n.polygonOffsetFactor=e.polygonOffsetFactor,n.polygonOffsetUnits=e.polygonOffsetUnits)},e.prototype.validatePipelineFormats=function(e){for(var t=0;t<this.currentColorAttachments.length;t++)this.currentColorAttachments[t];this.currentDepthStencilAttachment&&Ts(this.currentDepthStencilAttachment.format===e.depthStencilAttachmentFormat),-1!==this.currentSampleCount&&Ts(this.currentSampleCount===e.sampleCount)},e.prototype.setPipeline=function(e){var t=this;if(this.renderBundle)this.renderBundle.push((function(){return t.setPipeline(e)}));else{this.currentPipeline=e,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var n=this.currentPipeline.program;if(this.useProgram(n),n.compileState===ru.NeedsBind){var r=this.gl,i=n.gl_program,a=n.descriptor,o=Jl(a.vertex.glsl,yu);if(Vl(r))for(var s=0;s<o.length;s++){var l=(0,ds.__read)(o[s],2)[1],u=r.getUniformBlockIndex(i,l);-1!==u&&4294967295!==u&&r.uniformBlockBinding(i,u,s)}var c=Jl(a.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm);for(s=0;s<c.length;s++){var h=(0,ds.__read)(c[s],3),d=h[1],f=h[2],v=r.getUniformLocation(i,d);r.uniform1i(v,parseInt(f))}n.compileState=ru.ReadyToUse}}},e.prototype.setVertexInput=function(e,t,n){var r,i,a,o=this;if(this.renderBundle)this.renderBundle.push((function(){return o.setVertexInput(e,t,n)}));else if(null!==e){Ts(this.currentPipeline.inputLayout===e);var s=e;this.bindVAO(s.vao);for(var l=this.gl,u=0;u<s.vertexBufferDescriptors.length;u++){var c=s.vertexBufferDescriptors[u],h=c.arrayStride,d=c.attributes;try{for(var f=(r=void 0,(0,ds.__values)(d)),v=f.next();!v.done;v=f.next()){var p=v.value,g=p.shaderLocation,m=p.offset,y=Vl(l)?g:null===(a=s.program.attributes[g])||void 0===a?void 0:a.location;if(!(0,T.Z)(y)){var E=t[u];if(null===E)continue;var _=p.vertexFormat;l.bindBuffer(l.ARRAY_BUFFER,Kl(E.buffer));var S=(E.offset||0)+m;l.vertexAttribPointer(y,_.size,_.type,_.normalized,h,S)}}}catch(e){r={error:e}}finally{try{v&&!v.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}}if(Ts(null!==n==(null!==s.indexBufferFormat)),null!==n){var R=n.buffer;Ts(R.usage===Uo.INDEX),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,Kl(R)),this.currentIndexBufferByteOffset=n.offset||0}else this.currentIndexBufferByteOffset=null}else Ts(null===this.currentPipeline.inputLayout),Ts(null===n),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(e){this.currentStencilRef!==e&&(this.currentStencilRef=e,this.applyStencil())},e.prototype.draw=function(e,t,n,r){var i,a=this;if(this.renderBundle)this.renderBundle.push((function(){return a.draw(e,t,n,r)}));else{var o=this.gl,s=this.currentPipeline;if(t){var l=[s.drawMode,n||0,e,t];Vl(o)?o.drawArraysInstanced.apply(o,(0,ds.__spreadArray)([],(0,ds.__read)(l),!1)):(i=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(i,(0,ds.__spreadArray)([],(0,ds.__read)(l),!1))}else o.drawArrays(s.drawMode,n,e);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(e/3*Math.max(t,1))}},e.prototype.drawIndexed=function(e,t,n,r,i){var a,o=this;if(this.renderBundle)this.renderBundle.push((function(){return o.drawIndexed(e,t,n,r,i)}));else{var s=this.gl,l=this.currentPipeline,u=Ss(l.inputLayout),c=Ss(this.currentIndexBufferByteOffset)+n*u.indexBufferCompByteSize;if(t){var h=[l.drawMode,e,u.indexBufferType,c,t];Vl(s)?s.drawElementsInstanced.apply(s,(0,ds.__spreadArray)([],(0,ds.__read)(h),!1)):(a=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(a,(0,ds.__spreadArray)([],(0,ds.__read)(h),!1))}else s.drawElements(l.drawMode,e,u.indexBufferType,c);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(e/3*Math.max(t,1))}},e.prototype.drawIndirect=function(e,t){},e.prototype.drawIndexedIndirect=function(e,t){},e.prototype.beginOcclusionQuery=function(e){var t=this.gl;if(Vl(t)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;t.beginQuery(n.gl_query_type,n.gl_query[e])}},e.prototype.endOcclusionQuery=function(){var e=this.gl;if(Vl(e)){var t=this.currentRenderPassDescriptor.occlusionQueryPool;e.endQuery(t.gl_query_type)}},e.prototype.pipelineQueryReady=function(e){var t=e;return this.queryProgramReady(t.program)},e.prototype.pipelineForceReady=function(e){},e.prototype.endPass=function(){for(var e=this.gl,t=Vl(e),n=1===this.currentColorResolveTos.length&&this.currentColorResolveTos[0]===this.scTexture,r=!1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];if(null!==a){var o=this.currentColorResolveTos[i],s=!1;null!==o&&(Ts(a.width===o.width&&a.height===o.height),this.setScissorRectEnabled(!1),n||(t&&e.bindFramebuffer(e.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&t&&this.bindFramebufferAttachment(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i])),s=!0,n||(o===this.scTexture?e.bindFramebuffer(t?Mo.DRAW_FRAMEBUFFER:Mo.FRAMEBUFFER,this.scPlatformFramebuffer):(e.bindFramebuffer(t?Mo.DRAW_FRAMEBUFFER:Mo.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&e.framebufferTexture2D(t?Mo.DRAW_FRAMEBUFFER:Mo.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o.gl_texture,this.currentColorResolveToLevels[i]))),n||(t?(e.blitFramebuffer(0,0,a.width,a.height,0,0,o.width,o.height,e.COLOR_BUFFER_BIT,e.LINEAR),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(a,o)),r=!0),this.currentRenderPassDescriptor.colorStore[i]||n||s||(e.bindFramebuffer(t?Mo.READ_FRAMEBUFFER:Mo.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(t?Mo.READ_FRAMEBUFFER:Mo.FRAMEBUFFER,e.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i])),n||e.bindFramebuffer(t?Mo.READ_FRAMEBUFFER:Mo.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var l=this.currentDepthStencilAttachment;if(l){var u=this.currentDepthStencilResolveTo;s=!1;u&&(Ts(l.width===u.width&&l.height===u.height),this.setScissorRectEnabled(!1),n||(e.bindFramebuffer(t?Mo.READ_FRAMEBUFFER:Mo.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),e.bindFramebuffer(t?Mo.DRAW_FRAMEBUFFER:Mo.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(t?Mo.READ_FRAMEBUFFER:Mo.FRAMEBUFFER,l),this.bindFramebufferDepthStencilAttachment(t?Mo.DRAW_FRAMEBUFFER:Mo.FRAMEBUFFER,u))),s=!0,n||(t&&e.blitFramebuffer(0,0,l.width,l.height,0,0,u.width,u.height,e.DEPTH_BUFFER_BIT,e.NEAREST),e.bindFramebuffer(t?Mo.DRAW_FRAMEBUFFER:Mo.FRAMEBUFFER,null)),r=!0),n||this.currentRenderPassDescriptor.depthStencilStore||(s||(e.bindFramebuffer(t?Mo.READ_FRAMEBUFFER:Mo.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(t?Mo.READ_FRAMEBUFFER:Mo.FRAMEBUFFER,l),s=!0),t&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[e.DEPTH_STENCIL_ATTACHMENT])),!n&&s&&e.bindFramebuffer(t?Mo.READ_FRAMEBUFFER:Mo.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}n||r||e.bindFramebuffer(t?Mo.DRAW_FRAMEBUFFER:Mo.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(e){if(this.currentScissorEnabled!==e){var t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),this.currentScissorEnabled=e}},e.prototype.applyStencil=function(){(0,T.Z)(this.currentStencilRef)||(this.gl.stencilFuncSeparate(Mo.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,this.currentMegaState.stencilFront.mask||255),this.gl.stencilFuncSeparate(Mo.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,this.currentMegaState.stencilBack.mask||255))},e.prototype.getFallbackTexture=function(e){var t=e.gl_target,n=e.formatKind;if(t===Mo.TEXTURE_2D)return n===Yo.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===Mo.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===Mo.TEXTURE_3D)return this.fallbackTexture3D;if(t===Mo.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.submitBlitRenderPass=function(e,t){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:"layout(location = 0) in vec2 a_Position;\nout vec2 v_TexCoord;\nvoid main() {\n  v_TexCoord = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_TexCoord.y = 1.0 - v_TexCoord.y;\n  #endif\n}"},fragment:{glsl:"uniform sampler2D u_Texture;\nin vec2 v_TexCoord;\nout vec4 outputColor;\nvoid main() {\n  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);\n}"}}),this.blitVertexBuffer=this.createBuffer({usage:Uo.VERTEX|Uo.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:8,stepMode:Go.VERTEX,attributes:[{format:es.F32_RG,offset:0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:Fo.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[es.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:Hs(zs)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:e.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:e}));var n=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var r=this.createRenderPass({colorAttachment:[e],colorResolveTo:[t],colorClearColor:[Cs]}),i=this.getCanvas(),a=i.width,o=i.height;r.setPipeline(this.blitRenderPipeline),r.setBindings(this.blitBindings),r.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),r.setViewport(0,0,a,o),this.gl.disable(this.gl.BLEND),r.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=n,this.inBlitRenderPass=!1},e}(),_u=function(){function e(e){this.pluginOptions=e}return e.prototype.createSwapChain=function(e){return(0,ds.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,l,u,c,h,d,f;return(0,ds.__generator)(this,(function(v){return t=this.pluginOptions,n=t.targets,r=t.xrCompatible,i=t.antialias,a=void 0!==i&&i,o=t.preserveDrawingBuffer,s=void 0!==o&&o,l=t.premultipliedAlpha,u=void 0===l||l,c=t.shaderDebug,h=t.trackResources,d={antialias:a,preserveDrawingBuffer:s,stencil:!0,premultipliedAlpha:u,xrCompatible:r},this.handleContextEvents(e),n.includes("webgl2")&&(f=e.getContext("webgl2",d)||e.getContext("experimental-webgl2",d)),!f&&n.includes("webgl1")&&(f=e.getContext("webgl",d)||e.getContext("experimental-webgl",d)),[2,new Eu(f,{shaderDebug:c,trackResources:h})]}))}))},e.prototype.handleContextEvents=function(e){var t=this.pluginOptions,n=t.onContextLost,r=t.onContextRestored,i=t.onContextCreationError;i&&e.addEventListener("webglcontextcreationerror",i,!1),n&&e.addEventListener("webglcontextlost",n,!1),r&&e.addEventListener("webglcontextrestored",r,!1)},e}(),Tu="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:function(){throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&Tu.decode();var Su=null;function Ru(){return null!==Su&&0!==Su.byteLength||(Su=new Uint8Array(lu.memory.buffer)),Su}function Au(e,t){return e>>>=0,Tu.decode(Ru().subarray(e,e+t))}var xu=new Array(128).fill(void 0);xu.push(void 0,null,!0,!1);var ku=xu.length;function Nu(e){return xu[e]}function Mu(e){var t=Nu(e);return function(e){e<132||(xu[e]=ku,ku=e)}(e),t}var Cu=0,bu="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:function(){throw Error("TextEncoder not available")}},Pu="function"==typeof bu.encodeInto?function(e,t){return bu.encodeInto(e,t)}:function(e,t){var n=bu.encode(e);return t.set(n),{read:e.length,written:n.length}};function Ou(e,t,n){if(void 0===n){var r=bu.encode(e),i=t(r.length,1)>>>0;return Ru().subarray(i,i+r.length).set(r),Cu=r.length,i}for(var a=e.length,o=t(a,1)>>>0,s=Ru(),l=0;l<a;l++){var u=e.charCodeAt(l);if(u>127)break;s[o+l]=u}if(l!==a){0!==l&&(e=e.slice(l)),o=n(o,a,a=l+3*e.length,1)>>>0;var c=Ru().subarray(o+l,o+a);l+=Pu(e,c).written}return Cu=l,o}var Iu=null;function wu(){return null!==Iu&&0!==Iu.byteLength||(Iu=new Int32Array(lu.memory.buffer)),Iu}function Lu(e,t,n){var r,i;try{var a=lu.__wbindgen_add_to_stack_pointer(-16),o=Ou(e,lu.__wbindgen_malloc,lu.__wbindgen_realloc),s=Cu,l=Ou(t,lu.__wbindgen_malloc,lu.__wbindgen_realloc),u=Cu;lu.glsl_compile(a,o,s,l,u,n);var c=wu()[a/4+0],h=wu()[a/4+1];return r=c,i=h,Au(c,h)}finally{lu.__wbindgen_add_to_stack_pointer(16),lu.__wbindgen_free(r,i,1)}}var Du,Bu,Fu=function(){function e(){us()(this,e);var t=lu.wgslcomposer_new();return e.__wrap(t)}return hs()(e,[{key:"__destroy_into_raw",value:function(){var e=this.__wbg_ptr;return this.__wbg_ptr=0,e}},{key:"free",value:function(){var e=this.__destroy_into_raw();lu.__wbg_wgslcomposer_free(e)}},{key:"load_composable",value:function(e){var t=Ou(e,lu.__wbindgen_malloc,lu.__wbindgen_realloc),n=Cu;lu.wgslcomposer_load_composable(this.__wbg_ptr,t,n)}},{key:"wgsl_compile",value:function(e){var t,n;try{var r=lu.__wbindgen_add_to_stack_pointer(-16),i=Ou(e,lu.__wbindgen_malloc,lu.__wbindgen_realloc),a=Cu;lu.wgslcomposer_wgsl_compile(r,this.__wbg_ptr,i,a);var o=wu()[r/4+0],s=wu()[r/4+1];return t=o,n=s,Au(o,s)}finally{lu.__wbindgen_add_to_stack_pointer(16),lu.__wbindgen_free(t,n,1)}}}],[{key:"__wrap",value:function(t){t>>>=0;var n=Object.create(e.prototype);return n.__wbg_ptr=t,n}}]),e}();function Uu(e,t){return Zu.apply(this,arguments)}function Zu(){return(Zu=ss()(as()().mark((function e(t,n){var r,i;return as()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("function"==typeof Response&&t instanceof Response)){e.next=23;break}if("function"!=typeof WebAssembly.instantiateStreaming){e.next=15;break}return e.prev=2,e.next=5,WebAssembly.instantiateStreaming(t,n);case 5:case 20:return e.abrupt("return",e.sent);case 8:if(e.prev=8,e.t0=e.catch(2),"application/wasm"==t.headers.get("Content-Type")){e.next=14;break}console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e.t0),e.next=15;break;case 14:throw e.t0;case 15:return e.next=17,t.arrayBuffer();case 17:return r=e.sent,e.next=20,WebAssembly.instantiate(r,n);case 23:return e.next=25,WebAssembly.instantiate(t,n);case 25:if(!((i=e.sent)instanceof WebAssembly.Instance)){e.next=30;break}return e.abrupt("return",{instance:i,module:t});case 30:return e.abrupt("return",i);case 31:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function Gu(){var e={wbg:{}};return e.wbg.__wbindgen_string_new=function(e,t){return function(e){ku===xu.length&&xu.push(xu.length+1);var t=ku;return ku=xu[t],xu[t]=e,t}(Au(e,t))},e.wbg.__wbindgen_object_drop_ref=function(e){Mu(e)},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Nu(e))},e.wbg.__wbg_log_576ca876af0d4a77=function(e,t){console.log(Nu(e),Nu(t))},e.wbg.__wbindgen_throw=function(e,t){throw new Error(Au(e,t))},e}function Vu(e,t){return lu=e.exports,Wu.__wbindgen_wasm_module=t,Iu=null,Su=null,lu}function Wu(e){return Hu.apply(this,arguments)}function Hu(){return(Hu=ss()(as()().mark((function e(t){var n,r,i,a;return as()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===lu){e.next=2;break}return e.abrupt("return",lu);case 2:return n=Gu(),("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t)),e.t0=Uu,e.next=7,t;case 7:return e.t1=e.sent,e.t2=n,e.next=11,(0,e.t0)(e.t1,e.t2);case 11:return r=e.sent,i=r.instance,a=r.module,e.abrupt("return",Vu(i,a));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xu(e){if(e===es.U8_R_NORM)return"r8unorm";if(e===es.S8_R_NORM)return"r8snorm";if(e===es.U8_RG_NORM)return"rg8unorm";if(e===es.S8_RG_NORM)return"rg8snorm";if(e===es.U32_R)return"r32uint";if(e===es.S32_R)return"r32sint";if(e===es.F32_R)return"r32float";if(e===es.U16_RG)return"rg16uint";if(e===es.S16_RG)return"rg16sint";if(e===es.F16_RG)return"rg16float";if(e===es.U8_RGBA_RT)return"bgra8unorm";if(e===es.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(e===es.U8_RGBA_NORM)return"rgba8unorm";if(e===es.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(e===es.S8_RGBA_NORM)return"rgba8snorm";if(e===es.U32_RG)return"rg32uint";if(e===es.S32_RG)return"rg32sint";if(e===es.F32_RG)return"rg32float";if(e===es.U16_RGBA)return"rgba16uint";if(e===es.S16_RGBA)return"rgba16sint";if(e===es.F16_RGBA)return"rgba16float";if(e===es.F32_RGBA)return"rgba32float";if(e===es.U32_RGBA)return"rgba32uint";if(e===es.S32_RGBA)return"rgba32sint";if(e===es.D24)return"depth24plus";if(e===es.D24_S8)return"depth24plus-stencil8";if(e===es.D32F)return"depth32float";if(e===es.D32F_S8)return"depth32float-stencil8";if(e===es.BC1)return"bc1-rgba-unorm";if(e===es.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(e===es.BC2)return"bc2-rgba-unorm";if(e===es.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(e===es.BC3)return"bc3-rgba-unorm";if(e===es.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(e===es.BC4_SNORM)return"bc4-r-snorm";if(e===es.BC4_UNORM)return"bc4-r-unorm";if(e===es.BC5_SNORM)return"bc5-rg-snorm";if(e===es.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function zu(e){if(e===Wo.TEXTURE_2D)return"2d";if(e===Wo.TEXTURE_CUBE_MAP)return"cube";if(e===Wo.TEXTURE_2D_ARRAY)return"2d-array";if(e===Wo.TEXTURE_3D)return"3d";throw new Error("whoops")}function Yu(e){if(e===Lo.CLAMP_TO_EDGE)return"clamp-to-edge";if(e===Lo.REPEAT)return"repeat";if(e===Lo.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function ju(e){if(e===Do.BILINEAR)return"linear";if(e===Do.POINT)return"nearest";throw new Error("whoops")}function Ku(e){if(e===Bo.LINEAR)return"linear";if(e===Bo.NEAREST)return"nearest";if(e===Bo.NO_MIP)return"nearest";throw new Error("whoops")}function qu(e){return e.gpuBuffer}function $u(e){if(e===qo.OcclusionConservative)return"occlusion";throw new Error("whoops")}function Qu(e){switch(e){case Fo.TRIANGLES:return"triangle-list";case Fo.POINTS:return"point-list";case Fo.TRIANGLE_STRIP:return"triangle-strip";case Fo.LINES:return"line-list";case Fo.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function Ju(e){if(e===Oo.NONE)return"none";if(e===Oo.FRONT)return"front";if(e===Oo.BACK)return"back";throw new Error("whoops")}function ec(e){if(e===Po.CCW)return"ccw";if(e===Po.CW)return"cw";throw new Error("whoops")}function tc(e){if(e===Io.ZERO)return"zero";if(e===Io.ONE)return"one";if(e===Io.SRC)return"src";if(e===Io.ONE_MINUS_SRC)return"one-minus-src";if(e===Io.DST)return"dst";if(e===Io.ONE_MINUS_DST)return"one-minus-dst";if(e===Io.SRC_ALPHA)return"src-alpha";if(e===Io.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(e===Io.DST_ALPHA)return"dst-alpha";if(e===Io.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(e===Io.CONST)return"constant";if(e===Io.ONE_MINUS_CONSTANT)return"one-minus-constant";if(e===Io.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function nc(e){if(e===wo.ADD)return"add";if(e===wo.SUBSTRACT)return"subtract";if(e===wo.REVERSE_SUBSTRACT)return"reverse-subtract";if(e===wo.MIN)return"min";if(e===wo.MAX)return"max";throw new Error("whoops")}function rc(e){return{operation:nc(e.blendMode),srcFactor:tc(e.blendSrcFactor),dstFactor:tc(e.blendDstFactor)}}function ic(e){return e.blendMode===wo.ADD&&e.blendSrcFactor===Io.ONE&&e.blendDstFactor===Io.ZERO}function ac(e){return ic(e.rgbBlendState)&&ic(e.alphaBlendState)?void 0:{color:rc(e.rgbBlendState),alpha:rc(e.alphaBlendState)}}function oc(e,t){return t.attachmentsState.map((function(t,n){return function(e,t){return{format:Xu(t),blend:ac(e),writeMask:e.channelWriteMask}}(t,e[n])}))}function sc(e){if(e===bo.NEVER)return"never";if(e===bo.LESS)return"less";if(e===bo.EQUAL)return"equal";if(e===bo.LEQUAL)return"less-equal";if(e===bo.GREATER)return"greater";if(e===bo.NOTEQUAL)return"not-equal";if(e===bo.GEQUAL)return"greater-equal";if(e===bo.ALWAYS)return"always";throw new Error("whoops")}function lc(e){if(e===zo.KEEP)return"keep";if(e===zo.REPLACE)return"replace";if(e===zo.ZERO)return"zero";if(e===zo.DECREMENT_CLAMP)return"decrement-clamp";if(e===zo.DECREMENT_WRAP)return"decrement-wrap";if(e===zo.INCREMENT_CLAMP)return"increment-clamp";if(e===zo.INCREMENT_WRAP)return"increment-wrap";if(e===zo.INVERT)return"invert";throw new Error("whoops")}function uc(e){if(e===Go.VERTEX)return"vertex";if(e===Go.INSTANCE)return"instance";throw new Error("whoops")}function cc(e){if(e===es.U8_R)return"uint8x2";if(e===es.U8_RG)return"uint8x2";if(e===es.U8_RGB)return"uint8x4";if(e===es.U8_RGBA)return"uint8x4";if(e===es.U8_RG_NORM)return"unorm8x2";if(e===es.U8_RGBA_NORM)return"unorm8x4";if(e===es.S8_RGB_NORM)return"snorm8x4";if(e===es.S8_RGBA_NORM)return"snorm8x4";if(e===es.U16_RG_NORM)return"unorm16x2";if(e===es.U16_RGBA_NORM)return"unorm16x4";if(e===es.S16_RG_NORM)return"snorm16x2";if(e===es.S16_RGBA_NORM)return"snorm16x4";if(e===es.S16_RG)return"uint16x2";if(e===es.F16_RG)return"float16x2";if(e===es.F16_RGBA)return"float16x4";if(e===es.F32_R)return"float32";if(e===es.F32_RG)return"float32x2";if(e===es.F32_RGB)return"float32x3";if(e===es.F32_RGBA)return"float32x4";throw"whoops"}function hc(e,t,n,r){switch(void 0===n&&(n=!1),e){case es.S8_R:case es.S8_R_NORM:case es.S8_RG_NORM:case es.S8_RGB_NORM:case es.S8_RGBA_NORM:var i=(ArrayBuffer,new Int8Array(t));return r&&i.set(new Int8Array(r)),i;case es.U8_R:case es.U8_R_NORM:case es.U8_RG:case es.U8_RG_NORM:case es.U8_RGB:case es.U8_RGB_NORM:case es.U8_RGB_SRGB:case es.U8_RGBA:case es.U8_RGBA_NORM:case es.U8_RGBA_SRGB:var a=(ArrayBuffer,new Uint8Array(t));return r&&a.set(new Uint8Array(r)),a;case es.S16_R:case es.S16_RG:case es.S16_RG_NORM:case es.S16_RGB_NORM:case es.S16_RGBA:case es.S16_RGBA_NORM:var o=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(n?t/2:t);return r&&o.set(new Int16Array(r)),o;case es.U16_R:case es.U16_RGB:case es.U16_RGBA_5551:case es.U16_RGBA_NORM:case es.U16_RG_NORM:case es.U16_R_NORM:var s=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(n?t/2:t);return r&&s.set(new Uint16Array(r)),s;case es.S32_R:var l=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(n?t/4:t);return r&&l.set(new Int32Array(r)),l;case es.U32_R:case es.U32_RG:var u=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(n?t/4:t);return r&&u.set(new Uint32Array(r)),u;case es.F32_R:case es.F32_RG:case es.F32_RGB:case es.F32_RGBA:var c=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(n?t/4:t);return r&&c.set(new Float32Array(r)),c}var h=(ArrayBuffer,new Uint8Array(t));return r&&h.set(new Uint8Array(r)),h}function dc(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":case"depth16unorm":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":case"depth32float":default:return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8}}}!function(e){e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.TEXTURE_BINDING=4]="TEXTURE_BINDING",e[e.STORAGE_BINDING=8]="STORAGE_BINDING",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"}(Du||(Du={})),function(e){e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"}(Bu||(Bu={}));var fc=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this)||this;return i.id=n,i.device=r,i}return(0,ds.__extends)(t,e),t.prototype.destroy=function(){},t}(d.Z),vc=function(e){function t(t){var n,r,i=t.id,a=t.device,o=t.descriptor,s=e.call(this,{id:i,device:a})||this;s.type=Co.Bindings;var l=o.pipeline;Ts(!!l);var u=o.uniformBufferBindings,c=o.storageBufferBindings,h=o.samplerBindings,d=o.storageTextureBindings;s.numUniformBuffers=(null==u?void 0:u.length)||0;var f=[[],[],[],[]],v=0;if(u&&u.length)for(var p=0;p<u.length;p++){var g=o.uniformBufferBindings[p],m=g.binding,y=g.size,E=g.offset,_={buffer:qu(g.buffer),offset:null!=E?E:0,size:y};f[0].push({binding:null!=m?m:v++,resource:_})}if(h&&h.length){v=0;for(p=0;p<h.length;p++){var T=(0,ds.__assign)((0,ds.__assign)({},h[p]),qs),S=null!==(m=o.samplerBindings[p]).texture?m.texture:s.device.getFallbackTexture(T);T.dimension=S.dimension,T.formatKind=_s(S.format);var R=S.gpuTextureView;if(f[1].push({binding:null!==(n=m.textureBinding)&&void 0!==n?n:v++,resource:R}),-1!==m.samplerBinding){var A=null!==m.sampler?m.sampler:s.device.getFallbackSampler(T),x=A.gpuSampler;f[1].push({binding:null!==(r=m.samplerBinding)&&void 0!==r?r:v++,resource:x})}}}if(c&&c.length){v=0;for(p=0;p<c.length;p++){var k=o.storageBufferBindings[p];m=k.binding,y=k.size,E=k.offset,_={buffer:qu(k.buffer),offset:null!=E?E:0,size:y};f[2].push({binding:null!=m?m:v++,resource:_})}}if(d&&d.length){v=0;for(p=0;p<d.length;p++){var N=o.storageTextureBindings[p];m=N.binding,R=(S=N.texture).gpuTextureView;f[3].push({binding:null!=m?m:v++,resource:R})}}var M=f.findLastIndex((function(e){return!!e.length}));return s.gpuBindGroup=f.map((function(e,t){return t<=M&&s.device.device.createBindGroup({layout:l.getBindGroupLayout(t),entries:e})})),s}return(0,ds.__extends)(t,e),t}(fc),pc=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=Co.Buffer;var o=i.usage,s=i.viewOrSize,l=!!(o&Uo.MAP_READ);a.usage=function(e){var t=0;return e&Uo.INDEX&&(t|=GPUBufferUsage.INDEX),e&Uo.VERTEX&&(t|=GPUBufferUsage.VERTEX),e&Uo.UNIFORM&&(t|=GPUBufferUsage.UNIFORM),e&Uo.STORAGE&&(t|=GPUBufferUsage.STORAGE),e&Uo.COPY_SRC&&(t|=GPUBufferUsage.COPY_SRC),e&Uo.INDIRECT&&(t|=GPUBufferUsage.INDIRECT),t|GPUBufferUsage.COPY_DST}(o),l&&(a.usage=Uo.MAP_READ|Uo.COPY_DST);var u=!(0,E.Z)(s);(a.view=(0,E.Z)(s)?null:s,a.size=(0,E.Z)(s)?Ls(s,4):Ls(s.byteLength,4),(0,E.Z)(s))?a.gpuBuffer=a.device.device.createBuffer({usage:a.usage,size:a.size,mappedAtCreation:!!l&&u}):(a.gpuBuffer=a.device.device.createBuffer({usage:a.usage,size:a.size,mappedAtCreation:!0}),new(s&&s.constructor||Float32Array)(a.gpuBuffer.getMappedRange()).set(s),a.gpuBuffer.unmap());return a}return(0,ds.__extends)(t,e),t.prototype.setSubData=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=this.gpuBuffer;r=r||t.byteLength,r=Math.min(r,this.size-e);var a=t.byteOffset+n,o=a+r,s=r+3&-4;if(s!==r){var l=new Uint8Array(t.buffer.slice(a,o));(t=new Uint8Array(s)).set(l),n=0,a=0,o=s,r=s}for(var u=15728640,c=0;o-(a+c)>u;)this.device.device.queue.writeBuffer(i,e+c,t.buffer,a+c,u),c+=u;this.device.device.queue.writeBuffer(i,e+c,t.buffer,a+c,r-c)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()},t}(fc),gc=function(){function e(){this.gpuComputePassEncoder=null}return e.prototype.dispatchWorkgroups=function(e,t,n){this.gpuComputePassEncoder.dispatchWorkgroups(e,t,n)},e.prototype.dispatchWorkgroupsIndirect=function(e,t){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(e.gpuBuffer,t)},e.prototype.finish=function(){this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.frameCommandEncoder=null},e.prototype.beginComputePass=function(e){Ts(null===this.gpuComputePassEncoder),this.frameCommandEncoder=e,this.gpuComputePassEncoder=this.frameCommandEncoder.beginComputePass(this.gpuComputePassDescriptor)},e.prototype.setPipeline=function(e){var t=Ss(e.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(t)},e.prototype.setBindings=function(e){var t=this,n=e;n.gpuBindGroup.forEach((function(e,r){e&&t.gpuComputePassEncoder.setBindGroup(r,n.gpuBindGroup[r])}))},e.prototype.pushDebugGroup=function(e){this.gpuComputePassEncoder.pushDebugGroup(e)},e.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(e){this.gpuComputePassEncoder.insertDebugMarker(e)},e}(),mc=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=Co.ComputePipeline,a.gpuComputePipeline=null,a.descriptor=i;var o=i.program.computeStage;if(null===o)return a;var s={layout:"auto",compute:(0,ds.__assign)({},o)};return a.gpuComputePipeline=a.device.device.createComputePipeline(s),void 0!==a.name&&(a.gpuComputePipeline.label=a.name),a}return(0,ds.__extends)(t,e),t.prototype.getBindGroupLayout=function(e){return this.gpuComputePipeline.getBindGroupLayout(e)},t}(fc),yc=function(e){function t(t){var n,r,i,a,o=t.id,s=t.device,l=t.descriptor,u=e.call(this,{id:o,device:s})||this;u.type=Co.InputLayout;var c=[];try{for(var h=(0,ds.__values)(l.vertexBufferDescriptors),d=h.next();!d.done;d=h.next()){var f=d.value,v=f.arrayStride,p=f.stepMode,g=f.attributes;c.push({arrayStride:v,stepMode:uc(p),attributes:[]});try{for(var m=(i=void 0,(0,ds.__values)(g)),y=m.next();!y.done;y=m.next()){var E=y.value,_=E.shaderLocation,T=E.format,S=E.offset;c[c.length-1].attributes.push({shaderLocation:_,format:cc(T),offset:S})}}catch(e){i={error:e}}finally{try{y&&!y.done&&(a=m.return)&&a.call(m)}finally{if(i)throw i.error}}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}return u.indexFormat=function(e){if(null!==e){if(e===es.U16_R)return"uint16";if(e===es.U32_R)return"uint32";throw new Error("whoops")}}(l.indexBufferFormat),u.buffers=c,u}return(0,ds.__extends)(t,e),t}(fc),Ec=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;return a.type=Co.Program,a.vertexStage=null,a.fragmentStage=null,a.computeStage=null,a.descriptor=i,i.vertex&&(a.vertexStage=a.createShaderStage(i.vertex,"vertex")),i.fragment&&(a.fragmentStage=a.createShaderStage(i.fragment,"fragment")),i.compute&&(a.computeStage=a.createShaderStage(i.compute,"compute")),a}return(0,ds.__extends)(t,e),t.prototype.setUniformsLegacy=function(e){},t.prototype.createShaderStage=function(e,t){var n,r,i=e.glsl,a=e.wgsl,o=e.entryPoint,s=e.postprocess,l=a;if(!l)try{l=this.device.glsl_compile(i,t,!1)}catch(e){throw console.error(e,i),new Error("whoops")}var u=function(e){if(!l.includes(e))return"continue";l=(l=l.replace("var T_".concat(e,": texture_2d<f32>;"),"var T_".concat(e,": texture_depth_2d;"))).replace(new RegExp("textureSample\\(T_".concat(e,"(.*)\\);$"),"gm"),(function(t,n){return"vec4<f32>(textureSample(T_".concat(e).concat(n,"), 0.0, 0.0, 0.0);")}))};try{for(var c=(0,ds.__values)(["u_TextureFramebufferDepth"]),h=c.next();!h.done;h=c.next()){u(h.value)}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}return s&&(l=s(l)),{module:this.device.device.createShaderModule({code:l}),entryPoint:o||"main"}},t}(fc),_c=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=Co.QueryPool;var o=i.elemCount,s=i.type;return a.querySet=a.device.device.createQuerySet({type:$u(s),count:o}),a.resolveBuffer=a.device.device.createBuffer({size:8*o,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),a.cpuBuffer=a.device.device.createBuffer({size:8*o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),a.results=null,a}return(0,ds.__extends)(t,e),t.prototype.queryResultOcclusion=function(e){return null===this.results?null:this.results[e]!==BigInt(0)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},t}(fc),Tc=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this,{id:n,device:r})||this;return i.type=Co.Readback,i}return(0,ds.__extends)(t,e),t.prototype.readTexture=function(e,t,n,r,i,a,o,s){return void 0===o&&(o=0),(0,ds.__awaiter)(this,void 0,void 0,(function(){var s,l,u,c,h,d,f;return(0,ds.__generator)(this,(function(v){return 0,l=dc((s=e).gpuTextureformat),u=Math.ceil(r/l.width)*l.length,c=256*Math.ceil(u/256),h=c*i,d=this.device.createBuffer({usage:Uo.STORAGE|Uo.MAP_READ|Uo.COPY_DST,hint:Zo.STATIC,viewOrSize:h}),(f=this.device.device.createCommandEncoder()).copyTextureToBuffer({texture:s.gpuTexture,mipLevel:0,origin:{x:t,y:n,z:Math.max(0,0)}},{buffer:d.gpuBuffer,offset:0,bytesPerRow:c},{width:r,height:i,depthOrArrayLayers:1}),this.device.device.queue.submit([f.finish()]),[2,this.readBuffer(d,0,a.byteLength===h?a:null,o,h,s.format,!0,!1,u,c,i)]}))}))},t.prototype.readTextureSync=function(e,t,n,r,i,a,o,s){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},t.prototype.readBuffer=function(e,t,n,r,i,a,o,s,l,u,c){var h=this;void 0===t&&(t=0),void 0===n&&(n=null),void 0===i&&(i=0),void 0===a&&(a=es.U8_RGB),void 0===o&&(o=!1),void 0===l&&(l=0),void 0===u&&(u=0),void 0===c&&(c=0);var d=e,f=i||d.size,v=n||d.view,p=v&&v.constructor&&v.constructor.BYTES_PER_ELEMENT||Es(a),g=d;if(!(d.usage&Uo.MAP_READ&&d.usage&Uo.COPY_DST)){var m=this.device.device.createCommandEncoder();g=this.device.createBuffer({usage:Uo.STORAGE|Uo.MAP_READ|Uo.COPY_DST,hint:Zo.STATIC,viewOrSize:f}),m.copyBufferToBuffer(d.gpuBuffer,t,g.gpuBuffer,0,f),this.device.device.queue.submit([m.finish()])}return new Promise((function(e,n){g.gpuBuffer.mapAsync(Bu.READ,t,f).then((function(){var n=g.gpuBuffer.getMappedRange(t,f),r=v;if(o)r=null===r?hc(a,f,!0,n):hc(a,r.buffer,void 0,n);else if(null===r)switch(p){case 1:(r=new Uint8Array(f)).set(new Uint8Array(n));break;case 2:r=h.getHalfFloatAsFloatRGBAArrayBuffer(f/2,n);break;case 4:(r=new Float32Array(f/4)).set(new Float32Array(n))}else switch(p){case 1:(r=new Uint8Array(r.buffer)).set(new Uint8Array(n));break;case 2:r=h.getHalfFloatAsFloatRGBAArrayBuffer(f/2,n,v);break;case 4:var i=v&&v.constructor||Float32Array;(r=new i(r.buffer)).set(new i(n))}if(l!==u){1!==p||o||(l*=2,u*=2);for(var s=new Uint8Array(r.buffer),d=l,m=0,y=1;y<c;++y){m=y*u;for(var E=0;E<l;++E)s[d++]=s[m++]}r=0===p||o?new Uint8Array(s.buffer,0,d):new Float32Array(s.buffer,0,d/4)}g.gpuBuffer.unmap(),e(r)}),(function(e){return n(e)}))}))},t.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(e,t,n){n||(n=new Float32Array(e));for(var r,i,a,o,s=new Uint16Array(t);e--;)n[e]=(r=s[e],i=void 0,a=void 0,o=void 0,i=(32768&r)>>15,o=1023&r,0===(a=(31744&r)>>10)?(i?-1:1)*Math.pow(2,-14)*(o/Math.pow(2,10)):31==a?o?NaN:1/0*(i?-1:1):(i?-1:1)*Math.pow(2,a-15)*(1+o/Math.pow(2,10)));return n},t}(fc),Sc=function(){function e(e){this.device=e,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return e.prototype.getEncoder=function(){var e;return(null===(e=this.renderBundle)||void 0===e?void 0:e.renderBundleEncoder)||this.gpuRenderPassEncoder},e.prototype.getTextureView=function(e,t){return Ts(t<e.mipLevelCount),1===e.mipLevelCount?e.gpuTextureView:e.gpuTexture.createView({baseMipLevel:t,mipLevelCount:1})},e.prototype.setRenderPassDescriptor=function(e){var t,n,r,i,a,o;this.descriptor=e,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var s=e.colorAttachment.length;this.gfxColorAttachment.length=s,this.gfxColorResolveTo.length=s;for(var l=0;l<e.colorAttachment.length;l++){var u=e.colorAttachment[l],c=e.colorResolveTo[l];if(null===u&&null!==c&&(u=c,c=null),this.gfxColorAttachment[l]=u,this.gfxColorResolveTo[l]=c,this.gfxColorAttachmentLevel[l]=(null===(t=e.colorAttachmentLevel)||void 0===t?void 0:t[l])||0,this.gfxColorResolveToLevel[l]=(null===(n=e.colorResolveToLevel)||void 0===n?void 0:n[l])||0,null===u){this.gpuColorAttachments.length=l,this.gfxColorAttachment.length=l,this.gfxColorResolveTo.length=l;break}void 0===this.gpuColorAttachments[l]&&(this.gpuColorAttachments[l]={}),(d=this.gpuColorAttachments[l]).view=this.getTextureView(u,(null===(r=this.gfxColorAttachmentLevel)||void 0===r?void 0:r[l])||0);var h=null!==(a=null===(i=e.colorClearColor)||void 0===i?void 0:i[l])&&void 0!==a?a:"load";"load"===h?d.loadOp="load":(d.loadOp="clear",d.clearValue=h),d.storeOp=(null===(o=e.colorStore)||void 0===o?void 0:o[l])?"store":"discard",d.resolveTarget=void 0,null!==c&&(u.sampleCount>1?d.resolveTarget=this.getTextureView(c,this.gfxColorResolveToLevel[l]):d.storeOp="store")}if(this.gfxDepthStencilAttachment=e.depthStencilAttachment,this.gfxDepthStencilResolveTo=e.depthStencilResolveTo,e.depthStencilAttachment){var d,f=e.depthStencilAttachment;(d=this.gpuDepthStencilAttachment).view=f.gpuTextureView,!!(ms(f.format)&Jo.Depth)?("load"===e.depthClearValue?d.depthLoadOp="load":(d.depthLoadOp="clear",d.depthClearValue=e.depthClearValue),e.depthStencilStore||null!==this.gfxDepthStencilResolveTo?d.depthStoreOp="store":d.depthStoreOp="discard"):(d.depthLoadOp=void 0,d.depthStoreOp=void 0),!!(ms(f.format)&Jo.Stencil)?("load"===e.stencilClearValue?d.stencilLoadOp="load":(d.stencilLoadOp="clear",d.stencilClearValue=e.stencilClearValue),e.depthStencilStore||null!==this.gfxDepthStencilResolveTo?d.stencilStoreOp="store":d.stencilStoreOp="discard"):(d.stencilLoadOp=void 0,d.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=(0,T.Z)(e.occlusionQueryPool)?void 0:e.occlusionQueryPool.querySet},e.prototype.beginRenderPass=function(e,t){Ts(null===this.gpuRenderPassEncoder),this.setRenderPassDescriptor(t),this.frameCommandEncoder=e,this.gpuRenderPassEncoder=this.frameCommandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},e.prototype.flipY=function(e,t){return this.device.swapChainHeight-e-t},e.prototype.setViewport=function(e,t,n,r,i,a){void 0===i&&(i=0),void 0===a&&(a=1),this.gpuRenderPassEncoder.setViewport(e,this.flipY(t,r),n,r,i,a)},e.prototype.setScissorRect=function(e,t,n,r){this.gpuRenderPassEncoder.setScissorRect(e,this.flipY(t,r),n,r)},e.prototype.setPipeline=function(e){var t=Ss(e.gpuRenderPipeline);this.getEncoder().setPipeline(t)},e.prototype.setVertexInput=function(e,t,n){if(null!==e){var r=this.getEncoder(),i=e;null!==n&&r.setIndexBuffer(qu(n.buffer),Ss(i.indexFormat),n.offset);for(var a=0;a<t.length;a++){var o=t[a];null!==o&&r.setVertexBuffer(a,qu(o.buffer),o.offset)}}},e.prototype.setBindings=function(e){var t=e,n=this.getEncoder();t.gpuBindGroup.forEach((function(e,r){e&&n.setBindGroup(r,t.gpuBindGroup[r])}))},e.prototype.setStencilReference=function(e){this.gpuRenderPassEncoder.setStencilReference(e)},e.prototype.draw=function(e,t,n,r){this.getEncoder().draw(e,t,n,r)},e.prototype.drawIndexed=function(e,t,n,r,i){this.getEncoder().drawIndexed(e,t,n,r,i)},e.prototype.drawIndirect=function(e,t){this.getEncoder().drawIndirect(qu(e),t)},e.prototype.drawIndexedIndirect=function(e,t){this.getEncoder().drawIndexedIndirect(qu(e),t)},e.prototype.beginOcclusionQuery=function(e){this.gpuRenderPassEncoder.beginOcclusionQuery(e)},e.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},e.prototype.pushDebugGroup=function(e){this.gpuRenderPassEncoder.pushDebugGroup(e)},e.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(e){this.gpuRenderPassEncoder.insertDebugMarker(e)},e.prototype.beginBundle=function(e){this.renderBundle=e},e.prototype.endBundle=function(){this.renderBundle.finish()},e.prototype.executeBundles=function(e){this.gpuRenderPassEncoder.executeBundles(e.map((function(e){return e.renderBundle})))},e.prototype.finish=function(){var e;null===(e=this.gpuRenderPassEncoder)||void 0===e||e.end(),this.gpuRenderPassEncoder=null;for(var t=0;t<this.gfxColorAttachment.length;t++){var n=this.gfxColorAttachment[t],r=this.gfxColorResolveTo[t];null!==n&&null!==r&&1===n.sampleCount&&this.copyAttachment(r,this.gfxColorAttachmentLevel[t],n,this.gfxColorResolveToLevel[t])}this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.frameCommandEncoder=null},e.prototype.copyAttachment=function(e,t,n,r){Ts(1===n.sampleCount);var i={texture:n.gpuTexture,mipLevel:r},a={texture:e.gpuTexture,mipLevel:t};Ts(n.width>>>r==e.width>>>t),Ts(n.height>>>r==e.height>>>t),Ts(!!(n.usage&Du.COPY_SRC)),Ts(!!(e.usage&Du.COPY_DST)),this.frameCommandEncoder.copyTextureToTexture(i,a,[e.width,e.height,1])},e}(),Rc=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;return a.type=Co.RenderPipeline,a.isCreatingAsync=!1,a.gpuRenderPipeline=null,a.descriptor=i,a.device.createRenderPipelineInternal(a,!1),a}return(0,ds.__extends)(t,e),t.prototype.getBindGroupLayout=function(e){return this.gpuRenderPipeline.getBindGroupLayout(e)},t}(fc),Ac=function(e){function t(t){var n,r,i=t.id,a=t.device,o=t.descriptor,s=e.call(this,{id:i,device:a})||this;s.type=Co.Sampler;var l=o.lodMinClamp,u=o.mipmapFilter===Bo.NO_MIP?o.lodMinClamp:o.lodMaxClamp,c=null!==(n=o.maxAnisotropy)&&void 0!==n?n:1;return c>1&&Ts(o.minFilter===Do.BILINEAR&&o.magFilter===Do.BILINEAR&&o.mipmapFilter===Bo.LINEAR),s.gpuSampler=s.device.device.createSampler({addressModeU:Yu(o.addressModeU),addressModeV:Yu(o.addressModeV),addressModeW:Yu(null!==(r=o.addressModeW)&&void 0!==r?r:o.addressModeU),lodMinClamp:l,lodMaxClamp:u,minFilter:ju(o.minFilter),magFilter:ju(o.magFilter),mipmapFilter:Ku(o.mipmapFilter),compare:void 0!==o.compareFunction?sc(o.compareFunction):void 0,maxAnisotropy:c}),s}return(0,ds.__extends)(t,e),t}(fc),xc=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=t.skipCreate,o=t.sampleCount,s=e.call(this,{id:n,device:r})||this;s.type=Co.Texture,s.flipY=!1;var l=i.format,u=i.dimension,c=i.width,h=i.height,d=i.depthOrArrayLayers,f=i.mipLevelCount,v=i.usage,p=i.pixelStore;return s.flipY=!!(null==p?void 0:p.unpackFlipY),s.device.createTextureShared({format:l,dimension:null!=u?u:Wo.TEXTURE_2D,width:c,height:h,depthOrArrayLayers:null!=d?d:1,mipLevelCount:null!=f?f:1,usage:v,sampleCount:null!=o?o:1},s,a),s}return(0,ds.__extends)(t,e),t.prototype.textureFromImageBitmapOrCanvas=function(e,t,n){for(var r=t[0].width,i=t[0].height,a={size:{width:r,height:i,depthOrArrayLayers:n},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},o=e.createTexture(a),s=0;s<t.length;s++)e.queue.copyExternalImageToTexture({source:t[s],flipY:this.flipY},{texture:o,origin:[0,0,s]},[r,i]);return[o,r,i]},t.prototype.isImageBitmapOrCanvases=function(e){var t=e[0];return t instanceof ImageBitmap||t instanceof HTMLCanvasElement||t instanceof OffscreenCanvas},t.prototype.isVideo=function(e){return e[0]instanceof HTMLVideoElement},t.prototype.setImageData=function(e,t){var n,r,i,a,o=this,s=this.device.device;if(this.isImageBitmapOrCanvases(e))r=(n=(0,ds.__read)(this.textureFromImageBitmapOrCanvas(s,e,this.depthOrArrayLayers),3))[0],i=n[1],a=n[2];else if(this.isVideo(e))r=s.importExternalTexture({source:e[0]});else{var l=dc(this.gpuTextureformat),u=Math.ceil(this.width/l.width)*l.length;e.forEach((function(e){s.queue.writeTexture({texture:o.gpuTexture},e,{bytesPerRow:u},{width:o.width,height:o.height})}))}this.width=i,this.height=a,r&&(this.gpuTexture=r),this.gpuTextureView=this.gpuTexture.createView({dimension:zu(this.dimension)})},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()},t}(fc),kc=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this,{id:n,device:r})||this;return i.type=Co.RenderBundle,i.renderBundleEncoder=i.device.device.createRenderBundleEncoder({colorFormats:[i.device.swapChainFormat]}),i}return(0,ds.__extends)(t,e),t.prototype.finish=function(){this.renderBundle=this.renderBundleEncoder.finish()},t}(fc),Nc=function(){function e(e,t,n,r,i,a){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=Du.RENDER_ATTACHMENT|Du.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.frameCommandEncoderPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=jo.UPPER_LEFT,this.clipSpaceNearZ=Ko.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=t,this.canvas=n,this.canvasContext=r,this.glsl_compile=i,this.WGSLComposer=a,this.fallbackTexture2D=this.createFallbackTexture(Wo.TEXTURE_2D,Yo.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(Wo.TEXTURE_2D,Yo.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(Wo.TEXTURE_2D_ARRAY,Yo.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(Wo.TEXTURE_3D,Yo.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(Wo.TEXTURE_CUBE_MAP,Yo.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:Lo.REPEAT,addressModeV:Lo.REPEAT,minFilter:Do.POINT,magFilter:Do.POINT,mipmapFilter:Bo.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:Lo.REPEAT,addressModeV:Lo.REPEAT,minFilter:Do.POINT,magFilter:Do.POINT,mipmapFilter:Bo.NEAREST,compareFunction:bo.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(e){console.error(e.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return e.prototype.destroy=function(){},e.prototype.configureSwapChain=function(e,t){this.swapChainWidth===e&&this.swapChainHeight===t||(this.swapChainWidth=e,this.swapChainHeight=t)},e.prototype.getOnscreenTexture=function(){var e=this.canvasContext.getCurrentTexture(),t=e.createView(),n=new xc({id:0,device:this,descriptor:{format:es.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:Wo.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return n.depthOrArrayLayers=1,n.sampleCount=1,n.gpuTexture=e,n.gpuTextureView=t,n.name="Onscreen",this.setResourceName(n,"Onscreen Texture"),n},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.canvas},e.prototype.beginFrame=function(){Ts(0===this.frameCommandEncoderPool.length)},e.prototype.endFrame=function(){Ts(this.frameCommandEncoderPool.every((function(e){return null!==e}))),this.device.queue.submit(this.frameCommandEncoderPool.map((function(e){return e.finish()}))),this.frameCommandEncoderPool=[]},e.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},e.prototype.createBuffer=function(e){return new pc({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createTexture=function(e){return new xc({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createSampler=function(e){return new Ac({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTarget=function(e){var t=new xc({id:this.getNextUniqueId(),device:this,descriptor:(0,ds.__assign)((0,ds.__assign)({},e),{dimension:Wo.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:Ho.RENDER_TARGET}),sampleCount:e.sampleCount});return t.depthOrArrayLayers=1,t.type=Co.RenderTarget,t},e.prototype.createRenderTargetFromTexture=function(e){var t=e,n=t.format,r=t.width,i=t.height,a=t.depthOrArrayLayers,o=t.sampleCount,s=t.mipLevelCount,l=t.gpuTexture,u=t.gpuTextureView,c=t.usage;Ts(!!(c&Du.RENDER_ATTACHMENT));var h=new xc({id:this.getNextUniqueId(),device:this,descriptor:{format:n,width:r,height:i,depthOrArrayLayers:a,dimension:Wo.TEXTURE_2D,mipLevelCount:s,usage:c},skipCreate:!0});return h.depthOrArrayLayers=a,h.sampleCount=o,h.gpuTexture=l,h.gpuTextureView=u,h},e.prototype.createProgram=function(e){var t,n;return(null===(t=e.vertex)||void 0===t?void 0:t.glsl)&&(e.vertex.glsl=Fl(this.queryVendorInfo(),"vert",e.vertex.glsl)),(null===(n=e.fragment)||void 0===n?void 0:n.glsl)&&(e.fragment.glsl=Fl(this.queryVendorInfo(),"frag",e.fragment.glsl)),new Ec({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createProgramSimple=function(e){return new Ec({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createTextureShared=function(e,t,n){var r={width:e.width,height:e.height,depthOrArrayLayers:e.depthOrArrayLayers},i=e.mipLevelCount,a=Xu(e.format),o=function(e){if(e===Wo.TEXTURE_2D)return"2d";if(e===Wo.TEXTURE_CUBE_MAP)return"2d";if(e===Wo.TEXTURE_2D_ARRAY)return"2d";if(e===Wo.TEXTURE_3D)return"3d";throw new Error("whoops")}(e.dimension),s=function(e){var t=0;return e&Ho.SAMPLED&&(t|=Du.TEXTURE_BINDING|Du.COPY_DST|Du.COPY_SRC),e&Ho.STORAGE&&(t|=Du.TEXTURE_BINDING|Du.STORAGE_BINDING|Du.COPY_SRC|Du.COPY_DST),e&Ho.RENDER_TARGET&&(t|=Du.RENDER_ATTACHMENT|Du.TEXTURE_BINDING|Du.COPY_SRC|Du.COPY_DST),t}(e.usage);if(t.gpuTextureformat=a,t.dimension=e.dimension,t.format=e.format,t.width=e.width,t.height=e.height,t.depthOrArrayLayers=e.depthOrArrayLayers,t.mipLevelCount=i,t.usage=s,t.sampleCount=e.sampleCount,!n){var l=this.device.createTexture({size:r,mipLevelCount:i,format:a,dimension:o,sampleCount:e.sampleCount,usage:s}),u=l.createView();t.gpuTexture=l,t.gpuTextureView=u}},e.prototype.getFallbackSampler=function(e){return e.formatKind===Yo.Depth&&e.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},e.prototype.getFallbackTexture=function(e){var t=e.dimension,n=e.formatKind;if(t===Wo.TEXTURE_2D)return n===Yo.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===Wo.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===Wo.TEXTURE_3D)return this.fallbackTexture3D;if(t===Wo.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.createFallbackTexture=function(e,t){var n=e===Wo.TEXTURE_CUBE_MAP?6:1,r=t===Yo.Float?es.U8_RGBA_NORM:es.D24;return this.createTexture({dimension:e,format:r,usage:Ho.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1})},e.prototype.createBindings=function(e){return new vc({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createInputLayout=function(e){return new yc({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createComputePipeline=function(e){return new mc({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderPipeline=function(e){return new Rc({id:this.getNextUniqueId(),device:this,descriptor:(0,ds.__assign)({},e)})},e.prototype.createQueryPool=function(e,t){return new _c({id:this.getNextUniqueId(),device:this,descriptor:{type:e,elemCount:t}})},e.prototype.createRenderPipelineInternal=function(e,t){var n;if(null===e.gpuRenderPipeline){var r=e.descriptor,i=r.program,a=i.vertexStage,o=i.fragmentStage;if(null!==a&&null!==o){var s=r.megaStateDescriptor||{},l=s.stencilBack,u=s.stencilFront,c=(0,ds.__rest)(s,["stencilBack","stencilFront"]),h=Hs(zs);r.megaStateDescriptor=(0,ds.__assign)((0,ds.__assign)((0,ds.__assign)({},h),{stencilBack:(0,ds.__assign)((0,ds.__assign)({},h.stencilBack),l),stencilFront:(0,ds.__assign)((0,ds.__assign)({},h.stencilFront),u)}),c);var d=r.megaStateDescriptor.attachmentsState[0];r.colorAttachmentFormats.forEach((function(e,t){r.megaStateDescriptor.attachmentsState[t]||(r.megaStateDescriptor.attachmentsState[t]=Gs(void 0,d))}));var f,v,p=(f=null!==(n=r.topology)&&void 0!==n?n:Fo.TRIANGLES,v=r.megaStateDescriptor,{topology:Qu(f),cullMode:Ju(v.cullMode),frontFace:ec(v.frontFace)}),g=oc(r.colorAttachmentFormats,r.megaStateDescriptor),m=function(e,t){if(!(0,T.Z)(e))return{format:Xu(e),depthWriteEnabled:!!t.depthWrite,depthCompare:sc(t.depthCompare),depthBias:t.polygonOffset?t.polygonOffsetUnits:0,depthBiasSlopeScale:t.polygonOffset?t.polygonOffsetFactor:0,stencilFront:{compare:sc(t.stencilFront.compare),passOp:lc(t.stencilFront.passOp),failOp:lc(t.stencilFront.failOp),depthFailOp:lc(t.stencilFront.depthFailOp)},stencilBack:{compare:sc(t.stencilBack.compare),passOp:lc(t.stencilBack.passOp),failOp:lc(t.stencilBack.failOp),depthFailOp:lc(t.stencilBack.depthFailOp)},stencilReadMask:4294967295,stencilWriteMask:4294967295}}(r.depthStencilAttachmentFormat,r.megaStateDescriptor),y=void 0;null!==r.inputLayout&&(y=r.inputLayout.buffers);var E=r.sampleCount,_={layout:"auto",vertex:(0,ds.__assign)((0,ds.__assign)({},a),{buffers:y}),primitive:p,depthStencil:m,multisample:{count:E},fragment:(0,ds.__assign)((0,ds.__assign)({},o),{targets:g})};e.gpuRenderPipeline=this.device.createRenderPipeline(_)}}},e.prototype.createReadback=function(){return new Tc({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderBundle=function(){return new kc({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderPass=function(e){var t=this.renderPassPool.pop();void 0===t&&(t=new Sc(this));var n=this.frameCommandEncoderPool.pop();return void 0===n&&(n=this.device.createCommandEncoder()),t.beginRenderPass(n,e),t},e.prototype.createComputePass=function(){var e=this.computePassPool.pop();void 0===e&&(e=new gc);var t=this.frameCommandEncoderPool.pop();return void 0===t&&(t=this.device.createCommandEncoder()),e.beginComputePass(t),e},e.prototype.submitPass=function(e){var t=e;t instanceof Sc?(this.frameCommandEncoderPool.push(t.frameCommandEncoder),t.finish(),this.renderPassPool.push(t)):t instanceof gc&&(this.frameCommandEncoderPool.push(t.frameCommandEncoder),t.finish(),this.computePassPool.push(t))},e.prototype.copySubTexture2D=function(e,t,n,r,i,a,o){var s=this.device.createCommandEncoder(),l=e,u=r,c={texture:u.gpuTexture,origin:[i,a,0],mipLevel:0,aspect:"all"},h={texture:l.gpuTexture,origin:[t,n,0],mipLevel:0,aspect:"all"};Ts(!!(u.usage&Du.COPY_SRC)),Ts(!!(l.usage&Du.COPY_DST)),s.copyTextureToTexture(c,h,[u.width,u.height,o||1]),this.device.queue.submit([s.finish()])},e.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},e.prototype.queryTextureFormatSupported=function(e,t,n){if(function(e){switch(gs(e)){case $o.BC1:case $o.BC2:case $o.BC3:case $o.BC4_SNORM:case $o.BC4_UNORM:case $o.BC5_SNORM:case $o.BC5_UNORM:return!0;default:return!1}}(e)){if(!this.featureTextureCompressionBC)return!1;var r=function(e){switch(gs(e)){case $o.BC1:case $o.BC2:case $o.BC3:case $o.BC4_SNORM:case $o.BC4_UNORM:case $o.BC5_SNORM:case $o.BC5_UNORM:return 4;default:return 1}}(e);return t%r==0&&n%r==0&&this.featureTextureCompressionBC}switch(e){case es.U16_RGBA_NORM:case es.F32_RGBA:return!1}return!0},e.prototype.queryPlatformAvailable=function(){return!0},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(e){return e.descriptor},e.prototype.queryRenderTarget=function(e){return e},e.prototype.setResourceName=function(e,t){if(e.name=t,e.type===Co.Buffer)(n=e).gpuBuffer.label=t;else if(e.type===Co.Texture){(n=e).gpuTexture.label=t,n.gpuTextureView.label=t}else if(e.type===Co.RenderTarget){(n=e).gpuTexture.label=t,n.gpuTextureView.label=t}else if(e.type===Co.Sampler){(n=e).gpuSampler.label=t}else if(e.type===Co.RenderPipeline){var n;null!==(n=e).gpuRenderPipeline&&(n.gpuRenderPipeline.label=t)}},e.prototype.setResourceLeakCheck=function(e,t){},e.prototype.checkForLeaks=function(){},e.prototype.programPatched=function(e){},e.prototype.pipelineQueryReady=function(e){return null!==e.gpuRenderPipeline},e.prototype.pipelineForceReady=function(e){var t=e;this.createRenderPipelineInternal(t,!1)},e}(),Mc=(function(){function e(e){this.pluginOptions=e}e.prototype.createSwapChain=function(e){return(0,ds.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,a,o,s;return(0,ds.__generator)(this,(function(l){switch(l.label){case 0:if(void 0===globalThis.navigator.gpu)return[2,null];t=null,l.label=1;case 1:return l.trys.push([1,3,,4]),n=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:n})];case 2:return t=l.sent(),[3,4];case 3:return r=l.sent(),console.log(r),[3,4];case 4:return null===t?[2,null]:(i=["depth32float-stencil8","texture-compression-bc","float32-filterable"].filter((function(e){return t.features.has(e)})),[4,t.requestDevice({requiredFeatures:i})]);case 5:if((a=l.sent())&&(o=this.pluginOptions.onContextLost,a.lost.then((function(){o&&o()}))),null===a)return[2,null];if(!(s=e.getContext("webgpu")))return[2,null];l.label=6;case 6:return l.trys.push([6,8,,9]),[4,Wu(this.pluginOptions.shaderCompilerPath)];case 7:case 8:return l.sent(),[3,9];case 9:return[2,new Nc(t,a,e,s,Lu,Fu&&new Fu)]}}))}))}}(),n(67120)),Cc=n(20539),bc=n.n(Cc),Pc=(0,a.Z)((function e(){(0,o.Z)(this,e),this.drawcalls=[]}));Pc.tag="c-renderable-3d";var Oc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.lights=[]}),[{key:"addLight",value:function(e){this.lights.push(e),this.sortLights()}},{key:"removeLight",value:function(e){var t=this.lights.indexOf(e);this.lights.splice(t,1),this.sortLights()}},{key:"addFog",value:function(e){this.fog=e}},{key:"removeFog",value:function(e){this.fog=null}},{key:"getFog",value:function(){return this.fog}},{key:"getAllLights",value:function(){return this.lights}},{key:"getDefines",value:function(){var e={USE_LIGHT:!!this.lights.length};return this.lights.forEach((function(t){e[t.define]||(e[t.define]=0),e[t.define]++})),e}},{key:"sortLights",value:function(){this.lights.sort((function(e,t){return e.order-t.order}))}}])}(),Ic=["style"],wc=function(e){function t(e){var n,r=e.style,i=(0,ce.Z)(e,Ic);return(0,o.Z)(this,t),(n=(0,s.Z)(this,t,[(0,u.Z)({type:he.MESH,style:(0,u.Z)({x:"",y:"",z:"",lineWidth:0},r)},i)])).cullable.enable=!1,n.style.geometry.meshes.push(n),n.style.material.meshes.push(n),n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"destroy",value:function(){(0,W.Z)(t,"destroy",this,3)([]);var e=this.style.geometry.meshes,n=e.indexOf(this);e.splice(n,1),n=(e=this.style.material.meshes).indexOf(this),e.splice(n,1)}}])}(Va);wc.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Va.PARSED_STYLE_LIST),["x","y","z","geometry","material"]));var Lc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e){var t=e.x,n=void 0===t?0:t,r=e.y,i=void 0===r?0:r,a=e.z,o=void 0===a?0:a,s=e.geometry.computeBoundingBox();return{cx:n,cy:i,cz:o,hwidth:s.halfExtents[0],hheight:s.halfExtents[1],hdepth:s.halfExtents[2]}}}])}(),Dc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.counter=0,this.id2DisplayObjectMap={}}),[{key:"getId",value:function(e){var t=this.counter++;return this.id2DisplayObjectMap[t]=e,t}},{key:"getById",value:function(e){return this.id2DisplayObjectMap[e]}},{key:"deleteById",value:function(e){delete this.id2DisplayObjectMap[e]}},{key:"reset",value:function(){this.counter=0,this.id2DisplayObjectMap={}}},{key:"decodePickingColor",value:function(e){var t=(0,h.Z)(e,3);return t[0]+256*t[1]+65536*t[2]-1}},{key:"encodePickingColor",value:function(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}}])}(),Bc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.name="(unnamed)",this.preprocessedVert="",this.preprocessedFrag="",this.both="",this.vert="",this.frag="",this.defines={}}),[{key:"definesChanged",value:function(){this.preprocessedVert="",this.preprocessedFrag=""}},{key:"setDefineString",value:function(e,t){if(null!==t){if(this.defines[e]===t)return!1;this.defines[e]=t}else{if((0,T.Z)(this.defines[e]))return!1;delete this.defines[e]}return this.definesChanged(),!0}},{key:"setDefineBool",value:function(e,t){return this.setDefineString(e,t?"1":null)}},{key:"getDefineString",value:function(e){return Is(this.defines[e])}},{key:"getDefineBool",value:function(e){var t=this.getDefineString(e);return null!==t&&Ts("1"===t),null!==t}}])}(),Fc=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.currentBufferWordSize=-1,this.currentWordOffset=0,this.buffer=null,this.shadowBufferF32=null,this.shadowBufferU8=null,this.device=t;var n=t.queryLimits();this.uniformBufferWordAlignment=n.uniformBufferWordAlignment,this.uniformBufferMaxPageWordSize=n.uniformBufferMaxPageWordSize}),[{key:"isSupportedUBO",value:function(){return"WebGL1"!==this.device.queryVendorInfo().platformString}},{key:"findPageIndex",value:function(e){return e/this.uniformBufferMaxPageWordSize|0}},{key:"allocateChunk",value:function(e){Ts((e=Ds(e,this.uniformBufferWordAlignment))<this.uniformBufferMaxPageWordSize);var t=this.currentWordOffset;return this.findPageIndex(t)!==this.findPageIndex(t+e-1)&&(t=Ds(t,this.uniformBufferMaxPageWordSize)),this.currentWordOffset=t+e,this.ensureShadowBuffer(t,e),t}},{key:"ensureShadowBuffer",value:function(e,t){if(null===this.shadowBufferU8||null===this.shadowBufferF32){var n=Ds(this.currentWordOffset,this.uniformBufferMaxPageWordSize);this.shadowBufferU8=new Uint8Array(4*n),this.shadowBufferF32=new Float32Array(this.shadowBufferU8.buffer)}else if(e+t>=this.shadowBufferF32.length){Ts(e<this.currentWordOffset&&e+t<=this.currentWordOffset);var r=Ds(Math.max(this.currentWordOffset,2*this.shadowBufferF32.length),this.uniformBufferMaxPageWordSize),i=new Uint8Array(4*r);if(i.set(this.shadowBufferU8,0),this.shadowBufferU8=i,this.shadowBufferF32=new Float32Array(this.shadowBufferU8.buffer),!(this.currentWordOffset<=r))throw new Error("Assert fail: this.currentWordOffset [".concat(this.currentWordOffset,"] <= newWordCount [").concat(r,"]"))}}},{key:"mapBufferF32",value:function(){return Ss(this.shadowBufferF32)}},{key:"prepareToRender",value:function(){if(null!==this.shadowBufferF32){var e=Ss(this.shadowBufferF32);e.length!==this.currentBufferWordSize&&(this.currentBufferWordSize=e.length,null!==this.buffer&&this.buffer.destroy(),this.buffer=this.device.createBuffer({viewOrSize:4*this.currentBufferWordSize,usage:Uo.UNIFORM,hint:Zo.DYNAMIC}));var t=Ds(this.currentWordOffset,this.uniformBufferMaxPageWordSize);if(!(t<=this.currentBufferWordSize))throw new Error("Assert fail: wordCount [".concat(t,"] (").concat(this.currentWordOffset," aligned ").concat(this.uniformBufferMaxPageWordSize,") <= this.currentBufferWordSize [").concat(this.currentBufferWordSize,"]"));if(this.isSupportedUBO())Ss(this.buffer).setSubData(0,this.shadowBufferU8,0,4*t);this.currentWordOffset=0}}},{key:"destroy",value:function(){null!==this.buffer&&this.buffer.destroy(),this.shadowBufferF32=null,this.shadowBufferU8=null}}])}();function Uc(e,t){return e+=t,e+=e<<10,(e+=e>>>6)>>>0}function Zc(e){return e+=e<<3,e^=e>>>11,(e+=e<<15)>>>0}function Gc(e){return 0}var Vc=(0,a.Z)((function e(){(0,o.Z)(this,e),this.keys=[],this.values=[]})),Wc=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e),this.buckets=new Map,this.keyEqualFunc=t,this.keyHashFunc=n}),[{key:"findBucketIndex",value:function(e,t){for(var n=0;n<e.keys.length;n++)if(this.keyEqualFunc(t,e.keys[n]))return n;return-1}},{key:"findBucket",value:function(e){var t=this.keyHashFunc(e);return this.buckets.get(t)}},{key:"get",value:function(e){var t=this.findBucket(e);if(void 0===t)return null;var n=this.findBucketIndex(t,e);return n<0?null:t.values[n]}},{key:"add",value:function(e,t){var n=this.keyHashFunc(e);void 0===this.buckets.get(n)&&this.buckets.set(n,new Vc);var r=this.buckets.get(n);r.keys.push(e),r.values.push(t)}},{key:"delete",value:function(e){var t=this.findBucket(e);if(void 0!==t){var n=this.findBucketIndex(t,e);-1!==n&&(t.keys.splice(n,1),t.values.splice(n,1))}}},{key:"clear",value:function(){this.buckets.clear()}},{key:"size",value:function(){var e,t=0,n=(0,ue.Z)(this.buckets.values());try{for(n.s();!(e=n.n()).done;){t+=e.value.values.length}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"values",value:(0,se.Z)().mark((function e(){var t,n,r,i,a;return(0,se.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=(0,ue.Z)(this.buckets.values()),e.prev=1,t.s();case 2:if((n=t.n()).done){e.next=6;break}r=n.value,i=r.values.length-1;case 3:if(!(i>=0)){e.next=5;break}return e.next=4,r.values[i];case 4:i--,e.next=3;break;case 5:e.next=2;break;case 6:e.next=8;break;case 7:e.prev=7,a=e.catch(1),t.e(a);case 8:return e.prev=8,t.f(),e.finish(8);case 9:case"end":return e.stop()}}),e,this,[[1,7,8,9]])}))}])}();function Hc(e,t){var n=void 0!==t.defines?t.defines:null,r=void 0!==t.both?t.both+t.vert:t.vert,i=void 0!==t.both?t.both+t.frag:t.frag;return function(e,t,n,r){return void 0===r&&(r=null),{vert:t,frag:n,preprocessedVert:Fl(e,"vert",t,r),preprocessedFrag:Fl(e,"frag",n,r)}}(e.queryVendorInfo(),r,i,n)}function Xc(e,t){return Ts(""!==e.preprocessedVert&&""!==t.preprocessedVert),Ts(""!==e.preprocessedFrag&&""!==t.preprocessedFrag),e.preprocessedVert===t.preprocessedVert&&e.preprocessedFrag===t.preprocessedFrag}function zc(e,t){return e=Uc(e,t.blendMode),e=Uc(e,t.blendSrcFactor),e=Uc(e,t.blendDstFactor)}function Yc(e,t){return e=zc(e,t.rgbBlendState),e=Uc(e=zc(e,t.alphaBlendState),t.channelWriteMask)}function jc(e,t){for(var n,r,i,a,o,s,l,u,c=0;c<t.attachmentsState.length;c++)e=Yc(e,t.attachmentsState[c]);return e=function(e,t){return Uc(e,t.r<<24|t.g<<16|t.b<<8|t.a)}(e,t.blendConstant),e=Uc(e,t.depthCompare),e=Uc(e,t.depthWrite?1:0),e=Uc(e,null===(n=t.stencilFront)||void 0===n?void 0:n.compare),e=Uc(e,null===(r=t.stencilFront)||void 0===r?void 0:r.passOp),e=Uc(e,null===(i=t.stencilFront)||void 0===i?void 0:i.failOp),e=Uc(e,null===(a=t.stencilFront)||void 0===a?void 0:a.depthFailOp),e=Uc(e,null===(o=t.stencilBack)||void 0===o?void 0:o.compare),e=Uc(e,null===(s=t.stencilBack)||void 0===s?void 0:s.passOp),e=Uc(e,null===(l=t.stencilBack)||void 0===l?void 0:l.failOp),e=Uc(e,null===(u=t.stencilBack)||void 0===u?void 0:u.depthFailOp),e=Uc(e,t.stencilWrite?1:0),e=Uc(e,t.cullMode),e=Uc(e,t.frontFace?1:0),e=Uc(e,t.polygonOffset?1:0)}function Kc(e){var t=0;t=Uc(t,e.program.id),null!==e.inputLayout&&(t=Uc(t,e.inputLayout.id)),t=jc(t,e.megaStateDescriptor);for(var n=0;n<e.colorAttachmentFormats.length;n++)t=Uc(t,e.colorAttachmentFormats[n]||0);return Zc(t=Uc(t,e.depthStencilAttachmentFormat||0))}function qc(e){for(var t=0,n=0;n<e.samplerBindings.length;n++){var r=e.samplerBindings[n];null!==r&&null!==r.texture&&(t=Uc(t,r.texture.id))}for(var i=0;i<e.uniformBufferBindings.length;i++){var a=e.uniformBufferBindings[i];null!==a&&null!==a.buffer&&(t=Uc(t,a.buffer.id),t=Uc(t,a.binding),t=Uc(t,a.offset),t=Uc(t,a.size))}return Zc(t)}var $c=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.bindingsCache=new Wc(nl,qc),this.renderPipelinesCache=new Wc(ll,Kc),this.inputLayoutsCache=new Wc(hl,Gc),this.programCache=new Wc(Xc,Gc),this.samplerCache=new Wc(dl,Gc),this.device=t}),[{key:"createBindings",value:function(e){var t,n=this.bindingsCache.get(e);if(null===n){var r={samplerBindings:(t=e).samplerBindings&&Qs(t.samplerBindings,fl),uniformBufferBindings:t.uniformBufferBindings&&Qs(t.uniformBufferBindings,vl),storageBufferBindings:t.storageBufferBindings&&Qs(t.storageBufferBindings,vl),storageTextureBindings:t.storageTextureBindings&&Qs(t.storageTextureBindings,pl),pipeline:t.pipeline};r.uniformBufferBindings=r.uniformBufferBindings.filter((function(e){return e.size>0})),n=this.device.createBindings(r),this.bindingsCache.add(r,n)}return n}},{key:"createRenderPipeline",value:function(e){var t=this.renderPipelinesCache.get(e);if(null===t){var n=function(e){var t=e.inputLayout,n=e.program,r=e.topology;return{inputLayout:t,megaStateDescriptor:e.megaStateDescriptor&&Hs(e.megaStateDescriptor),program:n,topology:r,colorAttachmentFormats:e.colorAttachmentFormats.slice(),depthStencilAttachmentFormat:e.depthStencilAttachmentFormat,sampleCount:e.sampleCount}}(e);t=this.device.createRenderPipeline((0,u.Z)((0,u.Z)({},n),{},{colorAttachmentFormats:e.colorAttachmentFormats.filter((function(e){return e}))})),this.renderPipelinesCache.add(n,t)}return t}},{key:"createInputLayout",value:function(e){e.vertexBufferDescriptors=e.vertexBufferDescriptors.filter((function(e){return!!e}));var t,n=this.inputLayoutsCache.get(e);if(null===n){var r={vertexBufferDescriptors:Qs((t=e).vertexBufferDescriptors,ml),indexBufferFormat:t.indexBufferFormat,program:t.program};n=this.device.createInputLayout(r),this.inputLayoutsCache.add(r,n)}return n}},{key:"createProgramSimple",value:function(e){var t,n=e.vert,r=e.frag,i=e.preprocessedFrag,a=e.preprocessedVert,o=null;if(a&&i&&(o=this.programCache.get({vert:n,frag:r,preprocessedFrag:i,preprocessedVert:a})),null===o){var s=Hc(this.device,e),l=s.preprocessedVert,u=s.preprocessedFrag;e.preprocessedVert=l,e.preprocessedFrag=u;var c={preprocessedVert:(t=e).preprocessedVert,preprocessedFrag:t.preprocessedFrag,vert:t.vert,frag:t.frag};o=this.device.createProgramSimple({vertex:{glsl:l},fragment:{glsl:u}},n),this.programCache.add(c,o)}return o}},{key:"createSampler",value:function(e){var t=this.samplerCache.get(e);return null===t&&(t=this.device.createSampler(e),this.samplerCache.add(e,t)),t}},{key:"destroy",value:function(){var e,t=(0,ue.Z)(this.bindingsCache.values());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(e){t.e(e)}finally{t.f()}var n,r=(0,ue.Z)(this.renderPipelinesCache.values());try{for(r.s();!(n=r.n()).done;){n.value.destroy()}}catch(e){r.e(e)}finally{r.f()}var i,a=(0,ue.Z)(this.inputLayoutsCache.values());try{for(a.s();!(i=a.n()).done;){i.value.destroy()}}catch(e){a.e(e)}finally{a.f()}var o,s=(0,ue.Z)(this.programCache.values());try{for(s.s();!(o=s.n()).done;){o.value.destroy()}}catch(e){s.e(e)}finally{s.f()}var l,u=(0,ue.Z)(this.samplerCache.values());try{for(u.s();!(l=u.n()).done;){l.value.destroy()}}catch(e){u.e(e)}finally{u.f()}this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear(),this.samplerCache.clear()}}])}(),Qc=function(e){return e.NONE="none",e.LINEAR="LinearToneMapping",e.REINHARD="ReinhardToneMapping",e.CINEON="OptimizedCineonToneMapping",e.ACES_FILMIC="ACESFilmicToneMapping",e.CUSTOM="CustomToneMapping",e}({}),Jc=function(e){return e[e.Color0=0]="Color0",e[e.Color1=1]="Color1",e[e.Color2=2]="Color2",e[e.Color3=3]="Color3",e[e.ColorMax=3]="ColorMax",e[e.DepthStencil=4]="DepthStencil",e}({}),eh=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.renderTargetIDs=[],this.renderTargetLevels=[],this.resolveTextureOutputIDs=[],this.resolveTextureOutputExternalTextures=[],this.resolveTextureOutputExternalTextureLevel=[],this.resolveTextureInputIDs=[],this.renderTargetExtraRefs=[],this.resolveTextureInputTextures=[],this.renderTargets=[],this.descriptor={colorAttachment:[],colorAttachmentLevel:[],colorResolveTo:[],colorResolveToLevel:[],colorStore:[],depthStencilAttachment:null,depthStencilResolveTo:null,depthStencilStore:!0,colorClearColor:["load"],depthClearValue:"load",stencilClearValue:"load",occlusionQueryPool:null},this.viewportX=0,this.viewportY=0,this.viewportW=1,this.viewportH=1,this.execFunc=null,this.postFunc=null,this.debugThumbnails=[]}),[{key:"setDebugName",value:function(e){this.debugName=e}},{key:"pushDebugThumbnail",value:function(e){this.debugThumbnails[e]=!0}},{key:"setViewport",value:function(e,t,n,r){this.viewportX=e,this.viewportY=t,this.viewportW=n,this.viewportH=r}},{key:"attachRenderTargetID",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Ts(void 0===this.renderTargetIDs[e]),this.renderTargetIDs[e]=t,this.renderTargetLevels[e]=n}},{key:"attachResolveTexture",value:function(e){this.resolveTextureInputIDs.push(e)}},{key:"attachOcclusionQueryPool",value:function(e){this.descriptor.occlusionQueryPool=e}},{key:"exec",value:function(e){Ts(null===this.execFunc),this.execFunc=e}},{key:"post",value:function(e){Ts(null===this.postFunc),this.postFunc=e}},{key:"addExtraRef",value:function(e){this.renderTargetExtraRefs[e]=!0}}])}(),th=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e),this.dimension=Wo.TEXTURE_2D,this.depthOrArrayLayers=1,this.mipLevelCount=1,this.width=0,this.height=0,this.sampleCount=0,this.usage=Ho.RENDER_TARGET,this.needsClear=!0,this.texture=null,this.age=0,this.format=n.format,this.width=n.width,this.height=n.height,this.sampleCount=n.sampleCount,Ts(this.sampleCount>=1),this.sampleCount>1?this.attachment=t.createRenderTarget(this):(this.texture=t.createTexture(this),this.attachment=t.createRenderTargetFromTexture(this.texture))}),[{key:"setDebugName",value:function(e,t){this.debugName=t,null!==this.texture&&e.setResourceName(this.texture,this.debugName),e.setResourceName(this.attachment,this.debugName)}},{key:"matchesDescription",value:function(e){return this.format===e.format&&this.width===e.width&&this.height===e.height&&this.sampleCount===e.sampleCount}},{key:"reset",value:function(e){Ts(this.matchesDescription(e)),this.age=0}},{key:"destroy",value:function(){this.attachment.destroy()}}])}(),nh=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e),this.dimension=Wo.TEXTURE_2D,this.depthOrArrayLayers=1,this.mipLevelCount=1,this.usage=Ho.RENDER_TARGET,this.width=0,this.height=0,this.age=0,this.format=n.format,this.width=n.width,this.height=n.height,this.texture=t.createTexture(this)}),[{key:"matchesDescription",value:function(e){return this.format===e.format&&this.width===e.width&&this.height===e.height}},{key:"reset",value:function(e){Ts(this.matchesDescription(e)),this.age=0}},{key:"destroy",value:function(){this.texture.destroy()}}])}(),rh=(0,a.Z)((function e(){(0,o.Z)(this,e),this.renderTargetDescriptions=[],this.resolveTextureRenderTargetIDs=[],this.passes=[],this.renderTargetDebugNames=[]})),ih=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.currentPass=null,this.renderTargetDeadPool=[],this.singleSampledTextureDeadPool=[],this.currentGraph=null,this.renderTargetOutputCount=[],this.renderTargetResolveCount=[],this.resolveTextureUseCount=[],this.renderTargetAliveForID=[],this.singleSampledTextureForResolveTextureID=[],this.device=t}),[{key:"acquireRenderTargetForDescription",value:function(e){for(var t=0;t<this.renderTargetDeadPool.length;t++){var n=this.renderTargetDeadPool[t];if(n.matchesDescription(e))return n.reset(e),this.renderTargetDeadPool.splice(t--,1),n}return new th(this.device,e)}},{key:"acquireSingleSampledTextureForDescription",value:function(e){for(var t=0;t<this.singleSampledTextureDeadPool.length;t++){var n=this.singleSampledTextureDeadPool[t];if(n.matchesDescription(e))return n.reset(e),this.singleSampledTextureDeadPool.splice(t--,1),n}return new nh(this.device,e)}},{key:"beginGraphBuilder",value:function(){Ts(null===this.currentGraph),this.currentGraph=new rh}},{key:"pushPass",value:function(e){var t=new eh;e(t),this.currentGraph.passes.push(t)}},{key:"createRenderTargetID",value:function(e,t){return this.currentGraph.renderTargetDebugNames.push(t),this.currentGraph.renderTargetDescriptions.push(e)-1}},{key:"createResolveTextureID",value:function(e){return this.currentGraph.resolveTextureRenderTargetIDs.push(e)-1}},{key:"findMostRecentPassThatAttachedRenderTarget",value:function(e){for(var t=this.currentGraph.passes.length-1;t>=0;t--){var n=this.currentGraph.passes[t];if(n.renderTargetIDs.includes(e))return n}return null}},{key:"resolveRenderTargetPassAttachmentSlot",value:function(e,t){var n=e;if(void 0===n.resolveTextureOutputIDs[t]){var r=n.renderTargetIDs[t],i=this.createResolveTextureID(r);n.resolveTextureOutputIDs[t]=i}return n.resolveTextureOutputIDs[t]}},{key:"findPassForResolveRenderTarget",value:function(e){var t=Ss(this.findMostRecentPassThatAttachedRenderTarget(e)),n=t.renderTargetIDs.indexOf(e);return Ts(void 0===t.resolveTextureOutputExternalTextures[n]),t}},{key:"resolveRenderTarget",value:function(e){var t=this.findPassForResolveRenderTarget(e),n=t.renderTargetIDs.indexOf(e);return this.resolveRenderTargetPassAttachmentSlot(t,n)}},{key:"resolveRenderTargetToExternalTexture",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.findPassForResolveRenderTarget(e),i=r.renderTargetIDs.indexOf(e);Ts(void 0===r.resolveTextureOutputIDs[i]),r.resolveTextureOutputExternalTextures[i]=t,r.resolveTextureOutputExternalTextureLevel[i]=n}},{key:"getRenderTargetDescription",value:function(e){return Ss(this.currentGraph.renderTargetDescriptions[e])}},{key:"scheduleAddUseCount",value:function(e,t){for(var n=0;n<t.renderTargetIDs.length;n++){var r=t.renderTargetIDs[n];void 0!==r&&(this.renderTargetOutputCount[r]++,t.renderTargetExtraRefs[n]&&this.renderTargetOutputCount[r]++)}for(var i=0;i<t.resolveTextureInputIDs.length;i++){var a=t.resolveTextureInputIDs[i];if(void 0!==a){this.resolveTextureUseCount[a]++;var o=e.resolveTextureRenderTargetIDs[a];this.renderTargetResolveCount[o]++}}}},{key:"acquireRenderTargetForID",value:function(e,t){if(void 0===t)return null;if(Ts(this.renderTargetOutputCount[t]>0),!this.renderTargetAliveForID[t]){var n=e.renderTargetDescriptions[t],r=this.acquireRenderTargetForDescription(n);r.setDebugName(this.device,e.renderTargetDebugNames[t]),this.renderTargetAliveForID[t]=r}return this.renderTargetAliveForID[t]}},{key:"releaseRenderTargetForID",value:function(e,t){if(void 0===e)return null;var n=Ss(this.renderTargetAliveForID[e]);return t?(Ts(this.renderTargetOutputCount[e]>0),this.renderTargetOutputCount[e]--):(Ts(this.renderTargetResolveCount[e]>0),this.renderTargetResolveCount[e]--),0===this.renderTargetOutputCount[e]&&0===this.renderTargetResolveCount[e]&&(n.needsClear=!0,this.renderTargetAliveForID[e]=void 0,this.renderTargetDeadPool.push(n)),n}},{key:"acquireResolveTextureInputTextureForID",value:function(e,t){var n=e.resolveTextureRenderTargetIDs[t];Ts(this.resolveTextureUseCount[t]>0),this.resolveTextureUseCount[t]--;var r=Ss(this.releaseRenderTargetForID(n,!1));if(void 0!==this.singleSampledTextureForResolveTextureID[t]){var i=this.singleSampledTextureForResolveTextureID[t];return 0===this.resolveTextureUseCount[t]&&this.singleSampledTextureDeadPool.push(i),i.texture}return Ss(r.texture)}},{key:"determineResolveParam",value:function(e,t,n){var r=t.renderTargetIDs[n],i=t.resolveTextureOutputIDs[n],a=t.resolveTextureOutputExternalTextures[n],o=void 0!==i,s=void 0!==a;Ts(!(o&&s));var l=null,u=!1,c=0;if(this.renderTargetOutputCount[r]>1&&(u=!0),o){Ts(e.resolveTextureRenderTargetIDs[i]===r),Ts(this.resolveTextureUseCount[i]>0),Ts(this.renderTargetOutputCount[r]>0);var h=Ss(this.renderTargetAliveForID[r]);if(null!==h.texture&&1===this.renderTargetOutputCount[r])l=null,u=!0;else{if(!this.singleSampledTextureForResolveTextureID[i]){var d=Ss(e.renderTargetDescriptions[r]);this.singleSampledTextureForResolveTextureID[i]=this.acquireSingleSampledTextureForDescription(d),this.device.setResourceName(this.singleSampledTextureForResolveTextureID[i].texture,"".concat(h.debugName," (Resolve ").concat(i,")"))}l=this.singleSampledTextureForResolveTextureID[i].texture}}else s?(l=a,c=t.resolveTextureOutputExternalTextureLevel[n]):l=null;return{resolveTo:l,store:u,level:c}}},{key:"schedulePass",value:function(e,t){for(var n=t.renderTargetIDs[Jc.DepthStencil],r=Jc.Color0;r<=Jc.ColorMax;r++){var i=t.renderTargetIDs[r],a=this.acquireRenderTargetForID(e,i);t.renderTargets[r]=a,t.descriptor.colorAttachment[r]=null!==a?a.attachment:null,t.descriptor.colorAttachmentLevel[r]=t.renderTargetLevels[r];var o=this.determineResolveParam(e,t,r),s=o.resolveTo,l=o.store,u=o.level;t.descriptor.colorResolveTo[r]=s,t.descriptor.colorResolveToLevel[r]=u,t.descriptor.colorStore[r]=l,t.descriptor.colorClearColor[r]=null!==a&&a.needsClear?e.renderTargetDescriptions[i].colorClearColor:"load"}var c=this.acquireRenderTargetForID(e,n);t.renderTargets[Jc.DepthStencil]=c,t.descriptor.depthStencilAttachment=null!==c?c.attachment:null;var h=this.determineResolveParam(e,t,Jc.DepthStencil),d=h.resolveTo,f=h.store;t.descriptor.depthStencilResolveTo=d,t.descriptor.depthStencilStore=f,t.descriptor.depthClearValue=null!==c&&c.needsClear?e.renderTargetDescriptions[n].depthClearValue:"load",t.descriptor.stencilClearValue=null!==c&&c.needsClear?e.renderTargetDescriptions[n].stencilClearValue:"load";for(var v=0,p=0,g=0,m=0;m<t.renderTargets.length;m++){var y=t.renderTargets[m];if(y){var E=y.width>>>t.renderTargetLevels[m],_=y.height>>>t.renderTargetLevels[m];0===v&&(v=E,p=_,g=y.sampleCount),Ts(E===v),Ts(_===p),Ts(y.sampleCount===g),y.needsClear=!1}}v>0&&p>0&&(t.viewportX*=v,t.viewportY*=p,t.viewportW*=v,t.viewportH*=p);for(var T=0;T<t.resolveTextureInputIDs.length;T++){var S=t.resolveTextureInputIDs[T];t.resolveTextureInputTextures[T]=this.acquireResolveTextureInputTextureForID(e,S)}for(var R=0;R<t.renderTargetIDs.length;R++)this.releaseRenderTargetForID(t.renderTargetIDs[R],!0);for(var A=0;A<t.renderTargetExtraRefs.length;A++)t.renderTargetExtraRefs[A]&&this.releaseRenderTargetForID(t.renderTargetIDs[A],!0)}},{key:"scheduleGraph",value:function(e){Ts(0===this.renderTargetOutputCount.length),Ts(0===this.renderTargetResolveCount.length),Ts(0===this.resolveTextureUseCount.length);for(var t=0;t<this.renderTargetDeadPool.length;t++)this.renderTargetDeadPool[t].age++;for(var n=0;n<this.singleSampledTextureDeadPool.length;n++)this.singleSampledTextureDeadPool[n].age++;ws(this.renderTargetOutputCount,e.renderTargetDescriptions.length,0),ws(this.renderTargetResolveCount,e.renderTargetDescriptions.length,0),ws(this.resolveTextureUseCount,e.resolveTextureRenderTargetIDs.length,0);for(var r=0;r<e.passes.length;r++)this.scheduleAddUseCount(e,e.passes[r]);for(var i=0;i<e.passes.length;i++)this.schedulePass(e,e.passes[i]);for(var a=0;a<this.renderTargetOutputCount.length;a++)Ts(0===this.renderTargetOutputCount[a]);for(var o=0;o<this.renderTargetResolveCount.length;o++)Ts(0===this.renderTargetResolveCount[o]);for(var s=0;s<this.resolveTextureUseCount.length;s++)Ts(0===this.resolveTextureUseCount[s]);for(var l=0;l<this.renderTargetAliveForID.length;l++)Ts(void 0===this.renderTargetAliveForID[l]);for(var u=0;u<this.renderTargetDeadPool.length;u++)this.renderTargetDeadPool[u].age>=1&&(this.renderTargetDeadPool[u].destroy(),this.renderTargetDeadPool.splice(u--,1));for(var c=0;c<this.singleSampledTextureDeadPool.length;c++)this.singleSampledTextureDeadPool[c].age>=1&&(this.singleSampledTextureDeadPool[c].destroy(),this.singleSampledTextureDeadPool.splice(c--,1));this.renderTargetResolveCount.length=0,this.renderTargetOutputCount.length=0,this.resolveTextureUseCount.length=0}},{key:"execPass",value:function(e){Ts(null===this.currentPass),this.currentPass=e;var t=this.device.createRenderPass(e.descriptor);t.pushDebugGroup(e.debugName),t.setViewport(e.viewportX,e.viewportY,e.viewportW,e.viewportH),null!==e.execFunc&&e.execFunc(t,this),t.popDebugGroup(),this.device.submitPass(t),null!==e.postFunc&&e.postFunc(this),this.currentPass=null}},{key:"execGraph",value:function(e){var t=this;this.scheduleGraph(e),this.device.beginFrame(),e.passes.forEach((function(e){t.execPass(e)})),this.device.endFrame(),this.singleSampledTextureForResolveTextureID.length=0}},{key:"execute",value:function(){var e=Ss(this.currentGraph);this.execGraph(e),this.currentGraph=null}},{key:"getDebug",value:function(){return this}},{key:"getPasses",value:function(){return this.currentGraph.passes}},{key:"getPassDebugThumbnails",value:function(e){return e.debugThumbnails}},{key:"getPassRenderTargetID",value:function(e,t){return e.renderTargetIDs[t]}},{key:"getRenderTargetIDDebugName",value:function(e){return this.currentGraph.renderTargetDebugNames[e]}},{key:"getResolveTextureForID",value:function(e){var t=this.currentPass,n=t.resolveTextureInputIDs.indexOf(e);return Ts(n>=0),Ss(t.resolveTextureInputTextures[n])}},{key:"getRenderTargetAttachment",value:function(e){var t=this.currentPass.renderTargets[e];return t?t.attachment:null}},{key:"getRenderTargetTexture",value:function(e){var t=this.currentPass.renderTargets[e];return t?t.texture:null}},{key:"newGraphBuilder",value:function(){return this.beginGraphBuilder(),this}},{key:"destroy",value:function(){for(var e=0;e<this.renderTargetAliveForID.length;e++)Ts(void 0===this.renderTargetAliveForID[e]);for(var t=0;t<this.singleSampledTextureForResolveTextureID.length;t++)Ts(void 0===this.singleSampledTextureForResolveTextureID[t]);for(var n=0;n<this.renderTargetDeadPool.length;n++)this.renderTargetDeadPool[n].destroy();for(var r=0;r<this.singleSampledTextureDeadPool.length;r++)this.singleSampledTextureDeadPool[r].destroy()}}])}(),ah=function(e){return e[e.BACKGROUND=0]="BACKGROUND",e[e.ALPHA_TEST=16]="ALPHA_TEST",e[e.OPAQUE=32]="OPAQUE",e[e.TRANSLUCENT=128]="TRANSLUCENT",e}({});function oh(e,t){return(16777215&e|(255&t)<<24)>>>0}function sh(e,t){return oh(function(e,t){return e>>>31&1?e:(4278190335&e|(65535&t)<<8)>>>0}(0,t),e)}p.fromValues(1,0,0,0,0,1,0,0,0,0,2,0,0,0,-1,1);p.fromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1);function lh(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return e[t+0]=n,e[t+1]=r,e[t+2]=i,e[t+3]=a,4}var uh=function(e){return e[e.None=0]="None",e[e.Indexed=1]="Indexed",e[e.AllowSkippingIfPipelineNotReady=2]="AllowSkippingIfPipelineNotReady",e[e.Template=4]="Template",e[e.Draw=8]="Draw",e[e.InheritedFlags=3]="InheritedFlags",e}({}),ch=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.sortKey=0,this.debug=null,this.uniforms=[],this.bindingDescriptors=Fs(1,(function(){return{bindingLayout:null,samplerBindings:[],uniformBufferBindings:[]}})),this.dynamicUniformBufferByteOffsets=Fs(4,(function(){return 0})),this.flags=0,this.vertexBuffers=null,this.indexBuffer=null,this.drawStart=0,this.drawCount=0,this.drawInstanceCount=0,this.renderPipelineDescriptor={inputLayout:null,megaStateDescriptor:Hs(zs),program:null,topology:Fo.TRIANGLES,colorAttachmentFormats:[],depthStencilAttachmentFormat:null,sampleCount:1},this.reset()}),[{key:"reset",value:function(){this.sortKey=0,this.flags=uh.AllowSkippingIfPipelineNotReady,this.vertexBuffers=null,this.indexBuffer=null,this.renderPipelineDescriptor.inputLayout=null}},{key:"setFromTemplate",value:function(e){var t,n;Ws(this.renderPipelineDescriptor.megaStateDescriptor,e.renderPipelineDescriptor.megaStateDescriptor),this.renderPipelineDescriptor.program=e.renderPipelineDescriptor.program,this.renderPipelineDescriptor.inputLayout=e.renderPipelineDescriptor.inputLayout,this.renderPipelineDescriptor.topology=e.renderPipelineDescriptor.topology,this.renderPipelineDescriptor.colorAttachmentFormats.length=Math.max(this.renderPipelineDescriptor.colorAttachmentFormats.length,e.renderPipelineDescriptor.colorAttachmentFormats.length);for(var r=0;r<e.renderPipelineDescriptor.colorAttachmentFormats.length;r++)this.renderPipelineDescriptor.colorAttachmentFormats[r]=e.renderPipelineDescriptor.colorAttachmentFormats[r];this.renderPipelineDescriptor.depthStencilAttachmentFormat=e.renderPipelineDescriptor.depthStencilAttachmentFormat,this.renderPipelineDescriptor.sampleCount=e.renderPipelineDescriptor.sampleCount,this.uniformBuffer=e.uniformBuffer,this.uniforms=(0,c.Z)(e.uniforms),this.drawCount=e.drawCount,this.drawStart=e.drawStart,this.drawInstanceCount=e.drawInstanceCount,this.vertexBuffers=e.vertexBuffers,this.indexBuffer=e.indexBuffer,this.flags=this.flags&~uh.InheritedFlags|e.flags&uh.InheritedFlags,this.sortKey=e.sortKey;var i=this.bindingDescriptors[0],a=e.bindingDescriptors[0];this.setBindingLayout({numSamplers:null===(t=a.samplerBindings)||void 0===t?void 0:t.length,numUniformBuffers:null===(n=a.uniformBufferBindings)||void 0===n?void 0:n.length});for(var o=0;o<Math.min(i.uniformBufferBindings.length,a.uniformBufferBindings.length);o++)i.uniformBufferBindings[o].size=e.bindingDescriptors[0].uniformBufferBindings[o].size;this.setSamplerBindingsFromTextureMappings(a.samplerBindings);for(var s=0;s<e.dynamicUniformBufferByteOffsets.length;s++)this.dynamicUniformBufferByteOffsets[s]=e.dynamicUniformBufferByteOffsets[s]}},{key:"validate",value:function(){for(var e=0;e<this.bindingDescriptors.length;e++)for(var t=this.bindingDescriptors[e],n=0;n<(null===(r=t.uniformBufferBindings)||void 0===r?void 0:r.length);n++){var r;Ts(t.uniformBufferBindings[n].size>0)}Ts(this.drawCount>0)}},{key:"setProgram",value:function(e){this.renderPipelineDescriptor.program=e}},{key:"setMegaStateFlags",value:function(e){return Ws(this.renderPipelineDescriptor.megaStateDescriptor,e),this.renderPipelineDescriptor.megaStateDescriptor}},{key:"getMegaStateFlags",value:function(){return this.renderPipelineDescriptor.megaStateDescriptor}},{key:"setVertexInput",value:function(e,t,n){this.vertexBuffers=t,this.indexBuffer=n,this.renderPipelineDescriptor.inputLayout=e}},{key:"setBindingLayout",value:function(e){Ts(e.numUniformBuffers<this.dynamicUniformBufferByteOffsets.length);for(var t=this.bindingDescriptors[0].uniformBufferBindings.length;t<e.numUniformBuffers;t++)this.bindingDescriptors[0].uniformBufferBindings.push({binding:t,buffer:null,size:0});for(var n=this.bindingDescriptors[0].samplerBindings.length;n<e.numSamplers;n++)this.bindingDescriptors[0].samplerBindings.push({sampler:null,texture:null})}},{key:"drawIndexes",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.flags=Bs(this.flags,uh.Indexed,!0),this.drawCount=e,this.drawStart=t,this.drawInstanceCount=1}},{key:"drawIndexesInstanced",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.flags=Bs(this.flags,uh.Indexed,!0),this.drawCount=e,this.drawStart=n,this.drawInstanceCount=t}},{key:"drawPrimitives",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.flags=Bs(this.flags,uh.Indexed,!1),this.drawCount=e,this.drawStart=t,this.drawInstanceCount=1}},{key:"setUniforms",value:function(e,t){if(0!==t.length){this.uniforms[e]=t;var n=0,r=[];t.forEach((function(e){var t=e.value;if((0,E.Z)(t)||Array.isArray(t)||t instanceof Float32Array){var i=(0,E.Z)(t)?[t]:t,a=i.length>4?4:i.length,o=4-n%4;if(4!==o)if(o>=a);else{n+=o;for(var s=0;s<o;s++)r.push(0)}n+=i.length,r.push.apply(r,(0,c.Z)(i))}}));var i=4-r.length%4;if(4!==i)for(var a=0;a<i;a++)r.push(0);for(var o=this.allocateUniformBuffer(e,r.length),s=this.mapUniformBufferF32(e),l=0;l<r.length;l+=4)o+=lh(s,o,r[l],r[l+1],r[l+2],r[l+3])}}},{key:"setUniformBuffer",value:function(e){this.uniformBuffer=e}},{key:"allocateUniformBuffer",value:function(e,t){var n;return Ts((null===(n=this.bindingDescriptors[0].uniformBufferBindings)||void 0===n?void 0:n.length)<this.dynamicUniformBufferByteOffsets.length),this.dynamicUniformBufferByteOffsets[e]=this.uniformBuffer.allocateChunk(t)<<2,this.bindingDescriptors[0].uniformBufferBindings[e].size=t<<2,this.getUniformBufferOffset(e)}},{key:"getUniformBufferOffset",value:function(e){return this.dynamicUniformBufferByteOffsets[e]>>>2}},{key:"mapUniformBufferF32",value:function(e){return this.uniformBuffer.mapBufferF32()}},{key:"getUniformBuffer",value:function(){return this.uniformBuffer}},{key:"setSamplerBindingsFromTextureMappings",value:function(e){e=e.filter((function(e){return e}));for(var t=0;t<this.bindingDescriptors[0].samplerBindings.length;t++){var n=this.bindingDescriptors[0].samplerBindings[t],r=e[t];null!=r?(n.texture=r.texture,n.sampler=r.sampler):(n.texture=null,n.sampler=null)}}},{key:"setAllowSkippingIfPipelineNotReady",value:function(e){this.flags=Bs(this.flags,uh.AllowSkippingIfPipelineNotReady,e)}},{key:"setAttachmentFormatsFromRenderPass",value:function(e,t){for(var n=e.queryRenderPass(t),r=-1,i=0;i<n.colorAttachment.length;i++){var a=null!==n.colorAttachment[i]?e.queryRenderTarget(n.colorAttachment[i]):null;this.renderPipelineDescriptor.colorAttachmentFormats[i]=null!==a?a.format:null,null!==a&&(-1===r?r=a.sampleCount:Ts(r===a.sampleCount))}var o=null!==n.depthStencilAttachment?e.queryRenderTarget(n.depthStencilAttachment):null;this.renderPipelineDescriptor.depthStencilAttachmentFormat=null!==o?o.format:null,null!==o&&(-1===r?r=o.sampleCount:Ts(r===o.sampleCount)),Ts(r>0),this.renderPipelineDescriptor.sampleCount=r}},{key:"drawOnPass",value:function(e,t){var n=this,r=e.device;this.setAttachmentFormatsFromRenderPass(r,t);var i=e.createRenderPipeline(this.renderPipelineDescriptor);if(!r.pipelineQueryReady(i)){if(this.flags&uh.AllowSkippingIfPipelineNotReady)return!1;r.pipelineForceReady(i)}t.setPipeline(i),t.setVertexInput(this.renderPipelineDescriptor.inputLayout,this.vertexBuffers,this.indexBuffer);for(var a=0;a<this.bindingDescriptors[0].uniformBufferBindings.length;a++)this.bindingDescriptors[0].uniformBufferBindings[a].buffer=Ss(this.uniformBuffer.buffer),this.bindingDescriptors[0].uniformBufferBindings[a].offset=this.dynamicUniformBufferByteOffsets[a];this.renderPipelineDescriptor.program.gl_program&&this.uniforms.forEach((function(e){var t={};e.forEach((function(e){var n=e.name,r=e.value;t[n]=r})),n.renderPipelineDescriptor.program.setUniformsLegacy(t)}));var o=e.createBindings((0,u.Z)((0,u.Z)({},this.bindingDescriptors[0]),{},{pipeline:i}));return t.setBindings(o),this.flags&uh.Indexed?t.drawIndexed(this.drawCount,this.drawInstanceCount,this.drawStart,0,0):t.draw(this.drawCount,this.drawInstanceCount,this.drawStart,0),!0}}])}();function hh(e,t){return e.sortKey-t.sortKey}var dh=function(e){return e[e.Forwards=0]="Forwards",e[e.Backwards=1]="Backwards",e}({}),fh=function(){return(0,a.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hh,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dh.Forwards;(0,o.Z)(this,e),this.renderInsts=[],this.usePostSort=!1,this.compareFunction=t,this.executionOrder=n}),[{key:"checkUsePostSort",value:function(){this.usePostSort=null!==this.compareFunction&&this.renderInsts.length>=500}},{key:"insertSorted",value:function(e){var t,n,r,i;null===this.compareFunction||this.usePostSort?this.renderInsts.push(e):(t=this.renderInsts,n=e,r=this.compareFunction,i=function(e,t,n){for(var r=0,i=e.length;r<i;){var a=r+(i-r>>>1);n(t,e[a])<0?i=a:r=a+1}return r}(t,n,r),t.splice(i,0,n)),this.checkUsePostSort()}},{key:"submitRenderInst",value:function(e){e.flags|=uh.Draw,this.insertSorted(e)}},{key:"ensureSorted",value:function(){this.usePostSort&&(0!==this.renderInsts.length&&this.renderInsts.sort(this.compareFunction),this.usePostSort=!1)}},{key:"drawOnPassRendererNoReset",value:function(e,t){if(this.ensureSorted(),this.executionOrder===dh.Forwards)for(var n=0;n<this.renderInsts.length;n++)this.renderInsts[n].drawOnPass(e,t);else for(var r=this.renderInsts.length-1;r>=0;r--)this.renderInsts[r].drawOnPass(e,t)}},{key:"reset",value:function(){this.renderInsts.length=0}},{key:"drawOnPassRenderer",value:function(e,t){this.drawOnPassRendererNoReset(e,t),this.reset()}}])}(),vh=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.pool=[],this.allocCount=0}),[{key:"allocRenderInstIndex",value:function(){return this.allocCount++,this.allocCount>this.pool.length&&this.pool.push(new ch),this.allocCount-1}},{key:"popRenderInst",value:function(){this.allocCount--}},{key:"reset",value:function(){for(var e=0;e<this.pool.length;e++)this.pool[e].reset();this.allocCount=0}},{key:"destroy",value:function(){this.pool.length=0,this.allocCount=0}}])}(),ph=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.instPool=new vh,this.templatePool=new vh,this.simpleRenderInstList=new fh,this.currentRenderInstList=this.simpleRenderInstList,this.renderCache=t}),[{key:"newRenderInst",value:function(){var e=this.templatePool.allocCount-1,t=this.instPool.allocRenderInstIndex(),n=this.instPool.pool[t];return n.debug=null,e>=0&&n.setFromTemplate(this.templatePool.pool[e]),n}},{key:"submitRenderInst",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentRenderInstList;t.submitRenderInst(e)}},{key:"setCurrentRenderInstList",value:function(e){Ts(null===this.simpleRenderInstList),this.currentRenderInstList=e}},{key:"pushTemplateRenderInst",value:function(){var e=this.templatePool.allocCount-1,t=this.templatePool.allocRenderInstIndex(),n=this.templatePool.pool[t];return e>=0&&n.setFromTemplate(this.templatePool.pool[e]),n.flags|=uh.Template,n}},{key:"popTemplateRenderInst",value:function(){this.templatePool.popRenderInst()}},{key:"getTemplateRenderInst",value:function(){var e=this.templatePool.allocCount-1;return this.templatePool.pool[e]}},{key:"resetRenderInsts",value:function(){this.instPool.reset(),null!==this.simpleRenderInstList&&this.simpleRenderInstList.reset(),Ts(0===this.templatePool.allocCount)}},{key:"destroy",value:function(){this.instPool.destroy(),this.renderCache.destroy()}},{key:"disableSimpleMode",value:function(){this.simpleRenderInstList=null}},{key:"drawOnPassRenderer",value:function(e){Ss(this.simpleRenderInstList).drawOnPassRenderer(this.renderCache,e)}},{key:"drawOnPassRendererNoReset",value:function(e){Ss(this.simpleRenderInstList).drawOnPassRendererNoReset(this.renderCache,e)}}])}(),gh=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.parameters=t}),[{key:"getDevice",value:function(){return this.device}},{key:"setDevice",value:function(e){this.device=e,this.renderCache=new $c(e),this.renderGraph=new ih(this.device),this.renderInstManager=new ph(this.renderCache),this.uniformBuffer=new Fc(this.device)}},{key:"pushTemplateRenderInst",value:function(){var e=this.renderInstManager.pushTemplateRenderInst();return e.setUniformBuffer(this.uniformBuffer),e}},{key:"prepareToRender",value:function(){this.uniformBuffer.prepareToRender()}},{key:"destroy",value:function(){this.uniformBuffer&&this.uniformBuffer.destroy(),this.renderInstManager&&this.renderInstManager.destroy(),this.renderCache&&this.renderCache.destroy(),this.renderGraph&&this.renderGraph.destroy()}},{key:"getCache",value:function(){return this.renderCache}},{key:"getDefines",value:function(){var e,t,n;return{USE_TONEMAPPING:(null===(e=this.parameters)||void 0===e?void 0:e.toneMapping)&&(null===(t=this.parameters)||void 0===t?void 0:t.toneMapping)!==Qc.NONE,toneMapping:null===(n=this.parameters)||void 0===n?void 0:n.toneMapping}}}])}(),mh=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.width=0,this.height=0,this.sampleCount=0,this.colorClearColor="load",this.depthClearValue="load",this.stencilClearValue="load",this.format=t}),[{key:"setDimensions",value:function(e,t,n){this.width=e,this.height=t,this.sampleCount=n}},{key:"copyDimensions",value:function(e){this.width=e.width,this.height=e.height,this.sampleCount=e.sampleCount}}])}();function yh(e){return{colorClearColor:e,depthClearValue:1,stencilClearValue:0}}yh(ks(.88,.88,.88,1)),yh(Ms);var Eh=yh(bs),_h=function(e){return e[e.None=0]="None",e[e.FXAA=1]="FXAA",e[e.MSAAx4=2]="MSAAx4",e}({});function Th(e,t){var n=function(e){return e.antialiasingMode===_h.MSAAx4?4:1}(t);e.setDimensions(t.backbufferWidth,t.backbufferHeight,n)}function Sh(e,t,n){var r=function(e){if(e===Jc.Color0)return es.U8_RGBA_RT;if(e===Jc.DepthStencil)return es.D24_S8;throw new Error("whoops")}(e),i=new mh(r);return Th(i,t),null!==n&&(i.colorClearColor=n.colorClearColor,i.depthClearValue=n.depthClearValue,i.stencilClearValue=n.stencilClearValue),i}var Rh=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.texture=null,this.sampler=null,this.width=0,this.height=0,this.lodBias=0}),[{key:"reset",value:function(){this.texture=null,this.sampler=null,this.width=0,this.height=0,this.lodBias=0}},{key:"copy",value:function(e){this.texture=e.texture,this.sampler=e.sampler,this.width=e.width,this.height=e.height,this.lodBias=e.lodBias}}])}(),Ah=["style"],xh=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.style,r=(0,ce.Z)(e,Ah);return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:t.tag,style:(0,u.Z)({intensity:Math.PI},n)},r)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(Va);xh.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Va.PARSED_STYLE_LIST),["intensity"])),xh.tag="light";var kh=["style"],Nh=function(e){return e[e.NONE=0]="NONE",e[e.EXP=1]="EXP",e[e.EXP2=2]="EXP2",e[e.LINEAR=3]="LINEAR",e}({}),Mh=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.style,r=(0,ce.Z)(e,kh);return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:t.tag,style:(0,u.Z)({type:Nh.NONE,fill:"black",start:1,end:1e3,density:0},n)},r)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(Va);function Ch(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Zo.STATIC,i=e.createBuffer({viewOrSize:n.byteLength,usage:t,hint:r});return i.setSubData(0,new Uint8Array(n)),i}Mh.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Va.PARSED_STYLE_LIST),["type","density","start","end"])),Mh.tag="fog";var bh,Ph,Oh=function(e){return e.CHANGED="changed",e}({}),Ih=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,o.Z)(this,t),(n=(0,s.Z)(this,t)).drawMode=Fo.TRIANGLES,n.vertexBuffers=[],n.vertices=[],n.inputLayoutDescriptor={vertexBufferDescriptors:[],indexBufferFormat:null,program:null},n.vertexCount=0,n.instancedCount=0,n.indexStart=0,n.primitiveStart=0,n.dirty=!0,n.meshes=[],n.device=e,n.props=r,n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"validate",value:function(e){return!0}},{key:"build",value:function(e){}},{key:"computeBoundingBox",value:function(){return new Te}},{key:"setIndexBuffer",value:function(e){return this.indexBuffer&&this.indexBuffer.destroy(),this.indexBuffer=Ch(this.device,Uo.INDEX,new Uint32Array(ArrayBuffer.isView(e)?e.buffer:e).buffer),this.indices=e,this.inputLayoutDescriptor.indexBufferFormat=es.U32_R,this}},{key:"setVertexBuffer",value:function(e){var t=this,n=e.bufferIndex,r=e.byteStride,i=e.stepMode,a=e.attributes,o=e.data;this.inputLayoutDescriptor.vertexBufferDescriptors[n]={arrayStride:r,stepMode:i,attributes:[]},this.vertices[n]=o,a.forEach((function(e){var r=e.format,i=e.bufferByteOffset,a=e.location,o=e.divisor;e.byteStride;var s=t.inputLayoutDescriptor.vertexBufferDescriptors[n].attributes.find((function(e){return e.shaderLocation===a}));s?(s.format=r,s.offset=i,s.divisor=o):t.inputLayoutDescriptor.vertexBufferDescriptors[n].attributes.push({format:r,offset:i,shaderLocation:a,divisor:o})})),this.vertexBuffers[n]&&this.vertexBuffers[n].destroy();var s=Ch(this.device,Uo.VERTEX,o.buffer,Zo.DYNAMIC);return this.vertexBuffers[n]=s,this}},{key:"getVertexBuffer",value:function(e){return this.vertexBuffers[e]}},{key:"updateVertexBuffer",value:function(e,t,n,r){var i=this.inputLayoutDescriptor.vertexBufferDescriptors[e];if(i){var a=i.arrayStride,o=this.inputLayoutDescriptor.vertexBufferDescriptors[e].attributes.find((function(e){return e.shaderLocation===t}));if(o){var s=n*a;this.getVertexBuffer(e).setSubData(o.offset+s,r)}this.emit(Oh.CHANGED)}}},{key:"updateIndices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.indexBuffer&&this.indexBuffer.setSubData(t,new Uint8Array(ArrayBuffer.isView(e)?e:new Uint32Array(e))),this}},{key:"destroy",value:function(){this.vertexBuffers.forEach((function(e){e&&e.destroy()})),this.indexBuffer&&this.indexBuffer.destroy(),this.inputLayoutDescriptor.vertexBufferDescriptors=[],this.indexBuffer=void 0,this.vertexBuffers=[],this.indices=void 0,this.vertices=[],this.vertexCount=0,this.instancedCount=0}}])}(d.Z),wh="#define GLSLIFY 1\nlayout(location = 0) in vec2 a_Position;\n\nout vec2 v_TexCoord;\n\nvoid main() {\n  v_TexCoord = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_TexCoord.y = 1.0 - v_TexCoord.y;\n  #endif\n}",Lh="#define GLSLIFY 1\nuniform sampler2D u_Texture;\nin vec2 v_TexCoord;\n\nout vec4 outputColor;\n\nfloat MonochromeNTSC(vec3 t_Color) {\n  // NTSC primaries.\n  return dot(t_Color.rgb, vec3(0.299, 0.587, 0.114));\n}\n\nvec4 FXAA(PD_SAMPLER_2D(t_Texture), in vec2 t_PixelCenter, in vec2 t_InvResolution) {\n  // FXAA v2, based on implementations:\n  // http://www.geeks3d.com/20110405/fxaa-fast-approximate-anti-aliasing-demo-glsl-opengl-test-radeon-geforce/\n  // https://github.com/mitsuhiko/webgl-meincraft\n\n  float lumaMM = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy).rgb);\n\n  #if 1\n    vec2 t_PixelTopLeft = t_PixelCenter.xy - t_InvResolution.xy * 0.5;\n    float lumaNW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy)             .rgb);\n    float lumaNE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy + vec2(1.0, 0.0)).rgb);\n    float lumaSW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy + vec2(0.0, 1.0)).rgb);\n    float lumaSE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy + vec2(1.0, 1.0)).rgb);\n  #else\n    // We're at the pixel center -- pixel edges are 0.5 units away.\n    // NOTE(jstpierre): mitsuhiko's port seems to get this wrong?\n    vec2 t_PixelSize = t_InvResolution.xy * 0.5;\n\n    float lumaNW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2(-1.0, -1.0)).rgb);\n    float lumaNE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2( 1.0, -1.0)).rgb);\n    float lumaSW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2(-1.0,  1.0)).rgb);\n    float lumaSE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2( 1.0,  1.0)).rgb);\n  #endif\n\n  vec2 dir; \n  dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n  dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n  const float FXAA_REDUCE_MIN = 1.0/128.0;\n  const float FXAA_REDUCE_MUL = 1.0/8.0;\n  const float FXAA_SPAN_MAX = 8.0;\n\n  float dirReduce = max(\n      (lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\n      FXAA_REDUCE_MIN);\n\n  float rcpDirMin = 1.0/(min(abs(dir.x), abs(dir.y)) + dirReduce);\n  dir = min(vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * u_InvResolution.xy;\n\n  float lumaMin = min(lumaMM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n  float lumaMax = max(lumaMM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n  vec4 rgbA = (1.0/2.0) * (\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (1.0/3.0 - 0.5)) +\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (2.0/3.0 - 0.5)));\n  vec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (0.0/3.0 - 0.5)) +\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (3.0/3.0 - 0.5)));\n  float lumaB = MonochromeNTSC(rgbB.rgb);\n\n  vec4 rgbOutput = ((lumaB < lumaMin) || (lumaB > lumaMax)) ? rgbA : rgbB;\n  return rgbOutput;\n}\n\nvoid main() {\n  outputColor = FXAA(PP_SAMPLER_2D(u_Texture), v_TexCoord.xy, u_InvResolution.xy);\n}",Dh=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).features={},e.both="\nlayout(std140) uniform ub_Params {\n    vec4 u_Misc[1];\n};\n#define u_InvResolution (u_Misc[0].xy)\n",e.vert=wh,e.frag=Lh,e}return(0,l.Z)(t,e),(0,a.Z)(t)}(Bc),Bh=Fs(1,(function(){return new Rh}));var Fh=function(e){return e.PROJECTION_MATRIX="u_ProjectionMatrix",e.VIEW_MATRIX="u_ViewMatrix",e.CAMERA_POSITION="u_CameraPosition",e.DEVICE_PIXEL_RATIO="u_DevicePixelRatio",e.VIEWPORT="u_Viewport",e.IS_ORTHO="u_IsOrtho",e.IS_PICKING="u_IsPicking",e}({}),Uh=function(){function e(t,n,r,i,a){(0,o.Z)(this,e),this.renderLists={leftEye:new fh,rightEye:new fh,picking:new fh},this.cameras=[],this.renderHelper=t,this.lightPool=n,this.texturePool=r,this.batchManager=i,this.options=a}return(0,a.Z)(e,[{key:"getDevice",value:function(){return this.device}},{key:"getSwapChain",value:function(){return this.swapChain}},{key:"getRenderLists",value:function(){return this.renderLists}},{key:"apply",value:function(t){var n=this;this.context=t;var r=t.renderingService,i=t.renderingContext,a=t.config,o=i.root.ownerDocument.defaultView;a.disableRenderHooks=!0;var s=function(e){var t=e.target;t.nodeName!==xh.tag?t.nodeName!==Mh.tag?(t.renderable3D||(t.renderable3D=new Pc),n.batchManager.add(t)):n.lightPool.addFog(t):n.lightPool.addLight(t)},l=function(e){var t=e.target;if(t.nodeName!==xh.tag)if(t.nodeName!==Mh.tag){if(t.nodeName===he.MESH){var r,i;if(null!==(r=t.style.geometry)&&void 0!==r&&r.meshes){var a=t.style.geometry.meshes.indexOf(t);a>-1&&t.style.geometry.meshes.splice(a,1)}if(null!==(i=t.style.material)&&void 0!==i&&i.meshes){var o=t.style.material.meshes.indexOf(t);o>-1&&t.style.material.meshes.splice(o,1)}}n.swapChain&&n.batchManager.remove(t),delete t.renderable3D}else n.lightPool.removeFog(t);else n.lightPool.removeLight(t)},h=function(e){if(n.swapChain){var t=e.target,r=e.attrName,i=e.newValue;"zIndex"===r?t.parentNode.forEach((function(e){n.batchManager.changeRenderOrder(e,e.sortable.renderOrder)})):n.batchManager.updateAttribute(t,r,i)}},d=function(e){if(n.swapChain)for(var t=e.detail,r=0;r<t.length;r++){var i=t[r].target;(i.nodeName===he.FRAGMENT?i.childNodes:[i]).forEach((function(e){n.batchManager.updateAttribute(e,"modelMatrix",null)}))}};r.hooks.initAsync.tapPromise(e.tag,(0,le.Z)((0,se.Z)().mark((function e(){var r,i,a,c;return(0,se.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.addEventListener(Ji.MOUNTED,s),o.addEventListener(Ji.UNMOUNTED,l),o.addEventListener(Ji.ATTR_MODIFIED,h),o.addEventListener(Ji.BOUNDS_CHANGED,d),n.context.config.renderer.getConfig().enableDirtyRectangleRendering=!1,r=n.context.contextService.getDomElement(),i=n.context.config,a=i.width,c=i.height,n.context.contextService.resize(a,c),e.next=1,n.context.deviceContribution.createSwapChain(r);case 1:n.swapChain=e.sent,n.device=n.swapChain.getDevice(),n.renderHelper.setDevice(n.device),n.renderHelper.renderInstManager.disableSimpleMode(),n.swapChain.configureSwapChain(r.width,r.height),o.addEventListener(ho.RESIZE,(function(){n.swapChain.configureSwapChain(r.width,r.height)})),n.batchManager.attach((0,u.Z)({device:n.device},t));case 2:case"end":return e.stop()}}),e)})))),r.hooks.destroy.tap(e.tag,(function(){n.renderHelper.destroy(),n.batchManager.destroy(),n.texturePool.destroy(),o.removeEventListener(Ji.MOUNTED,s),o.removeEventListener(Ji.UNMOUNTED,l),o.removeEventListener(Ji.ATTR_MODIFIED,h),o.removeEventListener(Ji.BOUNDS_CHANGED,d),n.device.destroy(),n.device.checkForLeaks(),a.disableRenderHooks=!1})),r.hooks.beginFrame.tap(e.tag,(function(e){var t,r=null==e?void 0:e.session,i=n.context.config,a=i.width,o=i.height;if(r){var s=r.renderState.baseLayer;s||(s=r.renderState.layers[0]),n.swapChain.configureSwapChain(s.framebufferWidth,s.framebufferHeight,s.framebuffer);var l=r.referenceSpace,u=e.getViewerPose(l);u&&u.views.forEach((function(e,t){var i=r.renderState.baseLayer.getViewport(e),l=p.fromValues.apply(p,(0,c.Z)(e.transform.matrix));l[12]*=a,l[13]*=o,l[14]*=500,l[12]+=a/2,l[13]-=o/2,l[14]+=250;var u=p.fromValues.apply(p,(0,c.Z)(e.projectionMatrix)),h=p.invert(p.create(),l);p.scale(h,h,f.fromValues(1,-1,1));var d=e.transform.position,v=d.x,g=d.y,m=d.z;n.cameras[t]={viewport:{x:i.x/s.framebufferWidth,y:i.y/s.framebufferHeight,width:i.width/s.framebufferWidth,height:i.height/s.framebufferHeight},projectionMatrix:u,viewMatrix:h,cameraPosition:[v,g,m],isOrtho:!1}}))}else{var h=n.context.camera;n.cameras=[{viewport:{x:0,y:0,width:1,height:1},projectionMatrix:h.getPerspective(),viewMatrix:h.getViewTransform(),cameraPosition:h.getPosition(),isOrtho:h.isOrtho()}]}var d,v=n.swapChain.getCanvas(),g=n.renderHelper.renderInstManager;if(n.builder=n.renderHelper.renderGraph.newGraphBuilder(),"transparent"===n.context.config.background)d=Ns;else{var m=Sn(n.context.config.background);d=n.context.config.background?ks(Number(m.r)/255*Number(m.alpha),Number(m.g)/255*Number(m.alpha),Number(m.b)/255*Number(m.alpha),Number(m.alpha)):Cs}var y={backbufferWidth:v.width,backbufferHeight:v.height,antialiasingMode:_h.None},E=Sh(Jc.Color0,y,yh(d)),_=Sh(Jc.DepthStencil,y,Eh),T=n.builder.createRenderTargetID(E,"Main Color"),S=n.builder.createRenderTargetID(_,"Main Depth");n.builder.pushPass((function(e){e.setDebugName("Main Render Pass"),e.attachRenderTargetID(Jc.Color0,T),e.attachRenderTargetID(Jc.DepthStencil,S),e.exec((function(e,t){n.cameras.forEach((function(r,i){var a=r.viewport,o=a.x,s=a.y,l=a.width,u=a.height,c=t.currentPass,h=c.viewportW,d=c.viewportH;e.setViewport(o*h,s*d,l*h,u*d),(0===i?n.renderLists.leftEye:n.renderLists.rightEye).drawOnPassRenderer(g.renderCache,e)}))}))})),null!==(t=n.options)&&void 0!==t&&t.enableFXAA&&function(e,t,n,r){e.pushPass((function(i){i.setDebugName("FXAA"),i.attachRenderTargetID(Jc.Color0,r);var a=e.resolveRenderTarget(r);i.attachResolveTexture(a);var o=t.renderInstManager.newRenderInst();o.setUniformBuffer(t.uniformBuffer),o.setAllowSkippingIfPipelineNotReady(!1),o.setMegaStateFlags(Ys),o.setBindingLayout({numUniformBuffers:1,numSamplers:1}),o.drawPrimitives(3);var s=o.allocateUniformBuffer(0,4);lh(o.mapUniformBufferF32(0),s,1/n.backbufferWidth,1/n.backbufferHeight);var l=new Dh,u=t.renderCache.createProgramSimple(l);o.setProgram(u),bh||((bh=new Ih(t.getDevice())).setVertexBuffer({bufferIndex:0,byteStride:8,stepMode:Go.VERTEX,attributes:[{format:es.F32_RG,bufferByteOffset:0,location:0}],data:new Float32Array([1,3,-3,-1,1,-1])}),bh.vertexCount=3,Ph=t.getCache().createInputLayout(bh.inputLayoutDescriptor)),i.exec((function(e,n){Bh[0].texture=n.getResolveTextureForID(a),o.setSamplerBindingsFromTextureMappings(Bh),o.setVertexInput(Ph,bh.vertexBuffers.map((function(e){return{buffer:e,byteOffset:0}})),null),o.drawOnPass(t.renderCache,e)}))}))}(n.builder,n.renderHelper,y,T),n.builder.resolveRenderTargetToExternalTexture(T,n.swapChain.getOnscreenTexture())})),r.hooks.endFrame.tap(e.tag,(function(e){var t=n.renderHelper.renderInstManager,r=n.context.config,i=r.width,a=r.height;if(n.cameras.forEach((function(e,r){var o=e.viewport,s=e.cameraPosition,l=e.viewMatrix,u=e.projectionMatrix,c=e.isOrtho,h=o.width,d=o.height,f=n.renderHelper.pushTemplateRenderInst();f.setBindingLayout({numUniformBuffers:2,numSamplers:0}),f.setMegaStateFlags(js({depthWrite:!0,blendConstant:Ns},{rgbBlendMode:wo.ADD,alphaBlendMode:wo.ADD,rgbBlendSrcFactor:Io.SRC_ALPHA,alphaBlendSrcFactor:Io.ONE,rgbBlendDstFactor:Io.ONE_MINUS_SRC_ALPHA,alphaBlendDstFactor:Io.ONE_MINUS_SRC_ALPHA})),f.setUniforms(0,[{name:Fh.PROJECTION_MATRIX,value:u},{name:Fh.VIEW_MATRIX,value:l},{name:Fh.CAMERA_POSITION,value:s},{name:Fh.DEVICE_PIXEL_RATIO,value:n.context.contextService.getDPR()},{name:Fh.VIEWPORT,value:[i*h,a*d]},{name:Fh.IS_ORTHO,value:c?1:0},{name:Fh.IS_PICKING,value:0}]),n.batchManager.render(0===r?n.renderLists.leftEye:n.renderLists.rightEye),t.popTemplateRenderInst()})),n.renderHelper.prepareToRender(),n.renderHelper.renderGraph.execute(),t.resetRenderInsts(),n.enableCapture&&n.resolveCapturePromise){var o=n.captureOptions,s=o.type,l=o.encoderOptions,u=n.context.contextService.getDomElement().toDataURL(s,l);n.resolveCapturePromise(u),n.enableCapture=!1,n.captureOptions=void 0,n.resolveCapturePromise=void 0}}))}},{key:"loadTexture",value:function(e,t,n){return this.texturePool.getOrCreateTexture(this.device,e,t,(function(e){n&&n(e)}))}},{key:"toDataURL",value:(t=(0,le.Z)((0,se.Z)().mark((function e(t){var n=this;return(0,se.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.enableCapture=!0,this.captureOptions=t,this.capturePromise=new Promise((function(e){n.resolveCapturePromise=function(t){e(t)}})),e.abrupt("return",this.capturePromise);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]);var t}();Uh.tag="RenderGraph";var Zh=function(){function e(t,n,r,i){(0,o.Z)(this,e),this.renderHelper=t,this.renderGraphPlugin=n,this.pickingIdGenerator=r,this.batchManager=i}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=this;this.context=t;var r=t.renderingService,i=t.renderingContext.root.ownerDocument.defaultView,a=function(e){var t=e.target;t.renderable3D||(t.renderable3D=new Pc);var r=t.renderable3D,i=n.pickingIdGenerator.getId(t);r.pickingId=i,r.encodedPickingColor=n.pickingIdGenerator.encodePickingColor(i)},o=function(e){var t=e.target.renderable3D;t&&n.pickingIdGenerator.deleteById(t.pickingId)};r.hooks.init.tap(e.tag,(function(){i.addEventListener(Ji.MOUNTED,a),i.addEventListener(Ji.UNMOUNTED,o)})),r.hooks.destroy.tap(e.tag,(function(){i.removeEventListener(Ji.MOUNTED,a),i.removeEventListener(Ji.UNMOUNTED,o),n.pickingIdGenerator.reset()})),r.hooks.pickSync.tap(e.tag,(function(e){return n.pick(e)})),r.hooks.pick.tapPromise(e.tag,function(){var e=(0,le.Z)((0,se.Z)().mark((function e(t){return(0,se.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.pick(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"pick",value:function(e){var t=e.topmost,n=e.position,r=n.viewportX,i=n.viewportY,a=this.context.contextService.getDPR(),o=this.context.config.width*a,s=this.context.config.height*a,l=r*a,u=i*a;if(!this.renderHelper.renderGraph||l>o||l<0||u>s||u<0)return e.picked=[],e;var c=this.pickByRectangleInDepth(new xe((0,R.Z)(Math.round(l),0,o-1),(0,R.Z)(Math.round(u),0,s-1),1,1),t?1:100);return e.picked=c,e}},{key:"pickByRectangleInDepth",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=null,r=1,i=[];do{if(!(n=this.pickByRectangle(e,n)))break;r++,i.push(n)}while(n&&r<=t);return t>1&&this.restorePickingColor(i),i}},{key:"restorePickingColor",value:function(e){var t=this;e.forEach((function(e){t.batchManager.updateAttribute(e,"pointerEvents",!0,!0)}))}},{key:"pickByRectangle",value:function(e,t){var n,r=this,i=this.renderGraphPlugin.getDevice(),a=this.renderGraphPlugin.getRenderLists(),o=this.renderHelper.renderInstManager,s=this.renderHelper.renderGraph.newGraphBuilder(),l=Ns,c=this.context.camera,h=e.x,d=e.y,f=e.width,v=e.height,p={backbufferWidth:f,backbufferHeight:v,antialiasingMode:_h.None},g=Sh(Jc.Color0,p,yh(l)),m=s.createRenderTargetID(g,"Picking Color"),y=Sh(Jc.DepthStencil,p,Eh),E=s.createRenderTargetID(y,"Picking Depth"),_=(0,u.Z)({},c.getView());this.renderHelper.renderGraph.renderTargetDeadPool.forEach((function(e){e.age=-1})),s.pushPass((function(e){e.setDebugName("Picking Pass"),e.attachRenderTargetID(Jc.Color0,m),e.attachRenderTargetID(Jc.DepthStencil,E),e.exec((function(e){a.picking.drawOnPassRenderer(o.renderCache,e)})),e.post((function(e){var t,a=e.getRenderTargetTexture(Jc.Color0),o=i.createReadback();_&&_.enabled?c.setViewOffset(_.fullWidth,_.fullHeight,_.offsetX,_.offsetY,_.width,_.height):c.clearViewOffset(),c.setEnableUpdate(!0);try{t=o.readTextureSync(a,0,0,f,v,new Uint8Array(f*v*4))}catch(e){}var s=-1;if(!t||0===t[0]&&0===t[1]&&0===t[2]||(s=r.pickingIdGenerator.decodePickingColor(t)),s>-1){var l=r.pickingIdGenerator.getById(s);l&&l.isVisible()&&l.isInteractive()&&(n=l)}o.destroy()}))}));var T=this.renderHelper.pushTemplateRenderInst();T.setBindingLayout({numUniformBuffers:2,numSamplers:0}),T.setMegaStateFlags(js({depthWrite:!0},{rgbBlendMode:wo.ADD,rgbBlendSrcFactor:Io.ONE,rgbBlendDstFactor:Io.ZERO,alphaBlendMode:wo.ADD,alphaBlendSrcFactor:Io.ONE,alphaBlendDstFactor:Io.ZERO}));var S=this.context.config,R=S.width,A=S.height,x=this.context.contextService.getDPR();return c.setEnableUpdate(!1),c.setViewOffset(R*x,A*x,h,A*x-d,f,v),T.setUniforms(0,[{name:Fh.PROJECTION_MATRIX,value:c.getPerspective()},{name:Fh.VIEW_MATRIX,value:c.getViewTransform()},{name:Fh.CAMERA_POSITION,value:c.getPosition()},{name:Fh.DEVICE_PIXEL_RATIO,value:this.context.contextService.getDPR()},{name:Fh.VIEWPORT,value:[f,v]},{name:Fh.IS_ORTHO,value:c.isOrtho()?1:0},{name:Fh.IS_PICKING,value:1}]),t&&this.batchManager.updateAttribute(t,"pointerEvents",!1,!0),this.batchManager.render(a.picking,!0),o.popTemplateRenderInst(),this.renderHelper.prepareToRender(),this.renderHelper.renderGraph.execute(),o.resetRenderInsts(),n}}])}();Zh.tag="WebGLPicker";var Gh=5e-4,Vh=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.clipPathMeshCreated=!1}),[{key:"beforeUploadUBO",value:function(e,t){}},{key:"beforeInitMesh",value:function(e){}},{key:"afterInitMesh",value:function(e){}}])}();var Wh=function(e){return e.CHANGED="changed",e}({}),Hh=function(e){function t(e,n){var r;(0,o.Z)(this,t),(r=(0,s.Z)(this,t)).props={},r.meshes=[],r.defines={},r.uniforms={},r.uboBuffer=[],r.textures={},r.samplers=[],r.programDirty=!0,r.textureDirty=!0,r.geometryDirty=!0;var i=Hs(zs),a=i.cullMode,l=i.depthCompare,c=i.depthWrite,h=i.stencilFront,d=i.stencilBack,f=i.stencilWrite,v=i.frontFace,p=i.polygonOffset,g=i.attachmentsState;return r.device=e,r.props=(0,u.Z)({cullMode:a,depthTest:!0,depthCompare:l,depthWrite:c,stencilFront:h,stencilBack:d,stencilWrite:f,frontFace:v,polygonOffset:p,attachmentsState:g,dithering:!1,wireframe:!1,wireframeColor:"black",wireframeLineWidth:1,vertexShader:"",fragmentShader:""},n),r.compile(),r}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"cullMode",get:function(){return this.props.cullMode},set:function(e){this.props.cullMode=e}},{key:"frontFace",get:function(){return this.props.frontFace},set:function(e){this.props.frontFace=e}},{key:"blendConstant",get:function(){return this.props.blendConstant},set:function(e){this.props.blendConstant=e}},{key:"blendEquation",get:function(){return this.props.blendEquation},set:function(e){this.props.blendEquation=e}},{key:"blendEquationAlpha",get:function(){return this.props.blendEquationAlpha},set:function(e){this.props.blendEquationAlpha=e}},{key:"blendSrc",get:function(){return this.props.blendSrc},set:function(e){this.props.blendSrc=e}},{key:"blendDst",get:function(){return this.props.blendDst},set:function(e){this.props.blendDst=e}},{key:"blendSrcAlpha",get:function(){return this.props.blendSrcAlpha},set:function(e){this.props.blendSrcAlpha=e}},{key:"blendDstAlpha",get:function(){return this.props.blendDstAlpha},set:function(e){this.props.blendDstAlpha=e}},{key:"depthCompare",get:function(){return this.props.depthCompare},set:function(e){this.props.depthCompare=e}},{key:"depthTest",get:function(){return this.props.depthTest},set:function(e){this.props.depthTest=e}},{key:"depthWrite",get:function(){return this.props.depthWrite},set:function(e){this.props.depthWrite=e}},{key:"stencilFront",get:function(){return this.props.stencilFront},set:function(e){this.props.stencilFront=e}},{key:"stencilBack",get:function(){return this.props.stencilBack},set:function(e){this.props.stencilBack=e}},{key:"stencilWrite",get:function(){return this.props.stencilWrite},set:function(e){this.props.stencilWrite=e}},{key:"stencilRef",get:function(){return this.props.stencilRef},set:function(e){this.props.stencilRef=e}},{key:"polygonOffset",get:function(){return this.props.polygonOffset},set:function(e){this.props.polygonOffset=e}},{key:"dithering",get:function(){return this.props.dithering},set:function(e){this.props.dithering=e}},{key:"wireframe",get:function(){return this.props.wireframe},set:function(e){this.props.wireframe!==e&&(this.geometryDirty=!0,this.programDirty=!0,this.props.wireframe=e,this.dispatchMutationEvent()),this.defines.USE_WIREFRAME=!!e}},{key:"wireframeColor",get:function(){return this.props.wireframeColor},set:function(e){this.props.wireframeColor=e}},{key:"wireframeLineWidth",get:function(){return this.props.wireframeLineWidth},set:function(e){this.props.wireframeLineWidth=e}},{key:"vertexShader",get:function(){return this.props.vertexShader},set:function(e){this.props.vertexShader!==e&&(this.programDirty=!0,this.props.vertexShader=e,this.compile())}},{key:"fragmentShader",get:function(){return this.props.fragmentShader},set:function(e){this.props.fragmentShader!==e&&(this.programDirty=!0,this.props.fragmentShader=e,this.compile())}},{key:"compile",value:function(){var e=this;this.props.fragmentShader.replace(/^\s*uniform\s*sampler2D\s*(.*)\s*;$/gm,(function(t,n){return e.samplers.push(n),""})),this.uniformNames=function(e){var t=[],n=[];return e.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,(function(e,t,r){var i=[];return r.trim().replace("\r\n","\n").split("\n").forEach((function(e){var t=(0,ds.__read)(e.trim().split(/\s+/),2),n=t[0],r=t[1];i.push({type:n.trim(),name:r.replace(";","").trim()})})),n.push({type:t.trim(),uniforms:i}),""})),e.replace(/\s*uniform(?:\s+)(?:\w+)(?:\s?){([^]*?)};?/g,(function(e,r){return r.trim().replace("\r\n","\n").split("\n").forEach((function(e){var r=e.trim().split(" "),i=r[0]||"",a=r[1]||"",o=a.indexOf("[")>-1;if(a=a.replace(";","").replace("[","").trim(),!i.startsWith("#")){if(i){var s=n.find((function(e){return i===e.type}));if(s)if(o)for(var l=function(e){s.uniforms.forEach((function(n){t.push("".concat(a,"[").concat(e,"].").concat(n.name))}))},u=0;u<5;u++)l(u);else s.uniforms.forEach((function(e){t.push("".concat(a,".").concat(e.name))}))}a&&t.push(a)}})),""})),t}(this.props.fragmentShader)}},{key:"setUniforms",value:function(e){var t=this,n=!1;Object.keys(e).forEach((function(r){var i,a=e[r],o=t.textures[r];o&&o!==a&&(t.textureDirty=!0),(i=a)&&i.type?(t.textures[r]=a,t.textureDirty=!0,a.on(Vo.LOADED,(function(){t.dispatchMutationEvent()}))):(t.uniforms[r]=a,n=!0),(0,T.Z)(e[r])&&(delete t.textures[r],delete t.uniforms[r])})),n&&this.dispatchMutationEvent()}},{key:"dispatchMutationEvent",value:function(){this.emit(Wh.CHANGED)}}])}(d.Z),Xh=function(e){function t(e,n){var r;return(0,o.Z)(this,t),(r=(0,s.Z)(this,t,[e,(0,u.Z)({},n)])).defines=(0,u.Z)((0,u.Z)({},r.defines),{},{USE_UV:!1,USE_MAP:!1,USE_WIREFRAME:!1,USE_FOG:!1,USE_LIGHT:!1}),r}return(0,l.Z)(t,e),(0,a.Z)(t)}(Hh);function zh(e){var t={};return Object.keys(e).forEach((function(n){"number"==typeof e[n]&&(t[n]=e[n])})),t}var Yh=function(e){return Object.fromEntries(Object.entries(e).filter((function(e){var t=(0,h.Z)(e,2);return t[0],void 0!==t[1]})))};function jh(e,t){return 256*(e=(0,R.Z)(Math.floor(e),0,255))+(t=(0,R.Z)(Math.floor(t),0,255))}var Kh=1,qh="FillTextureMapping",$h=function(e){return e[e.MODEL_MATRIX=0]="MODEL_MATRIX",e[e.PACKED_COLOR=1]="PACKED_COLOR",e[e.PACKED_STYLE=2]="PACKED_STYLE",e[e.PICKING_COLOR=3]="PICKING_COLOR",e[e.POSITION=4]="POSITION",e[e.NORMAL=5]="NORMAL",e[e.UV=6]="UV",e[e.BARYCENTRIC=7]="BARYCENTRIC",e[e.MAX=8]="MAX",e}({}),Qh=function(e){return e[e.MODEL_MATRIX0=0]="MODEL_MATRIX0",e[e.MODEL_MATRIX1=1]="MODEL_MATRIX1",e[e.MODEL_MATRIX2=2]="MODEL_MATRIX2",e[e.MODEL_MATRIX3=3]="MODEL_MATRIX3",e[e.PACKED_COLOR=4]="PACKED_COLOR",e[e.PACKED_STYLE1=5]="PACKED_STYLE1",e[e.PACKED_STYLE2=6]="PACKED_STYLE2",e[e.PICKING_COLOR=7]="PICKING_COLOR",e[e.POSITION=8]="POSITION",e[e.NORMAL=9]="NORMAL",e[e.UV=10]="UV",e[e.BARYCENTRIC=11]="BARYCENTRIC",e[e.MAX=12]="MAX",e}({}),Jh=function(){return(0,a.Z)((function e(t,n,r,i,a){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,l=arguments.length>6?arguments[6]:void 0;(0,o.Z)(this,e),this.id=Kh++,this.gradientAttributeName="fill",this.objects=[],this.program=new Bc,this.geometryDirty=!0,this.materialDirty=!0,this.textureMappings=[],this.divisor=1,this.mergeXYZIntoModelMatrix=!1,this.checkNodeName=!0,this.maxInstances=1/0,this.inited=!1,this.renderHelper=t,this.texturePool=n,this.lightPool=r,this.drawcallCtors=a,this.index=s,this.context=l}),[{key:"instance",get:function(){return this.objects[0]}},{key:"init",value:function(){this.inited||(this.renderer.beforeInitMesh(this),this.material=new Xh(this.context.device),this.material.defines=(0,u.Z)((0,u.Z)({},zh(Qh)),this.material.defines),this.geometry=new Ih(this.context.device),this.geometry.meshes=this.objects,this.material.meshes=this.objects,this.observeGeometryChanged(),this.observeMaterialChanged(),this.inited=!0,this.renderer.afterInitMesh(this))}},{key:"observeGeometryChanged",value:function(){var e=this;this.geometry.on(Oh.CHANGED,(function(){e.geometry.meshes.forEach((function(e){e.renderable.dirty=!0})),e.context.renderingService.dirty()}))}},{key:"observeMaterialChanged",value:function(){var e=this;this.material.on(Wh.CHANGED,(function(){e.material.meshes.forEach((function(e){e.renderable.dirty=!0})),e.context.renderingService.dirty()}))}},{key:"shouldMergeColor",value:function(e,t,n){var r=e.parsedStyle[n],i=t.parsedStyle[n];return!r&&!i||(!(!Tn(r)||!Tn(i))||(!(!_n(r)||!_n(i)||r.image!==i.image)||!(!Array.isArray(r)||!Array.isArray(i)||e.style[n]!==t.style[n])))}},{key:"shouldMerge",value:function(e,t){return!this.instance||(!this.checkNodeName||this.instance.nodeName===e.nodeName)&&(!e.parsedStyle.clipPath&&!(!this.shouldMergeColor(this.instance,e,"fill")||!this.shouldMergeColor(this.instance,e,"stroke")))}},{key:"createGeometry",value:function(e){var t,n,r=this,i=p.create(),a=p.create(),o=[],s=[],l=[],u=[],h=this.divisor,d=(null===(t=e[0])||void 0===t?void 0:t.nodeName)===he.CIRCLE||(null===(n=e[0])||void 0===n?void 0:n.nodeName)===he.ELLIPSE?.5:0;e.forEach((function(e){var t,n=e.parsedStyle,h=n.fill,v=n.stroke,g=n.opacity,m=void 0===g?1:g,y=n.fillOpacity,E=void 0===y?1:y,_=n.strokeOpacity,T=void 0===_?1:_,S=n.lineWidth,R=void 0===S?1:S,A=n.visibility,x=n.increasedLineWidthForHitTesting,k=void 0===x?0:x,N=[0,0,0,0];Tn(h)&&(N=[Number(h.r),Number(h.g),Number(h.b),255*Number(h.alpha)]);var M=[0,0,0,0];Tn(v)&&(M=[Number(v.r),Number(v.g),Number(v.b),255*Number(v.alpha)]),p.mul(a,r.context.camera.getViewTransform(),i);var C=e.isInteractive()&&(null===(t=e.renderable3D)||void 0===t?void 0:t.encodedPickingColor)||[0,0,0];if(r.mergeXYZIntoModelMatrix){var b=e.parsedStyle,P=b.x,O=b.y,I=b.z;p.mul(i,e.getWorldTransform(),p.fromTranslation(i,f.fromValues(P,O,I)))}else p.copy(i,e.getWorldTransform());o.push.apply(o,(0,c.Z)(i)),s.push(jh(N[0],N[1]),jh(N[2],N[3]),jh(M[0],M[1]),jh(M[2],M[3])),l.push(m,E,T,R,"hidden"!==A?1:0,d,d,k),u.push.apply(u,(0,c.Z)(C).concat([e.sortable.renderOrder*Gh]))})),this.geometry.instancedCount=e.length,this.geometry.setVertexBuffer({bufferIndex:$h.MODEL_MATRIX,byteStride:64,stepMode:Go.INSTANCE,attributes:[{format:es.F32_RGBA,bufferByteOffset:0,location:Qh.MODEL_MATRIX0,divisor:h},{format:es.F32_RGBA,bufferByteOffset:16,location:Qh.MODEL_MATRIX1,divisor:h},{format:es.F32_RGBA,bufferByteOffset:32,location:Qh.MODEL_MATRIX2,divisor:h},{format:es.F32_RGBA,bufferByteOffset:48,location:Qh.MODEL_MATRIX3,divisor:h}],data:new Float32Array(o)}),this.geometry.setVertexBuffer({bufferIndex:$h.PACKED_COLOR,byteStride:16,stepMode:Go.INSTANCE,attributes:[{format:es.F32_RGBA,bufferByteOffset:0,location:Qh.PACKED_COLOR,divisor:h}],data:new Float32Array(s)}),this.geometry.setVertexBuffer({bufferIndex:$h.PACKED_STYLE,byteStride:32,stepMode:Go.INSTANCE,attributes:[{format:es.F32_RGBA,bufferByteOffset:0,location:Qh.PACKED_STYLE1,divisor:h},{format:es.F32_RGBA,bufferByteOffset:16,location:Qh.PACKED_STYLE2,divisor:h}],data:new Float32Array(l)}),this.geometry.setVertexBuffer({bufferIndex:$h.PICKING_COLOR,byteStride:16,stepMode:Go.INSTANCE,attributes:[{format:es.F32_RGBA,bufferByteOffset:0,location:Qh.PICKING_COLOR,divisor:h}],data:new Float32Array(u)})}},{key:"destroy",value:function(){this.geometry&&this.geometry.destroy()}},{key:"applyRenderInst",value:function(e,t){var n=this,r=!!this.lightPool.getFog();this.clipPathTarget||this.clipPath?this.clipPathTarget?(this.material.stencilWrite=!0,this.material.depthWrite=!1,this.material.stencilFront={compare:bo.ALWAYS,passOp:zo.REPLACE},this.material.stencilBack={compare:bo.ALWAYS,passOp:zo.REPLACE}):(this.material.stencilWrite=!1,this.material.depthWrite=!0,this.material.stencilFront={compare:bo.EQUAL,passOp:zo.KEEP},this.material.stencilBack={compare:bo.EQUAL,passOp:zo.KEEP}):this.material.stencilWrite=!1,(this.materialDirty||this.material.programDirty)&&this.createMaterial(t);var i,a,o,s,l=(0,u.Z)({},this.material.defines);if(this.material.defines.USE_FOG=r,this.material.defines=(0,u.Z)((0,u.Z)((0,u.Z)({},this.lightPool.getDefines()),this.material.defines),this.renderHelper.getDefines()),this.material.textureDirty){this.textureMappings=[];var c=this.createFillGradientTextureMapping(t);c&&this.textureMappings.push(c),Object.keys(this.material.textures).sort((function(e,t){return n.material.samplers.indexOf(e)-n.material.samplers.indexOf(t)})).forEach((function(e){var t=new Rh;t.name=e,t.texture=n.material.textures[e],n.context.device.setResourceName(t.texture,"Material Texture ".concat(e)),t.sampler=n.renderHelper.getCache().createSampler({addressModeU:Lo.CLAMP_TO_EDGE,addressModeV:Lo.CLAMP_TO_EDGE,minFilter:Do.POINT,magFilter:Do.BILINEAR,mipmapFilter:Bo.LINEAR,lodMinClamp:0,lodMaxClamp:0}),n.textureMappings.push(t)})),this.textureMappings.length?(this.material.defines.USE_UV=!0,this.material.defines.USE_MAP=!0):(this.material.defines.USE_UV=!1,this.material.defines.USE_MAP=!1),this.material.textureDirty=!1}((i=l,a=this.material.defines,o=Object.keys(i),s=Object.keys(a),!(o.length===s.length&&o.every((function(e){return i[e]===a[e]}))))||this.material.programDirty||this.materialDirty)&&(this.material.defines=(0,u.Z)((0,u.Z)({},this.material.defines),zh(Qh)),Object.keys(this.material.defines).forEach((function(e){var t=n.material.defines[e];"boolean"==typeof t?n.program.setDefineBool(e,t):n.program.setDefineString(e,"".concat(t))})),this.program.vert=this.material.vertexShader,this.program.frag=this.material.fragmentShader,this.material.programDirty=!1,this.materialDirty=!1),this.material.geometryDirty&&(this.geometryDirty=!0,this.material.geometryDirty=!1),(this.geometryDirty||this.geometry.dirty)&&(this.geometry&&this.geometry.destroy(),this.createGeometry(t),this.material.wireframe&&this.generateWireframe(this.geometry),this.geometryDirty=!1,this.geometry.dirty=!1);var h=this.renderHelper.getCache().createProgramSimple(this.program),d=this.renderHelper.getCache().createInputLayout((0,u.Z)((0,u.Z)({},this.geometry.inputLayoutDescriptor),{},{program:h})),f=!!this.geometry.indexBuffer;e.renderPipelineDescriptor.topology=this.geometry.drawMode,e.setProgram(h),e.setVertexInput(d,this.geometry.vertexBuffers.filter((function(e){return!!e})).map((function(e){return{buffer:e,byteOffset:0}})),f?{buffer:this.geometry.indexBuffer,offset:0}:null),this.renderer.beforeUploadUBO(e,this),this.uploadUBO(e),f?e.drawIndexesInstanced(this.geometry.vertexCount,this.geometry.instancedCount,this.geometry.indexStart):e.drawPrimitives(this.geometry.vertexCount,this.geometry.primitiveStart),e.sortKey=sh(ah.OPAQUE,t[0].sortable.renderOrder)}},{key:"updateBatchedAttribute",value:function(e,t,n,r){var i=this;if(0!==e.length){if("fill"===n||"stroke"===n){var a=[];e.forEach((function(e){var t=e.parsedStyle,n=t.fill,r=t.stroke,i=[0,0,0,0];Tn(n)&&(i=[Number(n.r),Number(n.g),Number(n.b),255*Number(n.alpha)]);var o=[0,0,0,0];Tn(r)&&(o=[Number(r.r),Number(r.g),Number(r.b),255*Number(r.alpha)]),a.push(jh(i[0],i[1]),jh(i[2],i[3]),jh(o[0],o[1]),jh(o[2],o[3]))})),this.geometry.updateVertexBuffer($h.PACKED_COLOR,Qh.PACKED_COLOR,t,new Uint8Array(new Float32Array(a).buffer));var o=this.instance.parsedStyle.fill,s=this.textureMappings.findIndex((function(e){return e.name===qh}));if(Tn(o))s>=0&&(this.textureMappings.splice(s,-1),this.material.textureDirty=!0);else{var l=this.createFillGradientTextureMapping([this.instance]);s>=0&&this.textureMappings.splice(s,1,l),this.material.textureDirty=!0}}else if(["opacity","fillOpacity","strokeOpacity","lineWidth","visibility","anchor","increasedLineWidthForHitTesting"].indexOf(n)>-1){var u,h,d=[],v=(null===(u=e[0])||void 0===u?void 0:u.nodeName)===he.CIRCLE||(null===(h=e[0])||void 0===h?void 0:h.nodeName)===he.ELLIPSE?.5:0;e.forEach((function(e){var t=e.parsedStyle,n=t.opacity,r=void 0===n?1:n,i=t.fillOpacity,a=void 0===i?1:i,o=t.strokeOpacity,s=void 0===o?1:o,l=t.lineWidth,u=void 0===l?1:l,c=t.visibility,h=t.increasedLineWidthForHitTesting,f=void 0===h?0:h;d.push(r,a,s,u,"hidden"!==c?1:0,v,v,f)})),this.geometry.updateVertexBuffer($h.PACKED_STYLE,Qh.PACKED_STYLE1,t,new Uint8Array(new Float32Array(d).buffer))}else if("modelMatrix"===n||this.mergeXYZIntoModelMatrix&&("x"===n||"y"===n||"z"===n)){var g=[],m=p.create();e.forEach((function(e){if(i.mergeXYZIntoModelMatrix){var t=e.parsedStyle,n=t.x,r=t.y,a=t.z;p.mul(m,e.getWorldTransform(),p.fromTranslation(m,f.fromValues(n,r,a)))}else p.copy(m,e.getWorldTransform());g.push.apply(g,(0,c.Z)(m))})),this.geometry.updateVertexBuffer($h.MODEL_MATRIX,Qh.MODEL_MATRIX0,t,new Uint8Array(new Float32Array(g).buffer))}else if("pointerEvents"===n){var y=[];e.forEach((function(e){var t,n=r&&e.isInteractive()&&(null===(t=e.renderable3D)||void 0===t?void 0:t.encodedPickingColor)||[0,0,0];y.push.apply(y,(0,c.Z)(n).concat([e.sortable.renderOrder*Gh]))})),this.geometry.updateVertexBuffer($h.PICKING_COLOR,Qh.PICKING_COLOR,t,new Uint8Array(new Float32Array(y).buffer))}}}},{key:"updateAttribute",value:function(e,t,n,r){"clipPath"===n&&this.clipPath&&(this.geometryDirty=!0),!0===this.geometryDirty&&0!==this.objects.length&&(this.geometry&&this.geometry.destroy(),this.createGeometry(this.objects),this.geometryDirty=!1)}},{key:"changeRenderOrder",value:function(e,t){var n,r=this.objects.indexOf(e),i=e.isInteractive()&&(null===(n=e.renderable3D)||void 0===n?void 0:n.encodedPickingColor)||[0,0,0];this.geometry.updateVertexBuffer($h.PICKING_COLOR,Qh.PICKING_COLOR,r,new Uint8Array(new Float32Array([].concat((0,c.Z)(i),[t*Gh])).buffer))}},{key:"generateWireframe",value:function(e){for(var t=e.indices,n=e.indices.length,r=e.vertices.map((function(e){return e.slice()})),i=$h.PICKING_COLOR;i<e.vertexBuffers.length;i++){var a=e.inputLayoutDescriptor.vertexBufferDescriptors[i].arrayStride;e.vertices[i]=new Float32Array(a/4*n)}for(var o=0,s=new Uint32Array(n),l=0;l<n;l++){for(var u=t[l],c=1;c<e.vertices.length;c++)for(var h=e.inputLayoutDescriptor.vertexBufferDescriptors[c].arrayStride/4,d=0;d<h;d++)e.vertices[c][o*h+d]=r[c][u*h+d];s[l]=o,o++}for(var f=$h.PICKING_COLOR+1;f<e.vertexBuffers.length;f++){var v=e.inputLayoutDescriptor.vertexBufferDescriptors[f],p=v.stepMode,g=v.arrayStride,m=e.inputLayoutDescriptor.vertexBufferDescriptors[f].attributes[0];if(m){var y=m.shaderLocation,E=m.offset,_=m.format,T=m.divisor;e.setVertexBuffer({bufferIndex:f,byteStride:g,stepMode:p,attributes:[{format:_,bufferByteOffset:E,location:y,divisor:T}],data:e.vertices[f]})}}for(var S=new Float32Array(3*n),R=0;R<n;)for(var A=0;A<3;A++){S[3*s[R++]+A]=1}e.setVertexBuffer({bufferIndex:$h.BARYCENTRIC,byteStride:12,stepMode:Go.VERTEX,attributes:[{format:es.F32_RGB,bufferByteOffset:0,location:Number(Qh.BARYCENTRIC)}],data:S}),e.setIndexBuffer(s)}},{key:"beforeUploadUBO",value:function(e,t){}},{key:"uploadUBO",value:function(e){var t,n=this,r=this.material,i=this.lightPool.getAllLights(),a=this.lightPool.getFog(),o=!!a,s=null!==(t=r.defines.USE_LIGHT)&&void 0!==t?t:!!i.length,l=r.defines.USE_WIREFRAME,c=[];if(l){var h=Sn(r.wireframeColor);c.push({name:"u_WireframeLineColor",value:[Number(h.r)/255,Number(h.g)/255,Number(h.b)/255]}),c.push({name:"u_WireframeLineWidth",value:r.wireframeLineWidth})}if(o&&this.uploadFog(c,a),this.uploadMaterial(c,r),s){var d={};i.forEach((function(e){d[e.define]||(d[e.define]=-1),d[e.define]++,e.uploadUBO(c,d[e.define])}))}c.sort((function(e,t){return n.material.uniformNames.indexOf(e.name)-n.material.uniformNames.indexOf(t.name)})),e.setUniforms(1,c);var f=r.depthCompare,v=r.depthWrite,p=r.stencilFront,g=r.stencilBack,m=r.stencilWrite,y=r.stencilRef,E=r.cullMode,_=r.frontFace,T=r.polygonOffset,S=r.blendConstant,R=r.blendEquation,A=r.blendEquationAlpha,x=r.blendSrc,k=r.blendDst,N=r.blendSrcAlpha,M=r.blendDstAlpha,C=Yh({blendConstant:S,depthCompare:f,depthWrite:v,stencilFront:p,stencilBack:g,stencilWrite:m,stencilRef:y,cullMode:E,frontFace:_,polygonOffset:T}),b=e.getMegaStateFlags().attachmentsState[0];e.setMegaStateFlags((0,u.Z)({attachmentsState:[{channelWriteMask:this.material.stencilWrite?Xo.NONE:Xo.ALL,rgbBlendState:(0,u.Z)((0,u.Z)({},b.rgbBlendState),Yh({blendMode:R,blendSrcFactor:x,blendDstFactor:k})),alphaBlendState:(0,u.Z)((0,u.Z)({},b.alphaBlendState),Yh({blendMode:A,blendSrcFactor:N,blendDstFactor:M}))}]},C)),e.setBindingLayout({numUniformBuffers:1,numSamplers:this.textureMappings.length}),e.setSamplerBindingsFromTextureMappings(this.textureMappings)}},{key:"uploadFog",value:function(e,t){var n=t.parsedStyle,r=n.type,i=n.fill,a=n.start,o=n.end,s=n.density;if(Tn(i)){var l=[Number(i.r)/255,Number(i.g)/255,Number(i.b)/255,Number(i.alpha)];e.push({name:"u_FogInfos",value:[r,a,o,s]}),e.push({name:"u_FogColor",value:l})}}},{key:"uploadMaterial",value:function(e,t){var n=Object.keys(t.uniforms).map((function(e){return{name:e,value:t.uniforms[e]}}));e.push.apply(e,(0,c.Z)(n))}},{key:"createFillGradientTextureMapping",value:function(e){var t,n=this,r=e[0],i=r.parsedStyle[this.gradientAttributeName];if(i&&(_n(i)||Array.isArray(i))){Array.isArray(i)?(this.program.setDefineBool("USE_PATTERN",!1),this.texturePool.getOrCreateGradient({gradients:i,width:128,height:128,instance:r})):_n(i)&&(this.program.setDefineBool("USE_PATTERN",!0),this.texturePool.getOrCreatePattern(i,r,(function(){e.forEach((function(e){e.renderable.dirty=!0})),n.material.textureDirty=!0}))),t=this.texturePool.getOrCreateCanvas();var a=this.texturePool.getOrCreateTexture(this.context.device,t,fs(es.U8_RGBA_NORM,1,1,1));if(a){var o=new Rh;return o.name=qh,o.texture=a,o.texture.on("loaded",(function(){e.forEach((function(e){e.renderable.dirty=!0})),n.material.textureDirty=!0})),this.context.device.setResourceName(o.texture,"Fill Texture".concat(this.id)),o.sampler=this.renderHelper.getCache().createSampler({addressModeU:Lo.CLAMP_TO_EDGE,addressModeV:Lo.CLAMP_TO_EDGE,minFilter:Do.POINT,magFilter:Do.BILINEAR,mipmapFilter:Bo.LINEAR,lodMinClamp:0,lodMaxClamp:0}),o}}return null}}])}(),ed=function(e){return e[e.PACKED_STYLE=$h.POSITION+1]="PACKED_STYLE",e}(ed||{}),td=function(e){return e[e.PACKED_STYLE3=Qh.MAX]="PACKED_STYLE3",e[e.EXTRUDE=1+e.PACKED_STYLE3]="EXTRUDE",e[e.SIZE=1+e.EXTRUDE]="SIZE",e}(td||{}),nd=[he.CIRCLE,he.ELLIPSE,he.RECT],rd=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"shouldMerge",value:function(e,n){var r=(0,W.Z)(t,"shouldMerge",this,3)([e,n]);return!!r}},{key:"createMaterial",value:function(e){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = EXTRUDE) in vec2 a_Extrude;\n// shape, radius, omitStroke, isBillboard\nlayout(location = PACKED_STYLE3) in vec3 a_StylePacked3;\nlayout(location = SIZE) in vec4 a_Size;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nout vec2 v_Data;\nout vec2 v_Radius;\nout vec3 v_StylePacked3;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  float strokeWidth;\n  if (u_IsPicking > 0.5) {\n    strokeWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;\n  } else {\n    strokeWidth = u_StrokeWidth;\n  }\n\n  bool omitStroke = a_StylePacked3.z == 1.0;\n  vec2 radius = a_Size.xy + vec2(omitStroke ? 0.0 : strokeWidth / 2.0);\n  vec2 offset = (a_Extrude + vec2(1.0) - 2.0 * u_Anchor.xy) * a_Size.xy + a_Extrude * vec2(omitStroke ? 0.0 : strokeWidth / 2.0);\n\n  bool isBillboard = a_Size.z > 0.5;\n  if (isBillboard) {\n    float rotation = 0.0;\n    bool isSizeAttenuation = a_Size.w > 0.5;\n    gl_Position = billboard(offset, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, a_Position);\n  } else {\n    gl_Position = project(vec4(a_Position.xy + offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n  \n  v_Radius = radius;\n  v_Data = vec2(a_Extrude * radius / radius.y);\n  v_StylePacked3 = a_StylePacked3;\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nin vec2 v_Data;\nin vec2 v_Radius;\nin vec3 v_StylePacked3;\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\n/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\n// @see http://www.iquilezles.org/www/articles/ellipsoids/ellipsoids.htm\nfloat sdEllipsoidApproximated(vec2 p, vec2 r) {\n  float k0 = length(p / r);\n  float k1 = length(p / (r * r));\n  return k0 * (k0 - 1.0) / k1;\n}\n\n// @see https://www.shadertoy.com/view/4llXD7\nfloat sdRoundedBox(vec2 p, vec2 b, float r) {\n  p = abs(p) - b + r;\n  return length(max(p, 0.0)) + min(max(p.x, p.y), 0.0) - r;\n}\n\nvoid main() {\n  int shape = int(floor(v_StylePacked3.x + 0.5));\n\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  bool omitStroke = v_StylePacked3.z == 1.0;\n\n  vec2 r = (v_Radius - (omitStroke ? 0.0 : u_StrokeWidth)) / v_Radius.y;\n  float wh = v_Radius.x / v_Radius.y;\n\n  float dist = length(v_Data);\n  float antialiased_blur = -fwidth(dist);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'ellipse', 'rect'\n  if (shape == 0) {\n    outer_df = sdCircle(v_Data, 1.0);\n    inner_df = sdCircle(v_Data, r.x);\n  } else if (shape == 1) {\n    outer_df = sdEllipsoidApproximated(v_Data, vec2(wh, 1.0));\n    inner_df = sdEllipsoidApproximated(v_Data, r);\n  } else if (shape == 2) {\n    bool useRadius = v_StylePacked3.y > epsilon;\n    outer_df = sdRoundedBox(v_Data, vec2(wh, 1.0), useRadius ? (v_StylePacked3.y + u_StrokeWidth / 2.0) / v_Radius.y : 0.0);\n    inner_df = sdRoundedBox(v_Data, r, useRadius ? (v_StylePacked3.y - u_StrokeWidth / 2.0) / v_Radius.y : 0.0);\n  }\n\n  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);\n\n  float color_t = u_StrokeWidth < 0.01 ? 0.0 : smoothstep(\n    antialiased_blur,\n    0.0,\n    inner_df\n  );\n\n  vec4 diffuseColor;\n  vec4 strokeColor;\n  if (u_IsPicking > 0.5) {\n    diffuseColor = vec4(u_PickingColor, 1.0);\n    strokeColor = vec4(u_PickingColor, 1.0);\n  } else {\n    diffuseColor = u_Color;\n    strokeColor = (u_StrokeColor == vec4(0) || omitStroke) ? vec4(0.0) : u_StrokeColor;\n  }\n\n  outputColor = mix(vec4(diffuseColor.rgb, diffuseColor.a * u_FillOpacity), strokeColor * u_StrokeOpacity, color_t);\n  outputColor.a = outputColor.a * u_Opacity * opacity_t;\n\n  if (outputColor.a < epsilon)\n    discard;\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n  }\n}",this.material.defines=(0,u.Z)((0,u.Z)({},this.material.defines),zh(td))}},{key:"createGeometry",value:function(e){var n=this;(0,W.Z)(t,"createGeometry",this,3)([e]);var r=[],i=[];e.forEach((function(e,t){var a=e,o=a.parsedStyle.radius,s=n.shouldOmitStroke(a.parsedStyle),l=n.getSize(e.parsedStyle,a.nodeName),u=n.getPosition(e.parsedStyle,a.nodeName);r.push.apply(r,(0,c.Z)(l).concat([a.parsedStyle.isBillboard?1:0,a.parsedStyle.isSizeAttenuation?1:0,nd.indexOf(a.nodeName),o&&o[0]||0,s?1:0])),i.push.apply(i,(0,c.Z)(u))})),this.geometry.setIndexBuffer(new Uint32Array([0,2,1,0,3,2])),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:$h.UV,byteStride:16,stepMode:Go.VERTEX,attributes:[{format:es.F32_RG,bufferByteOffset:0,location:td.EXTRUDE},{format:es.F32_RG,bufferByteOffset:8,location:Qh.UV}],data:new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1])}),this.geometry.setVertexBuffer({bufferIndex:$h.POSITION,byteStride:12,stepMode:Go.INSTANCE,attributes:[{format:es.F32_RGB,bufferByteOffset:0,location:Qh.POSITION}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:ed.PACKED_STYLE,byteStride:28,stepMode:Go.INSTANCE,attributes:[{format:es.F32_RGBA,bufferByteOffset:0,location:td.SIZE,divisor:1},{format:es.F32_RGB,bufferByteOffset:16,location:td.PACKED_STYLE3,divisor:1}],data:new Float32Array(r)})}},{key:"updateAttribute",value:function(e,n,r,i){var a=this;if(0!==e.length)if((0,W.Z)(t,"updateAttribute",this,3)([e,n,r,i]),this.updateBatchedAttribute(e,n,r,i),"r"===r||"rx"===r||"ry"===r||"width"===r||"height"===r||"lineWidth"===r||"stroke"===r||"lineDash"===r||"strokeOpacity"===r||"radius"===r||"isBillboard"===r||"isSizeAttenuation"===r){var o=[];e.forEach((function(e){var t=e,n=a.shouldOmitStroke(t.parsedStyle),r=a.getSize(e.parsedStyle,e.nodeName),i=(0,h.Z)(r,2),s=[i[0],i[1]];o.push.apply(o,s.concat([t.parsedStyle.isBillboard?1:0,t.parsedStyle.isSizeAttenuation?1:0,nd.indexOf(e.nodeName),e.parsedStyle.radius&&e.parsedStyle.radius[0]||0,n?1:0]))})),this.geometry.updateVertexBuffer(ed.PACKED_STYLE,td.SIZE,n,new Uint8Array(new Float32Array(o).buffer))}else if("cx"===r||"cy"===r||"x"===r||"y"===r){var s=[];e.forEach((function(e){var t=a.getPosition(e.parsedStyle,e.nodeName),n=(0,h.Z)(t,2),r=n[0],i=n[1];s.push(r,i)})),this.geometry.updateVertexBuffer($h.POSITION,Qh.POSITION,n,new Uint8Array(new Float32Array(s).buffer))}}},{key:"getPosition",value:function(e,t){var n=[0,0,0];if(t===he.CIRCLE||t===he.ELLIPSE){var r=e,i=r.cx,a=void 0===i?0:i,o=r.cy,s=void 0===o?0:o,l=r.cz;n=[a,s,void 0===l?0:l]}else if(t===he.RECT){var u=e,c=u.x,h=void 0===c?0:c,d=u.y,f=void 0===d?0:d,v=u.z;n=[h,f,void 0===v?0:v]}return n}},{key:"getSize",value:function(e,t){var n=[0,0];if(t===he.CIRCLE){var r=e.r;n=[r,r]}else if(t===he.ELLIPSE){var i=e;n=[i.rx,i.ry]}else if(t===he.RECT){var a=e;n=[a.width/2,a.height/2]}return n}},{key:"shouldOmitStroke",value:function(e){var t=e.lineDash,n=e.stroke,r=e.strokeOpacity,i=n&&!n.isNone,a=t&&t.length&&t.every((function(e){return 0!==e}));return!i||i&&(a||r<1)}}])}(Jh);function id(e,t,n,r,i,a){for(var o=i[i.length-3],s=i[i.length-2],l=null!=a?a:(0,R.Z)(ae(o,s,e,t,n,r,3)/10,8,100),u=0,c=0,h=1;h<=l;++h){var d=h/l;u=o+(e-o)*d,c=s+(t-s)*d,i.push(u+(e+(n-e)*d-u)*d,c+(t+(r-t)*d-c)*d,0)}}function ad(e,t,n,r,i,a,o,s){var l=o[o.length-3],u=o[o.length-2];o.length-=3;var c=null!=s?s:(0,R.Z)(ee(l,u,e,t,n,r,i,a,3)/10,8,100),h=0,d=0,f=0,v=0,p=0;o.push(l,u,0);for(var g=1,m=0;g<=c;++g)f=(d=(h=1-(m=g/c))*h)*h,p=(v=m*m)*m,o.push(f*l+3*d*m*e+3*h*v*n+p*i,f*u+3*d*m*t+3*h*v*r+p*a,0)}var od=1e20,sd=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e);var r=t.fontSize,i=void 0===r?24:r,a=t.buffer,s=void 0===a?3:a,l=t.radius,u=void 0===l?8:l,c=t.cutoff,h=void 0===c?.25:c,d=t.fontFamily,f=void 0===d?"sans-serif":d,v=t.fontWeight,p=void 0===v?"normal":v,g=t.fontStyle,m=void 0===g?"normal":g,y=t.canvas;this.buffer=s,this.cutoff=h,this.radius=u;var E=this.size=i+4*s,_=n.offscreenCanvasCreator.getOrCreateCanvas(y);_.width=E,_.height=E;var T=n.offscreenCanvasCreator.getOrCreateContext(y,{willReadFrequently:!0});this.ctx=T,T.font="".concat(m," ").concat(p," ").concat(i,"px ").concat(f),T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}),[{key:"draw",value:function(e){var t=this.ctx.measureText(e),n=t.width,r=t.actualBoundingBoxAscent,i=t.actualBoundingBoxDescent,a=t.actualBoundingBoxLeft,o=t.actualBoundingBoxRight,s=Math.ceil(r),l=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-a))),u=Math.min(this.size-this.buffer,s+Math.ceil(i)),c=l+2*this.buffer,h=u+2*this.buffer,d=Math.max(c*h,0),f=new Uint8ClampedArray(d),v={data:f,width:c,height:h,glyphWidth:l,glyphHeight:u,glyphTop:s,glyphLeft:0,glyphAdvance:n};if(0===l||0===u)return v;var p=this.ctx,g=this.buffer,m=this.gridInner,y=this.gridOuter;p.clearRect(g,g,l,u),p.fillText(e,g,g+s);var E=p.getImageData(g,g,l,u);y.fill(od,0,d),m.fill(0,0,d);for(var _=0;_<u;_++)for(var T=0;T<l;T++){var S=E.data[4*(_*l+T)+3]/255;if(0!==S){var R=(_+g)*c+T+g;if(1===S)y[R]=0,m[R]=od;else{var A=.5-S;y[R]=A>0?A*A:0,m[R]=A<0?A*A:0}}}ld(y,0,0,c,h,c,this.f,this.v,this.z),ld(m,g,g,l,u,c,this.f,this.v,this.z);for(var x=0;x<d;x++){var k=Math.sqrt(y[x])-Math.sqrt(m[x]);f[x]=Math.round(255-255*(k/this.radius+this.cutoff))}return v}}])}();function ld(e,t,n,r,i,a,o,s,l){for(var u=t;u<t+r;u++)ud(e,n*a+u,a,i,o,s,l);for(var c=n;c<n+i;c++)ud(e,c*a+t,1,r,o,s,l)}function ud(e,t,n,r,i,a,o){a[0]=0,o[0]=-od,o[1]=od,i[0]=e[t];for(var s=1,l=0,u=0;s<r;s++){i[s]=e[t+s*n];var c=s*s;do{var h=a[l];u=(i[s]-i[h]+c-h*h)/(s-h)/2}while(u<=o[l]&&--l>-1);a[++l]=s,o[l]=u,o[l+1]=od}for(var d=0,f=0;d<r;d++){for(;o[f+1]<d;)f++;var v=a[f],p=d-v;e[t+d*n]=i[v]+p*p}}var cd=function(e){return e[e.PACKED=$h.POSITION+1]="PACKED",e[e.VERTEX_NUM=1+e.PACKED]="VERTEX_NUM",e[e.TRAVEL=1+e.VERTEX_NUM]="TRAVEL",e[e.DASH=1+e.TRAVEL]="DASH",e}(cd||{}),hd=function(e){return e[e.PREV=Qh.POSITION]="PREV",e[e.POINT1=1+e.PREV]="POINT1",e[e.POINT2=1+e.POINT1]="POINT2",e[e.NEXT=1+e.POINT2]="NEXT",e[e.VERTEX_JOINT=1+e.NEXT]="VERTEX_JOINT",e[e.VERTEX_NUM=1+e.VERTEX_JOINT]="VERTEX_NUM",e[e.TRAVEL=1+e.VERTEX_NUM]="TRAVEL",e[e.DASH=1+e.TRAVEL]="DASH",e}(hd||{});function dd(e,t,n){return 4*(e?1:0)+2*(t?1:0)+(n?1:0)}function fd(e){if(!(e.nodeName===he.POLYLINE))return!1;var t=e.parsedStyle.points.points;return t.length&&!(0,T.Z)(t[0][2])}var vd=function(e){function t(e,n,r,i,a,l,u){var c;return(0,o.Z)(this,t),(c=(0,s.Z)(this,t,[e,n,r,i,a,l,u])).segmentNum=-1,c.renderHelper=e,c.texturePool=n,c.lightPool=r,c.segmentNum=c.calcSegmentNum(i),c.gradientAttributeName="stroke",c}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"calcSegmentNum",value:function(e){return gd(e,!1,12,this.calcSubpathIndex(e)).instancedCount}},{key:"calcSubpathIndex",value:function(e){if(e.nodeName===he.PATH){var t=this.drawcallCtors.filter((function(e){return e===Sd})).length;return this.index-t}return 0}},{key:"shouldMerge",value:function(e,n){var r=(0,W.Z)(t,"shouldMerge",this,3)([e,n]);if(!r)return!1;if(this.index!==n)return!1;var i=this.calcSegmentNum(e);return this.segmentNum===i}},{key:"createMaterial",value:function(e){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = PREV) in vec3 a_Prev;\nlayout(location = POINT1) in vec3 a_Point1;\nlayout(location = POINT2) in vec3 a_Point2;\nlayout(location = NEXT) in vec3 a_Next;\nlayout(location = VERTEX_JOINT) in float a_VertexJoint;\nlayout(location = VERTEX_NUM) in float a_VertexNum;\nlayout(location = TRAVEL) in float a_Travel;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\nlayout(location = DASH) in vec4 a_Dash;\nout vec4 v_Dash;\n\nconst float FILL = 1.0;\nconst float BEVEL = 4.0;\nconst float MITER = 8.0;\nconst float ROUND = 12.0;\nconst float JOINT_CAP_BUTT = 16.0;\nconst float JOINT_CAP_SQUARE = 18.0;\nconst float JOINT_CAP_ROUND = 20.0;\nconst float FILL_EXPAND = 24.0;\nconst float CAP_BUTT = 1.0;\nconst float CAP_SQUARE = 2.0;\nconst float CAP_ROUND = 3.0;\nconst float CAP_BUTT2 = 4.0;\n\nconst float u_Expand = 1.0;\nconst float u_MiterLimit = 5.0;\nconst float u_ScaleMode = 1.0;\nconst float u_Alignment = 0.5;\n\nout vec4 v_Distance;\nout vec4 v_Arc;\nout float v_Type;\nout float v_Travel;\nout float v_ScalingFactor;\n\nvec2 doBisect(\n  vec2 norm, float len, vec2 norm2, float len2, float dy, float inner\n) {\n  vec2 bisect = (norm + norm2) / 2.0;\n  bisect /= dot(norm, bisect);\n  vec2 shift = dy * bisect;\n  if (inner > 0.5) {\n    if (len < len2) {\n      if (abs(dy * (bisect.x * norm.y - bisect.y * norm.x)) > len) {\n        return dy * norm;\n      }\n    } else {\n      if (abs(dy * (bisect.x * norm2.y - bisect.y * norm2.x)) > len2) {\n        return dy * norm;\n      }\n    }\n  }\n  return dy * bisect;\n}\n\nvec2 clip2ScreenSpace(vec4 clip) {\n  return u_Viewport * (0.5 * clip.xy / clip.w + 0.5);\n}\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  v_Dash = a_Dash;\n\n  vec2 pointA;\n  vec2 pointB;\n  vec4 clip0;\n  vec4 clip1;\n\n  float compressed = a_Dash.w;\n  float is_billboard = floor(compressed / 4.0);\n  compressed -= is_billboard * 4.0;\n  float is_size_attenuation = floor(compressed / 2.0);\n  compressed -= is_size_attenuation * 2.0;\n  float is_3d_polyline = compressed;\n\n  bool isBillboard = is_billboard > 0.5;\n  bool isSizeAttenuation = is_size_attenuation > 0.5;\n  bool is3DPolyline = is_3d_polyline > 0.5;\n  if (isBillboard) {\n    clip0 = billboard(a_Point1.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0));\n    clip1 = billboard(a_Point2.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0));\n  } else if (is3DPolyline) {\n    clip0 = project(vec4(a_Point1, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    clip1 = project(vec4(a_Point2, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n\n  if (isBillboard || is3DPolyline) {\n    pointA = clip2ScreenSpace(clip0);\n    pointB = clip2ScreenSpace(clip1);\n  } else {\n    pointA = (u_ModelMatrix * vec4(a_Point1, 1.0)).xy;\n    pointB = (u_ModelMatrix * vec4(a_Point2, 1.0)).xy;\n  }\n\n  vec2 xBasis = pointB - pointA;\n  float len = length(xBasis);\n  vec2 forward = xBasis / len;\n  vec2 norm = vec2(forward.y, -forward.x);\n\n  float type = a_VertexJoint;\n\n  float lineWidth;\n  if (u_IsPicking > 0.5) {\n    lineWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;\n  } else {\n    lineWidth = u_StrokeWidth;\n  }\n\n  if (u_ScaleMode > 2.5) {\n    lineWidth *= length(u_ModelMatrix * vec4(1.0, 0.0, 0.0, 0.0));\n  } else if (u_ScaleMode > 1.5) {\n    lineWidth *= length(u_ModelMatrix * vec4(0.0, 1.0, 0.0, 0.0));\n  } else if (u_ScaleMode > 0.5) {\n    vec2 avgDiag = (u_ModelMatrix * vec4(1.0, 1.0, 0.0, 0.0)).xy;\n    lineWidth *= sqrt(dot(avgDiag, avgDiag) * 0.5);\n  }\n  float capType = floor(type / 32.0);\n  type -= capType * 32.0;\n  v_Arc = vec4(0.0);\n  lineWidth *= 0.5;\n  float lineAlignment = 2.0 * u_Alignment - 1.0;\n\n  vec2 pos;\n\n  if (capType == CAP_ROUND) {\n    if (a_VertexNum < 3.5) {\n      gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n      return;\n    }\n    type = JOINT_CAP_ROUND;\n    capType = 0.0;\n  }\n\n  if (type >= BEVEL) {\n    float dy = lineWidth + u_Expand;\n    float inner = 0.0;\n    if (a_VertexNum >= 1.5) {\n      dy = -dy;\n      inner = 1.0;\n    }\n\n    vec2 base, next, xBasis2, bisect;\n    float flag = 0.0;\n    float sign2 = 1.0;\n    if (a_VertexNum < 0.5 || a_VertexNum > 2.5 && a_VertexNum < 3.5) {\n      if (isBillboard) {\n        next = clip2ScreenSpace(billboard(a_Prev.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0)));\n      } else if (is3DPolyline) {\n        next = clip2ScreenSpace(project(vec4(a_Prev, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix));\n      } else {\n        next = (u_ModelMatrix * vec4(a_Prev, 1.0)).xy;\n      }\n\n      base = pointA;\n      flag = type - floor(type / 2.0) * 2.0;\n      sign2 = -1.0;\n    } else {\n      if (isBillboard) {\n        next = clip2ScreenSpace(billboard(a_Next.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0)));\n      } else if (is3DPolyline) {\n        next = clip2ScreenSpace(project(vec4(a_Next, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix));\n      } else {\n        next = (u_ModelMatrix * vec4(a_Next, 1.0)).xy;\n      }\n      \n      base = pointB;\n      if (type >= MITER && type < MITER + 3.5) {\n        flag = step(MITER + 1.5, type);\n        // check miter limit here?\n      }\n    }\n    xBasis2 = next - base;\n    float len2 = length(xBasis2);\n    vec2 norm2 = vec2(xBasis2.y, -xBasis2.x) / len2;\n    float D = norm.x * norm2.y - norm.y * norm2.x;\n    if (D < 0.0) {\n      inner = 1.0 - inner;\n    }\n    norm2 *= sign2;\n\n    if (abs(lineAlignment) > 0.01) {\n      float shift = lineWidth * lineAlignment;\n      pointA += norm * shift;\n      pointB += norm * shift;\n      if (abs(D) < 0.01) {\n        base += norm * shift;\n      } else {\n        base += doBisect(norm, len, norm2, len2, shift, 0.0);\n      }\n    }\n\n    float collinear = step(0.0, dot(norm, norm2));\n    v_Type = 0.0;\n    float dy2 = -1000.0;\n    float dy3 = -1000.0;\n    if (abs(D) < 0.01 && collinear < 0.5) {\n      if (type >= ROUND && type < ROUND + 1.5) {\n        type = JOINT_CAP_ROUND;\n      }\n      // TODO: BUTT here too\n    }\n\n    if (a_VertexNum < 3.5) {\n      if (abs(D) < 0.01) {\n        pos = dy * norm;\n      } else {\n        if (flag < 0.5 && inner < 0.5) {\n          pos = dy * norm;\n        } else {\n          pos = doBisect(norm, len, norm2, len2, dy, inner);\n        }\n      }\n      if (capType >= CAP_BUTT && capType < CAP_ROUND) {\n        float extra = step(CAP_SQUARE, capType) * lineWidth;\n        vec2 back = -forward;\n        if (a_VertexNum < 0.5 || a_VertexNum > 2.5) {\n          pos += back * (u_Expand + extra);\n          dy2 = u_Expand;\n        } else {\n          dy2 = dot(pos + base - pointA, back) - extra;\n        }\n      }\n      if (type >= JOINT_CAP_BUTT && type < JOINT_CAP_SQUARE + 0.5) {\n        float extra = step(JOINT_CAP_SQUARE, type) * lineWidth;\n        if (a_VertexNum < 0.5 || a_VertexNum > 2.5) {\n          dy3 = dot(pos + base - pointB, forward) - extra;\n        } else {\n          pos += forward * (u_Expand + extra);\n          dy3 = u_Expand;\n          if (capType >= CAP_BUTT) {\n            dy2 -= u_Expand + extra;\n          }\n        }\n      }\n    } else if (type >= JOINT_CAP_ROUND && type < JOINT_CAP_ROUND + 1.5) {\n      if (inner > 0.5) {\n        dy = -dy;\n        inner = 0.0;\n      }\n      vec2 d2 = abs(dy) * forward;\n      if (a_VertexNum < 4.5) {\n        dy = -dy;\n        pos = dy * norm;\n      } else if (a_VertexNum < 5.5) {\n        pos = dy * norm;\n      } else if (a_VertexNum < 6.5) {\n        pos = dy * norm + d2;\n        v_Arc.x = abs(dy);\n      } else {\n        dy = -dy;\n        pos = dy * norm + d2;\n        v_Arc.x = abs(dy);\n      }\n      dy2 = 0.0;\n      v_Arc.y = dy;\n      v_Arc.z = 0.0;\n      v_Arc.w = lineWidth;\n      v_Type = 3.0;\n    } else if (abs(D) < 0.01) {\n      pos = dy * norm;\n    } else {\n      if (type >= ROUND && type < ROUND + 1.5) {\n        if (inner > 0.5) {\n          dy = -dy;\n          inner = 0.0;\n        }\n        if (a_VertexNum < 4.5) {\n          pos = doBisect(norm, len, norm2, len2, -dy, 1.0);\n        } else if (a_VertexNum < 5.5) {\n          pos = dy * norm;\n        } else if (a_VertexNum > 7.5) {\n          pos = dy * norm2;\n        } else {\n          pos = doBisect(norm, len, norm2, len2, dy, 0.0);\n          float d2 = abs(dy);\n          if (length(pos) > abs(dy) * 1.5) {\n            if (a_VertexNum < 6.5) {\n              pos.x = dy * norm.x - d2 * norm.y;\n              pos.y = dy * norm.y + d2 * norm.x;\n            } else {\n              pos.x = dy * norm2.x + d2 * norm2.y;\n              pos.y = dy * norm2.y - d2 * norm2.x;\n            }\n          }\n        }\n        vec2 norm3 = normalize(norm + norm2);\n        float sign = step(0.0, dy) * 2.0 - 1.0;\n        v_Arc.x = sign * dot(pos, norm3);\n        v_Arc.y = pos.x * norm3.y - pos.y * norm3.x;\n        v_Arc.z = dot(norm, norm3) * lineWidth;\n        v_Arc.w = lineWidth;\n        dy = -sign * dot(pos, norm);\n        dy2 = -sign * dot(pos, norm2);\n        dy3 = v_Arc.z - v_Arc.x;\n        v_Type = 3.0;\n      } else {\n        float hit = 0.0;\n        if (type >= BEVEL && type < BEVEL + 1.5) {\n          if (dot(norm, norm2) > 0.0) {\n            type = MITER;\n          }\n        }\n        if (type >= MITER && type < MITER + 3.5) {\n          if (inner > 0.5) {\n            dy = -dy;\n            inner = 0.0;\n          }\n          float sign = step(0.0, dy) * 2.0 - 1.0;\n          pos = doBisect(norm, len, norm2, len2, dy, 0.0);\n          if (length(pos) > abs(dy) * u_MiterLimit) {\n            type = BEVEL;\n          } else {\n            if (a_VertexNum < 4.5) {\n              dy = -dy;\n              pos = doBisect(norm, len, norm2, len2, dy, 1.0);\n            } else if (a_VertexNum < 5.5) {\n              pos = dy * norm;\n            } else if (a_VertexNum > 6.5) {\n              pos = dy * norm2;\n            }\n            v_Type = 1.0;\n            dy = -sign * dot(pos, norm);\n            dy2 = -sign * dot(pos, norm2);\n            hit = 1.0;\n          }\n        }\n        if (type >= BEVEL && type < BEVEL + 1.5) {\n          if (inner > 0.5) {\n            dy = -dy;\n            inner = 0.0;\n          }\n          float d2 = abs(dy);\n          vec2 pos3 = vec2(dy * norm.x - d2 * norm.y, dy * norm.y + d2 * norm.x);\n          vec2 pos4 = vec2(dy * norm2.x + d2 * norm2.y, dy * norm2.y - d2 * norm2.x);\n          if (a_VertexNum < 4.5) {\n            pos = doBisect(norm, len, norm2, len2, -dy, 1.0);\n          } else if (a_VertexNum < 5.5) {\n            pos = dy * norm;\n          } else if (a_VertexNum > 7.5) {\n            pos = dy * norm2;\n          } else {\n            if (a_VertexNum < 6.5) {\n              pos = pos3;\n            } else {\n              pos = pos4;\n            }\n          }\n          vec2 norm3 = normalize(norm + norm2);\n          float sign = step(0.0, dy) * 2.0 - 1.0;\n          dy = -sign * dot(pos, norm);\n          dy2 = -sign * dot(pos, norm2);\n          dy3 = (-sign * dot(pos, norm3)) + lineWidth;\n          v_Type = 4.0;\n          hit = 1.0;\n        }\n        if (hit < 0.5) {\n          gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n          return;\n        }\n      }\n    }\n    pos += base;\n    v_Distance = vec4(dy, dy2, dy3, lineWidth) * u_DevicePixelRatio;\n    v_Arc = v_Arc * u_DevicePixelRatio;\n    v_Travel = a_Travel + dot(pos - pointA, vec2(-norm.y, norm.x));\n  }\n\n  v_ScalingFactor = sqrt(u_ModelMatrix[0][0] * u_ModelMatrix[0][0] + u_ModelMatrix[0][1] * u_ModelMatrix[0][1] + u_ModelMatrix[0][2] * u_ModelMatrix[0][2]);\n\n  if (isBillboard || is3DPolyline) {\n    vec4 clip = mix(clip0, clip1, 0.5);\n    gl_Position = vec4(clip.w * (2.0 * pos / u_Viewport - 1.0), clip.z, clip.w);\n  } else {\n    gl_Position = u_ProjectionMatrix * u_ViewMatrix * vec4(pos, u_ZIndex, 1.0);\n  }\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nin vec4 v_Dash;\n\nin vec4 v_Distance;\nin vec4 v_Arc;\nin float v_Type;\nin float v_Travel;\nin float v_ScalingFactor;\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\nvoid main(){\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  float alpha = 1.0;\n  float lineWidth = v_Distance.w;\n  if (v_Type < 0.5) {\n    float left = max(v_Distance.x - 0.5, -v_Distance.w);\n    float right = min(v_Distance.x + 0.5, v_Distance.w);\n    float near = v_Distance.y - 0.5;\n    float far = min(v_Distance.y + 0.5, 0.0);\n    float top = v_Distance.z - 0.5;\n    float bottom = min(v_Distance.z + 0.5, 0.0);\n    alpha = max(right - left, 0.0) * max(bottom - top, 0.0) * max(far - near, 0.0);\n  } else if (v_Type < 1.5) {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    alpha = a2 * b2 - a1 * b1;\n  } else if (v_Type < 2.5) {\n    alpha *= max(min(v_Distance.x + 0.5, 1.0), 0.0);\n    alpha *= max(min(v_Distance.y + 0.5, 1.0), 0.0);\n    alpha *= max(min(v_Distance.z + 0.5, 1.0), 0.0);\n  } else if (v_Type < 3.5) {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    float alpha_miter = a2 * b2 - a1 * b1;\n    float alpha_plane = max(min(v_Distance.z + 0.5, 1.0), 0.0);\n    float d = length(v_Arc.xy);\n    float circle_hor = max(min(v_Arc.w, d + 0.5) - max(-v_Arc.w, d - 0.5), 0.0);\n    float circle_vert = min(v_Arc.w * 2.0, 1.0);\n    float alpha_circle = circle_hor * circle_vert;\n    alpha = min(alpha_miter, max(alpha_circle, alpha_plane));\n  } else {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    alpha = a2 * b2 - a1 * b1;\n    alpha *= max(min(v_Distance.z + 0.5, 1.0), 0.0);\n  }\n\n  float u_Dash = v_Dash.x;\n  float u_Gap = v_Dash.y;\n  float u_DashOffset = v_Dash.z;\n  if (u_Dash + u_Gap > 1.0) {\n    float travel = mod(v_Travel + u_Gap * v_ScalingFactor * 0.5 + u_DashOffset, u_Dash * v_ScalingFactor + u_Gap * v_ScalingFactor) - (u_Gap * v_ScalingFactor * 0.5);\n    float left = max(travel - 0.5, -0.5);\n    float right = min(travel + 0.5, u_Gap * v_ScalingFactor + 0.5);\n    alpha *= max(0.0, right - left);\n  }\n\n  if (u_IsPicking > 0.5) {\n    vec3 pickingColor = u_PickingColor;\n    if (pickingColor.x == 0.0 && pickingColor.y == 0.0 && pickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(pickingColor, 1.0);\n  } else {\n    outputColor = u_StrokeColor;\n    #ifdef USE_MAP\n      outputColor = u_Color;\n    #endif\n\n    outputColor.a *= alpha * u_Opacity * u_StrokeOpacity;\n    if (outputColor.a < epsilon) {\n      discard;\n    }\n  }\n}",this.material.defines=(0,u.Z)((0,u.Z)({},this.material.defines),zh(hd))}},{key:"createGeometry",value:function(e){var n=this,r=[],i=[],a=[],o=[],s=0,l=0;e.forEach((function(e){var t=gd(e,!1,12,n.calcSubpathIndex(e)),u=t.pointsBuffer,h=t.travelBuffer,d=t.instancedCount,f=e.parsedStyle,v=f.lineDash,p=f.lineDashOffset,g=f.isBillboard,m=f.isSizeAttenuation;o.push(v&&v[0]||0,v&&v[1]||0,p||0,dd(g,m,fd(e))),s+=d;for(var y=0;y<u.length-12;y+=4)i.push(u[y],u[y+1],u[y+2],u[y+3],u[y+4],u[y+5],u[y+6],u[y+7],u[y+8],u[y+9],u[y+10],u[y+11],u[y+12],u[y+13],u[y+14],u[y+15]);a.push.apply(a,(0,c.Z)(h)),r.push(0+l,2+l,1+l,0+l,3+l,2+l,4+l,6+l,5+l,4+l,7+l,6+l,4+l,7+l,8+l),l+=9})),i.length&&(this.geometry.setVertexBuffer({bufferIndex:cd.PACKED,byteStride:64,stepMode:Go.INSTANCE,attributes:[{format:es.F32_RGB,bufferByteOffset:0,location:hd.PREV,divisor:1},{format:es.F32_RGB,bufferByteOffset:16,location:hd.POINT1,divisor:1},{format:es.F32_R,bufferByteOffset:28,location:hd.VERTEX_JOINT,divisor:1},{format:es.F32_RGB,bufferByteOffset:32,location:hd.POINT2,divisor:1},{format:es.F32_RGB,bufferByteOffset:48,location:hd.NEXT,divisor:1}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:cd.VERTEX_NUM,byteStride:4,stepMode:Go.INSTANCE,attributes:[{format:es.F32_R,bufferByteOffset:0,byteStride:4,location:hd.VERTEX_NUM,divisor:0}],data:new Float32Array([0,1,2,3,4,5,6,7,8])}),this.geometry.setVertexBuffer({bufferIndex:cd.TRAVEL,byteStride:4,stepMode:Go.INSTANCE,attributes:[{format:es.F32_R,bufferByteOffset:0,byteStride:4,location:hd.TRAVEL,divisor:1}],data:new Float32Array(a)}),this.divisor=s/e.length,this.geometry.setVertexBuffer({bufferIndex:cd.DASH,byteStride:16,stepMode:Go.INSTANCE,attributes:[{format:es.F32_RGBA,bufferByteOffset:0,location:hd.DASH,divisor:this.divisor}],data:new Float32Array(o)}),(0,W.Z)(t,"createGeometry",this,3)([e]),this.geometry.vertexCount=15,this.geometry.instancedCount=s,this.geometry.setIndexBuffer(new Uint32Array(r)))}},{key:"updateAttribute",value:function(e,n,r,i){var a=this;if(0!==e.length)if((0,W.Z)(t,"updateAttribute",this,3)([e,n,r,i]),this.updateBatchedAttribute(e,n,r,i),"r"===r||"rx"===r||"ry"===r||"width"===r||"height"===r||"radius"===r||"x1"===r||"y1"===r||"x2"===r||"y2"===r||"points"===r||"path"===r||"d"===r||"lineJoin"===r||"lineCap"===r||"markerStartOffset"===r||"markerEndOffset"===r||"markerStart"===r||"markerEnd"===r){var o=[],s=[],l=0;e.forEach((function(e){var t=gd(e,!1,12,a.calcSubpathIndex(e)),n=t.pointsBuffer,r=t.travelBuffer,i=t.instancedCount;l=i;for(var u=0;u<n.length-12;u+=4)o.push(n[u],n[u+1],n[u+2],n[u+3],n[u+4],n[u+5],n[u+6],n[u+7],n[u+8],n[u+9],n[u+10],n[u+11],n[u+12],n[u+13],n[u+14],n[u+15]);s.push.apply(s,(0,c.Z)(r))})),this.geometry.updateVertexBuffer(cd.PACKED,hd.PREV,n*l,new Uint8Array(new Float32Array(o).buffer)),this.geometry.updateVertexBuffer(cd.TRAVEL,hd.TRAVEL,n,new Uint8Array(new Float32Array(s).buffer))}else if("lineDashOffset"===r||"lineDash"===r||"isBillboard"===r||"isSizeAttenuation"===r){var u=[];e.forEach((function(e){var t=e.parsedStyle,n=t.lineDash,r=t.lineDashOffset,i=t.isBillboard,a=t.isSizeAttenuation;u.push(n&&n[0]||0,n&&n[1]||0,r||0,dd(i,a,fd(e)))})),this.geometry.updateVertexBuffer(cd.DASH,hd.DASH,n,new Uint8Array(new Float32Array(u).buffer))}}}],[{key:"calcSubpathNum",value:function(e){return e.nodeName===he.PATH?e.parsedStyle.d.absolutePath.filter((function(e){return"M"===e[0]})).length:1}}])}(Jh),pd=function(e){return e[e.NONE=0]="NONE",e[e.FILL=1]="FILL",e[e.JOINT_BEVEL=4]="JOINT_BEVEL",e[e.JOINT_MITER=8]="JOINT_MITER",e[e.JOINT_ROUND=12]="JOINT_ROUND",e[e.JOINT_CAP_BUTT=16]="JOINT_CAP_BUTT",e[e.JOINT_CAP_SQUARE=18]="JOINT_CAP_SQUARE",e[e.JOINT_CAP_ROUND=20]="JOINT_CAP_ROUND",e[e.FILL_EXPAND=24]="FILL_EXPAND",e[e.CAP_BUTT=32]="CAP_BUTT",e[e.CAP_SQUARE=64]="CAP_SQUARE",e[e.CAP_ROUND=96]="CAP_ROUND",e[e.CAP_BUTT2=128]="CAP_BUTT2",e}({});function gd(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=e.parsedStyle,a=i.lineCap,o=i.lineJoin,s=e.sortable.renderOrder*Gh,l=0,u=0,d=e.parsedStyle,f=d.markerStart,v=d.markerEnd,g=d.markerStartOffset,m=d.markerEndOffset,y=[],E=[];if(e.nodeName===he.POLYLINE||e.nodeName===he.POLYGON){var _,T,S=e.parsedStyle.points.points,R=S.length,A=0,x=0,k=0,N=0,M=0;f&&Ba(f)&&g&&(_=S[1][0]-S[0][0],T=S[1][1]-S[0][1],M=Math.atan2(T,_),A=Math.cos(M)*(g||0),x=Math.sin(M)*(g||0)),v&&Ba(v)&&m&&(_=S[R-2][0]-S[R-1][0],T=S[R-2][1]-S[R-1][1],M=Math.atan2(T,_),k=Math.cos(M)*(m||0),N=Math.sin(M)*(m||0));var C=e.nodeName===he.POLYLINE;if(y[0]=S.reduce((function(e,t,n){var r=0,i=0;return 0===n?(r=A,i=x):n===R-1&&(r=k,i=N),e.push(t[0]+r,t[1]+i,C?t[2]||0:s),e}),[]),e.nodeName===he.POLYGON){var b;if(t)return E=bc()(y[0],[],3),{pointsBuffer:y[0],travelBuffer:[],triangles:E,instancedCount:Math.round(y[0].length/3)};y[0].push(y[0][0],y[0][1],y[0][2]||s),(b=y[0]).push.apply(b,(0,c.Z)(Ed(y[0][0],y[0][1],y[0][2]||s,y[0][3],y[0][4],y[0][5]||s)))}}else if(e.nodeName===he.PATH||e.nodeName===he.CIRCLE||e.nodeName===he.ELLIPSE||e.nodeName===he.RECT){var P;if(e.nodeName!==he.PATH){if(P=cr(sr(e,p.identity(p.create()))),e.nodeName===he.RECT){var O=e.parsedStyle,I=O.width,w=O.height;I<0&&(l+=P.rect.width),w<0&&(u+=P.rect.height)}}else P=e.parsedStyle.d;var L,D,B=P,F=B.absolutePath,U=B.segments,Z=0,G=0,V=0,W=0,X=0;if(f&&f.parentNode&&Ba(f)&&g){var z=f.parentNode.getStartTangent(),Y=(0,h.Z)(z,2),j=Y[0],K=Y[1];L=j[0]-K[0],D=j[1]-K[1],X=Math.atan2(D,L),Z=Math.cos(X)*(g||0),G=Math.sin(X)*(g||0)}if(v&&v.parentNode&&Ba(v)&&m){var q=v.parentNode.getEndTangent(),$=(0,h.Z)(q,2),Q=$[0],J=$[1];L=Q[0]-J[0],D=Q[1]-J[1],X=Math.atan2(D,L),V=Math.cos(X)*(m||0),W=Math.sin(X)*(m||0)}var ee=-1,te=-1;if(F.forEach((function(t,r){var i=(0,Mc.Z)(t),a=i[0],o=(0,H.Z)(i).slice(1),d=F[r+1],f=0===r&&(0!==Z||0!==G),v=(r===F.length-1||d&&("M"===d[0]||"Z"===d[0]))&&0!==V&&0!==W;if("M"===a)te++,y[te]=[],ee=y[te].length,f?y[te].push(o[0]-l+Z,o[1]-u+G,s,o[0]-l,o[1]-u,s):y[te].push(o[0]-l,o[1]-u,s);else if("L"===a)v?y[te].push(o[0]-l+V,o[1]-u+W,s):y[te].push(o[0]-l,o[1]-u,s);else if("Q"===a)id(o[0]-l,o[1]-u,o[2]-l,o[3]-u,y[te],n),v&&y[te].push(o[2]-l+V,o[3]-u+W,s);else if("A"===a){for(var p=(0,h.Z)(U[r].prePoint,2),g=p[0],m=p[1],E=(0,rs.W)(g,m,o[0],o[1],o[2],o[3],o[4],o[5],o[6],void 0),_=0;_<E.length;_+=6)ad(E[_]-l,E[_+1]-u,E[_+2]-l,E[_+3]-u,E[_+4]-l,E[_+5]-u,y[te],n);v&&y[te].push(o[5]-l+V,o[6]-u+W,s)}else if("C"===a)ad(o[0]-l,o[1]-u,o[2]-l,o[3]-u,o[4]-l,o[5]-u,y[te],n),v&&y[te].push(o[4]-l+V,o[5]-u+W,s);else if("Z"===a&&(e.nodeName===he.PATH||e.nodeName===he.RECT)){var T,S=1e-4;(Math.abs(y[te][y[te].length-2]-y[te][ee])>S||Math.abs(y[te][y[te].length-1]-y[te][ee+1])>S)&&y[te].push(y[te][ee],y[te][ee+1],s),(T=y[te]).push.apply(T,(0,c.Z)(Ed(y[te][ee],y[te][ee+1],y[te][ee+2],y[te][ee+3],y[te][ee+4],y[te][ee+5])))}})),t){var ne=y[r];return{pointsBuffer:ne,travelBuffer:[],triangles:E=bc()(ne,[],3),instancedCount:Math.round(ne.length/3)}}}var re=md(o),ie=yd(a),ae=ie;ie===pd.CAP_ROUND&&(ae=pd.JOINT_CAP_ROUND),ie===pd.CAP_BUTT&&(ae=pd.JOINT_CAP_BUTT),ie===pd.CAP_SQUARE&&(ae=pd.JOINT_CAP_SQUARE);for(var oe=y[r],se=oe,le=4*(Math.round(0)+2),ue=0,ce=[],de=[],fe=0;fe<se.length;fe+=3)fe>1&&(ue+=Math.sqrt(Math.pow(se[fe]-se[fe-3],2)+Math.pow(se[fe+1]-se[fe+1-3],2)+Math.pow(se[fe+2]-se[fe+2-3],2))),de.push(ue),ce[le++]=se[fe],ce[le++]=se[fe+1],ce[le++]=se[fe+2]||0,ce[le]=re,0===fe&&ie!==pd.CAP_ROUND&&(ce[le]+=ie),fe+6>=se.length?ce[le]+=ae-re:fe+3>=se.length&&(ce[le]=0),le++;ce[le++]=se[se.length-6],ce[le++]=se[se.length-5],ce[le++]=se[se.length-4]||s,ce[le++]=0,ce[0]=se[0],ce[1]=se[1],ce[2]=se[2]||s,ce[3]=0,ce[4]=se[3],ce[5]=se[4],ce[6]=se[5]||s,ce[7]=ie===pd.CAP_ROUND?ie:0;var ve=Math.round(se.length/3);return{pointsBuffer:ce,travelBuffer:de,triangles:E,instancedCount:ve}}function md(e){var t;switch(e){case"bevel":t=pd.JOINT_BEVEL;break;case"round":t=pd.JOINT_ROUND;break;default:t=pd.JOINT_MITER}return t}function yd(e){var t;switch(e){case"square":t=pd.CAP_SQUARE;break;case"round":t=pd.CAP_ROUND;break;default:t=pd.CAP_BUTT}return t}function Ed(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n,o=[r-e,i-t,a-n],s=.01;return[e+o[0]*s,t+o[1]*s,n+o[2]*s]}var _d=function(e){return e[e.PACKED_STYLE=$h.POSITION+1]="PACKED_STYLE",e}(_d||{}),Td=function(e){return e[e.PACKED_STYLE3=Qh.MAX]="PACKED_STYLE3",e}(Td||{}),Sd=function(e){function t(e,n,r,i,a,l,u){var c;return(0,o.Z)(this,t),(c=(0,s.Z)(this,t,[e,n,r,i,a,l,u])).trianglesHash=[[],[]],c.renderHelper=e,c.texturePool=n,c.lightPool=r,c.trianglesHash=c.calcSegmentNum(i),c}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"calcSegmentNum",value:function(e){var t=gd(e,!0,12,this.calcSubpathIndex(e));return[t.triangles,t.pointsBuffer]}},{key:"calcSubpathIndex",value:function(e){return e.nodeName===he.PATH?this.index:0}},{key:"compareTrianglesHash",value:function(e){var t=(0,h.Z)(this.trianglesHash,2),n=t[0],r=t[1],i=(0,h.Z)(e,2),a=i[0],o=i[1];return n.length===a.length&&r.length===o.length&&(!n.some((function(e,t){return e!==a[t]}))&&!r.some((function(e,t){return e!==o[t]})))}},{key:"shouldMerge",value:function(e,n){var r=(0,W.Z)(t,"shouldMerge",this,3)([e,n]);if(!r)return!1;if(this.index!==n)return!1;var i=this.calcSegmentNum(e);return this.compareTrianglesHash(i)}},{key:"createGeometry",value:function(e){var n=this,r=[],i=[],a=[],o=0;if(e.forEach((function(e,t){var s=gd(e,!0,12,n.calcSubpathIndex(e)),l=s.triangles,u=s.pointsBuffer;if(l.length){var h=e.getGeometryBounds().halfExtents,d=[];u.forEach((function(e,t){t%3!=2&&d.push(e/h[t%3]/2)})),o+=i.length/3,i.push.apply(i,(0,c.Z)(u)),a.push.apply(a,d),r.push.apply(r,(0,c.Z)(l.map((function(e){return e+o}))))}})),i.length){(0,W.Z)(t,"createGeometry",this,3)([e]);var s=[];e.forEach((function(e){var t=e.parsedStyle,n=t.isBillboard,r=t.billboardRotation,i=t.isSizeAttenuation;s.push(n?1:0,null!=r?r:0,i?1:0,0)})),this.geometry.setVertexBuffer({bufferIndex:$h.POSITION,byteStride:12,stepMode:Go.VERTEX,attributes:[{format:es.F32_RGB,bufferByteOffset:0,location:Qh.POSITION}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:_d.PACKED_STYLE,byteStride:16,stepMode:Go.INSTANCE,attributes:[{format:es.F32_RGBA,bufferByteOffset:0,location:Td.PACKED_STYLE3,divisor:1}],data:new Float32Array(s)}),this.geometry.setVertexBuffer({bufferIndex:$h.UV,byteStride:8,stepMode:Go.VERTEX,attributes:[{format:es.F32_RG,bufferByteOffset:0,location:Qh.UV}],data:new Float32Array(a)}),this.geometry.vertexCount=r.length/e.length,this.geometry.setIndexBuffer(new Uint32Array(r))}}},{key:"createMaterial",value:function(e){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = PACKED_STYLE3) in vec4 a_StylePacked3;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  bool isBillboard = a_StylePacked3.x > 0.5;\n  if (isBillboard) {\n    float rotation = a_StylePacked3.y;\n    bool isSizeAttenuation = a_StylePacked3.z > 0.5;\n    gl_Position = billboard(a_Position.xy, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0));\n  } else {\n    gl_Position = project(vec4(a_Position.xy, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nout vec4 outputColor;\n\nvoid main(){\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n\n    outputColor.a = outputColor.a * u_Opacity * u_FillOpacity;\n  }\n}",this.material.defines=(0,u.Z)((0,u.Z)((0,u.Z)({},this.material.defines),zh(Td)),{},{INSTANCED:!0})}},{key:"updateAttribute",value:function(e,n,r,i){if(0!==e.length&&((0,W.Z)(t,"updateAttribute",this,3)([e,n,r,i]),this.updateBatchedAttribute(e,n,r,i),"isBillboard"===r||"billboardRotation"===r||"isSizeAttenuation"===r)){var a=[];e.forEach((function(e){var t=e.parsedStyle,n=t.isBillboard,r=t.billboardRotation,i=t.isSizeAttenuation;a.push(n?1:0,null!=r?r:0,i?1:0,0)})),this.geometry.updateVertexBuffer(_d.PACKED_STYLE,Td.PACKED_STYLE3,n,new Uint8Array(new Float32Array(a).buffer))}}}])}(Jh),Rd=[0,-.5,0,0,0,1,-.5,1,1,0,1,.5,1,1,1,0,.5,0,0,1],Ad=function(e){return e[e.POINT=$h.POSITION+1]="POINT",e[e.CAP=1+e.POINT]="CAP",e[e.DASH=1+e.CAP]="DASH",e}(Ad||{}),xd=function(e){return e[e.POSITION=Qh.POSITION]="POSITION",e[e.UV=Qh.UV]="UV",e[e.POINTA=Qh.NORMAL]="POINTA",e[e.POINTB=Qh.BARYCENTRIC]="POINTB",e[e.CAP=Qh.MAX]="CAP",e[e.DASH=Qh.MAX+1]="DASH",e}(xd||{}),kd={butt:1,round:2,square:3},Nd=function(e){function t(e,n,r,i,a,l,u){var c;return(0,o.Z)(this,t),(c=(0,s.Z)(this,t,[e,n,r,i,a,l,u])).renderHelper=e,c.texturePool=n,c.lightPool=r,c.gradientAttributeName="stroke",c}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"shouldMerge",value:function(e,n){var r=(0,W.Z)(t,"shouldMerge",this,3)([e,n]);return!!r}},{key:"createMaterial",value:function(e){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = POINTA) in vec3 a_PointA;\nlayout(location = POINTB) in vec3 a_PointB;\nlayout(location = CAP) in float a_Cap;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\nlayout(location = DASH) in vec4 a_Dash;\n\nout vec4 v_Dash;\nout vec2 v_Distance;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  float strokeWidth;\n  if (u_IsPicking > 0.5) {\n    strokeWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;\n  } else {\n    strokeWidth = u_StrokeWidth;\n  }\n  float clampedStrokeWidth = max(strokeWidth, 1.0);\n\n  bool isSizeAttenuation = a_Dash.w > 0.5;\n  if (isSizeAttenuation) {\n    vec4 clip0 = project(vec4(a_PointA, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    vec4 clip1 = project(vec4(a_PointB, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    // screen space\n    vec2 screen0 = u_Viewport * (0.5 * clip0.xy / clip0.w + 0.5);\n    vec2 screen1 = u_Viewport * (0.5 * clip1.xy / clip1.w + 0.5);\n    vec2 xBasis = normalize(screen1 - screen0);\n    vec2 yBasis = vec2(-xBasis.y, xBasis.x);\n    vec2 pt0 = screen0 + clampedStrokeWidth * (a_Position.x * xBasis + a_Position.y * yBasis);\n    vec2 pt1 = screen1 + clampedStrokeWidth * (a_Position.x * xBasis + a_Position.y * yBasis);\n    vec2 pt = mix(pt0, pt1, a_Position.z);\n    vec4 clip = mix(clip0, clip1, a_Position.z);\n    gl_Position = vec4(clip.w * (2.0 * pt / u_Viewport - 1.0), clip.z, clip.w);\n  } else {\n    vec2 xBasis = a_PointB.xy - a_PointA.xy;\n    vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));\n\n    vec2 point = a_PointA.xy + xBasis * a_Position.x + yBasis * clampedStrokeWidth * a_Position.y;\n    point = point - u_Anchor.xy * abs(xBasis);\n\n    // round & square\n    if (a_Cap > 1.0) {\n      point += sign(a_Position.x - 0.5) * normalize(xBasis) * vec2(clampedStrokeWidth / 2.0);\n    }\n    gl_Position = project(vec4(point, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n\n  float antialiasblur = 1.0 / strokeWidth;\n  v_Distance = vec2(a_Position.y * 2.0, antialiasblur);\n  v_Dash = vec4(a_Position.x, a_Dash.xyz);\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nin vec4 v_Dash;\nin vec2 v_Distance;\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_StrokeColor;\n    #ifdef USE_MAP\n      outputColor = u_Color;\n    #endif\n\n    float blur;\n    if (v_Distance.y < 1.0) {\n      blur = smoothstep(0.0, v_Distance.y, 1.0 - abs(v_Distance.x));\n    } else {\n      blur = 1.0 / v_Distance.y;\n    }\n    float u_dash_offset = v_Dash.y;\n    float u_dash_array = v_Dash.z;\n    float u_dash_ratio = v_Dash.w;\n\n    outputColor.a = outputColor.a\n      * max(blur, 0.5)\n      * u_Opacity * u_StrokeOpacity\n      * (u_dash_array < 1.0 ? (ceil((u_dash_array * u_dash_ratio) - mod(v_Dash.x + u_dash_offset, u_dash_array))) : 1.0);\n\n    if (outputColor.a < epsilon) {\n      discard;\n    }\n  }\n}",this.material.defines=(0,u.Z)((0,u.Z)({},this.material.defines),zh(xd))}},{key:"calcSubpathIndex",value:function(e){if(e.nodeName===he.PATH){var t=this.drawcallCtors.filter((function(e){return e===Sd})).length;return this.index-t}return 0}},{key:"createGeometry",value:function(e){var n=this;(0,W.Z)(t,"createGeometry",this,3)([e]);var r=[],i=[],a=[],o=[],s=0;e.forEach((function(e){var t,l;if(e.nodeName===he.LINE)t=e.parsedStyle,l=e.getTotalLength();else if(e.nodeName===he.POLYLINE){var u=e.parsedStyle,c=u.points.points,h=u.lineCap,d=u.lineDash,f=u.lineDashOffset,v=u.markerStart,p=u.markerEnd,g=u.markerStartOffset,m=u.markerEndOffset,y=u.isBillboard,E=u.isSizeAttenuation;t={x1:c[0][0],y1:c[0][1],x2:c[c.length-1][0],y2:c[c.length-1][1],z1:0,z2:0,lineCap:h,lineDash:d,lineDashOffset:f,isBillboard:y,isSizeAttenuation:E,markerStart:v,markerEnd:p,markerStartOffset:g,markerEndOffset:m},l=e.getTotalLength()}else if(e.nodeName===he.PATH){for(var _=e.parsedStyle,T=_.d.absolutePath,S=_.lineCap,R=_.lineDash,A=_.lineDashOffset,x=_.markerStart,k=_.markerEnd,N=_.markerStartOffset,M=_.markerEndOffset,C=_.isBillboard,b=_.isSizeAttenuation,P=0,O=0,I=n.calcSubpathIndex(e),w=0;w<T.length;w++){if("M"===T[w][0]){if(P===I){O=w;break}P++}}t={x1:T[O][1],y1:T[O][2],x2:T[O+1][1],y2:T[O+1][2],z1:0,z2:0,lineCap:S,lineDash:R,lineDashOffset:A,isBillboard:C,isSizeAttenuation:b,markerStart:x,markerEnd:k,markerStartOffset:N,markerEndOffset:M},l=e.getTotalLength()}var L=t,D=L.x1,B=L.y1,F=L.x2,U=L.y2,Z=L.z1,G=L.z2,V=L.lineCap,W=L.isBillboard,H=L.isSizeAttenuation,X=n.calcOffset(t),z=X.startOffsetX,Y=X.startOffsetY,j=X.endOffsetX,K=X.endOffsetY,q=n.calcDash(t,l),$=q.dashOffset,Q=q.dashSegmentPercent,J=q.dashRatioInEachSegment;i.push(kd[V]),a.push($,Q,J,W||H?1:0),r.push(D+z,B+Y,Z,F+j,U+K,G),o.push(0+s,2+s,1+s,0+s,3+s,2+s),s+=4})),this.geometry.setIndexBuffer(new Uint32Array(o)),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:$h.POSITION,byteStride:20,stepMode:Go.INSTANCE,attributes:[{format:es.F32_RGB,bufferByteOffset:0,location:xd.POSITION,divisor:0},{format:es.F32_RG,bufferByteOffset:12,location:xd.UV,divisor:0}],data:new Float32Array(Rd)}),this.geometry.setVertexBuffer({bufferIndex:Ad.POINT,byteStride:24,stepMode:Go.INSTANCE,attributes:[{format:es.F32_RGB,bufferByteOffset:0,location:xd.POINTA,divisor:1},{format:es.F32_RGB,bufferByteOffset:12,location:xd.POINTB,divisor:1}],data:new Float32Array(r)}),this.geometry.setVertexBuffer({bufferIndex:Ad.CAP,byteStride:4,stepMode:Go.INSTANCE,attributes:[{format:es.F32_R,bufferByteOffset:0,location:xd.CAP,divisor:1}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:Ad.DASH,byteStride:16,stepMode:Go.INSTANCE,attributes:[{format:es.F32_RGBA,bufferByteOffset:0,location:xd.DASH,divisor:1}],data:new Float32Array(a)})}},{key:"updateAttribute",value:function(e,n,r,i){var a=this;if(0!==e.length)if((0,W.Z)(t,"updateAttribute",this,3)([e,n,r,i]),this.updateBatchedAttribute(e,n,r,i),"x1"===r||"y1"===r||"x2"===r||"y2"===r||"z1"===r||"z2"===r||"markerStartOffset"===r||"markerEndOffset"===r||"markerStart"===r||"markerEnd"===r||"points"===r||"d"===r){var o=[];e.forEach((function(e){var t;if(e.nodeName===he.LINE)t=e.parsedStyle;else if(e.nodeName===he.POLYLINE){var n=e.parsedStyle,r=n.points.points,i=n.lineCap,s=n.markerStart,l=n.markerEnd,u=n.markerStartOffset,c=n.markerEndOffset,h=n.isBillboard,d=n.isSizeAttenuation;t={x1:r[0][0],y1:r[0][1],x2:r[r.length-1][0],y2:r[r.length-1][1],z1:0,z2:0,lineCap:i,isSizeAttenuation:d,isBillboard:h,markerStart:s,markerEnd:l,markerStartOffset:u,markerEndOffset:c}}else if(e.nodeName===he.PATH){var f=e.parsedStyle,v=f.d.absolutePath,p=f.lineCap,g=f.markerStart,m=f.markerEnd,y=f.markerStartOffset,E=f.markerEndOffset,_=f.isBillboard,T=f.isSizeAttenuation;t={x1:v[0][1],y1:v[0][2],x2:v[1][1],y2:v[1][2],z1:0,z2:0,lineCap:p,isBillboard:_,isSizeAttenuation:T,markerStart:g,markerEnd:m,markerStartOffset:y,markerEndOffset:E}}var S=t,R=S.x1,A=S.y1,x=S.x2,k=S.y2,N=S.z1,M=S.z2,C=a.calcOffset(t),b=C.startOffsetX,P=C.startOffsetY,O=C.endOffsetX,I=C.endOffsetY;o.push(R+b,A+P,N,x+O,k+I,M)})),this.geometry.updateVertexBuffer(Ad.POINT,xd.POINTA,n,new Uint8Array(new Float32Array(o).buffer))}else if("lineDashOffset"===r||"lineDash"===r||"isSizeAttenuation"===r||"isBillboard"===r){var s=[];e.forEach((function(e){var t=e.getTotalLength(),n=a.calcDash(e.parsedStyle,t),r=n.dashOffset,i=n.dashSegmentPercent,o=n.dashRatioInEachSegment;s.push(r,i,o,e.parsedStyle.isBillboard||e.parsedStyle.isSizeAttenuation?1:0)})),this.geometry.updateVertexBuffer(Ad.DASH,xd.DASH,n,new Uint8Array(new Float32Array(s).buffer))}else if("lineCap"===r){var l=[];e.forEach((function(e){var t=e.parsedStyle.lineCap;l.push(kd[t])})),this.geometry.updateVertexBuffer(Ad.CAP,xd.CAP,n,new Uint8Array(new Float32Array(l).buffer))}}},{key:"calcOffset",value:function(e){var t,n,r=e.x1,i=e.y1,a=e.x2,o=e.y2,s=e.markerStart,l=e.markerEnd,u=e.markerStartOffset,c=e.markerEndOffset,h=0,d=0,f=0,v=0,p=0;return s&&Ba(s)&&u&&(t=a-r,n=o-i,p=Math.atan2(n,t),h=Math.cos(p)*(u||0),d=Math.sin(p)*(u||0)),l&&Ba(l)&&c&&(t=r-a,n=i-o,p=Math.atan2(n,t),f=Math.cos(p)*(c||0),v=Math.sin(p)*(c||0)),{startOffsetX:h,startOffsetY:d,endOffsetX:f,endOffsetY:v}}},{key:"calcDash",value:function(e,t){var n=e.lineDash,r=e.lineDashOffset,i=0,a=1,o=0;if(n&&n.length){i=(r||0)/t;var s=n.reduce((function(e,t){return e+t}),0);0===s?(a=1,o=0):(a=s/t,o=n[1]/s)}return{dashOffset:i,dashSegmentPercent:a,dashRatioInEachSegment:o}}}],[{key:"isLine",value:function(e,t){if(e.nodeName===he.PATH){for(var n=e.parsedStyle.d.absolutePath,r=0,i=0,a=0;a<n.length;a++){if("M"===n[a][0]){if(r===t){i=a;break}r++}}if("M"===n[i][0]&&"L"===n[i+1][0]&&(void 0===n[i+2]||"M"===n[i+2][0]))return!0}else if(e.nodeName===he.POLYLINE){for(var o=e.parsedStyle.points.points,s=(o[1][0]-o[1][1])/(o[0][0]-o[0][1]),l=1;l<o.length-1;l++)if((o[l+1][0]-o[l+1][1])/(o[l][0]-o[l][1])!==s)return!1;return!0}return!1}}])}(Jh),Md=function(e){return e[e.PACKED_STYLE=$h.POSITION+1]="PACKED_STYLE",e[e.SIZE=$h.MAX]="SIZE",e}(Md||{}),Cd=function(e){return e[e.PACKED_STYLE3=Qh.MAX]="PACKED_STYLE3",e[e.SIZE=1+e.PACKED_STYLE3]="SIZE",e}(Cd||{}),bd=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"shouldMerge",value:function(e,n){var r=(0,W.Z)(t,"shouldMerge",this,3)([e,n]);return!!r&&this.instance.parsedStyle.src===e.parsedStyle.src}},{key:"createMaterial",value:function(e){var t=e[0].parsedStyle.src;this.material.defines=(0,u.Z)((0,u.Z)({},this.material.defines),zh(Cd)),this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = SIZE) in vec2 a_Size;\nlayout(location = PACKED_STYLE3) in vec4 a_StylePacked3;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  vec2 offset = (a_Uv - u_Anchor.xy) * a_Size;\n\n  bool isBillboard = a_StylePacked3.x > 0.5;\n  if (isBillboard) {\n    float rotation = a_StylePacked3.y;\n    bool isSizeAttenuation = a_StylePacked3.z > 0.5;\n    gl_Position = billboard(offset, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, a_Position);\n  } else {\n    gl_Position = project(vec4(a_Position.xy + offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nout vec4 outputColor;\n\nfloat epsilon = 0.000001;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n\n    // TODO: pointer-events: non-transparent-pixel\n    // if (u_Color.x == 0.0 && u_Color.y == 0.0 && u_Color.z == 0.0) {\n    //   discard;\n    // }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n    outputColor.a = outputColor.a * u_Opacity;\n\n    if (outputColor.a < epsilon) {\n      discard;\n    }\n  }\n}";var n=this.texturePool.getOrCreateTexture(this.context.device,t,void 0);this.material.setUniforms({u_Map:n})}},{key:"createGeometry",value:function(e){(0,W.Z)(t,"createGeometry",this,3)([e]);var n=[],r=[],i=[];e.forEach((function(e,t){var a=e.parsedStyle,o=a.x,s=void 0===o?0:o,l=a.y,u=void 0===l?0:l,c=a.z,h=void 0===c?0:c,d=a.width,f=a.height,v=a.isBillboard,p=a.billboardRotation,g=a.isSizeAttenuation;n.push(s,u,h),r.push(d,f),i.push(v?1:0,null!=p?p:0,g?1:0,0)})),this.geometry.setIndexBuffer(new Uint32Array([0,2,1,0,3,2])),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:$h.POSITION,byteStride:12,stepMode:Go.INSTANCE,attributes:[{format:es.F32_RGB,bufferByteOffset:0,location:Qh.POSITION}],data:new Float32Array(n)}),this.geometry.setVertexBuffer({bufferIndex:Md.SIZE,byteStride:8,stepMode:Go.INSTANCE,attributes:[{format:es.F32_RG,bufferByteOffset:0,location:Cd.SIZE}],data:new Float32Array(r)}),this.geometry.setVertexBuffer({bufferIndex:Md.PACKED_STYLE,byteStride:16,stepMode:Go.INSTANCE,attributes:[{format:es.F32_RGBA,bufferByteOffset:0,location:Cd.PACKED_STYLE3,divisor:1}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:$h.UV,byteStride:8,stepMode:Go.VERTEX,attributes:[{format:es.F32_RG,bufferByteOffset:0,location:Qh.UV}],data:new Float32Array([0,0,1,0,1,1,0,1])})}},{key:"updateAttribute",value:function(e,n,r,i){if(0!==e.length)if((0,W.Z)(t,"updateAttribute",this,3)([e,n,r,i]),this.updateBatchedAttribute(e,n,r,i),"x"===r||"y"===r||"z"===r){var a=[];e.forEach((function(e){var t=e.parsedStyle,n=t.x,r=void 0===n?0:n,i=t.y,o=void 0===i?0:i,s=t.z,l=void 0===s?0:s;a.push(r,o,l)})),this.geometry.updateVertexBuffer($h.POSITION,Qh.POSITION,n,new Uint8Array(new Float32Array(a).buffer))}else if("width"===r||"height"===r){var o=[];e.forEach((function(e){var t=e.parsedStyle,n=t.width,r=t.height;o.push(n,r)})),this.geometry.updateVertexBuffer(Md.SIZE,Cd.SIZE,n,new Uint8Array(new Float32Array(o).buffer))}else if("isBillboard"===r||"billboardRotation"===r||"isSizeAttenuation"===r){var s=[];e.forEach((function(e){var t=e.parsedStyle,n=t.isBillboard,r=t.billboardRotation,i=t.isSizeAttenuation;s.push(n?1:0,null!=r?r:0,i?1:0,0)})),this.geometry.updateVertexBuffer(Md.PACKED_STYLE,Cd.PACKED_STYLE3,n,new Uint8Array(new Float32Array(s).buffer))}else if("src"===r){var l=this.texturePool.getOrCreateTexture(this.context.device,i);this.material.setUniforms({u_Map:l})}}}])}(Jh);function Pd(e,t,n,r){var i=t.width,a=t.height;if(r){if(r.length!==i*a*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(i*a*n);return e.width=i,e.height=a,e.data=r,e}function Od(e,t,n,r,i,a){if(0===i.width||0===i.height)return t;if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var o=e.data,s=t.data,l=0;l<i.height;l++)for(var u=((n.y+l)*e.width+n.x)*a,c=((r.y+l)*t.width+r.x)*a,h=0;h<i.width*a;h++)s[c+h]=o[u+h];return t}var Id=function(){function e(t,n){(0,o.Z)(this,e),Pd(this,t,1,n)}return(0,a.Z)(e,[{key:"resize",value:function(e){!function(e,t,n){var r=t.width,i=t.height;if(r!==e.width||i!==e.height){var a=Pd({},{width:r,height:i},n);Od(e,a,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,r),height:Math.min(e.height,i)},n),e.width=r,e.height=i,e.data=a.data}}(this,e,1)}},{key:"clone",value:function(){return new e({width:this.width,height:this.height},new Uint8Array(this.data))}}],[{key:"copy",value:function(e,t,n,r,i){Od(e,t,n,r,i,1)}}])}();var wd=(0,a.Z)((function e(t){(0,o.Z)(this,e);var n={},r=[];for(var i in t){var a=t[i],s=n[i]={};for(var l in a){var u=a[+l];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var c={x:0,y:0,w:u.bitmap.width+2,h:u.bitmap.height+2};r.push(c),s[l]={rect:c,metrics:u.metrics}}}}var h=function(e){var t,n=0,r=0,i=(0,ue.Z)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;n+=a.w*a.h,r=Math.max(r,a.w)}}catch(e){i.e(e)}finally{i.f()}e.sort((function(e,t){return t.h-e.h}));var o,s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),r),h:1/0}],l=0,u=0,c=(0,ue.Z)(e);try{for(c.s();!(o=c.n()).done;)for(var h=o.value,d=s.length-1;d>=0;d--){var f=s[d];if(!(h.w>f.w||h.h>f.h)){if(h.x=f.x,h.y=f.y,u=Math.max(u,h.y+h.h),l=Math.max(l,h.x+h.w),h.w===f.w&&h.h===f.h){var v=s.pop();d<s.length&&(s[d]=v)}else h.h===f.h?(f.x+=h.w,f.w-=h.w):h.w===f.w?(f.y+=h.h,f.h-=h.h):(s.push({x:f.x+h.w,y:f.y,w:f.w-h.w,h:h.h}),f.y+=h.h,f.h-=h.h);break}}}catch(e){c.e(e)}finally{c.f()}return{w:l,h:u,fill:n/(l*u)||0}}(r),d=h.w,f=h.h,v=new Id({width:d||1,height:f||1});for(var p in t){var g=t[p];for(var m in g){var y=g[+m];if(y&&0!==y.bitmap.width&&0!==y.bitmap.height){var E=n[p][m].rect;Id.copy(y.bitmap,v,{x:0,y:0},{x:E.x+1,y:E.y+1},y.bitmap)}}}this.image=v,this.positions=n}));function Ld(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}var Dd=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.sdfGeneratorCache={},this.textMetricsCache={},this.glyphMap={},this.runtime=t}),[{key:"destroy",value:function(){this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy()}},{key:"getMap",value:function(){return this.glyphMap}},{key:"getAtlas",value:function(){return this.glyphAtlas}},{key:"getAtlasTexture",value:function(){return this.glyphAtlasTexture}},{key:"layout",value:function(e,t,n,r,i,a,o){var s=this,l=[],u=a,c=o,h="right"===r||"end"===r?1:"left"===r||"start"===r?0:.5;return e.forEach((function(e){var r=l.length;Array.from(e).forEach((function(e){var n=s.glyphMap[t],r=e.charCodeAt(0),a=n&&n[r];a&&(l.push({glyph:r,x:u,y:c,scale:1,fontStack:t}),u+=a.metrics.advance+i)}));for(var a=u-i,o=r;o<l.length;o++)l[o].x-=h*a;u=0,c+=n})),l}},{key:"generateAtlas",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,l=[];this.glyphMap[n]||(l=Ld());var c=Object.keys(this.glyphMap[n]||{});if(Array.from(new Set(o.split(""))).forEach((function(e){-1===c.indexOf(e.charCodeAt(0).toString())&&l.push(e)})),l.length){var h=l.map((function(o){return t.generateSDF(e,n,r,i,a,o)})).reduce((function(e,t){return e[t.id]=t,e}),{});this.glyphMap[n]=(0,u.Z)((0,u.Z)({},this.glyphMap[n]),h),this.glyphAtlas=new wd(this.glyphMap);var d=this.glyphAtlas.image,f=d.width,v=d.height,p=d.data;this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.glyphAtlasTexture=s.createTexture((0,u.Z)((0,u.Z)({},fs(es.ALPHA,f,v,1)),{},{pixelStore:{unpackFlipY:!1,unpackAlignment:1}})),this.glyphAtlasTexture.setImageData([p])}}},{key:"generateSDF",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=a.charCodeAt(0),s=this.sdfGeneratorCache[t];s||(s=this.sdfGeneratorCache[t]=new sd({canvas:e,fontSize:24,fontFamily:n,fontWeight:r,fontStyle:i,buffer:3,radius:8,cutoff:.25},this.runtime)),this.textMetricsCache[t]||(this.textMetricsCache[t]={}),this.textMetricsCache[t][a]||(this.textMetricsCache[t][a]=s.ctx.measureText(a).width);var l=s.draw(a),u=l.data,c=l.width,h=l.height,d=l.glyphWidth,f=l.glyphHeight,v=l.glyphLeft,p=l.glyphTop,g=l.glyphAdvance;return{id:o,bitmap:new Id({width:c,height:h},u),metrics:{width:d,height:f,left:v,top:p-24+3,advance:g}}}}])}();var Bd=function(e){return e[e.INSTANCED=$h.POSITION+1]="INSTANCED",e[e.TEX=1+e.INSTANCED]="TEX",e}(Bd||{}),Fd=function(e){return e[e.TEX=Qh.MAX]="TEX",e[e.OFFSET=1+e.TEX]="OFFSET",e}(Fd||{}),Ud=function(e){return e.SDF_MAP="u_SDFMap",e.SDF_MAP_SIZE="u_SDFMapSize",e.FONT_SIZE="u_FontSize",e.GAMMA_SCALE="u_GammaScale",e.STROKE_BLUR="u_StrokeBlur",e.HAS_STROKE="u_HasStroke",e}({}),Zd=function(e){function t(e,n,r,i,a,l,u){var c;return(0,o.Z)(this,t),(c=(0,s.Z)(this,t,[e,n,r,i,a,l,u])).packedBufferObjectMap=new WeakMap,c.tmpMat4=p.create(),c.renderHelper=e,c.texturePool=n,c.lightPool=r,c.fontHash=c.calcFontHash(i),c.glyphManager=new Dd(c.context),c}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"calcFontHash",value:function(e){e.getBounds();return e.parsedStyle.metrics.font+["fontSize","fontFamily","fontWeight","textBaseline","letterSpacing"].reduce((function(t,n){return t+e.parsedStyle[n]}),"")}},{key:"shouldMerge",value:function(e,n){var r=(0,W.Z)(t,"shouldMerge",this,3)([e,n]);return!!r&&(this.index===n&&this.fontHash===this.calcFontHash(e))}},{key:"createGeometry",value:function(e){var t=this,n=this.instance,r=n.parsedStyle,i=r.fontSize,a=void 0===i?16:i,o=r.letterSpacing,s=void 0===o?0:o,l=n.parsedStyle.textBaseline,u=void 0===l?"alphabetic":l,h=24/a,d=[],f=[],v=[],p=[],g=0;e.forEach((function(e){var n=e.parsedStyle,r=n.metrics,i=n.dx,a=void 0===i?0:i,o=n.dy,l=void 0===o?0:o,m=r.font,y=r.lines,E=r.height,_=r.lineHeight,T=a,S=l;"alphabetic"===u&&(u="bottom");var R=0;"middle"===u?R+=-E/2:"bottom"===u?R+=-E:"top"===u||"hanging"===u?R+=0:"ideographic"===u&&(R+=-E);var A=t.glyphManager.getAtlas(),x=t.buildTextBuffers({object:e,lines:y,fontStack:m,lineHeight:h*_,offsetX:h*T,offsetY:h*(R+S),letterSpacing:h*s,glyphAtlas:A,indicesOffset:g}),k=x.indicesOffset,N=x.indexBuffer,M=x.charUVOffsetBuffer,C=x.charPositionsBuffer,b=x.charPackedBuffer;g=k;var P=p.length;p.push.apply(p,(0,c.Z)(b));var O=p.length;t.packedBufferObjectMap.set(e,[P,O]),v.push.apply(v,(0,c.Z)(M)),f.push.apply(f,(0,c.Z)(C)),d.push.apply(d,(0,c.Z)(N))})),this.geometry.vertexCount=d.length,this.geometry.setIndexBuffer(new Uint32Array(d)),this.geometry.setVertexBuffer({bufferIndex:Bd.INSTANCED,byteStride:128,stepMode:Go.VERTEX,attributes:[{format:es.F32_RGBA,bufferByteOffset:0,location:Qh.MODEL_MATRIX0},{format:es.F32_RGBA,bufferByteOffset:16,location:Qh.MODEL_MATRIX1},{format:es.F32_RGBA,bufferByteOffset:32,location:Qh.MODEL_MATRIX2},{format:es.F32_RGBA,bufferByteOffset:48,location:Qh.MODEL_MATRIX3},{format:es.F32_RGBA,bufferByteOffset:64,location:Qh.PACKED_COLOR},{format:es.F32_RGBA,bufferByteOffset:80,location:Qh.PACKED_STYLE1},{format:es.F32_RGBA,bufferByteOffset:96,location:Qh.PACKED_STYLE2},{format:es.F32_RGBA,bufferByteOffset:112,location:Qh.PICKING_COLOR}],data:new Float32Array(p)}),this.geometry.setVertexBuffer({bufferIndex:$h.POSITION,byteStride:12,stepMode:Go.VERTEX,attributes:[{format:es.F32_RGB,bufferByteOffset:0,location:Qh.POSITION}],data:new Float32Array(f)}),this.geometry.setVertexBuffer({bufferIndex:Bd.TEX,byteStride:16,stepMode:Go.VERTEX,attributes:[{format:es.F32_RG,bufferByteOffset:0,location:Fd.TEX},{format:es.F32_RG,bufferByteOffset:8,location:Fd.OFFSET}],data:new Float32Array(v)})}},{key:"createMaterial",value:function(e){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n\nlayout(std140) uniform ub_ObjectParams {\n  vec2 u_SDFMapSize;\n  float u_FontSize;\n  float u_GammaScale;\n  float u_StrokeBlur;\n  float u_HasStroke;\n};\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = TEX) in vec2 a_Tex;\nlayout(location = OFFSET) in vec2 a_Offset;\n\nout vec2 v_Uv;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  v_Uv = a_Tex / u_SDFMapSize;\n  float fontScale = u_FontSize / 24.;\n\n  vec2 bufferOffset = vec2(0.7, 2.0);\n  vec2 offset = a_Offset * fontScale + + bufferOffset;\n\n  bool isBillboard = a_StylePacked2.y > 0.5;\n  if (isBillboard) {\n    float rotation =  a_StylePacked2.w;\n    bool isSizeAttenuation = a_StylePacked2.z > 0.5;\n    gl_Position = billboard(offset, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, a_Position );\n  } else {\n    gl_Position = project(vec4(a_Position.xy + offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\nlayout(std140) uniform ub_ObjectParams {\n  vec2 u_SDFMapSize;\n  float u_FontSize;\n  float u_GammaScale;\n  float u_StrokeBlur;\n  float u_HasStroke;\n};\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n\nuniform sampler2D u_SDFMap;\n\n#define SDF_PX 8.0\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n\n  float dist = texture(SAMPLER_2D(u_SDFMap), v_Uv).a;\n\n  float fontScale = u_FontSize / 24.0;\n  lowp vec4 color = u_Color;\n  lowp float buff = (256.0 - 64.0) / 256.0;\n  float opacity = u_FillOpacity;\n  if (u_HasStroke > 0.5 && u_StrokeWidth > 0.0) {\n    color = u_StrokeColor;\n    buff = (6.0 - u_StrokeWidth / fontScale / 2.0) / SDF_PX;\n    opacity = u_StrokeOpacity;\n  }\n\n  highp float gamma_scaled = fwidth(dist);\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n  opacity *= alpha * u_Opacity;\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n\n    if (opacity < epsilon) {\n      discard;\n    }\n\n    outputColor = color;\n    outputColor.a *= opacity;\n  }\n}",this.material.cullMode=Oo.BACK,this.material.defines=(0,u.Z)((0,u.Z)({},this.material.defines),zh(Fd));var t=this.instance.parsedStyle,n=t.fontSize,r=void 0===n?16:n,i=t.fontFamily,a=void 0===i?"sans-serif":i,o=t.fontWeight,s=void 0===o?"normal":o,l=t.fontStyle,c=void 0===l?"normal":l,h=t.metrics.font,d=e.map((function(e){return e.parsedStyle.text})).join("");this.glyphManager.generateAtlas(this.texturePool.context.config.offscreenCanvas,h,a,s.toString(),c,d,this.context.device);var f=this.glyphManager.getAtlasTexture(),v=this.glyphManager.getAtlas();this.context.device.setResourceName(f,"TextSDF Texture");var p=v.image,g=p.width,m=p.height;this.material.setUniforms((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)({},Ud.SDF_MAP,f),Ud.SDF_MAP_SIZE,[g,m]),Ud.FONT_SIZE,r),Ud.GAMMA_SCALE,1),Ud.STROKE_BLUR,.2),Ud.HAS_STROKE,this.index))}},{key:"changeRenderOrder",value:function(e,t){for(var n=this.geometry.vertices[Bd.INSTANCED],r=this.geometry.inputLayoutDescriptor.vertexBufferDescriptors[Bd.INSTANCED].arrayStride/4,i=this.packedBufferObjectMap.get(e),a=(0,h.Z)(i,2),o=a[0],s=a[1],l=n.slice(o,s),u=0;u<s-o;u+=r)l[u+r-1]=t*Gh;this.geometry.updateVertexBuffer(Bd.INSTANCED,Qh.MODEL_MATRIX0,o/r,new Uint8Array(l.buffer))}},{key:"updateAttribute",value:function(e,n,r,i){var a=this;if(0!==e.length)if((0,W.Z)(t,"updateAttribute",this,3)([e,n,r,i]),"text"===r||"fontFamily"===r||"fontSize"===r||"fontWeight"===r||"fontStyle"===r||"fontVariant"===r||"textBaseline"===r||"letterSpacing"===r||"wordWrapWidth"===r||"lineHeight"===r||"wordWrap"===r||"textAlign"===r||"x"===r||"y"===r||"dx"===r||"dy"===r)this.material.programDirty=!0,this.material.geometryDirty=!0,this.material.textureDirty=!0;else if("modelMatrix"===r||"fill"===r||"fillOpacity"===r||"stroke"===r||"strokeOpacity"===r||"opacity"===r||"lineWidth"===r||"visibility"===r||"pointerEvents"===r||"isBillboard"===r||"billboardRotation"===r||"isSizeAttenuation"===r){var o=this.geometry.vertices[Bd.INSTANCED],s=this.geometry.inputLayoutDescriptor.vertexBufferDescriptors[Bd.INSTANCED].arrayStride/4;e.forEach((function(e){var t,n=e.parsedStyle,r=n.fill,i=n.stroke,l=n.opacity,u=void 0===l?1:l,c=n.fillOpacity,d=void 0===c?1:c,f=n.strokeOpacity,v=void 0===f?1:f,g=n.lineWidth,m=void 0===g?1:g,y=n.visibility,E=n.isBillboard,_=n.billboardRotation,T=n.isSizeAttenuation,S=[0,0,0,0];Tn(r)&&(S=[Number(r.r),Number(r.g),Number(r.b),255*Number(r.alpha)]);var R=[0,0,0,0];Tn(i)&&(R=[Number(i.r),Number(i.g),Number(i.b),255*Number(i.alpha)]);for(var A=e.isInteractive()&&(null===(t=e.renderable3D)||void 0===t?void 0:t.encodedPickingColor)||[0,0,0],x=p.copy(a.tmpMat4,e.getWorldTransform()),k=a.packedBufferObjectMap.get(e),N=(0,h.Z)(k,2),M=N[0],C=N[1],b=o.slice(M,C),P=0;P<C-M;P+=s)b[P+0]=x[0],b[P+1]=x[1],b[P+2]=x[2],b[P+3]=x[3],b[P+4]=x[4],b[P+5]=x[5],b[P+6]=x[6],b[P+7]=x[7],b[P+8]=x[8],b[P+9]=x[9],b[P+10]=x[10],b[P+11]=x[11],b[P+12]=x[12],b[P+13]=x[13],b[P+14]=x[14],b[P+15]=x[15],b[P+16]=jh(S[0],S[1]),b[P+17]=jh(S[2],S[3]),b[P+18]=jh(R[0],R[1]),b[P+19]=jh(R[2],R[3]),b[P+20]=u,b[P+21]=d,b[P+22]=v,b[P+23]=m,b[P+24]="hidden"!==y?1:0,b[P+25]=E?1:0,b[P+26]=T?1:0,b[P+27]=null!=_?_:0,b[P+28]=A[0],b[P+29]=A[1],b[P+30]=A[2];a.geometry.updateVertexBuffer(Bd.INSTANCED,Qh.MODEL_MATRIX0,M/s,new Uint8Array(b.buffer))}))}}},{key:"buildTextBuffers",value:function(e){var t,n=e.object,r=e.lines,i=e.fontStack,a=e.lineHeight,o=e.letterSpacing,s=e.offsetX,l=e.offsetY,u=e.glyphAtlas,h=e.indicesOffset,d=n.parsedStyle,f=d.textAlign,v=void 0===f?"start":f,g=d.fill,m=d.stroke,y=d.opacity,E=void 0===y?1:y,_=d.fillOpacity,T=void 0===_?1:_,S=d.strokeOpacity,R=void 0===S?1:S,A=d.lineWidth,x=void 0===A?1:A,k=d.visibility,N=d.isBillboard,M=d.billboardRotation,C=d.isSizeAttenuation,b=d.x,P=void 0===b?0:b,O=d.y,I=void 0===O?0:O,w=d.z,L=void 0===w?0:w,D=[0,0,0,0];Tn(g)&&(D=[Number(g.r),Number(g.g),Number(g.b),255*Number(g.alpha)]);var B=[0,0,0,0];Tn(m)&&(B=[Number(m.r),Number(m.g),Number(m.b),255*Number(m.alpha)]);var F=n.isInteractive()&&(null===(t=n.renderable3D)||void 0===t?void 0:t.encodedPickingColor)||[0,0,0],U=p.copy(this.tmpMat4,n.getWorldTransform()),Z=[],G=[],V=[],W=[],H=h,X=function(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r],a=t[i.fontStack],o=a&&a[i.glyph];if(o){var s=o.rect;if(s){var l=o.metrics.advance*i.scale/2,u=[i.x+l,i.y],c=(o.metrics.left-4)*i.scale-l+u[0],h=(-o.metrics.top-4)*i.scale+u[1],d=c+s.w*i.scale,f=h+s.h*i.scale,v={x:c,y:h},p={x:d,y:h},g={x:c,y:f},m={x:d,y:f};n.push({tl:v,tr:p,bl:g,br:m,tex:s,glyphOffset:[0,0]})}}}return n}(this.glyphManager.layout(r,i,a,v,o,s,l),u.positions);return X.forEach((function(e){var t=[];t.push.apply(t,(0,c.Z)(U));var r=[].concat(t,[jh(D[0],D[1]),jh(D[2],D[3]),jh(B[0],B[1]),jh(B[2],B[3]),E,T,R,x,"hidden"!==k?1:0,N?1:0,C?1:0,null!=M?M:0],(0,c.Z)(F),[n.sortable.renderOrder*Gh]);Z.push.apply(Z,(0,c.Z)(r).concat((0,c.Z)(r),(0,c.Z)(r),(0,c.Z)(r))),G.push(e.tex.x,e.tex.y,e.tl.x,e.tl.y),G.push(e.tex.x+e.tex.w,e.tex.y,e.tr.x,e.tr.y),G.push(e.tex.x+e.tex.w,e.tex.y+e.tex.h,e.br.x,e.br.y),G.push(e.tex.x,e.tex.y+e.tex.h,e.bl.x,e.bl.y),V.push(P,I,L,P,I,L,P,I,L,P,I,L),W.push(0+H,2+H,1+H),W.push(2+H,0+H,3+H),H+=4})),{indexBuffer:W,charUVOffsetBuffer:G,charPositionsBuffer:V,charPackedBuffer:Z,indicesOffset:H}}},{key:"destroy",value:function(){(0,W.Z)(t,"destroy",this,3)([]),this.glyphManager.destroy()}}])}(Jh),Gd=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).mergeXYZIntoModelMatrix=!1,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"shouldMerge",value:function(e,n){var r=(0,W.Z)(t,"shouldMerge",this,3)([e,n]);return!!r&&(this.instance.nodeName!==he.MESH||this.instance.parsedStyle.material===e.parsedStyle.material&&this.instance.parsedStyle.geometry===e.parsedStyle.geometry)}},{key:"updateAttribute",value:function(e,n,r,i){0!==e.length&&((0,W.Z)(t,"updateAttribute",this,3)([e,n,r,i]),this.updateBatchedAttribute(e,n,r,i))}},{key:"createMaterial",value:function(e){var t=this.instance.parsedStyle.material;this.material=t,this.observeMaterialChanged()}},{key:"createGeometry",value:function(e){var n=this.instance.parsedStyle.geometry;this.geometry=n,(0,W.Z)(t,"createGeometry",this,3)([e]),this.geometry.build(e),this.observeGeometryChanged()}}])}(Jh),Vd=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getDrawcallCtors",value:function(e){var t=[],n=e.parsedStyle.fill;return n&&!n.isNone&&t.push(rd),this.needDrawStrokeSeparately(e)&&t.push(vd),t}},{key:"needDrawStrokeSeparately",value:function(e){var t=e.parsedStyle,n=t.fill,r=t.stroke,i=t.lineDash,a=t.lineWidth,o=t.strokeOpacity,s=n&&!n.isNone,l=r&&!r.isNone,u=i&&i.length&&i.every((function(e){return 0!==e}));return!s||l&&a>0&&(o<1||u)}}])}(Vh),Wd=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getDrawcallCtors",value:function(e){var t=e.parsedStyle,n=t.fill,r=t.stroke,i=t.opacity,a=t.strokeOpacity,o=t.lineWidth,s=r&&!r.isNone,l=vd.calcSubpathNum(e),u=[];if(!(e.nodeName===he.POLYLINE||null!=n&&n.isNone))for(var c=0;c<l;c++)u.push(Sd);for(var h=0;h<l;h++){if(0!==a&&0!==i&&0!==o&&s)Nd.isLine(e,h)?u.push(Nd):u.push(vd)}return u}}])}(Vh),Hd=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getDrawcallCtors",value:function(){return[bd]}}])}(Vh),Xd=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getDrawcallCtors",value:function(e){var t=[],n=e.parsedStyle,r=n.stroke,i=n.lineWidth,a=void 0===i?1:i;return!(!r||r.isNone||!a)&&t.push(Zd),t.push(Zd),t}},{key:"beforeUploadUBO",value:function(e,t){var n=t.instance.renderable3D.drawcalls.length;t.material.setUniforms((0,V.Z)({},Ud.HAS_STROKE,1===n?0:1-t.index))}}])}(Vh),zd=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getDrawcallCtors",value:function(){return[Nd]}}])}(Vh),Yd=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getDrawcallCtors",value:function(){return[Gd]}}])}(Vh),jd=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getDrawcallCtors",value:function(e){var t=[],n=e.parsedStyle,r=n.fill,i=n.radius,a=i&&i.length&&i.some((function(e){return e!==i[0]}));return null!=r&&r.isNone||a||t.push(rd),a&&t.push(Sd),(a||this.needDrawStrokeSeparately(e))&&t.push(vd),t}},{key:"needDrawStrokeSeparately",value:function(e){var t=e.parsedStyle,n=t.fill,r=t.stroke,i=t.lineDash,a=t.lineWidth,o=t.strokeOpacity,s=n&&!n.isNone,l=r&&!r.isNone,u=i&&i.length&&i.every((function(e){return 0!==e}));return!s||l&&a>0&&(o<1||u)}}])}(Vh),Kd=1,qd=function(){return(0,a.Z)((function e(t,n,r,i){(0,o.Z)(this,e),this.drawcalls=[],this.pendingUpdatePatches={},this.stencilRefCache={},this.renderHelper=t,this.rendererFactory=n,this.texturePool=r,this.lightPool=i}),[{key:"destroy",value:function(){this.drawcalls.forEach((function(e){e.destroy()})),this.drawcalls=[],this.pendingUpdatePatches={}}},{key:"render",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n||this.updatePendingPatches(),this.drawcalls.forEach((function(r){r.init();var i=r.objects;r.clipPathTarget&&(i=[r.clipPath]);var a=t.renderHelper.renderInstManager.newRenderInst();a.setAllowSkippingIfPipelineNotReady(!1),r.applyRenderInst(a,i),t.renderHelper.renderInstManager.submitRenderInst(a,e),n||r.objects.forEach((function(e){e.renderable.dirty=!1}))}))}},{key:"attach",value:function(e){this.context=e}},{key:"add",value:function(e){var t=this,n=e.renderable3D;if(n&&!n.drawcalls.length){var r=this.rendererFactory[e.nodeName];r&&r.getDrawcallCtors(e).forEach((function(i,a,o){var s=t.drawcalls.find((function(t){return i===t.constructor&&t.index===a&&t.objects.length<t.maxInstances&&t.shouldMerge(e,a)}));s&&s.key===e.parsedStyle.batchKey||((s=new i(t.renderHelper,t.texturePool,t.lightPool,e,o,a,t.context)).renderer=r,t.drawcalls.push(s),e.parsedStyle.batchKey&&(s.key=e.parsedStyle.batchKey)),s&&(s.objects.push(e),n.drawcalls[a]=s,s.geometryDirty=!0)}))}}},{key:"remove",value:function(e){var t=this,n=e.renderable3D;n&&(n.drawcalls.forEach((function(n){if(n){var r=n.objects.indexOf(e);if(r>-1&&(n.objects.splice(r,1),n.geometryDirty=!0),0===n.objects.length)t.drawcalls.splice(t.drawcalls.indexOf(n),1).forEach((function(e){e.destroy()}))}})),n.drawcalls=[])}},{key:"updateAttribute",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.renderable3D,o=this.rendererFactory[e.nodeName];if(o){var s=o.getDrawcallCtors(e);if(s.forEach((function(s,l,u){var c=a.drawcalls.find((function(e){return e&&e.index===l&&e.constructor===s}));if(c||((c=a.drawcalls[l])&&(c.objects.splice(c.objects.indexOf(e),1),c.geometryDirty=!0,0===c.objects.length&&r.drawcalls.splice(r.drawcalls.indexOf(c),1),a.drawcalls[a.drawcalls.indexOf(c)]=void 0),(c=r.drawcalls.find((function(t){return s===t.constructor&&t.index===l&&t.objects.length<t.maxInstances&&t.shouldMerge(e,l)})))?c.geometryDirty=!0:((c=new s(r.renderHelper,r.texturePool,r.lightPool,e,u,l,r.context)).renderer=o,c.init(),r.drawcalls.push(c)),c.objects.push(e),a.drawcalls[l]=c),c.inited&&!c.geometryDirty)if(c.shouldMerge(e,l)){var h=c.objects.indexOf(e);if(i)e.parsedStyle[t]=n,c.updateAttribute([e],h,t,n);else{var d=c.id+t;r.pendingUpdatePatches[d]||(r.pendingUpdatePatches[d]={instance:c,objectIndices:[],name:t,value:n}),-1===r.pendingUpdatePatches[d].objectIndices.indexOf(h)&&r.pendingUpdatePatches[d].objectIndices.push(h)}}else r.remove(e),r.add(e);else r.remove(e),r.add(e)})),a.drawcalls.length>s.length)for(var l=a.drawcalls.length,u=l-1;u>=s.length;u--){var c=a.drawcalls[u];c.objects.splice(c.objects.indexOf(e),1),c.geometryDirty=!0,0===c.objects.length&&this.drawcalls.splice(this.drawcalls.indexOf(c),1),a.drawcalls.pop()}}}},{key:"changeRenderOrder",value:function(e,t){var n=e.renderable3D;n&&n.drawcalls.length&&n.drawcalls.forEach((function(n){n&&n.inited&&!n.geometryDirty&&n.inited&&n.changeRenderOrder(e,t)}))}},{key:"getStencilRef",value:function(e){return this.stencilRefCache[e.entity]||(this.stencilRefCache[e.entity]=Kd++),this.stencilRefCache[e.entity]}},{key:"updatePendingPatches",value:function(){var e=this;Object.keys(this.pendingUpdatePatches).forEach((function(t){var n=e.pendingUpdatePatches[t],r=n.instance,i=n.objectIndices,a=n.name,o=n.value;i.sort((function(e,t){return e-t}));var s=[];i.forEach((function(e){var t=s[s.length-1];t&&e===t[t.length-1]+1?t.push(e):s.push([e])})),s.forEach((function(e){r.updateAttribute(r.objects.slice(e[0],e[0]+e.length),e[0],a,o)}))})),this.pendingUpdatePatches={}}}])}(),$d=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e),this.textureCache={},this.context=t,this.runtime=n}),[{key:"getOrCreateTexture",value:function(e,t,n,r){var i,a=this,o="string"==typeof t?t:t.src||"";if(o&&this.textureCache[o])(i=this.textureCache[o]).emit(Vo.LOADED);else if(i=e.createTexture((0,u.Z)({format:es.U8_RGBA_NORM,width:1,height:1,depthOrArrayLayers:1,mipLevelCount:1,dimension:Wo.TEXTURE_2D,usage:Ho.SAMPLED,pixelStore:{unpackFlipY:!1}},n)),o&&(this.textureCache[o]=i),(0,S.Z)(t)){var s=this.context.config.createImage();s&&(s.onload=function(){var e=function(e){a.textureCache[o].setImageData([e]),a.textureCache[o].emit(Vo.LOADED),a.context.renderingService.dirty(),r&&r(a.textureCache[o],e)};a.runtime.globalThis.createImageBitmap?a.runtime.globalThis.createImageBitmap(s).then((function(t){return e(t)})).catch((function(){e(s)})):e(s)},s.onerror=function(){},s.crossOrigin="Anonymous",s.src=t)}else i.setImageData([t]),i.emit(Vo.LOADED),this.context.renderingService.dirty();return i}},{key:"getOrCreateCanvas",value:function(){return this.runtime.offscreenCanvasCreator.getOrCreateCanvas(this.context.config.offscreenCanvas)}},{key:"getOrCreateGradient",value:function(e){var t=e.instance,n=e.gradients,r=t.getGeometryBounds().halfExtents,i=2*r[0]||1,a=2*r[1]||1,o=this.context.config.offscreenCanvas,s=this.runtime.offscreenCanvasCreator.getOrCreateCanvas(o),l=this.runtime.offscreenCanvasCreator.getOrCreateContext(o);s.width=i,s.height=a;var c=this.context.imagePool;n.forEach((function(e){var t=c.getOrCreateGradient((0,u.Z)((0,u.Z)({type:e.type},e.value),{},{width:i,height:a,min:[0,0]}),l);l.fillStyle=t,l.fillRect(0,0,i,a)}))}},{key:"getOrCreatePattern",value:function(e,t,n){var r,i=e.image,a=e.repetition,o=e.transform,s=t.getGeometryBounds().halfExtents,l=2*s[0]||1,u=2*s[1]||1,c=this.context.config.offscreenCanvas,h=this.runtime.offscreenCanvasCreator.getOrCreateCanvas(c),d=this.runtime.offscreenCanvasCreator.getOrCreateContext(c);if(h.width=l,h.height=u,(0,S.Z)(i)){var f=this.context.imagePool.getImageSync(i,t,n);r=null==f?void 0:f.img}else r=i;var v=r&&d.createPattern(r,a);if(o){var p=Ci(_r(o),new Va({}));v.setTransform({a:p[0],b:p[1],c:p[4],d:p[5],e:p[12],f:p[13]})}d.fillStyle=v,d.fillRect(0,0,l,u)}},{key:"destroy",value:function(){for(var e in this.textureCache)this.textureCache[e].destroy();this.textureCache={}}}])}(),Qd=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(e=(0,s.Z)(this,t)).name="device-renderer",e.parameters={toneMapping:Qc.NONE,toneMappingExposure:1},e.options=n,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(e){var t;e.geometryUpdaterFactory[he.MESH]=new Lc;var n=new gh(this.parameters),r=new Oc,i=new $d(this.context,e),a=new Dc,o=new Vd,s=new Wd,l=(t={},(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(t,he.CIRCLE,o),he.ELLIPSE,o),he.POLYLINE,s),he.PATH,s),he.POLYGON,s),he.RECT,new jd),he.IMAGE,new Hd),he.LINE,new zd),he.TEXT,new Xd),he.MESH,new Yd),(0,V.Z)((0,V.Z)(t,he.GROUP,void 0),he.HTML,void 0)),u=new qd(n,l,i,r),c=new Uh(n,r,i,u,this.options);this.addRenderingPlugin(c),this.addRenderingPlugin(new Zh(n,c,a,u))}},{key:"destroy",value:function(e){delete e.geometryUpdaterFactory[he.MESH]}},{key:"getRenderGraphPlugin",value:function(){return this.plugins[0]}},{key:"getDevice",value:function(){return this.getRenderGraphPlugin().getDevice()}},{key:"getSwapChain",value:function(){return this.getRenderGraphPlugin().getSwapChain()}},{key:"loadTexture",value:function(e,t,n){return this.getRenderGraphPlugin().loadTexture(e,t,n)}},{key:"toDataURL",value:function(e){return this.getRenderGraphPlugin().toDataURL(e)}},{key:"setParameters",value:function(e){this.parameters=(0,u.Z)((0,u.Z)({},this.parameters),e)}}])}(fe),Jd=function(){function e(t){(0,o.Z)(this,e),this.dragndropPluginOptions=t}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=this,r=t.renderingService,i=t.renderingContext.root.ownerDocument,a=i.defaultView,o=function(e){var t=e.target,r=t===i,o=r&&n.dragndropPluginOptions.isDocumentDraggable?i:t.closest&&t.closest("[draggable=true]");if(o){var s=!1,l=e.timeStamp,u=[e.clientX,e.clientY],c=null,h=[e.clientX,e.clientY],d=function(){var e=(0,le.Z)((0,se.Z)().mark((function e(a){var d,f,v,p,g,m;return(0,se.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}if(d=a.timeStamp-l,f=(0,_.y)([a.clientX,a.clientY],u),!(d<=n.dragndropPluginOptions.dragstartTimeThreshold||f<=n.dragndropPluginOptions.dragstartDistanceThreshold)){e.next=1;break}return e.abrupt("return");case 1:a.type="dragstart",o.dispatchEvent(a),s=!0;case 2:if(a.type="drag",a.dx=a.clientX-h[0],a.dy=a.clientY-h[1],o.dispatchEvent(a),h=[a.clientX,a.clientY],r){e.next=4;break}return v="pointer"===n.dragndropPluginOptions.overlap?[a.canvasX,a.canvasY]:t.getBounds().center,e.next=3,i.elementsFromPoint(v[0],v[1]);case 3:p=e.sent,g=p[p.indexOf(t)+1],m=(null==g?void 0:g.closest("[droppable=true]"))||(n.dragndropPluginOptions.isDocumentDroppable?i:null),c!==m&&(c&&(a.type="dragleave",a.target=c,c.dispatchEvent(a)),m&&(a.type="dragenter",a.target=m,m.dispatchEvent(a)),(c=m)&&(a.type="dragover",a.target=c,c.dispatchEvent(a)));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();a.addEventListener("pointermove",d);var f=function(e){if(s){e.detail={preventClick:!0};var t=e.clone();c&&(t.type="drop",t.target=c,c.dispatchEvent(t)),t.type="dragend",o.dispatchEvent(t),s=!1}a.removeEventListener("pointermove",d)};t.addEventListener("pointerup",f,{once:!0}),t.addEventListener("pointerupoutside",f,{once:!0})}};r.hooks.init.tap(e.tag,(function(){a.addEventListener("pointerdown",o)})),r.hooks.destroy.tap(e.tag,(function(){a.removeEventListener("pointerdown",o)}))}}])}();Jd.tag="Dragndrop";var ef=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(e=(0,s.Z)(this,t)).name="dragndrop",e.options=n,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){this.addRenderingPlugin(new Jd((0,u.Z)({overlap:"pointer",isDocumentDraggable:!1,isDocumentDroppable:!1,dragstartDistanceThreshold:0,dragstartTimeThreshold:0},this.options)))}},{key:"destroy",value:function(){this.removeAllRenderingPlugins()}},{key:"setOptions",value:function(e){Object.assign(this.plugins[0].dragndropPluginOptions,e)}}])}(fe),tf="object"===("undefined"==typeof performance?"undefined":i()(performance))&&performance.now?performance:Date,nf=function(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.abs(n)>Math.abs(r)?n>0?"right":"left":r>0?"down":"up"},rf=function(e,t){var n=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y);return Math.sqrt(n*n+r*r)},af=function(){function e(t){var n=this;(0,o.Z)(this,e),this.evCache=[],this.startPoints=[],this.processEvent={},this.throttleTimer=0,this.emitThrottles=[],this._start=function(e,t){n.reset(),n.startTime=tf.now();var r=n.evCache,i=n.startPoints;if(e){var a,o=e.pointerId,s=e.x,l=e.y,u=r.findIndex((function(e){return o===e.pointerId}));-1!==u&&r.splice(u,1),r.push({pointerId:o,x:s,y:l,ev:e});for(var h=(0,c.Z)((null===(a=e.nativeEvent)||void 0===a?void 0:a.touches)||[]),d=function(e){if(h.find((function(t){return r[e].pointerId===t.identifier})))return 1;r.splice(e,1)},f=r.length-1;f>-1;f--)d(f)}i.length=r.length;for(var v=0;v<r.length;v++){var p=r[v],g={x:p.x,y:p.y};i[v]=g}if(1!==i.length){var m,y;n.startDistance=rf(i[0],i[1]),n.center=(m=i[0],y=i[1],{x:m.x+(y.x-m.x)/2,y:m.y+(y.y-m.y)/2})}else{var E=r[0].ev;n.pressTimeout=setTimeout((function(){var e="press",r="none";E.direction=r,E.deltaX=0,E.deltaY=0,E.points=i,n.emitStart(e,E,t),E.type=e,t.dispatchEvent(E),n.eventType=e,n.direction=r,n.movingTarget=t}),250)}},this._move=function(e,t){n.clearPressTimeout();var r=n.startPoints,i=n.evCache;if(r.length){for(var a=e.x,o=e.y,s=e.pointerId,l=0,u=i.length;l<u;l++)if(s===i[l].pointerId){i[l]={pointerId:s,x:a,y:o,ev:e};break}var c={x:a,y:o},h=i.map((function(e){return{x:e.x,y:e.y}})),d=tf.now();if(n.prevMoveTime=n.lastMoveTime,n.prevMovePoint=n.lastMovePoint,n.lastMoveTime=d,n.lastMovePoint=c,1===r.length){var f=r[0],v=a-f.x,p=o-f.y,g=n.direction||nf(f,c);n.direction=g;var m=n.getEventType(c,t,e);return e.direction=g,e.deltaX=v,e.deltaY=p,e.points=h,n.emitStart(m,e,t),e.type=m,void n.refreshAndGetTarget(t).dispatchEvent(e)}var y=n.startDistance,E=rf(h[0],h[1]);e.zoom=E/y,e.center=n.center,e.points=h,n.emitStart("pinch",e,t),n._throttleEmit("pinch",e,t)}},this._end=function(e,t){var r=n.evCache,i=n.startPoints,a=r.map((function(e){return{x:e.x,y:e.y}}));if(e.points=a,n.emitEnd(e,n.refreshAndGetTarget(t)),1===r.length){var o=tf.now(),s=n.lastMoveTime;if(o-s<100){var l=s-(n.prevMoveTime||n.startTime);if(l>0){var u=n.prevMovePoint||i[0],c=n.lastMovePoint||i[0],h=rf(u,c)/l;h>.3&&(e.velocity=h,e.direction=nf(u,c),e.type="swipe",t.dispatchEvent(e))}}}for(var d=0,f=r.length;d<f;d++)if(r[d].pointerId===e.pointerId){r.splice(d,1),i.splice(d,1);break}n.reset(),r.length>0&&n._start(void 0,t)},this._cancel=function(e,t){var r=n.evCache.map((function(e){return{x:e.x,y:e.y}}));e.points=r,n.emitEnd(e,n.refreshAndGetTarget(t)),n.evCache=[],n.reset()},this.options=t}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=this,r=t.renderingService,i=t.renderingContext.root.ownerDocument,a=i.defaultView;this.canvas=a;var o=function(e){return e===i&&n.options.isDocumentGestureEnabled?i:e},s=function(e){var t=o(e.target);t&&n._move(e,t)},l=function(e){var t=o(e.target);t&&n._start(e,t)},u=function(e){var t=o(e.target);t&&n._end(e,t)},c=function(e){var t=o(e.target);t&&n._cancel(e,t)},h=function(e){var t=o(e.target);t&&n._end(e,t)};r.hooks.init.tap(e.tag,(function(){a.addEventListener("pointermove",s),a.addEventListener("pointerdown",l),a.addEventListener("pointerup",u),a.addEventListener("pointercancel",c),a.addEventListener("pointerupoutside",h)})),r.hooks.destroy.tap(e.tag,(function(){a.removeEventListener("pointermove",s),a.removeEventListener("pointerdown",l),a.removeEventListener("pointerup",u),a.removeEventListener("pointercancel",c),a.removeEventListener("pointerupoutside",h)}))}},{key:"getEventType",value:function(e,t,n){var r,i=this.eventType,a=this.startTime,o=this.startPoints;if(i)return i;(this.movingTarget=t,this.isPanListenerInPath=n.path.some((function(e){var t;return!(null===(t=e.emitter)||void 0===t||null===(t=t.eventNames())||void 0===t||!t.includes("pan"))})),this.isPanListenerInPath)?r=tf.now()-a>250&&rf(o[0],e)<10?"press":"pan":r="press";return this.eventType=r,r}},{key:"enable",value:function(e){this.processEvent[e]=!0}},{key:"isProcess",value:function(e){return this.processEvent[e]}},{key:"emitStart",value:function(e,t,n){this.isProcess(e)||(this.enable(e),t.type="".concat(e,"start"),n.dispatchEvent(t))}},{key:"_throttleEmit",value:function(e,t,n){var r=this;this.pushEvent(e,t);var i=this.throttleTimer,a=this.emitThrottles,o=this.processEvent;i||(this.throttleTimer=this.canvas.requestAnimationFrame((function(){for(var e=0,t=a.length;e<t;e++){var i=a[e],s=i.type,l=i.ev;o[s]&&(l.type=s,n.dispatchEvent(l))}r.throttleTimer=0,r.emitThrottles.length=0})))}},{key:"emitEnd",value:function(e,t){var n=this.processEvent;Object.keys(n).forEach((function(r){e.type="".concat(r,"end"),t.dispatchEvent(e),delete n[r]}))}},{key:"pushEvent",value:function(e,t){for(var n=this.emitThrottles,r={type:e,ev:t},i=0,a=n.length;i<a;i++)if(n[i].type===e)return void n.splice(i,1,r);n.push(r)}},{key:"clearPressTimeout",value:function(){this.pressTimeout&&(clearTimeout(this.pressTimeout),this.pressTimeout=null)}},{key:"refreshAndGetTarget",value:function(e){return this.movingTarget?(this.movingTarget&&!this.movingTarget.isConnected&&(this.movingTarget=e),this.movingTarget):e}},{key:"reset",value:function(){this.clearPressTimeout(),this.startTime=0,this.startDistance=0,this.direction=null,this.eventType=null,this.prevMoveTime=0,this.prevMovePoint=null,this.lastMoveTime=0,this.lastMovePoint=null,this.movingTarget=null,this.isPanListenerInPath=null}}])}();af.tag="Gesture";var of=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(e=(0,s.Z)(this,t)).name="gesture",e.options=n,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){this.addRenderingPlugin(new af((0,u.Z)({isDocumentGestureEnabled:!1},this.options)))}},{key:"destroy",value:function(){this.removeAllRenderingPlugins()}}])}(fe);var sf=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.canvasConfig=t.config,this.deviceRendererPlugin=t.deviceRendererPlugin}),[{key:"init",value:(t=(0,le.Z)((0,se.Z)().mark((function e(){var t,n,r,i;return(0,se.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.canvasConfig,n=t.canvas,r=t.devicePixelRatio,this.$canvas=n,this.context=this.$canvas.getContext("webgl"),i=(i=r||1)>=1?Math.ceil(i):1,this.dpr=i,this.resize(this.canvasConfig.width,this.canvasConfig.height);case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getContext",value:function(){return this.context}},{key:"getDomElement",value:function(){return this.$canvas}},{key:"getDPR",value:function(){return this.dpr}},{key:"getBoundingClientRect",value:function(){if(this.$canvas.getBoundingClientRect)return this.$canvas.getBoundingClientRect()}},{key:"destroy",value:function(){this.context=null,this.$canvas=null}},{key:"resize",value:function(e,t){var n,r=devicePixelRatio,a=this.$canvas;a.style&&(a.style.width="".concat(e,"px"),a.style.height="".concat(t,"px")),(n=a)&&"object"===i()(n)&&(1===n.nodeType&&n.nodeName||n.isCanvasElement)&&(a.width=e*r,a.height=t*r)}},{key:"applyCursorStyle",value:function(e){}},{key:"toDataURL",value:(e=(0,le.Z)((0,se.Z)().mark((function e(t){return(0,se.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.deviceRendererPlugin.toDataURL(t));case 1:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})}]);var e,t}(),lf=function(e){function t(e,n){var r;return(0,o.Z)(this,t),(r=(0,s.Z)(this,t)).name="mobile-webgl-context-register",r.rendererPlugin=e,r.config=n,r}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){this.context.ContextService=sf,this.context.deviceRendererPlugin=this.rendererPlugin;var e=this.config;this.context.deviceContribution=new _u((0,u.Z)({},null!=e&&e.targets?{targets:e.targets}:{targets:["webgl2","webgl1"]}))}},{key:"destroy",value:function(){delete this.context.ContextService}}])}(fe),uf=function(e){function t(e){var n;(0,o.Z)(this,t),n=(0,s.Z)(this,t,[e]);var r=new Qd;return n.registerPlugin(new lf(r,e)),n.registerPlugin(new So.Plugin),n.registerPlugin(r),n.registerPlugin(new ns.Plugin),n.registerPlugin(new xo.Plugin),n.registerPlugin(new ef({isDocumentDraggable:!!(0,T.Z)(null==e?void 0:e.isDocumentDraggable)||e.isDocumentDraggable,isDocumentDroppable:!!(0,T.Z)(null==e?void 0:e.isDocumentDroppable)||e.isDocumentDroppable,dragstartDistanceThreshold:(0,T.Z)(null==e?void 0:e.dragstartDistanceThreshold)?10:e.dragstartDistanceThreshold,dragstartTimeThreshold:(0,T.Z)(null==e?void 0:e.dragstartTimeThreshold)?50:e.dragstartTimeThreshold})),n.registerPlugin(new of({isDocumentGestureEnabled:!0})),n}return(0,l.Z)(t,e),(0,a.Z)(t)}(ve)},20539:function(e){function t(e,t,r){r=r||2;var a,o,s,l,h,d,v,p=t&&t.length,g=p?t[0]*r:e.length,m=n(e,0,g,r,!0),y=[];if(!m||m.next===m.prev)return y;if(p&&(m=function(e,t,r,i){var a,o,s,l=[];for(a=0,o=t.length;a<o;a++)(s=n(e,t[a]*i,a<o-1?t[a+1]*i:e.length,i,!1))===s.next&&(s.steiner=!0),l.push(f(s));for(l.sort(u),a=0;a<l.length;a++)r=c(l[a],r);return r}(e,t,m,r)),e.length>80*r){a=s=e[0],o=l=e[1];for(var E=r;E<g;E+=r)(h=e[E])<a&&(a=h),(d=e[E+1])<o&&(o=d),h>s&&(s=h),d>l&&(l=d);v=0!==(v=Math.max(s-a,l-o))?32767/v:0}return i(m,y,r,a,o,v,0),y}function n(e,t,n,r,i){var a,o;if(i===k(e,t,n,r)>0)for(a=t;a<n;a+=r)o=R(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=R(a,e[a],e[a+1],o);return o&&m(o,o.next)&&(A(o),o=o.next),o}function r(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(A(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function i(e,t,n,u,c,h,f){if(e){!f&&h&&function(e,t,n,r){var i=e;do{0===i.z&&(i.z=d(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,a,o,s,l,u=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<u&&(s++,r=r.nextZ);t++);for(l=u;s>0||l>0&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,u*=2}while(o>1)}(i)}(e,u,c,h);for(var v,p,g=e;e.prev!==e.next;)if(v=e.prev,p=e.next,h?o(e,u,c,h):a(e))t.push(v.i/n|0),t.push(e.i/n|0),t.push(p.i/n|0),A(e),e=p.next,g=p.next;else if((e=p)===g){f?1===f?i(e=s(r(e),t,n),t,n,u,c,h,2):2===f&&l(e,t,n,u,c,h):i(r(e),t,n,u,c,h,1);break}}}function a(e){var t=e.prev,n=e,r=e.next;if(g(t,n,r)>=0)return!1;for(var i=t.x,a=n.x,o=r.x,s=t.y,l=n.y,u=r.y,c=i<a?i<o?i:o:a<o?a:o,h=s<l?s<u?s:u:l<u?l:u,d=i>a?i>o?i:o:a>o?a:o,f=s>l?s>u?s:u:l>u?l:u,p=r.next;p!==t;){if(p.x>=c&&p.x<=d&&p.y>=h&&p.y<=f&&v(i,s,a,l,o,u,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function o(e,t,n,r){var i=e.prev,a=e,o=e.next;if(g(i,a,o)>=0)return!1;for(var s=i.x,l=a.x,u=o.x,c=i.y,h=a.y,f=o.y,p=s<l?s<u?s:u:l<u?l:u,m=c<h?c<f?c:f:h<f?h:f,y=s>l?s>u?s:u:l>u?l:u,E=c>h?c>f?c:f:h>f?h:f,_=d(p,m,t,n,r),T=d(y,E,t,n,r),S=e.prevZ,R=e.nextZ;S&&S.z>=_&&R&&R.z<=T;){if(S.x>=p&&S.x<=y&&S.y>=m&&S.y<=E&&S!==i&&S!==o&&v(s,c,l,h,u,f,S.x,S.y)&&g(S.prev,S,S.next)>=0)return!1;if(S=S.prevZ,R.x>=p&&R.x<=y&&R.y>=m&&R.y<=E&&R!==i&&R!==o&&v(s,c,l,h,u,f,R.x,R.y)&&g(R.prev,R,R.next)>=0)return!1;R=R.nextZ}for(;S&&S.z>=_;){if(S.x>=p&&S.x<=y&&S.y>=m&&S.y<=E&&S!==i&&S!==o&&v(s,c,l,h,u,f,S.x,S.y)&&g(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;R&&R.z<=T;){if(R.x>=p&&R.x<=y&&R.y>=m&&R.y<=E&&R!==i&&R!==o&&v(s,c,l,h,u,f,R.x,R.y)&&g(R.prev,R,R.next)>=0)return!1;R=R.nextZ}return!0}function s(e,t,n){var i=e;do{var a=i.prev,o=i.next.next;!m(a,o)&&y(a,i,i.next,o)&&T(a,o)&&T(o,a)&&(t.push(a.i/n|0),t.push(i.i/n|0),t.push(o.i/n|0),A(i),A(i.next),i=e=o),i=i.next}while(i!==e);return r(i)}function l(e,t,n,a,o,s){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&p(l,u)){var c=S(l,u);return l=r(l,l.next),c=r(c,c.next),i(l,t,n,a,o,s,0),void i(c,t,n,a,o,s,0)}u=u.next}l=l.next}while(l!==e)}function u(e,t){return e.x-t.x}function c(e,t){var n=function(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o&&(o=s,n=r.x<r.next.x?r:r.next,s===i))return n}r=r.next}while(r!==t);if(!n)return null;var l,u=n,c=n.x,d=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&v(a<d?i:o,a,c,d,a<d?o:i,a,r.x,r.y)&&(l=Math.abs(a-r.y)/(i-r.x),T(r,e)&&(l<f||l===f&&(r.x>n.x||r.x===n.x&&h(n,r)))&&(n=r,f=l)),r=r.next}while(r!==u);return n}(e,t);if(!n)return t;var i=S(n,e);return r(i,i.next),r(n,n.next)}function h(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function d(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function v(e,t,n,r,i,a,o,s){return(i-o)*(t-s)>=(e-o)*(a-s)&&(e-o)*(r-s)>=(n-o)*(t-s)&&(n-o)*(a-s)>=(i-o)*(r-s)}function p(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&y(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(T(e,t)&&T(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||m(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,n,r){var i=_(g(e,t,n)),a=_(g(e,t,r)),o=_(g(n,r,e)),s=_(g(n,r,t));return i!==a&&o!==s||(!(0!==i||!E(e,n,t))||(!(0!==a||!E(e,r,t))||(!(0!==o||!E(n,e,r))||!(0!==s||!E(n,t,r)))))}function E(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function _(e){return e>0?1:e<0?-1:0}function T(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function S(e,t){var n=new x(e.i,e.x,e.y),r=new x(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function R(e,t,n,r){var i=new x(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function A(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function x(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function k(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}e.exports=t,e.exports.default=t,t.deviation=function(e,t,n,r){var i=t&&t.length,a=i?t[0]*n:e.length,o=Math.abs(k(e,0,a,n));if(i)for(var s=0,l=t.length;s<l;s++){var u=t[s]*n,c=s<l-1?t[s+1]*n:e.length;o-=Math.abs(k(e,u,c,n))}var h=0;for(s=0;s<r.length;s+=3){var d=r[s]*n,f=r[s+1]*n,v=r[s+2]*n;h+=Math.abs((e[d]-e[v])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[v+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},t.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<t;o++)n.vertices.push(e[i][a][o]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n}},85545:function(e,t,n){n.d(t,{Z:function(){return o}});var r=n(9370),i=n(71360),a=n(41295);function o(e,t,n){return t=(0,r.Z)(t),(0,a.Z)(e,(0,i.Z)()?Reflect.construct(t,n||[],(0,r.Z)(e).constructor):t.apply(e,n))}},67505:function(e,t,n){n.d(t,{Z:function(){return o}});var r=n(9370);function i(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=(0,r.Z)(e)););return e}function a(){return a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=i(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},a.apply(null,arguments)}function o(e,t,n,i){var o=a((0,r.Z)(1&i?e.prototype:e),t,n);return 2&i&&"function"==typeof o?function(e){return o.apply(n,e)}:o}}}]);